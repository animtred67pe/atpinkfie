/*
 * PinkFie A Flash Player Emulator in JavaScript ES6
 * 
 * Made By Anim Tred
 */

var PinkFie = (function() {
	var audioContext = new AudioContext();
	var hasTouchEvents = "ontouchstart" in window;
	var config = {
		useWebGL: false,
		debug: false
	}
	var PinkFieLog = function() {
		this._listeners = [];
	}
	PinkFieLog.prototype.subscribe = function(fn) {
		this._listeners.push(fn);
	}
	PinkFieLog.prototype.emit = function(type, messages) {
		if (this._listeners.length) {
			for (var listener of this._listeners) {
				listener[1](listener[0], type, messages);
			}	
		} else {
			console.log.apply(console, messages);
		}
	}
	PinkFieLog.prototype.log = function() {
		this.emit("log", arguments);
	}
	PinkFieLog.prototype.warn = function() {
		this.emit("warn", arguments);
	}
	PinkFieLog.prototype.error = function() {
		this.emit("error", arguments);
	}
	var log = new PinkFieLog();
	var BTreeMap = function() {
		this.lists = [];
	}
	BTreeMap.prototype.values = function() {
		var out = [];
		for (var i = 0; i < this.lists.length; i++) {
			var element = this.lists[i];
			out.push(element[1]);
		}
		return out;
	}
	BTreeMap.prototype.highest = function() {
		var o = this.lists[this.lists.length - 1];
		return o ? o[0] : null;
	}
	BTreeMap.prototype.get = function(idx) {
		for (var i = 0; i < this.lists.length; i++) {
			var list = this.lists[i];
			if (list[0] == idx) {
				return list[1];
			}
		}
		return null;
	}
	BTreeMap.prototype.remove = function(idx) {
		for (var i = 0; i < this.lists.length; i++) {
			var list = this.lists[i];
			if (list[0] == idx) {
				this.lists.splice(i, 1);
				return list[1];
			}
		}
		return null;
	}
	BTreeMap.prototype.insert = function(idx, value) {
		for (var i = 0; i < this.lists.length; i++) {
			var list = this.lists[i];
			if (list[0] == idx) {
				this.lists[i] = [idx, value];
				return list[1];
			} else if (list[0] > idx) {
				this.lists.splice(i, 0, [idx, value]);
				return null;
			}
		}
		this.lists.push([idx, value]);
		return null;
	}
	BTreeMap.prototype.range = function(g1, g2) {
		if (g1 != null) {
			for (var i = 0; i < this.lists.length; i++) {
				var c = this.lists[i];
				if (c[0] !== g1) {
					if (c[0] > g1) {
						return c[1];
					}
				}
			}
		} else if (g2 != null) {
			for (var i = this.lists.length - 1; i >= 0; i--) {
				var c = this.lists[i];
				if (c[0] !== g2) {
					if (c[0] < g2) {
						return c[1];
					}
				}
			}
		}
		return null;
	}
	function multiplicationColor(a, b) {
		return [
			a[0] * b[0],
			a[1] * b[1],
			a[2] * b[2],
			a[3] * b[3],
			a[0] * b[4] + a[4],
			a[1] * b[5] + a[5],
			a[2] * b[6] + a[6],
			a[3] * b[7] + a[7]
		];
	}
	function multiplicationMatrix(a, b) {
		return [
			a[0] * b[0] + a[2] * b[1],
			a[1] * b[0] + a[3] * b[1],
			a[0] * b[2] + a[2] * b[3],
			a[1] * b[2] + a[3] * b[3],
			a[0] * b[4] + a[2] * b[5] + a[4],
			a[1] * b[4] + a[3] * b[5] + a[5]
		];
	}
	function eq_ignore_case(n1, n2) {
		return n1.toLowerCase() == n2.toLowerCase();
	}
	function clampToI32(n) {
		return Math.max(Math.min(n, 2147483647), -2147483648) | 0;
	}
	function parse_array_index(name) {
		var a = +name;
		if (Number.isInteger(a)) {
			return a;
		} else {
			return null;
		}
	}
	
	function string_trim_start_matches(str, pat) {
		var pos = false;
		for (var i = 0; i < str.length; i++) {
			var c = str[i];
			if (c == pat) {
				pos = true;
			} else {
				if (pos) {
					return str.slice(i);
				}
			}
		}
		return str;
	}
	function string_rfind(str, pats) {
		for (var i = str.length - 1; i >= 0; i--) {
			var c = str[i];
			for (var j = 0; j < pats.length; j++) {
				if (c == pats[j]) {
					return i;
				}
			}
		}
		return null;
	}
	function SATURATE(_) {
		return (_ > 255) ? 255 : ((_ < 0) ? 0 : _);
	}
	function yuv420_to_rgba(y, u, v, y_width) {
		var y_height = (y.length / y_width) | 0;
		var chroma_width = ((y_width + 1) / 2) | 0;
		var rgba = new Uint8Array(y.length * 4);
		for (var h = 0; h < y_height; h++) {
			for (var w = 0; w < y_width; w++) {
				var idx = w + h * y_width;
				var chroma_idx = (w >> 1) + (h >> 1) * chroma_width;
				var Y = y[idx] - 16;
				var U = u[chroma_idx] - 128;
				var V = v[chroma_idx] - 128;
				var outputData_pos = w * 4 + y_width * h * 4;
				rgba[outputData_pos] = SATURATE(1.164 * Y + 1.596 * V);
				rgba[outputData_pos + 1] = SATURATE(1.164 * Y - 0.813 * V - 0.391 * U);
				rgba[outputData_pos + 2] = SATURATE(1.164 * Y + 2.018 * U);
				rgba[outputData_pos + 3] = 255;
			}
		}
		return rgba;
	}
	function checkImageColorTransform(colorTransform) {
		return (colorTransform[0] !== 1) || (colorTransform[1] !== 1) || (colorTransform[2] !== 1) || colorTransform[4] || colorTransform[5] || colorTransform[6];
	}
	function generateColorTransform(color, data) {
		return [
			Math.max(0, Math.min((color[0] * data[0]) + data[4], 255)) | 0,
			Math.max(0, Math.min((color[1] * data[1]) + data[5], 255)) | 0,
			Math.max(0, Math.min((color[2] * data[2]) + data[6], 255)) | 0,
			Math.max(0, Math.min((color[3] * 255 * data[3]) + data[7], 255)) / 255
		];		
	}
	function cloneArray(src) {
		var arr = [];
		var length = src.length;
		for (var i = 0; i < length; i++) {
			arr[i] = src[i];
		}
		return arr;
	}
	function object_assign(a, b) {
		var r = {};
		for (var i in a) 
			r[i] = a[i];
		for (var j in b) 
			r[j] = b[j];
		return r;
	};
	(function() { // fixup ES5
		var array_fill = function(_, a, b) {
			var length = this.length;
			var start = a || 0;
			var end = (b == null) ? length : Math.min(b, length);
			for (var i = start; i < end; i++) {
				this[i] = _;
			}
		}
		var array_slice = function(a, b) {
			var length = this.length;
			var start = a || 0;
			var end = (b == null) ? length : Math.min(b, length);
			var len = end - start;
			var result = new this.constructor(len);
			var j = start;
			for (var i = 0; i < len; i++) {
				result[i] = this[j++];
			}
			return result;
		}
		function initA(obj) {
			if (!("slice" in obj)) {
				obj.slice = array_slice;
			}
			if (!("fill" in obj)) {
				obj.fill = array_fill;
			}
		}
		initA(Array.prototype);
		initA(Uint8Array.prototype);
		initA(Int8Array.prototype);
		initA(Uint16Array.prototype);
		initA(Int16Array.prototype);
		initA(Uint32Array.prototype);
		initA(Int32Array.prototype);
		initA(Float32Array.prototype);
		initA(Float64Array.prototype);
	}());
	var Transform = function(matrix, colorTransform) {
		this.matrix = matrix || Matrix.IDENTITY.clone();
		this.colorTransform = colorTransform || [1, 1, 1, 1, 0, 0, 0, 0];
	}
	Transform.prototype.clone = function() {
		return new Transform(this.matrix.clone(), this.colorTransform.slice(0));
	}
	Transform.prototype.toArray = function() {
		return {
			matrix: this.matrix.toArray(),
			colorTransform: this.colorTransform.slice(0)
		}
	}
	var TransformStack = function() {
		this.stack = [new Transform()];
	}
	TransformStack.prototype.stackPush = function(transform) {
		var cur_transform = this.getTransform();
		var matrix = cur_transform.matrix.mul(transform.matrix);
		var colorTransform = multiplicationColor(cur_transform.colorTransform, transform.colorTransform);
		this.stack.push(new Transform(matrix, colorTransform));
	}
	TransformStack.prototype.stackPop = function() {
		this.stack.pop();
	}
	TransformStack.prototype.getTransform = function() {
		return this.stack[this.stack.length - 1];
	}
	var $DataView = new DataView(new ArrayBuffer(8));
	var ByteStream = function(data) {
		this.data = data;
		this.bit_offset = 0;
		this.byte_offset = 0;
	}
	Object.defineProperties(ByteStream.prototype, {
		length: {
			get: function() {
				return this.data.length;
			}
		},
		bytesAvailable: {
			get: function() {
				return this.data.length - this.byte_offset;
			}
		}
	})
	ByteStream.prototype.readString = function(length) {
		var str = "";
		var count = length;
		while (count) {
			var code = this.data[this.byte_offset++];
			str += String.fromCharCode(code);
			count--;
		}
		return str;
	}
	ByteStream.prototype.readBytes = function(length) {
		this.byteAlign();
		var bytes = this.data.subarray(this.byte_offset, this.byte_offset + length);
		this.byte_offset += length;
		return bytes;
	}
	ByteStream.prototype.readBytesNullTerminated = function() {
		this.byteAlign();
		var bo = this.byte_offset;
		var offset = 0;
		var length = this.data.length;
		while (true) {
			var val = this.data[bo + offset];
			offset++;
			if (val === 0 || (bo + offset) >= length) {
				break;
			}
		}
		this.byte_offset = bo + offset;
		return this.data.subarray(bo, bo + offset - 1);
	}
	ByteStream.prototype.readNetBytes = function() {
		var count = this.readUint8();
		var val = [];
		while (count--) {
			var dat = this.data[this.byte_offset++];
			if (dat == 0) continue;
			val.push(dat);
		}
		return new Uint8Array(val);
	}
	ByteStream.prototype.incrementOffset = function(byteInt, bitInt) {
		this.byte_offset += byteInt;
		this.bit_offset += bitInt;
		this.byteCarry();
	}
	ByteStream.prototype.setOffset = function(byteInt, bitInt) {
		this.byte_offset = byteInt;
		this.bit_offset = bitInt;
	}
	ByteStream.prototype.byteAlign = function() {
		if (!this.bit_offset) return;
		this.byte_offset += ((this.bit_offset + 7) / 8) | 0;
		this.bit_offset = 0;
	}
	ByteStream.prototype.readUint8 = function() {
		this.byteAlign();
		return this.data[this.byte_offset++];
	}
	ByteStream.prototype.readUint16 = function() {
		this.byteAlign();
		return this.data[this.byte_offset++] + (this.data[this.byte_offset++] << 8);
	}
	ByteStream.prototype.readUint24 = function() {
		this.byteAlign();
		return this.data[this.byte_offset++] + (this.data[this.byte_offset++] << 8) + (this.data[this.byte_offset++] << 16);
	}
	ByteStream.prototype.readUint32 = function() {
		this.byteAlign();
		return this.readInt32() >>> 0;
	}
	ByteStream.prototype.readUint64 = function() {
		this.byteAlign();
		var n1 = this.readUint32();
		var n2 = this.readUint32();
		return n1 + (Math.pow(2, 32) * n2);
	}
	ByteStream.prototype.readInt8 = function() {
		return this.readUint8() << 24 >> 24;
	}
	ByteStream.prototype.readInt16 = function() {
		return this.readUint16() << 16 >> 16;
	}
	ByteStream.prototype.readInt24 = function() {
		var t = this.readUint24();
		return t >> 23 && (t -= 16777216), t;
	}
	ByteStream.prototype.readInt32 = function() {
		return (this.data[this.byte_offset++] + (this.data[this.byte_offset++] << 8) + (this.data[this.byte_offset++] << 16) + (this.data[this.byte_offset++] << 24));
	}
	ByteStream.prototype.readFixed8 = function() {
		return this.readInt16() / 0x100;
	}
	ByteStream.prototype.readFixed16 = function() {
		return this.readInt32() / 0x10000;
	}
	ByteStream.prototype.readFloat32 = function() {
		var t = this.data[this.byte_offset++];
		var e = this.data[this.byte_offset++];
		var s = this.data[this.byte_offset++];
		var a = 0;
		a |= this.data[this.byte_offset++] << 24, a |= s << 16, a |= e << 8, a |= t << 0;
		var i = a >> 23 & 255;
		return a && 2147483648 !== a ? (2147483648 & a ? -1 : 1) * (8388608 | 8388607 & a) * Math.pow(2, i - 127 - 23) : 0;
	}
	ByteStream.prototype.readDouble = function() {
		$DataView.setFloat64(0, 0);
		for (var t = 0; t < 8; ++t) $DataView.setUint8(t, this.readUint8());
		return $DataView.getFloat64(0, !0);
	}
	ByteStream.prototype.readEncodedU32 = function() {
		this.byteAlign();
		var val = 0;
		var i = 0;
		while (i < 35) {
			var byte = this.readUint8();
			val |= (byte & 0b01111111) << i;
			if ((byte & 0b10000000) == 0) {
				break;
			}
			i += 7;
		}
		return val >>> 0;
	}
	ByteStream.prototype.byteCarry = function() {
		if (this.bit_offset > 7) {
			this.byte_offset += ((this.bit_offset + 7) / 8) | 0;
			this.bit_offset &= 0x07;
		} else {
			while (this.bit_offset < 0) {
				this.byte_offset--;
				this.bit_offset += 8;
			}
		}
	}
	ByteStream.prototype.readUB = function(n) {
		var value = 0;
		while (n--) {
			value <<= 1;
			value |= this.readBit();
		}
		return value >>> 0;
	}
	ByteStream.prototype.readBit = function() {
		var val = (this.data[this.byte_offset] >> (7 - this.bit_offset++)) & 0x1;
		this.byteCarry();
		return val;
	}
	ByteStream.prototype.readSB = function(n) {
		var uval = this.readUB(n);
		var shift = 32 - n;
		return (uval << shift) >> shift;
	}
	ByteStream.prototype.readSBFixed8 = function(n) {
		return this.readSB(n) / 0x100;
	}
	ByteStream.prototype.readSBFixed16 = function(n) {
		return this.readSB(n) / 0x10000;
	}
	var LZMA = (function() {
		function __init(e) {
			var t = [];
			t.push(e[12], e[13], e[14], e[15], e[16], e[4], e[5], e[6], e[7]);
			var s = 8;
			for (var _e = 5; _e < 9; ++_e) {
				if (t[_e] >= s) {
					t[_e] = t[_e] - s | 0;
					break
				}
				t[_e] = 256 + t[_e] - s | 0,s = 1
			}
			t.push(0, 0, 0, 0);
			e.set(t, 4);
			return e.subarray(4);
		}
		function __reverseDecode2(e, t, s, i) {
			var r = 1, o = 0, d = 0;
			for (; d < i; ++d) {
				var _i = s.decodeBit(e, t + r);
				r = r << 1 | _i,o |= _i << d
			}
			return o
		}
		function __decompress(e, t) {
			var s = new Decoder, i = s.decodeHeader(e), r = i.uncompressedSize;
			if (s.setProperties(i),!s.decodeBody(e, t, r))
				throw new Error("Error in lzma data stream");
			return t
		}
		var OutWindow = function() {
			this._buffer = null,
			this._stream = null,
			this._pos = 0,
			this._streamPos = 0,
			this._windowSize = 0
		}
		OutWindow.prototype.create = function(e) {
			this._buffer && this._windowSize === e || (this._buffer = new Uint8Array(e)),
			this._windowSize = e
		}
		OutWindow.prototype.flush = function() {
			var e = this._pos - this._streamPos;
			e && (this._stream.writeBytes(this._buffer, e),
			this._pos >= this._windowSize && (this._pos = 0),
			this._streamPos = this._pos)
		}
		OutWindow.prototype.releaseStream = function() {
			this.flush(),
			this._stream = null
		}
		OutWindow.prototype.setStream = function(e) {
			this._stream = e
		}
		OutWindow.prototype.init = function(_) {
			var e = (_ == null) ? false : _;
			e || (this._streamPos = 0,this._pos = 0)
		}
		OutWindow.prototype.copyBlock = function(e, t) {
			var s = this._pos - e - 1;
			for (s < 0 && (s += this._windowSize); t--; )
				s >= this._windowSize && (s = 0),
				this._buffer[this._pos++] = this._buffer[s++],
				this._pos >= this._windowSize && this.flush()
		}
		OutWindow.prototype.putByte = function(e) {
			this._buffer[this._pos++] = e,
			this._pos >= this._windowSize && this.flush()
		}
		OutWindow.prototype.getByte = function(e) {
			var t = this._pos - e - 1;
			return t < 0 && (t += this._windowSize),this._buffer[t]
		}
		var RangeDecoder = function() {
			this._stream = null,
			this._code = 0,
			this._range = -1
		}
		RangeDecoder.prototype.setStream = function(e) {
			this._stream = e
		}
		RangeDecoder.prototype.releaseStream = function() {
			this._stream = null
		}
		RangeDecoder.prototype.init = function() {
			var e = 5;
			for (this._code = 0,this._range = -1; e--; ) this._code = this._code << 8 | this._stream.readByte()
		}
		RangeDecoder.prototype.decodeDirectBits = function(e) {
			var t = 0, s = e;
			for (; s--; ) {
				this._range >>>= 1;
				var _e = this._code - this._range >>> 31;
				this._code -= this._range & _e - 1,t = t << 1 | 1 - _e,0 == (4278190080 & this._range) && (this._code = this._code << 8 | this._stream.readByte(),this._range <<= 8)
			}
			return t
		}
		RangeDecoder.prototype.decodeBit = function(e, t) {
			var s = e[t], i = (this._range >>> 11) * s;
			return (2147483648 ^ this._code) < (2147483648 ^ i) ? (this._range = i,e[t] += 2048 - s >>> 5,0 == (4278190080 & this._range) && (this._code = this._code << 8 | this._stream.readByte(),this._range <<= 8),0) : (this._range -= i,this._code -= i,e[t] -= s >>> 5,0 == (4278190080 & this._range) && (this._code = this._code << 8 | this._stream.readByte(),this._range <<= 8),1)
		}
		var BitTreeDecoder = function(e) {
			this._models = Array(1 << e).fill(1024),
			this._numBitLevels = e
		}
		BitTreeDecoder.prototype.decode = function(e) {
			var t = 1, s = this._numBitLevels;
			for (; s--; )t = t << 1 | e.decodeBit(this._models, t);
			return t - (1 << this._numBitLevels)
		}
		BitTreeDecoder.prototype.reverseDecode = function(e) {
			var t = 1, s = 0, i = 0;
			for (; i < this._numBitLevels; ++i) {
				var r = e.decodeBit(this._models, t);
				t = t << 1 | r,s |= r << i
			}
			return s
		}
		var LenDecoder = function() {
			this._choice = [1024, 1024],
			this._lowCoder = [],
			this._midCoder = [],
			this._highCoder = new BitTreeDecoder(8),
			this._numPosStates = 0
		}
		LenDecoder.prototype.create = function(e) {
			for (; this._numPosStates < e; ++this._numPosStates) this._lowCoder[this._numPosStates] = new BitTreeDecoder(3),this._midCoder[this._numPosStates] = new BitTreeDecoder(3)
		}
		LenDecoder.prototype.decode = function(e, t) {
			return 0 === e.decodeBit(this._choice, 0) ? this._lowCoder[t].decode(e) : 0 === e.decodeBit(this._choice, 1) ? 8 + this._midCoder[t].decode(e) : 16 + this._highCoder.decode(e)
		}
		var Decoder2 = function() {
			this._decoders = Array(768).fill(1024)
		}
		Decoder2.prototype.decodeNormal = function(e) {
			var t = 1;
			do {
				t = t << 1 | e.decodeBit(this._decoders, t)
			} while (t < 256);
			return 255 & t
		}
		Decoder2.prototype.decodeWithMatchByte = function(e, t) {
			var s = 1;
			do {
				var i = t >> 7 & 1;
				t <<= 1;
				var r = e.decodeBit(this._decoders, (1 + i << 8) + s);
				if (s = s << 1 | r,i !== r) {
					for (; s < 256; )s = s << 1 | e.decodeBit(this._decoders, s);
					break
				}
			} while (s < 256);
			return 255 & s
		}
		var LiteralDecoder = function() {}
		LiteralDecoder.prototype.create = function(e, t) {
			if (this._coders && this._numPrevBits === t && this._numPosBits === e) return;
			this._numPosBits = e,
			this._posMask = (1 << e) - 1,
			this._numPrevBits = t,
			this._coders = [];
			var s = 1 << this._numPrevBits + this._numPosBits;
			for (; s--; )this._coders[s] = new Decoder2
		}
		LiteralDecoder.prototype.getDecoder = function(e, t) {
			return this._coders[((e & this._posMask) << this._numPrevBits) + ((255 & t) >>> 8 - this._numPrevBits)]
		}
		var Decoder = function() {
			this._outWindow = new OutWindow,
			this._rangeDecoder = new RangeDecoder,
			this._isMatchDecoders = Array(192).fill(1024),
			this._isRepDecoders = Array(12).fill(1024),
			this._isRepG0Decoders = Array(12).fill(1024),
			this._isRepG1Decoders = Array(12).fill(1024),
			this._isRepG2Decoders = Array(12).fill(1024),
			this._isRep0LongDecoders = Array(192).fill(1024),
			this._posDecoders = Array(114).fill(1024),
			this._posAlignDecoder = new BitTreeDecoder(4),
			this._lenDecoder = new LenDecoder,
			this._repLenDecoder = new LenDecoder,
			this._literalDecoder = new LiteralDecoder,
			this._dictionarySize = -1,
			this._dictionarySizeCheck = -1,
			this._posSlotDecoder = [new BitTreeDecoder(6), new BitTreeDecoder(6), new BitTreeDecoder(6), new BitTreeDecoder(6)]
		}
		Decoder.prototype.setDictionarySize = function(e) {
			return !(e < 0) && (this._dictionarySize !== e && (this._dictionarySize = e,this._dictionarySizeCheck = Math.max(this._dictionarySize, 1),this._outWindow.create(Math.max(this._dictionarySizeCheck, 4096))),!0)
		}
		Decoder.prototype.setLcLpPb = function(e, t, s) {
			if (e > 8 || t > 4 || s > 4)return !1;
			var i = 1 << s;
			return this._literalDecoder.create(t, e),this._lenDecoder.create(i),this._repLenDecoder.create(i),this._posStateMask = i - 1,!0
		}
		Decoder.prototype.setProperties = function(e) {
			if (!this.setLcLpPb(e.lc, e.lp, e.pb))throw Error("Incorrect stream properties");
			if (!this.setDictionarySize(e.dictionarySize))throw Error("Invalid dictionary size")
		}
		Decoder.prototype.decodeHeader = function(e) {
			if (e._$size < 13)return !1;
			var t = e.readByte();
			var s = t % 9;
			t = ~~(t / 9);
			var i = t % 5, r = ~~(t / 5);
			var o = e.readByte();
			o |= e.readByte() << 8,o |= e.readByte() << 16,o += 16777216 * e.readByte();
			var d = e.readByte();
			return d |= e.readByte() << 8,d |= e.readByte() << 16,d += 16777216 * e.readByte(),e.readByte(),e.readByte(),e.readByte(),e.readByte(),{lc: s,lp: i,pb: r,dictionarySize: o,uncompressedSize: d}
		}
		Decoder.prototype.decodeBody = function(e, t, s) {
			var i, r, o = 0, d = 0, h = 0, c = 0, n = 0, _ = 0, a = 0;
			for (this._rangeDecoder.setStream(e),this._rangeDecoder.init(),this._outWindow.setStream(t),this._outWindow.init(!1); _ < s; ) {
				var _e1 = _ & this._posStateMask;
				if (0 === this._rangeDecoder.decodeBit(this._isMatchDecoders, (o << 4) + _e1)) {
					var _e = this._literalDecoder.getDecoder(_++, a);
					a = o >= 7 ? _e.decodeWithMatchByte(this._rangeDecoder, this._outWindow.getByte(d)) : _e.decodeNormal(this._rangeDecoder),this._outWindow.putByte(a),o = o < 4 ? 0 : o - (o < 10 ? 3 : 6)
				} else {
					if (1 === this._rangeDecoder.decodeBit(this._isRepDecoders, o))i = 0,0 === this._rangeDecoder.decodeBit(this._isRepG0Decoders, o) ? 0 === this._rangeDecoder.decodeBit(this._isRep0LongDecoders, (o << 4) + _e1) && (o = o < 7 ? 9 : 11,i = 1) : (0 === this._rangeDecoder.decodeBit(this._isRepG1Decoders, o) ? r = h : (0 === this._rangeDecoder.decodeBit(this._isRepG2Decoders, o) ? r = c : (r = n,n = c),c = h),h = d,d = r),0 === i && (i = 2 + this._repLenDecoder.decode(this._rangeDecoder, _e1),o = o < 7 ? 8 : 11);
					else {
						n = c,c = h,h = d,i = 2 + this._lenDecoder.decode(this._rangeDecoder, _e1),o = o < 7 ? 7 : 10;
						var _t = this._posSlotDecoder[i <= 5 ? i - 2 : 3].decode(this._rangeDecoder);
						if (_t >= 4) {
							var __e = (_t >> 1) - 1;
							if (d = (2 | 1 & _t) << __e,_t < 14)d += __reverseDecode2(this._posDecoders, d - _t - 1, this._rangeDecoder, __e);
							else if (d += this._rangeDecoder.decodeDirectBits(__e - 4) << 4,d += this._posAlignDecoder.reverseDecode(this._rangeDecoder),d < 0) {
								if (-1 === d)break;
								return !1
							}
						} else d = _t
					}
					if (d >= _ || d >= this._dictionarySizeCheck)return !1;
					this._outWindow.copyBlock(d, i),_ += i,a = this._outWindow.getByte(0)
				}
			}
			return this._outWindow.releaseStream(),this._rangeDecoder.releaseStream(),!0
		}
		var InStream = function(e) {
			this._$data = e;
			this._$size = e.length;
			this._$offset = 0;
		}
		InStream.prototype.readByte = function() {
			return this._$data[this._$offset++];
		}
		var OutStream = function(e) {
			this.size = 0;
			this.buffers = e;
		}
		OutStream.prototype.writeBytes = function(e, t) {
			if (e.length === t) {
				this.buffers.set(e, this.size);
			} else {
				this.buffers.set(e.subarray(0, t), this.size);
			}
			this.size += t;
		}
		return {
			parse: function (data, fileLength) {
				var s = data.slice(0);
				var i = new Uint8Array(fileLength);
				__decompress(new InStream(__init(s)), new OutStream(i));
				return i
			}
		};
	}());

	var pako = (function(e,t){var _={};"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(_);return _}(this,(function(e){var t=function(e,t,i,n){for(var a=65535&e|0,r=e>>>16&65535|0,o=0;0!==i;){i-=o=i>2e3?2e3:i;do{r=r+(a=a+t[n++]|0)|0}while(--o);a%=65521,r%=65521}return a|r<<16|0},i=new Uint32Array(function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}()),n=function(e,t,n,a){var r=i,o=a+n;e^=-1;for(var s=a;s<o;s++)e=e>>>8^r[255&(e^t[s])];return-1^e},a=16209,r=function(e,t){var i,n,r,o,s,l,f,d,h,c,u,w,b,m,k,_,v,g,p,y,x,E,R,A,Z=e.state;i=e.next_in,R=e.input,n=i+(e.avail_in-5),r=e.next_out,A=e.output,o=r-(t-e.avail_out),s=r+(e.avail_out-257),l=Z.dmax,f=Z.wsize,d=Z.whave,h=Z.wnext,c=Z.window,u=Z.hold,w=Z.bits,b=Z.lencode,m=Z.distcode,k=(1<<Z.lenbits)-1,_=(1<<Z.distbits)-1;e:do{w<15&&(u+=R[i++]<<w,w+=8,u+=R[i++]<<w,w+=8),v=b[u&k];t:for(;;){if(u>>>=g=v>>>24,w-=g,0===(g=v>>>16&255))A[r++]=65535&v;else{if(!(16&g)){if(0==(64&g)){v=b[(65535&v)+(u&(1<<g)-1)];continue t}if(32&g){Z.mode=16191;break e}e.msg="invalid literal/length code",Z.mode=a;break e}p=65535&v,(g&=15)&&(w<g&&(u+=R[i++]<<w,w+=8),p+=u&(1<<g)-1,u>>>=g,w-=g),w<15&&(u+=R[i++]<<w,w+=8,u+=R[i++]<<w,w+=8),v=m[u&_];i:for(;;){if(u>>>=g=v>>>24,w-=g,!(16&(g=v>>>16&255))){if(0==(64&g)){v=m[(65535&v)+(u&(1<<g)-1)];continue i}e.msg="invalid distance code",Z.mode=a;break e}if(y=65535&v,w<(g&=15)&&(u+=R[i++]<<w,(w+=8)<g&&(u+=R[i++]<<w,w+=8)),(y+=u&(1<<g)-1)>l){e.msg="invalid distance too far back",Z.mode=a;break e}if(u>>>=g,w-=g,y>(g=r-o)){if((g=y-g)>d&&Z.sane){e.msg="invalid distance too far back",Z.mode=a;break e}if(x=0,E=c,0===h){if(x+=f-g,g<p){p-=g;do{A[r++]=c[x++]}while(--g);x=r-y,E=A}}else if(h<g){if(x+=f+h-g,(g-=h)<p){p-=g;do{A[r++]=c[x++]}while(--g);if(x=0,h<p){p-=g=h;do{A[r++]=c[x++]}while(--g);x=r-y,E=A}}}else if(x+=h-g,g<p){p-=g;do{A[r++]=c[x++]}while(--g);x=r-y,E=A}for(;p>2;)A[r++]=E[x++],A[r++]=E[x++],A[r++]=E[x++],p-=3;p&&(A[r++]=E[x++],p>1&&(A[r++]=E[x++]))}else{x=r-y;do{A[r++]=A[x++],A[r++]=A[x++],A[r++]=A[x++],p-=3}while(p>2);p&&(A[r++]=A[x++],p>1&&(A[r++]=A[x++]))}break}}break}}while(i<n&&r<s);i-=p=w>>3,u&=(1<<(w-=p<<3))-1,e.next_in=i,e.next_out=r,e.avail_in=i<n?n-i+5:5-(i-n),e.avail_out=r<s?s-r+257:257-(r-s),Z.hold=u,Z.bits=w},o=15,s=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),l=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),f=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),d=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),h=function(e,t,i,n,a,r,h,c){var u,w,b,m,k,_,v,g,p,y=c.bits,x=0,E=0,R=0,A=0,Z=0,S=0,T=0,O=0,U=0,D=0,I=null,B=new Uint16Array(16),N=new Uint16Array(16),C=null;for(x=0;x<=o;x++)B[x]=0;for(E=0;E<n;E++)B[t[i+E]]++;for(Z=y,A=o;A>=1&&0===B[A];A--);if(Z>A&&(Z=A),0===A)return a[r++]=20971520,a[r++]=20971520,c.bits=1,0;for(R=1;R<A&&0===B[R];R++);for(Z<R&&(Z=R),O=1,x=1;x<=o;x++)if(O<<=1,(O-=B[x])<0)return-1;if(O>0&&(0===e||1!==A))return-1;for(N[1]=0,x=1;x<o;x++)N[x+1]=N[x]+B[x];for(E=0;E<n;E++)0!==t[i+E]&&(h[N[t[i+E]]++]=E);if(0===e?(I=C=h,_=20):1===e?(I=s,C=l,_=257):(I=f,C=d,_=0),D=0,E=0,x=R,k=r,S=Z,T=0,b=-1,m=(U=1<<Z)-1,1===e&&U>852||2===e&&U>592)return 1;for(;;){v=x-T,h[E]+1<_?(g=0,p=h[E]):h[E]>=_?(g=C[h[E]-_],p=I[h[E]-_]):(g=96,p=0),u=1<<x-T,R=w=1<<S;do{a[k+(D>>T)+(w-=u)]=v<<24|g<<16|p|0}while(0!==w);for(u=1<<x-1;D&u;)u>>=1;if(0!==u?(D&=u-1,D+=u):D=0,E++,0==--B[x]){if(x===A)break;x=t[i+h[E]]}if(x>Z&&(D&m)!==b){for(0===T&&(T=Z),k+=R,O=1<<(S=x-T);S+T<A&&!((O-=B[S+T])<=0);)S++,O<<=1;if(U+=1<<S,1===e&&U>852||2===e&&U>592)return 1;a[b=D&m]=Z<<24|S<<16|k-r|0}}return 0!==D&&(a[k+D]=x-T<<24|64<<16|0),c.bits=Z,0},c={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},u=c.Z_FINISH,w=c.Z_BLOCK,b=c.Z_TREES,m=c.Z_OK,k=c.Z_STREAM_END,_=c.Z_NEED_DICT,v=c.Z_STREAM_ERROR,g=c.Z_DATA_ERROR,p=c.Z_MEM_ERROR,y=c.Z_BUF_ERROR,x=c.Z_DEFLATED,E=16180,R=16190,A=16191,Z=16192,S=16194,T=16199,O=16200,U=16206,D=16209,I=function(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)};function B(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var N,C,z=function(e){if(!e)return 1;var t=e.state;return!t||t.strm!==e||t.mode<E||t.mode>16211?1:0},F=function(e){if(z(e))return v;var t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=E,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,m},L=function(e){if(z(e))return v;var t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,F(e)},M=function(e,t){var i;if(z(e))return v;var n=e.state;return t<0?(i=0,t=-t):(i=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?v:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,L(e))},H=function(e,t){if(!e)return v;var i=new B;e.state=i,i.strm=e,i.window=null,i.mode=E;var n=M(e,t);return n!==m&&(e.state=null),n},j=!0,K=function(e){if(j){N=new Int32Array(512),C=new Int32Array(32);for(var t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(h(1,e.lens,0,288,N,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;h(2,e.lens,0,32,C,0,e.work,{bits:5}),j=!1}e.lencode=N,e.lenbits=9,e.distcode=C,e.distbits=5},P=function(e,t,i,n){var a,r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),n>=r.wsize?(r.window.set(t.subarray(i-r.wsize,i),0),r.wnext=0,r.whave=r.wsize):((a=r.wsize-r.wnext)>n&&(a=n),r.window.set(t.subarray(i-n,i-n+a),r.wnext),(n-=a)?(r.window.set(t.subarray(i-n,i),0),r.wnext=n,r.whave=r.wsize):(r.wnext+=a,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=a))),0},Y={inflateReset:L,inflateReset2:M,inflateResetKeep:F,inflateInit:function(e){return H(e,15)},inflateInit2:H,inflate:function(e,i){var a,o,s,l,f,d,c,B,N,C,F,L,M,H,j,Y,G,X,W,q,J,Q,V,$,ee=0,te=new Uint8Array(4),ie=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(z(e)||!e.output||!e.input&&0!==e.avail_in)return v;(a=e.state).mode===A&&(a.mode=Z),f=e.next_out,s=e.output,c=e.avail_out,l=e.next_in,o=e.input,d=e.avail_in,B=a.hold,N=a.bits,C=d,F=c,Q=m;e:for(;;)switch(a.mode){case E:if(0===a.wrap){a.mode=Z;break}for(;N<16;){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}if(2&a.wrap&&35615===B){0===a.wbits&&(a.wbits=15),a.check=0,te[0]=255&B,te[1]=B>>>8&255,a.check=n(a.check,te,2,0),B=0,N=0,a.mode=16181;break}if(a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&B)<<8)+(B>>8))%31){e.msg="incorrect header check",a.mode=D;break}if((15&B)!==x){e.msg="unknown compression method",a.mode=D;break}if(N-=4,J=8+(15&(B>>>=4)),0===a.wbits&&(a.wbits=J),J>15||J>a.wbits){e.msg="invalid window size",a.mode=D;break}a.dmax=1<<a.wbits,a.flags=0,e.adler=a.check=1,a.mode=512&B?16189:A,B=0,N=0;break;case 16181:for(;N<16;){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}if(a.flags=B,(255&a.flags)!==x){e.msg="unknown compression method",a.mode=D;break}if(57344&a.flags){e.msg="unknown header flags set",a.mode=D;break}a.head&&(a.head.text=B>>8&1),512&a.flags&&4&a.wrap&&(te[0]=255&B,te[1]=B>>>8&255,a.check=n(a.check,te,2,0)),B=0,N=0,a.mode=16182;case 16182:for(;N<32;){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}a.head&&(a.head.time=B),512&a.flags&&4&a.wrap&&(te[0]=255&B,te[1]=B>>>8&255,te[2]=B>>>16&255,te[3]=B>>>24&255,a.check=n(a.check,te,4,0)),B=0,N=0,a.mode=16183;case 16183:for(;N<16;){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}a.head&&(a.head.xflags=255&B,a.head.os=B>>8),512&a.flags&&4&a.wrap&&(te[0]=255&B,te[1]=B>>>8&255,a.check=n(a.check,te,2,0)),B=0,N=0,a.mode=16184;case 16184:if(1024&a.flags){for(;N<16;){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}a.length=B,a.head&&(a.head.extra_len=B),512&a.flags&&4&a.wrap&&(te[0]=255&B,te[1]=B>>>8&255,a.check=n(a.check,te,2,0)),B=0,N=0}else a.head&&(a.head.extra=null);a.mode=16185;case 16185:if(1024&a.flags&&((L=a.length)>d&&(L=d),L&&(a.head&&(J=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Uint8Array(a.head.extra_len)),a.head.extra.set(o.subarray(l,l+L),J)),512&a.flags&&4&a.wrap&&(a.check=n(a.check,o,L,l)),d-=L,l+=L,a.length-=L),a.length))break e;a.length=0,a.mode=16186;case 16186:if(2048&a.flags){if(0===d)break e;L=0;do{J=o[l+L++],a.head&&J&&a.length<65536&&(a.head.name+=String.fromCharCode(J))}while(J&&L<d);if(512&a.flags&&4&a.wrap&&(a.check=n(a.check,o,L,l)),d-=L,l+=L,J)break e}else a.head&&(a.head.name=null);a.length=0,a.mode=16187;case 16187:if(4096&a.flags){if(0===d)break e;L=0;do{J=o[l+L++],a.head&&J&&a.length<65536&&(a.head.comment+=String.fromCharCode(J))}while(J&&L<d);if(512&a.flags&&4&a.wrap&&(a.check=n(a.check,o,L,l)),d-=L,l+=L,J)break e}else a.head&&(a.head.comment=null);a.mode=16188;case 16188:if(512&a.flags){for(;N<16;){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}if(4&a.wrap&&B!==(65535&a.check)){e.msg="header crc mismatch",a.mode=D;break}B=0,N=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),e.adler=a.check=0,a.mode=A;break;case 16189:for(;N<32;){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}e.adler=a.check=I(B),B=0,N=0,a.mode=R;case R:if(0===a.havedict)return e.next_out=f,e.avail_out=c,e.next_in=l,e.avail_in=d,a.hold=B,a.bits=N,_;e.adler=a.check=1,a.mode=A;case A:if(i===w||i===b)break e;case Z:if(a.last){B>>>=7&N,N-=7&N,a.mode=U;break}for(;N<3;){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}switch(a.last=1&B,N-=1,3&(B>>>=1)){case 0:a.mode=16193;break;case 1:if(K(a),a.mode=T,i===b){B>>>=2,N-=2;break e}break;case 2:a.mode=16196;break;case 3:e.msg="invalid block type",a.mode=D}B>>>=2,N-=2;break;case 16193:for(B>>>=7&N,N-=7&N;N<32;){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}if((65535&B)!=(B>>>16^65535)){e.msg="invalid stored block lengths",a.mode=D;break}if(a.length=65535&B,B=0,N=0,a.mode=S,i===b)break e;case S:a.mode=16195;case 16195:if(L=a.length){if(L>d&&(L=d),L>c&&(L=c),0===L)break e;s.set(o.subarray(l,l+L),f),d-=L,l+=L,c-=L,f+=L,a.length-=L;break}a.mode=A;break;case 16196:for(;N<14;){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}if(a.nlen=257+(31&B),B>>>=5,N-=5,a.ndist=1+(31&B),B>>>=5,N-=5,a.ncode=4+(15&B),B>>>=4,N-=4,a.nlen>286||a.ndist>30){e.msg="too many length or distance symbols",a.mode=D;break}a.have=0,a.mode=16197;case 16197:for(;a.have<a.ncode;){for(;N<3;){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}a.lens[ie[a.have++]]=7&B,B>>>=3,N-=3}for(;a.have<19;)a.lens[ie[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,V={bits:a.lenbits},Q=h(0,a.lens,0,19,a.lencode,0,a.work,V),a.lenbits=V.bits,Q){e.msg="invalid code lengths set",a.mode=D;break}a.have=0,a.mode=16198;case 16198:for(;a.have<a.nlen+a.ndist;){for(;Y=(ee=a.lencode[B&(1<<a.lenbits)-1])>>>16&255,G=65535&ee,!((j=ee>>>24)<=N);){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}if(G<16)B>>>=j,N-=j,a.lens[a.have++]=G;else{if(16===G){for($=j+2;N<$;){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}if(B>>>=j,N-=j,0===a.have){e.msg="invalid bit length repeat",a.mode=D;break}J=a.lens[a.have-1],L=3+(3&B),B>>>=2,N-=2}else if(17===G){for($=j+3;N<$;){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}N-=j,J=0,L=3+(7&(B>>>=j)),B>>>=3,N-=3}else{for($=j+7;N<$;){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}N-=j,J=0,L=11+(127&(B>>>=j)),B>>>=7,N-=7}if(a.have+L>a.nlen+a.ndist){e.msg="invalid bit length repeat",a.mode=D;break}for(;L--;)a.lens[a.have++]=J}}if(a.mode===D)break;if(0===a.lens[256]){e.msg="invalid code -- missing end-of-block",a.mode=D;break}if(a.lenbits=9,V={bits:a.lenbits},Q=h(1,a.lens,0,a.nlen,a.lencode,0,a.work,V),a.lenbits=V.bits,Q){e.msg="invalid literal/lengths set",a.mode=D;break}if(a.distbits=6,a.distcode=a.distdyn,V={bits:a.distbits},Q=h(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,V),a.distbits=V.bits,Q){e.msg="invalid distances set",a.mode=D;break}if(a.mode=T,i===b)break e;case T:a.mode=O;case O:if(d>=6&&c>=258){e.next_out=f,e.avail_out=c,e.next_in=l,e.avail_in=d,a.hold=B,a.bits=N,r(e,F),f=e.next_out,s=e.output,c=e.avail_out,l=e.next_in,o=e.input,d=e.avail_in,B=a.hold,N=a.bits,a.mode===A&&(a.back=-1);break}for(a.back=0;Y=(ee=a.lencode[B&(1<<a.lenbits)-1])>>>16&255,G=65535&ee,!((j=ee>>>24)<=N);){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}if(Y&&0==(240&Y)){for(X=j,W=Y,q=G;Y=(ee=a.lencode[q+((B&(1<<X+W)-1)>>X)])>>>16&255,G=65535&ee,!(X+(j=ee>>>24)<=N);){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}B>>>=X,N-=X,a.back+=X}if(B>>>=j,N-=j,a.back+=j,a.length=G,0===Y){a.mode=16205;break}if(32&Y){a.back=-1,a.mode=A;break}if(64&Y){e.msg="invalid literal/length code",a.mode=D;break}a.extra=15&Y,a.mode=16201;case 16201:if(a.extra){for($=a.extra;N<$;){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}a.length+=B&(1<<a.extra)-1,B>>>=a.extra,N-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=16202;case 16202:for(;Y=(ee=a.distcode[B&(1<<a.distbits)-1])>>>16&255,G=65535&ee,!((j=ee>>>24)<=N);){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}if(0==(240&Y)){for(X=j,W=Y,q=G;Y=(ee=a.distcode[q+((B&(1<<X+W)-1)>>X)])>>>16&255,G=65535&ee,!(X+(j=ee>>>24)<=N);){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}B>>>=X,N-=X,a.back+=X}if(B>>>=j,N-=j,a.back+=j,64&Y){e.msg="invalid distance code",a.mode=D;break}a.offset=G,a.extra=15&Y,a.mode=16203;case 16203:if(a.extra){for($=a.extra;N<$;){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}a.offset+=B&(1<<a.extra)-1,B>>>=a.extra,N-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){e.msg="invalid distance too far back",a.mode=D;break}a.mode=16204;case 16204:if(0===c)break e;if(L=F-c,a.offset>L){if((L=a.offset-L)>a.whave&&a.sane){e.msg="invalid distance too far back",a.mode=D;break}L>a.wnext?(L-=a.wnext,M=a.wsize-L):M=a.wnext-L,L>a.length&&(L=a.length),H=a.window}else H=s,M=f-a.offset,L=a.length;L>c&&(L=c),c-=L,a.length-=L;do{s[f++]=H[M++]}while(--L);0===a.length&&(a.mode=O);break;case 16205:if(0===c)break e;s[f++]=a.length,c--,a.mode=O;break;case U:if(a.wrap){for(;N<32;){if(0===d)break e;d--,B|=o[l++]<<N,N+=8}if(F-=c,e.total_out+=F,a.total+=F,4&a.wrap&&F&&(e.adler=a.check=a.flags?n(a.check,s,F,f-F):t(a.check,s,F,f-F)),F=c,4&a.wrap&&(a.flags?B:I(B))!==a.check){e.msg="incorrect data check",a.mode=D;break}B=0,N=0}a.mode=16207;case 16207:if(a.wrap&&a.flags){for(;N<32;){if(0===d)break e;d--,B+=o[l++]<<N,N+=8}if(4&a.wrap&&B!==(4294967295&a.total)){e.msg="incorrect length check",a.mode=D;break}B=0,N=0}a.mode=16208;case 16208:Q=k;break e;case D:Q=g;break e;case 16210:return p;default:return v}return e.next_out=f,e.avail_out=c,e.next_in=l,e.avail_in=d,a.hold=B,a.bits=N,(a.wsize||F!==e.avail_out&&a.mode<D&&(a.mode<U||i!==u))&&P(e,e.output,e.next_out,F-e.avail_out),C-=e.avail_in,F-=e.avail_out,e.total_in+=C,e.total_out+=F,a.total+=F,4&a.wrap&&F&&(e.adler=a.check=a.flags?n(a.check,s,F,e.next_out-F):t(a.check,s,F,e.next_out-F)),e.data_type=a.bits+(a.last?64:0)+(a.mode===A?128:0)+(a.mode===T||a.mode===S?256:0),(0===C&&0===F||i===u)&&Q===m&&(Q=y),Q},inflateEnd:function(e){if(z(e))return v;var t=e.state;return t.window&&(t.window=null),e.state=null,m},inflateGetHeader:function(e,t){if(z(e))return v;var i=e.state;return 0==(2&i.wrap)?v:(i.head=t,t.done=!1,m)},inflateSetDictionary:function(e,i){var n,a=i.length;return z(e)||0!==(n=e.state).wrap&&n.mode!==R?v:n.mode===R&&t(1,i,a,0)!==n.check?g:P(e,i,a,a)?(n.mode=16210,p):(n.havedict=1,m)},inflateInfo:"pako inflate (from Nodeca project)"};function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}var X=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},W=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!==G(i))throw new TypeError(i+"must be non-object");for(var n in i)X(i,n)&&(e[n]=i[n])}}return e},q=function(e){for(var t=0,i=0,n=e.length;i<n;i++)t+=e[i].length;for(var a=new Uint8Array(t),r=0,o=0,s=e.length;r<s;r++){var l=e[r];a.set(l,o),o+=l.length}return a},J=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){J=!1}for(var Q=new Uint8Array(256),V=0;V<256;V++)Q[V]=V>=252?6:V>=248?5:V>=240?4:V>=224?3:V>=192?2:1;Q[254]=Q[254]=1;var $=function(e){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);var t,i,n,a,r,o=e.length,s=0;for(a=0;a<o;a++)55296==(64512&(i=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(n=e.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(n-56320),a++),s+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(s),r=0,a=0;r<s;a++)55296==(64512&(i=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(n=e.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(n-56320),a++),i<128?t[r++]=i:i<2048?(t[r++]=192|i>>>6,t[r++]=128|63&i):i<65536?(t[r++]=224|i>>>12,t[r++]=128|i>>>6&63,t[r++]=128|63&i):(t[r++]=240|i>>>18,t[r++]=128|i>>>12&63,t[r++]=128|i>>>6&63,t[r++]=128|63&i);return t},ee=function(e,t){var i,n,a=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));var r=new Array(2*a);for(n=0,i=0;i<a;){var o=e[i++];if(o<128)r[n++]=o;else{var s=Q[o];if(s>4)r[n++]=65533,i+=s-1;else{for(o&=2===s?31:3===s?15:7;s>1&&i<a;)o=o<<6|63&e[i++],s--;s>1?r[n++]=65533:o<65536?r[n++]=o:(o-=65536,r[n++]=55296|o>>10&1023,r[n++]=56320|1023&o)}}}return function(e,t){if(t<65534&&e.subarray&&J)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));for(var i="",n=0;n<t;n++)i+=String.fromCharCode(e[n]);return i}(r,n)},te=function(e,t){(t=t||e.length)>e.length&&(t=e.length);for(var i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+Q[e[i]]>t?i:t},ie={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};var ne=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};var ae=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},re=Object.prototype.toString,oe=c.Z_NO_FLUSH,se=c.Z_FINISH,le=c.Z_OK,fe=c.Z_STREAM_END,de=c.Z_NEED_DICT,he=c.Z_STREAM_ERROR,ce=c.Z_DATA_ERROR,ue=c.Z_MEM_ERROR;function we(e){this.options=W({chunkSize:65536,windowBits:15,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ne,this.strm.avail_out=0;var i=Y.inflateInit2(this.strm,t.windowBits);if(i!==le)throw new Error(ie[i]);if(this.header=new ae,Y.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=$(t.dictionary):"[object ArrayBuffer]"===re.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=Y.inflateSetDictionary(this.strm,t.dictionary))!==le))throw new Error(ie[i])}function be(e,t){var i=new we(t);if(i.push(e),i.err)throw i.msg||ie[i.err];return i.result}we.prototype.push=function(e,t){var i,n,a,r=this.strm,o=this.options.chunkSize,s=this.options.dictionary;if(this.ended)return!1;for(n=t===~~t?t:!0===t?se:oe,"[object ArrayBuffer]"===re.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(o),r.next_out=0,r.avail_out=o),(i=Y.inflate(r,n))===de&&s&&((i=Y.inflateSetDictionary(r,s))===le?i=Y.inflate(r,n):i===ce&&(i=de));r.avail_in>0&&i===fe&&r.state.wrap>0&&0!==e[r.next_in];)Y.inflateReset(r),i=Y.inflate(r,n);switch(i){case he:case ce:case de:case ue:return this.onEnd(i),this.ended=!0,!1}if(a=r.avail_out,r.next_out&&(0===r.avail_out||i===fe))if("string"===this.options.to){var l=te(r.output,r.next_out),f=r.next_out-l,d=ee(r.output,l);r.next_out=f,r.avail_out=o-f,f&&r.output.set(r.output.subarray(l,l+f),0),this.onData(d)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(i!==le||0!==a){if(i===fe)return i=Y.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},we.prototype.onData=function(e){this.chunks.push(e)},we.prototype.onEnd=function(e){e===le&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=q(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var me=we,ke=be,_e=function(e,t){return(t=t||{}).raw=!0,be(e,t)},ve=be,ge=c,pe={Inflate:me,inflate:ke,inflateRaw:_e,ungzip:ve,constants:ge};e.Inflate=me,e.constants=ge,e.default=pe,e.inflate=ke,e.inflateRaw=_e,e.ungzip=ve,Object.defineProperty(e,"__esModule",{value:!0})})));

	/* 
	 * ANIM TRED NELLYMOSER ASAO IN JAVASCRIPT ES5
	 */
	var AT_ASAO=(function(){var _1=function(){this.bytePos=0,this.bitPos=0};_1.prototype.push=function(val,len,buf){if(this.bitPos==0)buf[this.bytePos]=val;else buf[this.bytePos]|=val<<this.bitPos;this.bitPos+=len;if(this.bitPos>=8){this.bytePos++,this.bitPos-=8;if(this.bitPos>0)buf[this.bytePos]=(val>>(len-this.bitPos))}},_1.prototype.pop=function(a,b){var c=(b[this.bytePos]&0xff)>>this.bitPos,d=8-this.bitPos;if(a>=d){this.bytePos++;if(a>d)c|=b[this.bytePos]<<d}this.bitPos=(this.bitPos+a)&7;return c&((1<<a)-1)};var _2=function(a){this.value=0,this.scale=0;if(a==0){this.value=a,this.scale=31;return}else if(a >=(1<<30)){this.value=0,this.scale=0;return}var v=a,s=0;if(v>0){do v<<=1,++s;while(v<(1<<30))}else{var b=1<<31;do v<<=1,++s;while(v>b+(1<<30))}this.value=v,this.scale=s},_o1=[0,2,4,6,8,10,12,14,16,18,21,24,28,32,37,43,49,56,64,73,83,95,109,124],_o2=[6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,0,0,0,0,0,0,0,0,0],_t0=[2,2,2,2,2,2,2,2,2,3,3,4,4,5,6,6,7,8,9,10,12,14,15,0],_t1=[3134,5342,6870,7792,8569,9185,9744,10191,10631,11061,11434,11770,12116,12513,12925,13300,13674,14027,14352,14716,15117,15477,15824,16157,16513,16804,17090,17401,17679,17948,18238,18520,18764,19078,19381,19640,19921,20205,20500,20813,21162,21465,21794,22137,22453,22756,23067,23350,23636,23926,24227,24521,24819,25107,25414,25730,26120,26497,26895,27344,27877,28463,29426,31355],_t2=[-11725,-9420,-7910,-6801,-5948,-5233,-4599,-4039,-3507,-3030,-2596,-2170,-1774,-1383,-1016,-660,-329,-1,337,696,1085,1512,1962,2433,2968,3569,4314,5279,6622,8154,10076,12975],_t3=[0,-0.847256005,0.722470999,-1.52474797,-0.453148007,0.375360996,1.47178996,-1.98225796,-1.19293797,-0.582937002,-0.0693780035,0.390956998,0.906920016,1.486274,2.22154093,-2.38878703,-1.80675399,-1.41054201,-1.07736099,-0.799501002,-0.555810988,-0.333402008,-0.132449001,0.0568020009,0.254877001,0.477355003,0.738685012,1.04430604,1.39544594,1.80987501,2.39187598,-2.38938308,-1.98846805,-1.75140405,-1.56431198,-1.39221299,-1.216465,-1.04694998,-0.890510023,-0.764558017,-0.645457983,-0.52592802,-0.405954987,-0.302971989,-0.209690005,-0.123986997,-0.0479229987,0.025773,0.100134,0.173718005,0.258554012,0.352290004,0.456988007,0.576775014,0.700316012,0.842552006,1.00938797,1.18213499,1.35345602,1.53208196,1.73326194,1.97223496,2.39781404,-2.5756309,-2.05733204,-1.89849198,-1.77278101,-1.66626,-1.57421803,-1.49933195,-1.43166399,-1.36522806,-1.30009902,-1.22809303,-1.15885794,-1.09212506,-1.013574,-0.920284986,-0.828705013,-0.737488985,-0.644775987,-0.559094012,-0.485713989,-0.411031991,-0.345970005,-0.285115987,-0.234162003,-0.187058002,-0.144250005,-0.110716999,-0.0739680007,-0.0365610011,-0.00732900016,0.0203610007,0.0479039997,0.0751969963,0.0980999991,0.122038998,0.145899996,0.169434994,0.197045997,0.225243002,0.255686998,0.287010014,0.319709986,0.352582991,0.388906986,0.433492005,0.476945996,0.520482004,0.564453006,0.612204015,0.668592989,0.734165013,0.803215981,0.878404021,0.956620991,1.03970695,1.12937701,1.22111595,1.30802798,1.40248001,1.50568199,1.62277305,1.77249599,1.94308805,2.29039311,0],_t4=[0.999981225,0.999529421,0.998475611,0.996820271,0.994564593,0.991709828,0.988257587,0.984210074,0.979569793,0.974339426,0.968522072,0.962121427,0.955141187,0.947585583,0.939459205,0.930767,0.921513975,0.911705971,0.901348829,0.890448689,0.879012227,0.867046177,0.854557991,0.841554999,0.828045011,0.81403631,0.799537301,0.784556627,0.769103289,0.753186822,0.736816585,0.720002472,0.702754676,0.685083687,0.666999876,0.64851439,0.629638195,0.610382795,0.590759695,0.570780694,0.550458014,0.529803574,0.50883007,0.487550199,0.465976506,0.444122106,0.422000289,0.399624199,0.377007395,0.354163498,0.331106305,0.307849586,0.284407496,0.260794103,0.237023607,0.213110298,0.189068705,0.164913103,0.1406582,0.116318598,0.0919089988,0.0674438998,0.0429382995,0.0184067003],_t5=[0.125,0.124962397,0.124849401,0.124661297,0.124398097,0.124059901,0.123647101,0.123159699,0.122598201,0.121962801,0.1212539,0.120471999,0.119617499,0.118690997,0.117693,0.116624102,0.115484901,0.114276201,0.112998702,0.111653,0.110240199,0.108760901,0.107216097,0.105606697,0.103933699,0.102198102,0.100400902,0.0985433012,0.0966262966,0.094651103,0.0926188976,0.0905309021,0.0883883014,0.0861926004,0.0839449018,0.0816465989,0.0792991966,0.076903902,0.0744623989,0.0719759986,0.069446303,0.0668746978,0.0642627999,0.0616123006,0.0589246005,0.0562013984,0.0534444004,0.0506552011,0.0478353985,0.0449868999,0.0421111993,0.0392102003,0.0362856016,0.0333391018,0.0303725004,0.0273876991,0.0243862998,0.0213702004,0.0183412991,0.0153013002,0.0122520998,0.0091955997,0.00613350002,0.00306769996],_t6=[-0.00613590004,-0.0306748003,-0.0551952012,-0.0796824023,-0.104121603,-0.128498107,-0.152797207,-0.177004203,-0.201104596,-0.225083902,-0.248927593,-0.272621393,-0.296150893,-0.319501996,-0.342660695,-0.365613014,-0.388345003,-0.410843194,-0.433093786,-0.455083609,-0.47679919,-0.498227686,-0.519356012,-0.540171504,-0.560661614,-0.580814004,-0.600616515,-0.620057225,-0.639124393,-0.657806695,-0.676092684,-0.693971515,-0.711432219,-0.728464425,-0.745057821,-0.761202395,-0.77688849,-0.792106628,-0.806847572,-0.8211025,-0.834862888,-0.848120272,-0.860866904,-0.873094976,-0.884797096,-0.895966172,-0.906595707,-0.916679084,-0.926210225,-0.935183525,-0.943593502,-0.95143503,-0.958703518,-0.965394378,-0.971503913,-0.977028072,-0.981963873,-0.986308098,-0.990058184,-0.993211925,-0.995767415,-0.997723103,-0.999077678,-0.999830604],_t7=[0.00613590004,0.0184067003,0.0306748003,0.0429382995,0.0551952012,0.0674438998,0.0796824023,0.0919089988,0.104121603,0.116318598,0.128498107,0.1406582,0.152797207,0.164913103,0.177004203,0.189068705,0.201104596,0.213110298,0.225083902,0.237023607,0.248927593,0.260794103,0.272621393,0.284407496,0.296150893,0.307849586,0.319501996,0.331106305,0.342660695,0.354163498,0.365613014,0.377007395,0.388345003,0.399624199,0.410843194,0.422000289,0.433093786,0.444122106,0.455083609,0.465976506,0.47679919,0.487550199,0.498227686,0.50883007,0.519356012,0.529803574,0.540171504,0.550458014,0.560661614,0.570780694,0.580814004,0.590759695,0.600616515,0.610382795,0.620057225,0.629638195,0.639124393,0.64851439,0.657806695,0.666999876,0.676092684,0.685083687,0.693971515,0.702754676,0.711432219,0.720002472,0.728464425,0.736816585,0.745057821,0.753186822,0.761202395,0.769103289,0.77688849,0.784556627,0.792106628,0.799537301,0.806847572,0.81403631,0.8211025,0.828045011,0.834862888,0.841554999,0.848120272,0.854557991,0.860866904,0.867046177,0.873094976,0.879012227,0.884797096,0.890448689,0.895966172,0.901348829,0.906595707,0.911705971,0.916679084,0.921513975,0.926210225,0.930767,0.935183525,0.939459205,0.943593502,0.947585583,0.95143503,0.955141187,0.958703518,0.962121427,0.965394378,0.968522072,0.971503913,0.974339426,0.977028072,0.979569793,0.981963873,0.984210074,0.986308098,0.988257587,0.990058184,0.991709828,0.993211925,0.994564593,0.995767415,0.996820271,0.997723103,0.998475611,0.999077678,0.999529421,0.999830604,0.999981225],_t8=[32767,30840,29127,27594,26214,24966,23831,22795,21845,20972,20165,19418,18725,18079,17476,16913,16384,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_t9=[0,0.0122715384,0.024541229,0.0368072242,0.0490676723,0.061320737,0.0735645667,0.0857973099,0.0980171412,0.110222213,0.122410677,0.134580716,0.146730468,0.158858135,0.170961887,0.183039889,0.195090324,0.207111374,0.219101235,0.231058106,0.242980182,0.254865646,0.266712755,0.27851969,0.290284693,0.302005947,0.313681751,0.32531029,0.336889863,0.348418683,0.359895051,0.371317178,0.382683426,0.393992037,0.405241311,0.416429549,0.427555084,0.438616246,0.449611336,0.460538715,0.471396744,0.482183784,0.492898196,0.50353837,0.514102757,0.524589658,0.534997642,0.545324981,0.555570245,0.565731823,0.575808167,0.585797846,0.59569931,0.605511069,0.615231574,0.624859512,0.634393275,0.643831551,0.653172851,0.662415802,0.671558976,0.680601001,0.689540565,0.698376238,0.707106769,0.715730846,0.724247098,0.732654274,0.740951121,0.749136388,0.757208824,0.765167296,0.773010433,0.780737221,0.78834641,0.795836926,0.803207517,0.81045723,0.817584813,0.824589312,0.831469595,0.838224709,0.84485358,0.851355195,0.857728601,0.863972843,0.870086968,0.876070082,0.881921232,0.887639642,0.893224299,0.898674488,0.903989315,0.909168005,0.914209783,0.919113874,0.923879504,0.928506076,0.932992816,0.937339008,0.941544056,0.945607305,0.949528158,0.953306019,0.956940353,0.960430503,0.963776052,0.966976464,0.970031261,0.972939968,0.975702107,0.97831738,0.980785251,0.983105481,0.985277653,0.987301409,0.989176512,0.990902662,0.992479503,0.993906975,0.99518472,0.996312618,0.997290432,0.998118103,0.99879545,0.999322355,0.999698818,0.999924719,1],_3=function(a){this.value=0,this.shift=0;if(a==124){this.value=4228,this.shift=19;return}else if(a==0){this.value=0,this.shift=0;return}var b=((~a>>>31)<<1)-1,c=a*b,d=-1;while((c&(1<<15))==0)c<<=1,d++;c>>=1;this.shift=27-d;var e=_t8[(c-0x3e00)>>10],f=c*e;f=(1<<30)-f,f+=(1<<14),f>>=15,f*=e,f+=(1<<14),f>>=15;var g=f;f*=c,f=(1<<29)-f,f+=(1<<14),f>>=15,f*=g,f+=(1<<13),f>>=14,f*=b;if(f>32767&&b==1)f=32767;else if(f<-32768&&b==-1)f=-32768;this.value=f},_f1=function(a,b,c,e,f){var d=0;if(c<=0)return d|0;var g=1<<(b-1);for(var i=0;i<c;++i){var h=a[i]-f;if(h<0)h=0;else h=(h+g)>>b;d+=Math.min(h,e)}return d|0},_f2=function(a,b,c,d){var e=0;for(var i=0;i<b;++i)if(a[i]>e)e=a[i];var f=0,g=new _2(e);f=g.scale-16;var h=new Int16Array(124);if(f<0)for(var i=0;i<b;++i)h[i]=(a[i]>>-f);else for(var i=0;i<b;++i)h[i]=(a[i]<<f);var k=new _3(b);for(var i=0;i<b;++i)h[i]=((h[i]*3)>>2);var l=0;for(var i=0;i<b;++i)l+=h[i];f+=11,l-=c<<f;var m=0,n=l-(c<<f);g=new _2(n),m=((n>>16)*k.value)>>15;var o=31-k.shift-g.scale;if(o>=0)m<<=o;else m>>=-o;var p=_f1(h,f,b,6,m);if(p!=c){var a1=(p-c),a2=0;if(a1<=0)for(;a1>=-16384;a1<<=1)a2++;else for(;a1<16384;a1<<=1)a2++;var a3=(a1*k.value)>>15;a2=f-(k.shift+a2-15);if(a2>=0)a3<<=a2;else a3>>=-a2;var a4=1,b1=0,b2=0;for(;;){b1=p,b2=m,m+=a3,p=_f1(h,f,b,6,m);if(++a4>19)break;if((p-c)*(b1-c)<=0)break};if(p!=c){var b3=0,b4=0,b5=0;if(p>c)b3=m,m=b2,b4=p,b5=b1;else b3=b2,b4=b1,b5=p;while(p!=c&&a4<20){var c1=(m+b3)>>1;p=_f1(h,f,b,6,c1);++a4;if(p>c)b3=c1,b4=p;else m=c1,b5=p}var c2=Math.abs((b4-c)|0),c3=Math.abs((b5-c)|0);if(c2<c3)m=b3,p=b4;else p=b5}}for(var i=0;i<b;++i){var d1=h[i]-m;if(d1>=0)d1=(d1+(1<<(f-1)))>>f;else d1=0;d[i]=Math.min(d1,6)}if(p>c){var i=0,d2=0;for(;d2<c;++i)d2+=d[i];d2-=d[i-1];d[i-1]=c-d2;p=c;for(;i<b;++i)d[i]=0}return(c-p)|0},_f3=function(a,b,c){var f=c<<1,j=1;for(var i=1;i<f;i+=2){if(i<j){var d=a[b+i];a[b+i]=a[b+j],a[b+j]=d;var e=a[b+i-1];a[b+i-1]=a[b+j-1],a[b+j-1]=e}var x=c;while(x>1&&x<j)j-=x,x>>=1;j+=x}},_f4=function(a,b,c){var d=1<<c,j=0;_f3(a,b,d);for(var i=(d>>1);i>0;--i,j+=4){var j0=a[b+j],j1=a[b+j+1],j2=a[b+j+2],j3=a[b+j+3];a[b+j]=j0+j2,a[b+j+1]=j1+j3,a[b+j+2]=j0-j2,a[b+j+3]=j1-j3};j=0;for(var i=(d>>2);i>0;--i,j+=8){var j0=a[b+j],j1=a[b+j+1],j2=a[b+j+2],j3=a[b+j+3],j4=a[b+j+4],j5=a[b+j+5],j6=a[b+j+6],j7=a[b+j+7];a[b+j]=j0+j4,a[b+j+1]=j1+j5,a[b+j+2]=j2+j7,a[b+j+3]=j3-j6,a[b+j+4]=j0-j4,a[b+j+5]=j1-j5,a[b+j+6]=j2-j7,a[b+j+7]=j3+j6}var i=0,x=(d>>3),y=64,z=4;for(var idx1=c-2;idx1>0;--idx1,z<<=1,y>>=1,x>>=1){j=0;for(var idx2=x;idx2!=0;--idx2,j+=z<<1){for(var idx3=z>>1;idx3>0;--idx3,j+=2,i+=y){var k=j+(z<<1),j0=a[b+j],j1=a[b+j+1],k0=a[b+k],k1=a[b+k+1];a[b+k]=(j0-(k0*_t9[128-i]+k1*_t9[i])),a[b+j]=(j0+(k0*_t9[128-i]+k1*_t9[i])),a[b+k+1]=(j1+(k0*_t9[i]-k1*_t9[128-i])),a[b+j+1]=(j1-(k0*_t9[i]-k1*_t9[128-i]))};for(var idx4=z>>1;idx4>0;--idx4,j+=2,i-=y){var k=j+(z<<1),j0=a[b+j],j1=a[b+j+1],k0=a[b+k],k1=a[b+k+1];a[b+k]=(j0+(k0*_t9[128-i]-k1*_t9[i])),a[b+j]=(j0-(k0*_t9[128-i]-k1*_t9[i])),a[b+k+1]=(j1+(k1*_t9[128-i]+k0*_t9[i])),a[b+j+1]=(j1-(k1*_t9[128-i]+k0*_t9[i]))}}}},_f5=function(a,b,c,d,e){var f=1<<c,g=(f>>1)-1,h=f>>2;for(var i=0;i<h;++i){var i2=i<<1,j=f-1-i2,k=j-1,in_i2=a[b+i2],in_i2_1=a[b+i2+1],in_j=a[b+j],in_k=a[b+k];d[e+i2]=(_t4[i]*in_i2-_t6[i]*in_j),d[e+i2+1]=(in_j*_t4[i]+in_i2*_t6[i]),d[e+k]=(_t4[g-i]*in_k-_t6[g-i]*in_i2_1),d[e+j]=(in_i2_1*_t4[g-i]+in_k*_t6[g-i])};_f4(d,e,c-1);var l=d[e+f-1],m=d[e+f-2];d[e]=_t5[0]*d[e],d[e+f-1]=d[e+1]*-_t5[0],d[e+f-2]=_t5[g]*d[e+f-2]+_t5[1]*l,d[e+1]=m*_t5[1]-l*_t5[g];var o=f-3,p=g,j=3;for(var i=1;i<h;++i,--p,o-=2,j+=2){var q=d[e+o],r=d[e+o-1],s=d[e+j],t=d[e+j-1];d[e+j-1]=(_t5[p]*s+_t5[(j-1)>>1]*t),d[e+j]=(r*_t5[(j+1)>>1]-q*_t5[p-1]),d[e+o]=(t*_t5[p]-s*_t5[(j-1)>>1]),d[e+o-1]=(_t5[(j+1)>>1]*q+_t5[p-1]*r)}},_f6=function(a,b,c,d,e){var f=1<<c,g=f>>2,y=f-1,x=f>>1,j=x-1,i=0;_f5(b,0,c,d,e);for(;i<g;++i,--j,++x,--y){var h=a[i],k=a[j],l=d[e+x],m=d[e+y];a[i]=-d[e+j],a[j]=-d[e+i],d[e+i]=(h*_t7[y]+l*_t7[i]),d[e+j]=(k*_t7[x]+m*_t7[j]),d[e+x]=(_t7[x]*-m+_t7[j]*k),d[e+y]=(_t7[y]*-l+_t7[i]*h)}},_f7=function(a,b,c){var d=new Uint8Array(124),e1=new Float32Array(128),e2=new Float32Array(124),e3=new Float32Array(124),f=new Int32Array(124),o=new _1;var g=o.pop(_o2[0],b);d[0]=g,e1[0]=_t1[g];for(var i=1;i<23;i++)g=o.pop(_o2[i],b),d[i]=g,e1[i]=e1[i-1]+_t2[g];for(var i=0;i<23;i++){var h=Math.pow(2.0,e1[i]*(0.5*0.0009765625)),k=_o1[i],l=_o1[i+1];for(;k<l;++k)e3[k]=e1[i],e2[k]=h}var m=_f2(e3,124,198,f);for(var n=0;n<256;n+=128){for(var i=0;i<124;++i){var h=f[i],k=e2[i];if(h>0){var l=1<<h;g=o.pop(h,b),d[i]=g,k*=_t3[l-1+g]}else{var p=Math.random()*4294967296.0;if(p<(1<<30)+(1<<14))k*=-0.707099974;else k*=0.707099974}e1[i]=k;};for(var i=124;i<128;++i)e1[i]=0;for(var i=m;i>0;i-=8){if(i>8)o.pop(8,b);else{o.pop(i,b);break}};_f6(a,e1,7,c,n)}},_f8=function(a,b,c,d){var e=0;var f=Math.abs(a-b[c]);for(var i=c;i<d;++i){var g=Math.abs(a-b[i]);if(g<f)f=g,e=i-c}return e},_f9=function(a,b,c,d){var e=c,f=d;do{var g=(e+f)>>1;if(a>b[g])e=g;else f=g} while(f-e>1);if(f!=d)if(a-b[e]>b[f]-a)e=f;return e-c},_f10=function(a,b,c,d,e,f){var g=1<<d,h=g>>2,y=g-1,x=g>>1,j=x-1,i=0;for(;i<h;++i,++x,--y,--j)e[f+x]=a[i],e[f+y]=a[j],e[f+i]=-b[c+j]*_t7[x]-b[c+x]*_t7[j],e[f+j]=-b[c+y]*_t7[i]-b[c+i]*_t7[y],a[i]=b[c+i]*_t7[i]-b[c+y]*_t7[y],a[j]=b[c+j]*_t7[j]-b[c+x]*_t7[x];_f5(e,f,d,e,f)},_f11=function(q,w,e){var c=new Float32Array(256),d=new Float32Array(23),f=new Float32Array(23),g=new Float32Array(124),h=new Float32Array(124),j=new Int32Array(124),k=new _1;_f10(q,w,0,7,c,0);_f10(q,w,128,7,c,128);for(var i=0;i<23;++i){var l=_o1[i],m=_o1[i+1],n=0.0;for(;l<m;++l){var a=c[l],b=c[l+128];n+=a*a+b*b};var o=Math.max(1.0,n/(_t0[i]<<1));d[i]=Math.round(Math.log(o)*(1.44269502*1024.0))};var r=_f8(d[0],_t1,0,64);f[0]=_t1[r];k.push(r,_o2[0],e);for(var i=1;i<23;++i){r=_f8(d[i]-f[i-1],_t2,0,32);f[i]=f[i-1]+_t2[r];k.push(r,_o2[i],e)};for(var i=0;i<23;++i)d[i]=(1.0/Math.pow(2.0,f[i]*(0.5*0.0009765625)));for(var i=0;i<23;++i){var l=_o1[i],m=_o1[i+1];for(;l<m;++l)g[l]=f[i],h[l]=d[i]}var s=_f2(g,124,198,j);for(var u=0;u<256;u+=128){for(var i=0;i<124;++i){var p=j[i];if(p>0){var t=1<<p;r=_f9(h[i]*c[u+i],_t3,t-1,(t<<1)-1);k.push(r,p,e)}}for(var i=s;i>0;i-=8){if(i>8)k.push(0,8,e);else{k.push(0,i,e);break}}}};return{decode:_f7,encode:_f11}}());

	// ANIM TRED MP3 IN JAVASCRIPT
	var AT_MP3=(function(){var A=function(){this._end=0,this.viewUint8=null,this.bitPos=0,this.bytePos=0};A.prototype.readBit=function(){if(this._end<=this.bytePos)return 0;var a=(this.viewUint8[this.bytePos]>>(7-(this.bitPos++)));if(this.bitPos>7)this.bitPos=0,this.bytePos++;return a&1},A.prototype.get_bits=function(n){if(n===0)return 0;if(this._end<=this.bytePos)return 0;var a=0;while(n--)a<<=1,a|=this.readBit();return a},A.prototype.setData=function(_){this._end=_.length,this.viewUint8=_,this.bitPos=0,this.bytePos=0};var B=function(){this.h_layer=0,this.h_protection_bit=0,this.h_bitrate_index=0,this.h_padding_bit=0,this.h_mode_extension=0,this.h_version=0,this.h_mode=0,this.h_sample_frequency=0,this.h_number_of_subbands=0,this.h_intensity_stereo_bound=0,this.h_copyright=false,this.h_original=false,this.h_crc=0,this.framesize=0,this.nSlots=0};B.versionTable=[2,1,2.5,-1],B.layerTable=[-1,3,2,1],B.frequencies=[[22050,24000,16000],[44100,48000,32000],[11025,12000,8000]],B.MPEG2_LSF=0,B.MPEG25_LSF=2,B.MPEG1=1,B.STEREO=0,B.JOINT_STEREO=1,B.DUAL_CHANNEL=2,B.SINGLE_CHANNEL=3,B.FOURTYFOUR_POINT_ONE=0,B.FOURTYEIGHT=1,B.THIRTYTWO=2,B.bitrates=[[[0,32000,48000,56000,64000,80000,96000,112000,128000,144000,160000,176000,192000,224000,256000,0],[0,8000,16000,24000,32000,40000,48000,56000,64000,80000,96000,112000,128000,144000,160000,0],[0,8000,16000,24000,32000,40000,48000,56000,64000,80000,96000,112000,128000,144000,160000,0]],[[0,32000,64000,96000,128000,160000,192000,224000,256000,288000,320000,352000,384000,416000,448000,0],[0,32000,48000,56000,64000,80000,96000,112000,128000,160000,192000,224000,256000,320000,384000,0],[0,32000,40000,48000,56000,64000,80000,96000,112000,128000,160000,192000,224000,256000,320000,0]],[[0,32000,48000,56000,64000,80000,96000,112000,128000,144000,160000,176000,192000,224000,256000,0],[0,8000,16000,24000,32000,40000,48000,56000,64000,80000,96000,112000,128000,144000,160000,0],[0,8000,16000,24000,32000,40000,48000,56000,64000,80000,96000,112000,128000,144000,160000,0]]],B.prototype.parseHeader=function(_){this.h_crc=((_&0x00010000)>>>16)>>>0,this.h_sample_frequency=((_>>>10)&3),this.h_version=((_>>>19)&1);var a=0;if(((_>>>20)&1)==0)if(this.h_version==B.MPEG2_LSF)this.h_version=B.MPEG25_LSF;else throw new Error("UNKNOWN_ERROR");this.h_layer=4-(_>>>17)&3,this.h_protection_bit=(_>>>16)&1,this.h_bitrate_index=(_>>>12)&0xF,this.h_padding_bit=(_>>>9)&1,this.h_mode=(_>>>6)&3,this.h_mode_extension=(_>>>4)&3;if(this.h_mode==B.JOINT_STEREO)this.h_intensity_stereo_bound=(this.h_mode_extension<<2)+4;else this.h_intensity_stereo_bound=0;if(((_>>>3)&1)==1)this.h_copyright=true;if(((_>>>2)&1)==1)this.h_original=true;if(this.h_layer==1)this.h_number_of_subbands=32;else {a=this.h_bitrate_index;if(this.h_mode!=B.SINGLE_CHANNEL)if(a==4)a=1;else a-=4;if((a==1)||(a==2))if(this.h_sample_frequency==B.THIRTYTWO)this.h_number_of_subbands=12;else this.h_number_of_subbands=8;else if((this.h_sample_frequency==B.FOURTYEIGHT)||((a>=3)&&(a<=5)))this.h_number_of_subbands=27;else this.h_number_of_subbands=30}if(this.h_intensity_stereo_bound>this.h_number_of_subbands)this.h_intensity_stereo_bound=this.h_number_of_subbands;this.calculate_framesize()},B.prototype.frequency=function(){return B.frequencies[this.h_version][this.h_sample_frequency]},B.prototype.sample_frequency=function(){return this.h_sample_frequency},B.prototype.version=function(){return this.h_version},B.prototype.layer=function(){return this.h_layer},B.prototype.mode=function(){return this.h_mode},B.prototype.checksums=function(){return this.h_protection_bit==0},B.prototype.copyright=function(){return this.h_copyright},B.prototype.crc=function(){return this.h_crc},B.prototype.original=function(){return this.h_original},B.prototype.padding=function(){return this.h_padding_bit!=0},B.prototype.slots=function(){return this.nSlots},B.prototype.mode_extension=function(){return this.h_mode_extension},B.prototype.calculate_framesize=function(){if(this.h_layer==1){this.framesize=((12*B.bitrates[this.h_version][0][this.h_bitrate_index])/B.frequencies[this.h_version][this.h_sample_frequency])|0;if(this.h_padding_bit!=0)this.framesize++;this.framesize<<=2,this.nSlots=0}else{this.framesize=((144*B.bitrates[this.h_version][this.h_layer-1][this.h_bitrate_index])/B.frequencies[this.h_version][this.h_sample_frequency])|0;if(this.h_version==B.MPEG2_LSF||this.h_version==B.MPEG25_LSF)this.framesize>>=1;if(this.h_padding_bit!=0)this.framesize++;if(this.h_layer==3){if(this.h_version==B.MPEG1)this.nSlots=this.framesize-((this.h_mode==B.SINGLE_CHANNEL)?17:32)-((this.h_protection_bit!=0)?0:2)-4;else this.nSlots=this.framesize-((this.h_mode==B.SINGLE_CHANNEL)?9:17)-((this.h_protection_bit!=0)?0:2)-4}else this.nSlots=0}return this.framesize-=4,this.framesize},B.prototype.layer_string=function(){switch (this.h_layer){case 1:return "I";case 2:return "II";case 3:return "III"}return null},B.bitrate_str=[[["free format","32 kbit/s","48 kbit/s","56 kbit/s","64 kbit/s","80 kbit/s","96 kbit/s","112 kbit/s","128 kbit/s","144 kbit/s","160 kbit/s","176 kbit/s","192 kbit/s","224 kbit/s","256 kbit/s","forbidden"],["free format","8 kbit/s","16 kbit/s","24 kbit/s","32 kbit/s","40 kbit/s","48 kbit/s","56 kbit/s","64 kbit/s","80 kbit/s","96 kbit/s","112 kbit/s","128 kbit/s","144 kbit/s","160 kbit/s","forbidden"],["free format","8 kbit/s","16 kbit/s","24 kbit/s","32 kbit/s","40 kbit/s","48 kbit/s","56 kbit/s","64 kbit/s","80 kbit/s","96 kbit/s","112 kbit/s","128 kbit/s","144 kbit/s","160 kbit/s","forbidden"]],[["free format","32 kbit/s","64 kbit/s","96 kbit/s","128 kbit/s","160 kbit/s","192 kbit/s","224 kbit/s","256 kbit/s","288 kbit/s","320 kbit/s","352 kbit/s","384 kbit/s","416 kbit/s","448 kbit/s","forbidden"],["free format","32 kbit/s","48 kbit/s","56 kbit/s","64 kbit/s","80 kbit/s","96 kbit/s","112 kbit/s","128 kbit/s","160 kbit/s","192 kbit/s","224 kbit/s","256 kbit/s","320 kbit/s","384 kbit/s","forbidden"],["free format","32 kbit/s","40 kbit/s","48 kbit/s","56 kbit/s","64 kbit/s","80 kbit/s","96 kbit/s","112 kbit/s","128 kbit/s","160 kbit/s","192 kbit/s","224 kbit/s","256 kbit/s","320 kbit/s","forbidden"]],[["free format","32 kbit/s","48 kbit/s","56 kbit/s","64 kbit/s","80 kbit/s","96 kbit/s","112 kbit/s","128 kbit/s","144 kbit/s","160 kbit/s","176 kbit/s","192 kbit/s","224 kbit/s","256 kbit/s","forbidden"],["free format","8 kbit/s","16 kbit/s","24 kbit/s","32 kbit/s","40 kbit/s","48 kbit/s","56 kbit/s","64 kbit/s","80 kbit/s","96 kbit/s","112 kbit/s","128 kbit/s","144 kbit/s","160 kbit/s","forbidden"],["free format","8 kbit/s","16 kbit/s","24 kbit/s","32 kbit/s","40 kbit/s","48 kbit/s","56 kbit/s","64 kbit/s","80 kbit/s","96 kbit/s","112 kbit/s","128 kbit/s","144 kbit/s","160 kbit/s","forbidden"]]],B.prototype.bitrate_string=function(){return B.bitrate_str[this.h_version][this.h_layer-1][this.h_bitrate_index]},B.prototype.sample_frequency_string=function(){switch (this.h_sample_frequency){case B.THIRTYTWO:if(this.h_version==B.MPEG1)return "32 kHz";else if(this.h_version==B.MPEG2_LSF)return "16 kHz";else return "8 kHz";case B.FOURTYFOUR_POINT_ONE:if(this.h_version==B.MPEG1)return "44.1 kHz";else if(this.h_version==B.MPEG2_LSF)return "22.05 kHz";else return "11.025 kHz";case B.FOURTYEIGHT:if(this.h_version==B.MPEG1)return "48 kHz";else if(this.h_version==B.MPEG2_LSF)return "24 kHz";else return "12 kHz"}return null},B.isValidHeader=function(h){return(((h>>>24)==0xFF)&&(((h>>21)&2047)==2047)&&((((h&0x00180000)>>>19)>>>0)!=1)&&((((h&0x00060000)>>>17)>>>0)!=0)&&((((h&0x0000f000)>>>12)>>>0)!=0)&&((((h&0x0000f000)>>>12)>>>0)!=15)&&((((h&0x00000c00)>>>10)>>>0)!=3)&&(((h&0x00000003)>>>0)!=2))};var C=function(){this.offset=0,this.totbit=0,this.buf_byte_idx=0,this.buf=new Int32Array(C.BUFSIZE)};C.BUFSIZE=4096*8,C.BUFSIZE_MASK=C.BUFSIZE-1;C.prototype.hputbuf=function(_){var a=this.offset;this.buf[a++]=_&0x80,this.buf[a++]=_&0x40,this.buf[a++]=_&0x20,this.buf[a++]=_&0x10,this.buf[a++]=_&0x08,this.buf[a++]=_&0x04,this.buf[a++]=_&0x02,this.buf[a++]=_&0x01;if(a==C.BUFSIZE) this.offset=0;else this.offset=a},C.prototype.hsstell=function(){return this.totbit},C.prototype.hgetbits=function(_){this.totbit+=_;var a=0,b=this.buf_byte_idx;if(b+_<C.BUFSIZE)while(_-->0)a<<=1,a|=((this.buf[b++]!=0)?1:0);else while(_-->0)a<<=1,a|=((this.buf[b]!=0)?1:0),b=(b+1)&C.BUFSIZE_MASK;return this.buf_byte_idx=b,a},C.prototype.hget1bit=function(){this.totbit++;var a=this.buf[this.buf_byte_idx];this.buf_byte_idx=(this.buf_byte_idx+1)&C.BUFSIZE_MASK;return a},C.prototype.rewindNbits=function(_){this.totbit-=_;this.buf_byte_idx-=_;if(this.buf_byte_idx<0)this.buf_byte_idx+=C.BUFSIZE},C.prototype.rewindNbytes=function(_){var a=_<<3;this.totbit-=a,this.buf_byte_idx-=a;if(this.buf_byte_idx<0)this.buf_byte_idx+=C.BUFSIZE};var D=function(_,a,b,c,d,e,f,g){this.tablename0=_.charAt(0),this.tablename1=_.charAt(1),this.tablename2=_.charAt(2),this.xlen=a,this.ylen=b,this.linbits=c,this.linmax=d,this.ref=e,this.val=f,this.treelen=g};D.MXOFF=250,D.ValTab0=[[0,0]],D.ValTab1=[[2,1],[0,0],[2,1],[0,16],[2,1],[0,1],[0,17]],D.ValTab2=[[2,1],[0,0],[4,1],[2,1],[0,16],[0,1],[2,1],[0,17],[4,1],[2,1],[0,32],[0,33],[2,1],[0,18],[2,1],[0,2],[0,34]],D.ValTab3=[[4,1],[2,1],[0,0],[0,1],[2,1],[0,17],[2,1],[0,16],[4,1],[2,1],[0,32],[0,33],[2,1],[0,18],[2,1],[0,2],[0,34]],D.ValTab4=[[0,0]],D.ValTab5=[[2,1],[0,0],[4,1],[2,1],[0,16],[0,1],[2,1],[0,17],[8,1],[4,1],[2,1],[0,32],[0,2],[2,1],[0,33],[0,18],[8,1],[4,1],[2,1],[0,34],[0,48],[2,1],[0,3],[0,19],[2,1],[0,49],[2,1],[0,50],[2,1],[0,35],[0,51]],D.ValTab6=[[6,1],[4,1],[2,1],[0,0],[0,16],[0,17],[6,1],[2,1],[0,1],[2,1],[0,32],[0,33],[6,1],[2,1],[0,18],[2,1],[0,2],[0,34],[4,1],[2,1],[0,49],[0,19],[4,1],[2,1],[0,48],[0,50],[2,1],[0,35],[2,1],[0,3],[0,51]],D.ValTab7=[[2,1],[0,0],[4,1],[2,1],[0,16],[0,1],[8,1],[2,1],[0,17],[4,1],[2,1],[0,32],[0,2],[0,33],[18,1],[6,1],[2,1],[0,18],[2,1],[0,34],[0,48],[4,1],[2,1],[0,49],[0,19],[4,1],[2,1],[0,3],[0,50],[2,1],[0,35],[0,4],[10,1],[4,1],[2,1],[0,64],[0,65],[2,1],[0,20],[2,1],[0,66],[0,36],[12,1],[6,1],[4,1],[2,1],[0,51],[0,67],[0,80],[4,1],[2,1],[0,52],[0,5],[0,81],[6,1],[2,1],[0,21],[2,1],[0,82],[0,37],[4,1],[2,1],[0,68],[0,53],[4,1],[2,1],[0,83],[0,84],[2,1],[0,69],[0,85]],D.ValTab8=[[6,1],[2,1],[0,0],[2,1],[0,16],[0,1],[2,1],[0,17],[4,1],[2,1],[0,33],[0,18],[14,1],[4,1],[2,1],[0,32],[0,2],[2,1],[0,34],[4,1],[2,1],[0,48],[0,3],[2,1],[0,49],[0,19],[14,1],[8,1],[4,1],[2,1],[0,50],[0,35],[2,1],[0,64],[0,4],[2,1],[0,65],[2,1],[0,20],[0,66],[12,1],[6,1],[2,1],[0,36],[2,1],[0,51],[0,80],[4,1],[2,1],[0,67],[0,52],[0,81],[6,1],[2,1],[0,21],[2,1],[0,5],[0,82],[6,1],[2,1],[0,37],[2,1],[0,68],[0,53],[2,1],[0,83],[2,1],[0,69],[2,1],[0,84],[0,85]],D.ValTab9=[[8,1],[4,1],[2,1],[0,0],[0,16],[2,1],[0,1],[0,17],[10,1],[4,1],[2,1],[0,32],[0,33],[2,1],[0,18],[2,1],[0,2],[0,34],[12,1],[6,1],[4,1],[2,1],[0,48],[0,3],[0,49],[2,1],[0,19],[2,1],[0,50],[0,35],[12,1],[4,1],[2,1],[0,65],[0,20],[4,1],[2,1],[0,64],[0,51],[2,1],[0,66],[0,36],[10,1],[6,1],[4,1],[2,1],[0,4],[0,80],[0,67],[2,1],[0,52],[0,81],[8,1],[4,1],[2,1],[0,21],[0,82],[2,1],[0,37],[0,68],[6,1],[4,1],[2,1],[0,5],[0,84],[0,83],[2,1],[0,53],[2,1],[0,69],[0,85]],D.ValTab10=[[2,1],[0,0],[4,1],[2,1],[0,16],[0,1],[10,1],[2,1],[0,17],[4,1],[2,1],[0,32],[0,2],[2,1],[0,33],[0,18],[28,1],[8,1],[4,1],[2,1],[0,34],[0,48],[2,1],[0,49],[0,19],[8,1],[4,1],[2,1],[0,3],[0,50],[2,1],[0,35],[0,64],[4,1],[2,1],[0,65],[0,20],[4,1],[2,1],[0,4],[0,51],[2,1],[0,66],[0,36],[28,1],[10,1],[6,1],[4,1],[2,1],[0,80],[0,5],[0,96],[2,1],[0,97],[0,22],[12,1],[6,1],[4,1],[2,1],[0,67],[0,52],[0,81],[2,1],[0,21],[2,1],[0,82],[0,37],[4,1],[2,1],[0,38],[0,54],[0,113],[20,1],[8,1],[2,1],[0,23],[4,1],[2,1],[0,68],[0,83],[0,6],[6,1],[4,1],[2,1],[0,53],[0,69],[0,98],[2,1],[0,112],[2,1],[0,7],[0,100],[14,1],[4,1],[2,1],[0,114],[0,39],[6,1],[2,1],[0,99],[2,1],[0,84],[0,85],[2,1],[0,70],[0,115],[8,1],[4,1],[2,1],[0,55],[0,101],[2,1],[0,86],[0,116],[6,1],[2,1],[0,71],[2,1],[0,102],[0,117],[4,1],[2,1],[0,87],[0,118],[2,1],[0,103],[0,119]],D.ValTab11=[[6,1],[2,1],[0,0],[2,1],[0,16],[0,1],[8,1],[2,1],[0,17],[4,1],[2,1],[0,32],[0,2],[0,18],[24,1],[8,1],[2,1],[0,33],[2,1],[0,34],[2,1],[0,48],[0,3],[4,1],[2,1],[0,49],[0,19],[4,1],[2,1],[0,50],[0,35],[4,1],[2,1],[0,64],[0,4],[2,1],[0,65],[0,20],[30,1],[16,1],[10,1],[4,1],[2,1],[0,66],[0,36],[4,1],[2,1],[0,51],[0,67],[0,80],[4,1],[2,1],[0,52],[0,81],[0,97],[6,1],[2,1],[0,22],[2,1],[0,6],[0,38],[2,1],[0,98],[2,1],[0,21],[2,1],[0,5],[0,82],[16,1],[10,1],[6,1],[4,1],[2,1],[0,37],[0,68],[0,96],[2,1],[0,99],[0,54],[4,1],[2,1],[0,112],[0,23],[0,113],[16,1],[6,1],[4,1],[2,1],[0,7],[0,100],[0,114],[2,1],[0,39],[4,1],[2,1],[0,83],[0,53],[2,1],[0,84],[0,69],[10,1],[4,1],[2,1],[0,70],[0,115],[2,1],[0,55],[2,1],[0,101],[0,86],[10,1],[6,1],[4,1],[2,1],[0,85],[0,87],[0,116],[2,1],[0,71],[0,102],[4,1],[2,1],[0,117],[0,118],[2,1],[0,103],[0,119]],D.ValTab12=[[12,1],[4,1],[2,1],[0,16],[0,1],[2,1],[0,17],[2,1],[0,0],[2,1],[0,32],[0,2],[16,1],[4,1],[2,1],[0,33],[0,18],[4,1],[2,1],[0,34],[0,49],[2,1],[0,19],[2,1],[0,48],[2,1],[0,3],[0,64],[26,1],[8,1],[4,1],[2,1],[0,50],[0,35],[2,1],[0,65],[0,51],[10,1],[4,1],[2,1],[0,20],[0,66],[2,1],[0,36],[2,1],[0,4],[0,80],[4,1],[2,1],[0,67],[0,52],[2,1],[0,81],[0,21],[28,1],[14,1],[8,1],[4,1],[2,1],[0,82],[0,37],[2,1],[0,83],[0,53],[4,1],[2,1],[0,96],[0,22],[0,97],[4,1],[2,1],[0,98],[0,38],[6,1],[4,1],[2,1],[0,5],[0,6],[0,68],[2,1],[0,84],[0,69],[18,1],[10,1],[4,1],[2,1],[0,99],[0,54],[4,1],[2,1],[0,112],[0,7],[0,113],[4,1],[2,1],[0,23],[0,100],[2,1],[0,70],[0,114],[10,1],[6,1],[2,1],[0,39],[2,1],[0,85],[0,115],[2,1],[0,55],[0,86],[8,1],[4,1],[2,1],[0,101],[0,116],[2,1],[0,71],[0,102],[4,1],[2,1],[0,117],[0,87],[2,1],[0,118],[2,1],[0,103],[0,119]],D.ValTab13=[[2,1],[0,0],[6,1],[2,1],[0,16],[2,1],[0,1],[0,17],[28,1],[8,1],[4,1],[2,1],[0,32],[0,2],[2,1],[0,33],[0,18],[8,1],[4,1],[2,1],[0,34],[0,48],[2,1],[0,3],[0,49],[6,1],[2,1],[0,19],[2,1],[0,50],[0,35],[4,1],[2,1],[0,64],[0,4],[0,65],[70,1],[28,1],[14,1],[6,1],[2,1],[0,20],[2,1],[0,51],[0,66],[4,1],[2,1],[0,36],[0,80],[2,1],[0,67],[0,52],[4,1],[2,1],[0,81],[0,21],[4,1],[2,1],[0,5],[0,82],[2,1],[0,37],[2,1],[0,68],[0,83],[14,1],[8,1],[4,1],[2,1],[0,96],[0,6],[2,1],[0,97],[0,22],[4,1],[2,1],[0,128],[0,8],[0,129],[16,1],[8,1],[4,1],[2,1],[0,53],[0,98],[2,1],[0,38],[0,84],[4,1],[2,1],[0,69],[0,99],[2,1],[0,54],[0,112],[6,1],[4,1],[2,1],[0,7],[0,85],[0,113],[2,1],[0,23],[2,1],[0,39],[0,55],[72,1],[24,1],[12,1],[4,1],[2,1],[0,24],[0,130],[2,1],[0,40],[4,1],[2,1],[0,100],[0,70],[0,114],[8,1],[4,1],[2,1],[0,132],[0,72],[2,1],[0,144],[0,9],[2,1],[0,145],[0,25],[24,1],[14,1],[8,1],[4,1],[2,1],[0,115],[0,101],[2,1],[0,86],[0,116],[4,1],[2,1],[0,71],[0,102],[0,131],[6,1],[2,1],[0,56],[2,1],[0,117],[0,87],[2,1],[0,146],[0,41],[14,1],[8,1],[4,1],[2,1],[0,103],[0,133],[2,1],[0,88],[0,57],[2,1],[0,147],[2,1],[0,73],[0,134],[6,1],[2,1],[0,160],[2,1],[0,104],[0,10],[2,1],[0,161],[0,26],[68,1],[24,1],[12,1],[4,1],[2,1],[0,162],[0,42],[4,1],[2,1],[0,149],[0,89],[2,1],[0,163],[0,58],[8,1],[4,1],[2,1],[0,74],[0,150],[2,1],[0,176],[0,11],[2,1],[0,177],[0,27],[20,1],[8,1],[2,1],[0,178],[4,1],[2,1],[0,118],[0,119],[0,148],[6,1],[4,1],[2,1],[0,135],[0,120],[0,164],[4,1],[2,1],[0,105],[0,165],[0,43],[12,1],[6,1],[4,1],[2,1],[0,90],[0,136],[0,179],[2,1],[0,59],[2,1],[0,121],[0,166],[6,1],[4,1],[2,1],[0,106],[0,180],[0,192],[4,1],[2,1],[0,12],[0,152],[0,193],[60,1],[22,1],[10,1],[6,1],[2,1],[0,28],[2,1],[0,137],[0,181],[2,1],[0,91],[0,194],[4,1],[2,1],[0,44],[0,60],[4,1],[2,1],[0,182],[0,107],[2,1],[0,196],[0,76],[16,1],[8,1],[4,1],[2,1],[0,168],[0,138],[2,1],[0,208],[0,13],[2,1],[0,209],[2,1],[0,75],[2,1],[0,151],[0,167],[12,1],[6,1],[2,1],[0,195],[2,1],[0,122],[0,153],[4,1],[2,1],[0,197],[0,92],[0,183],[4,1],[2,1],[0,29],[0,210],[2,1],[0,45],[2,1],[0,123],[0,211],[52,1],[28,1],[12,1],[4,1],[2,1],[0,61],[0,198],[4,1],[2,1],[0,108],[0,169],[2,1],[0,154],[0,212],[8,1],[4,1],[2,1],[0,184],[0,139],[2,1],[0,77],[0,199],[4,1],[2,1],[0,124],[0,213],[2,1],[0,93],[0,224],[10,1],[4,1],[2,1],[0,225],[0,30],[4,1],[2,1],[0,14],[0,46],[0,226],[8,1],[4,1],[2,1],[0,227],[0,109],[2,1],[0,140],[0,228],[4,1],[2,1],[0,229],[0,186],[0,240],[38,1],[16,1],[4,1],[2,1],[0,241],[0,31],[6,1],[4,1],[2,1],[0,170],[0,155],[0,185],[2,1],[0,62],[2,1],[0,214],[0,200],[12,1],[6,1],[2,1],[0,78],[2,1],[0,215],[0,125],[2,1],[0,171],[2,1],[0,94],[0,201],[6,1],[2,1],[0,15],[2,1],[0,156],[0,110],[2,1],[0,242],[0,47],[32,1],[16,1],[6,1],[4,1],[2,1],[0,216],[0,141],[0,63],[6,1],[2,1],[0,243],[2,1],[0,230],[0,202],[2,1],[0,244],[0,79],[8,1],[4,1],[2,1],[0,187],[0,172],[2,1],[0,231],[0,245],[4,1],[2,1],[0,217],[0,157],[2,1],[0,95],[0,232],[30,1],[12,1],[6,1],[2,1],[0,111],[2,1],[0,246],[0,203],[4,1],[2,1],[0,188],[0,173],[0,218],[8,1],[2,1],[0,247],[4,1],[2,1],[0,126],[0,127],[0,142],[6,1],[4,1],[2,1],[0,158],[0,174],[0,204],[2,1],[0,248],[0,143],[18,1],[8,1],[4,1],[2,1],[0,219],[0,189],[2,1],[0,234],[0,249],[4,1],[2,1],[0,159],[0,235],[2,1],[0,190],[2,1],[0,205],[0,250],[14,1],[4,1],[2,1],[0,221],[0,236],[6,1],[4,1],[2,1],[0,233],[0,175],[0,220],[2,1],[0,206],[0,251],[8,1],[4,1],[2,1],[0,191],[0,222],[2,1],[0,207],[0,238],[4,1],[2,1],[0,223],[0,239],[2,1],[0,255],[2,1],[0,237],[2,1],[0,253],[2,1],[0,252],[0,254]],D.ValTab14=[[0,0]],D.ValTab15=[[16,1],[6,1],[2,1],[0,0],[2,1],[0,16],[0,1],[2,1],[0,17],[4,1],[2,1],[0,32],[0,2],[2,1],[0,33],[0,18],[50,1],[16,1],[6,1],[2,1],[0,34],[2,1],[0,48],[0,49],[6,1],[2,1],[0,19],[2,1],[0,3],[0,64],[2,1],[0,50],[0,35],[14,1],[6,1],[4,1],[2,1],[0,4],[0,20],[0,65],[4,1],[2,1],[0,51],[0,66],[2,1],[0,36],[0,67],[10,1],[6,1],[2,1],[0,52],[2,1],[0,80],[0,5],[2,1],[0,81],[0,21],[4,1],[2,1],[0,82],[0,37],[4,1],[2,1],[0,68],[0,83],[0,97],[90,1],[36,1],[18,1],[10,1],[6,1],[2,1],[0,53],[2,1],[0,96],[0,6],[2,1],[0,22],[0,98],[4,1],[2,1],[0,38],[0,84],[2,1],[0,69],[0,99],[10,1],[6,1],[2,1],[0,54],[2,1],[0,112],[0,7],[2,1],[0,113],[0,85],[4,1],[2,1],[0,23],[0,100],[2,1],[0,114],[0,39],[24,1],[16,1],[8,1],[4,1],[2,1],[0,70],[0,115],[2,1],[0,55],[0,101],[4,1],[2,1],[0,86],[0,128],[2,1],[0,8],[0,116],[4,1],[2,1],[0,129],[0,24],[2,1],[0,130],[0,40],[16,1],[8,1],[4,1],[2,1],[0,71],[0,102],[2,1],[0,131],[0,56],[4,1],[2,1],[0,117],[0,87],[2,1],[0,132],[0,72],[6,1],[4,1],[2,1],[0,144],[0,25],[0,145],[4,1],[2,1],[0,146],[0,118],[2,1],[0,103],[0,41],[92,1],[36,1],[18,1],[10,1],[4,1],[2,1],[0,133],[0,88],[4,1],[2,1],[0,9],[0,119],[0,147],[4,1],[2,1],[0,57],[0,148],[2,1],[0,73],[0,134],[10,1],[6,1],[2,1],[0,104],[2,1],[0,160],[0,10],[2,1],[0,161],[0,26],[4,1],[2,1],[0,162],[0,42],[2,1],[0,149],[0,89],[26,1],[14,1],[6,1],[2,1],[0,163],[2,1],[0,58],[0,135],[4,1],[2,1],[0,120],[0,164],[2,1],[0,74],[0,150],[6,1],[4,1],[2,1],[0,105],[0,176],[0,177],[4,1],[2,1],[0,27],[0,165],[0,178],[14,1],[8,1],[4,1],[2,1],[0,90],[0,43],[2,1],[0,136],[0,151],[2,1],[0,179],[2,1],[0,121],[0,59],[8,1],[4,1],[2,1],[0,106],[0,180],[2,1],[0,75],[0,193],[4,1],[2,1],[0,152],[0,137],[2,1],[0,28],[0,181],[80,1],[34,1],[16,1],[6,1],[4,1],[2,1],[0,91],[0,44],[0,194],[6,1],[4,1],[2,1],[0,11],[0,192],[0,166],[2,1],[0,167],[0,122],[10,1],[4,1],[2,1],[0,195],[0,60],[4,1],[2,1],[0,12],[0,153],[0,182],[4,1],[2,1],[0,107],[0,196],[2,1],[0,76],[0,168],[20,1],[10,1],[4,1],[2,1],[0,138],[0,197],[4,1],[2,1],[0,208],[0,92],[0,209],[4,1],[2,1],[0,183],[0,123],[2,1],[0,29],[2,1],[0,13],[0,45],[12,1],[4,1],[2,1],[0,210],[0,211],[4,1],[2,1],[0,61],[0,198],[2,1],[0,108],[0,169],[6,1],[4,1],[2,1],[0,154],[0,184],[0,212],[4,1],[2,1],[0,139],[0,77],[2,1],[0,199],[0,124],[68,1],[34,1],[18,1],[10,1],[4,1],[2,1],[0,213],[0,93],[4,1],[2,1],[0,224],[0,14],[0,225],[4,1],[2,1],[0,30],[0,226],[2,1],[0,170],[0,46],[8,1],[4,1],[2,1],[0,185],[0,155],[2,1],[0,227],[0,214],[4,1],[2,1],[0,109],[0,62],[2,1],[0,200],[0,140],[16,1],[8,1],[4,1],[2,1],[0,228],[0,78],[2,1],[0,215],[0,125],[4,1],[2,1],[0,229],[0,186],[2,1],[0,171],[0,94],[8,1],[4,1],[2,1],[0,201],[0,156],[2,1],[0,241],[0,31],[6,1],[4,1],[2,1],[0,240],[0,110],[0,242],[2,1],[0,47],[0,230],[38,1],[18,1],[8,1],[4,1],[2,1],[0,216],[0,243],[2,1],[0,63],[0,244],[6,1],[2,1],[0,79],[2,1],[0,141],[0,217],[2,1],[0,187],[0,202],[8,1],[4,1],[2,1],[0,172],[0,231],[2,1],[0,126],[0,245],[8,1],[4,1],[2,1],[0,157],[0,95],[2,1],[0,232],[0,142],[2,1],[0,246],[0,203],[34,1],[18,1],[10,1],[6,1],[4,1],[2,1],[0,15],[0,174],[0,111],[2,1],[0,188],[0,218],[4,1],[2,1],[0,173],[0,247],[2,1],[0,127],[0,233],[8,1],[4,1],[2,1],[0,158],[0,204],[2,1],[0,248],[0,143],[4,1],[2,1],[0,219],[0,189],[2,1],[0,234],[0,249],[16,1],[8,1],[4,1],[2,1],[0,159],[0,220],[2,1],[0,205],[0,235],[4,1],[2,1],[0,190],[0,250],[2,1],[0,175],[0,221],[14,1],[6,1],[4,1],[2,1],[0,236],[0,206],[0,251],[4,1],[2,1],[0,191],[0,237],[2,1],[0,222],[0,252],[6,1],[4,1],[2,1],[0,207],[0,253],[0,238],[4,1],[2,1],[0,223],[0,254],[2,1],[0,239],[0,255]],D.ValTab16=[[2,1],[0,0],[6,1],[2,1],[0,16],[2,1],[0,1],[0,17],[42,1],[8,1],[4,1],[2,1],[0,32],[0,2],[2,1],[0,33],[0,18],[10,1],[6,1],[2,1],[0,34],[2,1],[0,48],[0,3],[2,1],[0,49],[0,19],[10,1],[4,1],[2,1],[0,50],[0,35],[4,1],[2,1],[0,64],[0,4],[0,65],[6,1],[2,1],[0,20],[2,1],[0,51],[0,66],[4,1],[2,1],[0,36],[0,80],[2,1],[0,67],[0,52],[138,1],[40,1],[16,1],[6,1],[4,1],[2,1],[0,5],[0,21],[0,81],[4,1],[2,1],[0,82],[0,37],[4,1],[2,1],[0,68],[0,53],[0,83],[10,1],[6,1],[4,1],[2,1],[0,96],[0,6],[0,97],[2,1],[0,22],[0,98],[8,1],[4,1],[2,1],[0,38],[0,84],[2,1],[0,69],[0,99],[4,1],[2,1],[0,54],[0,112],[0,113],[40,1],[18,1],[8,1],[2,1],[0,23],[2,1],[0,7],[2,1],[0,85],[0,100],[4,1],[2,1],[0,114],[0,39],[4,1],[2,1],[0,70],[0,101],[0,115],[10,1],[6,1],[2,1],[0,55],[2,1],[0,86],[0,8],[2,1],[0,128],[0,129],[6,1],[2,1],[0,24],[2,1],[0,116],[0,71],[2,1],[0,130],[2,1],[0,40],[0,102],[24,1],[14,1],[8,1],[4,1],[2,1],[0,131],[0,56],[2,1],[0,117],[0,132],[4,1],[2,1],[0,72],[0,144],[0,145],[6,1],[2,1],[0,25],[2,1],[0,9],[0,118],[2,1],[0,146],[0,41],[14,1],[8,1],[4,1],[2,1],[0,133],[0,88],[2,1],[0,147],[0,57],[4,1],[2,1],[0,160],[0,10],[0,26],[8,1],[2,1],[0,162],[2,1],[0,103],[2,1],[0,87],[0,73],[6,1],[2,1],[0,148],[2,1],[0,119],[0,134],[2,1],[0,161],[2,1],[0,104],[0,149],[220,1],[126,1],[50,1],[26,1],[12,1],[6,1],[2,1],[0,42],[2,1],[0,89],[0,58],[2,1],[0,163],[2,1],[0,135],[0,120],[8,1],[4,1],[2,1],[0,164],[0,74],[2,1],[0,150],[0,105],[4,1],[2,1],[0,176],[0,11],[0,177],[10,1],[4,1],[2,1],[0,27],[0,178],[2,1],[0,43],[2,1],[0,165],[0,90],[6,1],[2,1],[0,179],[2,1],[0,166],[0,106],[4,1],[2,1],[0,180],[0,75],[2,1],[0,12],[0,193],[30,1],[14,1],[6,1],[4,1],[2,1],[0,181],[0,194],[0,44],[4,1],[2,1],[0,167],[0,195],[2,1],[0,107],[0,196],[8,1],[2,1],[0,29],[4,1],[2,1],[0,136],[0,151],[0,59],[4,1],[2,1],[0,209],[0,210],[2,1],[0,45],[0,211],[18,1],[6,1],[4,1],[2,1],[0,30],[0,46],[0,226],[6,1],[4,1],[2,1],[0,121],[0,152],[0,192],[2,1],[0,28],[2,1],[0,137],[0,91],[14,1],[6,1],[2,1],[0,60],[2,1],[0,122],[0,182],[4,1],[2,1],[0,76],[0,153],[2,1],[0,168],[0,138],[6,1],[2,1],[0,13],[2,1],[0,197],[0,92],[4,1],[2,1],[0,61],[0,198],[2,1],[0,108],[0,154],[88,1],[86,1],[36,1],[16,1],[8,1],[4,1],[2,1],[0,139],[0,77],[2,1],[0,199],[0,124],[4,1],[2,1],[0,213],[0,93],[2,1],[0,224],[0,14],[8,1],[2,1],[0,227],[4,1],[2,1],[0,208],[0,183],[0,123],[6,1],[4,1],[2,1],[0,169],[0,184],[0,212],[2,1],[0,225],[2,1],[0,170],[0,185],[24,1],[10,1],[6,1],[4,1],[2,1],[0,155],[0,214],[0,109],[2,1],[0,62],[0,200],[6,1],[4,1],[2,1],[0,140],[0,228],[0,78],[4,1],[2,1],[0,215],[0,229],[2,1],[0,186],[0,171],[12,1],[4,1],[2,1],[0,156],[0,230],[4,1],[2,1],[0,110],[0,216],[2,1],[0,141],[0,187],[8,1],[4,1],[2,1],[0,231],[0,157],[2,1],[0,232],[0,142],[4,1],[2,1],[0,203],[0,188],[0,158],[0,241],[2,1],[0,31],[2,1],[0,15],[0,47],[66,1],[56,1],[2,1],[0,242],[52,1],[50,1],[20,1],[8,1],[2,1],[0,189],[2,1],[0,94],[2,1],[0,125],[0,201],[6,1],[2,1],[0,202],[2,1],[0,172],[0,126],[4,1],[2,1],[0,218],[0,173],[0,204],[10,1],[6,1],[2,1],[0,174],[2,1],[0,219],[0,220],[2,1],[0,205],[0,190],[6,1],[4,1],[2,1],[0,235],[0,237],[0,238],[6,1],[4,1],[2,1],[0,217],[0,234],[0,233],[2,1],[0,222],[4,1],[2,1],[0,221],[0,236],[0,206],[0,63],[0,240],[4,1],[2,1],[0,243],[0,244],[2,1],[0,79],[2,1],[0,245],[0,95],[10,1],[2,1],[0,255],[4,1],[2,1],[0,246],[0,111],[2,1],[0,247],[0,127],[12,1],[6,1],[2,1],[0,143],[2,1],[0,248],[0,249],[4,1],[2,1],[0,159],[0,250],[0,175],[8,1],[4,1],[2,1],[0,251],[0,191],[2,1],[0,252],[0,207],[4,1],[2,1],[0,253],[0,223],[2,1],[0,254],[0,239]],D.ValTab24=[[60,1],[8,1],[4,1],[2,1],[0,0],[0,16],[2,1],[0,1],[0,17],[14,1],[6,1],[4,1],[2,1],[0,32],[0,2],[0,33],[2,1],[0,18],[2,1],[0,34],[2,1],[0,48],[0,3],[14,1],[4,1],[2,1],[0,49],[0,19],[4,1],[2,1],[0,50],[0,35],[4,1],[2,1],[0,64],[0,4],[0,65],[8,1],[4,1],[2,1],[0,20],[0,51],[2,1],[0,66],[0,36],[6,1],[4,1],[2,1],[0,67],[0,52],[0,81],[6,1],[4,1],[2,1],[0,80],[0,5],[0,21],[2,1],[0,82],[0,37],[250,1],[98,1],[34,1],[18,1],[10,1],[4,1],[2,1],[0,68],[0,83],[2,1],[0,53],[2,1],[0,96],[0,6],[4,1],[2,1],[0,97],[0,22],[2,1],[0,98],[0,38],[8,1],[4,1],[2,1],[0,84],[0,69],[2,1],[0,99],[0,54],[4,1],[2,1],[0,113],[0,85],[2,1],[0,100],[0,70],[32,1],[14,1],[6,1],[2,1],[0,114],[2,1],[0,39],[0,55],[2,1],[0,115],[4,1],[2,1],[0,112],[0,7],[0,23],[10,1],[4,1],[2,1],[0,101],[0,86],[4,1],[2,1],[0,128],[0,8],[0,129],[4,1],[2,1],[0,116],[0,71],[2,1],[0,24],[0,130],[16,1],[8,1],[4,1],[2,1],[0,40],[0,102],[2,1],[0,131],[0,56],[4,1],[2,1],[0,117],[0,87],[2,1],[0,132],[0,72],[8,1],[4,1],[2,1],[0,145],[0,25],[2,1],[0,146],[0,118],[4,1],[2,1],[0,103],[0,41],[2,1],[0,133],[0,88],[92,1],[34,1],[16,1],[8,1],[4,1],[2,1],[0,147],[0,57],[2,1],[0,148],[0,73],[4,1],[2,1],[0,119],[0,134],[2,1],[0,104],[0,161],[8,1],[4,1],[2,1],[0,162],[0,42],[2,1],[0,149],[0,89],[4,1],[2,1],[0,163],[0,58],[2,1],[0,135],[2,1],[0,120],[0,74],[22,1],[12,1],[4,1],[2,1],[0,164],[0,150],[4,1],[2,1],[0,105],[0,177],[2,1],[0,27],[0,165],[6,1],[2,1],[0,178],[2,1],[0,90],[0,43],[2,1],[0,136],[0,179],[16,1],[10,1],[6,1],[2,1],[0,144],[2,1],[0,9],[0,160],[2,1],[0,151],[0,121],[4,1],[2,1],[0,166],[0,106],[0,180],[12,1],[6,1],[2,1],[0,26],[2,1],[0,10],[0,176],[2,1],[0,59],[2,1],[0,11],[0,192],[4,1],[2,1],[0,75],[0,193],[2,1],[0,152],[0,137],[67,1],[34,1],[16,1],[8,1],[4,1],[2,1],[0,28],[0,181],[2,1],[0,91],[0,194],[4,1],[2,1],[0,44],[0,167],[2,1],[0,122],[0,195],[10,1],[6,1],[2,1],[0,60],[2,1],[0,12],[0,208],[2,1],[0,182],[0,107],[4,1],[2,1],[0,196],[0,76],[2,1],[0,153],[0,168],[16,1],[8,1],[4,1],[2,1],[0,138],[0,197],[2,1],[0,92],[0,209],[4,1],[2,1],[0,183],[0,123],[2,1],[0,29],[0,210],[9,1],[4,1],[2,1],[0,45],[0,211],[2,1],[0,61],[0,198],[85,250],[4,1],[2,1],[0,108],[0,169],[2,1],[0,154],[0,212],[32,1],[16,1],[8,1],[4,1],[2,1],[0,184],[0,139],[2,1],[0,77],[0,199],[4,1],[2,1],[0,124],[0,213],[2,1],[0,93],[0,225],[8,1],[4,1],[2,1],[0,30],[0,226],[2,1],[0,170],[0,185],[4,1],[2,1],[0,155],[0,227],[2,1],[0,214],[0,109],[20,1],[10,1],[6,1],[2,1],[0,62],[2,1],[0,46],[0,78],[2,1],[0,200],[0,140],[4,1],[2,1],[0,228],[0,215],[4,1],[2,1],[0,125],[0,171],[0,229],[10,1],[4,1],[2,1],[0,186],[0,94],[2,1],[0,201],[2,1],[0,156],[0,110],[8,1],[2,1],[0,230],[2,1],[0,13],[2,1],[0,224],[0,14],[4,1],[2,1],[0,216],[0,141],[2,1],[0,187],[0,202],[74,1],[2,1],[0,255],[64,1],[58,1],[32,1],[16,1],[8,1],[4,1],[2,1],[0,172],[0,231],[2,1],[0,126],[0,217],[4,1],[2,1],[0,157],[0,232],[2,1],[0,142],[0,203],[8,1],[4,1],[2,1],[0,188],[0,218],[2,1],[0,173],[0,233],[4,1],[2,1],[0,158],[0,204],[2,1],[0,219],[0,189],[16,1],[8,1],[4,1],[2,1],[0,234],[0,174],[2,1],[0,220],[0,205],[4,1],[2,1],[0,235],[0,190],[2,1],[0,221],[0,236],[8,1],[4,1],[2,1],[0,206],[0,237],[2,1],[0,222],[0,238],[0,15],[4,1],[2,1],[0,240],[0,31],[0,241],[4,1],[2,1],[0,242],[0,47],[2,1],[0,243],[0,63],[18,1],[8,1],[4,1],[2,1],[0,244],[0,79],[2,1],[0,245],[0,95],[4,1],[2,1],[0,246],[0,111],[2,1],[0,247],[2,1],[0,127],[0,143],[10,1],[4,1],[2,1],[0,248],[0,249],[4,1],[2,1],[0,159],[0,175],[0,250],[8,1],[4,1],[2,1],[0,251],[0,191],[2,1],[0,252],[0,207],[4,1],[2,1],[0,253],[0,223],[2,1],[0,254],[0,239]],	D.ValTab32=[[2,1],[0,0],[8,1],[4,1],[2,1],[0,8],[0,4],[2,1],[0,1],[0,2],[8,1],[4,1],[2,1],[0,12],[0,10],[2,1],[0,3],[0,6],[6,1],[2,1],[0,9],[2,1],[0,5],[0,7],[4,1],[2,1],[0,14],[0,13],[2,1],[0,15],[0,11]],D.ValTab33=[[16,1],[8,1],[4,1],[2,1],[0,0],[0,1],[2,1],[0,2],[0,3],[4,1],[2,1],[0,4],[0,5],[2,1],[0,6],[0,7],[8,1],[4,1],[2,1],[0,8],[0,9],[2,1],[0,10],[0,11],[4,1],[2,1],[0,12],[0,13],[2,1],[0,14],[0,15]],D.ht=null,D.initHuff=function(){if(D.ht!=null)return;D.ht=[],D.ht[0]=new D("0  ",0,0,0,0,-1,D.ValTab0,0),D.ht[1]=new D("1  ",2,2,0,0,-1,D.ValTab1,7),D.ht[2]=new D("2  ",3,3,0,0,-1,D.ValTab2,17),D.ht[3]=new D("3  ",3,3,0,0,-1,D.ValTab3,17),D.ht[4]=new D("4  ",0,0,0,0,-1,D.ValTab4,0),D.ht[5]=new D("5  ",4,4,0,0,-1,D.ValTab5,31),D.ht[6]=new D("6  ",4,4,0,0,-1,D.ValTab6,31),D.ht[7]=new D("7  ",6,6,0,0,-1,D.ValTab7,71),D.ht[8]=new D("8  ",6,6,0,0,-1,D.ValTab8,71),D.ht[9]=new D("9  ",6,6,0,0,-1,D.ValTab9,71),D.ht[10]=new D("10 ",8,8,0,0,-1,D.ValTab10,127),D.ht[11]=new D("11 ",8,8,0,0,-1,D.ValTab11,127),D.ht[12]=new D("12 ",8,8,0,0,-1,D.ValTab12,127),D.ht[13]=new D("13 ",16,16,0,0,-1,D.ValTab13,511),D.ht[14]=new D("14 ",0,0,0,0,-1,D.ValTab14,0),D.ht[15]=new D("15 ",16,16,0,0,-1,D.ValTab15,511),D.ht[16]=new D("16 ",16,16,1,1,-1,D.ValTab16,511),D.ht[17]=new D("17 ",16,16,2,3,16,D.ValTab16,511),D.ht[18]=new D("18 ",16,16,3,7,16,D.ValTab16,511),D.ht[19]=new D("19 ",16,16,4,15,16,D.ValTab16,511),D.ht[20]=new D("20 ",16,16,6,63,16,D.ValTab16,511),D.ht[21]=new D("21 ",16,16,8,255,16,D.ValTab16,511),D.ht[22]=new D("22 ",16,16,10,1023,16,D.ValTab16,511),D.ht[23]=new D("23 ",16,16,13,8191,16,D.ValTab16,511),D.ht[24]=new D("24 ",16,16,4,15,-1,D.ValTab24,512),D.ht[25]=new D("25 ",16,16,5,31,24,D.ValTab24,512),D.ht[26]=new D("26 ",16,16,6,63,24,D.ValTab24,512),D.ht[27]=new D("27 ",16,16,7,127,24,D.ValTab24,512),D.ht[28]=new D("28 ",16,16,8,255,24,D.ValTab24,512),D.ht[29]=new D("29 ",16,16,9,511,24,D.ValTab24,512),D.ht[30]=new D("30 ",16,16,11,2047,24,D.ValTab24,512),D.ht[31]=new D("31 ",16,16,13,8191,24,D.ValTab24,512),D.ht[32]=new D("32 ",1,16,0,0,-1,D.ValTab32,31),D.ht[33]=new D("33 ",1,16,0,0,-1,D.ValTab33,31)},D.huffman_decoder=function(h,x,y,v,w,_){var a=1<<((4*8)-1),b=0,c=1;if(h.val==null)return 2;if(h.treelen==0)return x[0]=y[0]=0,0;do{if(h.val[b][0]==0){x[0]=h.val[b][1]>>>4,y[0]=h.val[b][1]&0xf,c=0;break}if(_.hget1bit()!=0){while(h.val[b][1]>=D.MXOFF)b+=h.val[b][1];b+=h.val[b][1]}else{while(h.val[b][0]>=D.MXOFF)b+=h.val[b][0];b+=h.val[b][0]}a>>>=1}while((a!=0)||(b<0));if(h.tablename0=='3'&&(h.tablename1=='2'||h.tablename1=='3')){v[0]=(y[0]>>3)&1,w[0]=(y[0]>>2)&1,x[0]=(y[0]>>1)&1,y[0]=y[0]&1;if(v[0]!=0)if(_.hget1bit()!=0) v[0]=-v[0];if(w[0]!=0)if(_.hget1bit()!=0) w[0]=-w[0];if(x[0]!=0)if(_.hget1bit()!=0) x[0]=-x[0];if(y[0]!=0)if(_.hget1bit()!=0) y[0]=-y[0]}else{if(h.linbits!=0) if((h.xlen-1)==x[0]) x[0]+=_.hgetbits(h.linbits);if(x[0]!=0) if(_.hget1bit()!=0) x[0]=-x[0];if(h.linbits!=0) if((h.ylen-1)==y[0]) y[0]+=_.hgetbits(h.linbits);if(y[0]!=0) if(_.hget1bit()!=0) y[0]=-y[0]}return c};var E=function(a,b,c){if(E.d==null)E.d=E.load_d(),E.d16=E.splitArray(E.d,16);this.v1=new Float32Array(512),this.v2=new Float32Array(512),this._tmpOut=new Float32Array(32),this.samples=new Float32Array(32),this.channel=a,this.scalefactor=b,this.setEQ(c),this.reset()};E.d=null,E.d16=null,E.load_d=function(){return new Float32Array([0.000000000,-0.000442505, 0.003250122,-0.007003784,0.031082153,-0.078628540, 0.100311279,-0.572036743,1.144989014, 0.572036743, 0.100311279, 0.078628540,0.031082153, 0.007003784, 0.003250122, 0.000442505,-0.000015259,-0.000473022, 0.003326416,-0.007919312,0.030517578,-0.084182739, 0.090927124,-0.600219727,1.144287109, 0.543823242, 0.108856201, 0.073059082,0.031478882, 0.006118774, 0.003173828, 0.000396729,-0.000015259,-0.000534058, 0.003387451,-0.008865356,0.029785156,-0.089706421, 0.080688477,-0.628295898,1.142211914, 0.515609741, 0.116577148, 0.067520142,0.031738281, 0.005294800, 0.003082275, 0.000366211,-0.000015259,-0.000579834, 0.003433228,-0.009841919,0.028884888,-0.095169067, 0.069595337,-0.656219482,1.138763428, 0.487472534, 0.123474121, 0.061996460,0.031845093, 0.004486084, 0.002990723, 0.000320435,-0.000015259,-0.000625610, 0.003463745,-0.010848999,0.027801514,-0.100540161, 0.057617188,-0.683914185,1.133926392, 0.459472656, 0.129577637, 0.056533813,0.031814575, 0.003723145, 0.002899170, 0.000289917,-0.000015259,-0.000686646, 0.003479004,-0.011886597,0.026535034,-0.105819702, 0.044784546,-0.711318970,1.127746582, 0.431655884, 0.134887695, 0.051132202,0.031661987, 0.003005981, 0.002792358, 0.000259399,-0.000015259,-0.000747681, 0.003479004,-0.012939453,0.025085449,-0.110946655, 0.031082153,-0.738372803,1.120223999, 0.404083252, 0.139450073, 0.045837402,0.031387329, 0.002334595, 0.002685547, 0.000244141,-0.000030518,-0.000808716, 0.003463745,-0.014022827,0.023422241,-0.115921021, 0.016510010,-0.765029907,1.111373901, 0.376800537, 0.143264771, 0.040634155,0.031005859, 0.001693726, 0.002578735, 0.000213623,-0.000030518,-0.000885010, 0.003417969,-0.015121460,0.021575928,-0.120697021, 0.001068115,-0.791213989,1.101211548, 0.349868774, 0.146362305, 0.035552979,0.030532837, 0.001098633, 0.002456665, 0.000198364,-0.000030518,-0.000961304, 0.003372192,-0.016235352,0.019531250,-0.125259399,-0.015228271,-0.816864014,1.089782715, 0.323318481, 0.148773193, 0.030609131,0.029937744, 0.000549316, 0.002349854, 0.000167847,-0.000030518,-0.001037598, 0.003280640,-0.017349243,0.017257690,-0.129562378,-0.032379150,-0.841949463,1.077117920, 0.297210693, 0.150497437, 0.025817871,0.029281616, 0.000030518, 0.002243042, 0.000152588,-0.000045776,-0.001113892, 0.003173828,-0.018463135,0.014801025,-0.133590698,-0.050354004,-0.866363525,1.063217163, 0.271591187, 0.151596069, 0.021179199,0.028533936,-0.000442505, 0.002120972, 0.000137329,-0.000045776,-0.001205444, 0.003051758,-0.019577026,0.012115479,-0.137298584,-0.069168091,-0.890090942,1.048156738, 0.246505737, 0.152069092, 0.016708374,0.027725220,-0.000869751, 0.002014160, 0.000122070,-0.000061035,-0.001296997, 0.002883911,-0.020690918,0.009231567,-0.140670776,-0.088775635,-0.913055420,1.031936646, 0.221984863, 0.151962280, 0.012420654,0.026840210,-0.001266479, 0.001907349, 0.000106812,-0.000061035,-0.001388550, 0.002700806,-0.021789551,0.006134033,-0.143676758,-0.109161377,-0.935195923,1.014617920, 0.198059082, 0.151306152, 0.008316040,0.025909424,-0.001617432, 0.001785278, 0.000106812,-0.000076294,-0.001480103, 0.002487183,-0.022857666,0.002822876,-0.146255493,-0.130310059,-0.956481934,0.996246338, 0.174789429, 0.150115967, 0.004394531,0.024932861,-0.001937866, 0.001693726, 0.000091553,-0.000076294,-0.001586914, 0.002227783,-0.023910522,-0.000686646,-0.148422241,-0.152206421,-0.976852417,0.976852417, 0.152206421, 0.148422241, 0.000686646,0.023910522,-0.002227783, 0.001586914, 0.000076294,-0.000091553,-0.001693726, 0.001937866,-0.024932861,-0.004394531,-0.150115967,-0.174789429,-0.996246338,0.956481934, 0.130310059, 0.146255493,-0.002822876,0.022857666,-0.002487183, 0.001480103, 0.000076294,-0.000106812,-0.001785278, 0.001617432,-0.025909424,-0.008316040,-0.151306152,-0.198059082,-1.014617920,0.935195923, 0.109161377, 0.143676758,-0.006134033,0.021789551,-0.002700806, 0.001388550, 0.000061035,-0.000106812,-0.001907349, 0.001266479,-0.026840210,-0.012420654,-0.151962280,-0.221984863,-1.031936646,0.913055420, 0.088775635, 0.140670776,-0.009231567,0.020690918,-0.002883911, 0.001296997, 0.000061035,-0.000122070,-0.002014160, 0.000869751,-0.027725220,-0.016708374,-0.152069092,-0.246505737,-1.048156738,0.890090942, 0.069168091, 0.137298584,-0.012115479,0.019577026,-0.003051758, 0.001205444, 0.000045776,-0.000137329,-0.002120972, 0.000442505,-0.028533936,-0.021179199,-0.151596069,-0.271591187,-1.063217163,0.866363525, 0.050354004, 0.133590698,-0.014801025,0.018463135,-0.003173828, 0.001113892, 0.000045776,-0.000152588,-0.002243042,-0.000030518,-0.029281616,-0.025817871,-0.150497437,-0.297210693,-1.077117920,0.841949463, 0.032379150, 0.129562378,-0.017257690,0.017349243,-0.003280640, 0.001037598, 0.000030518,-0.000167847,-0.002349854,-0.000549316,-0.029937744,-0.030609131,-0.148773193,-0.323318481,-1.089782715,0.816864014, 0.015228271, 0.125259399,-0.019531250,0.016235352,-0.003372192, 0.000961304, 0.000030518,-0.000198364,-0.002456665,-0.001098633,-0.030532837,-0.035552979,-0.146362305,-0.349868774,-1.101211548,0.791213989,-0.001068115, 0.120697021,-0.021575928,0.015121460,-0.003417969, 0.000885010, 0.000030518,-0.000213623,-0.002578735,-0.001693726,-0.031005859,-0.040634155,-0.143264771,-0.376800537,-1.111373901,0.765029907,-0.016510010, 0.115921021,-0.023422241,0.014022827,-0.003463745, 0.000808716, 0.000030518,-0.000244141,-0.002685547,-0.002334595,-0.031387329,-0.045837402,-0.139450073,-0.404083252,-1.120223999,0.738372803,-0.031082153, 0.110946655,-0.025085449,0.012939453,-0.003479004, 0.000747681, 0.000015259,-0.000259399,-0.002792358,-0.003005981,-0.031661987,-0.051132202,-0.134887695,-0.431655884,-1.127746582,0.711318970,-0.044784546, 0.105819702,-0.026535034,0.011886597,-0.003479004, 0.000686646, 0.000015259,-0.000289917,-0.002899170,-0.003723145,-0.031814575,-0.056533813,-0.129577637,-0.459472656,-1.133926392,0.683914185,-0.057617188, 0.100540161,-0.027801514,0.010848999,-0.003463745, 0.000625610, 0.000015259,-0.000320435,-0.002990723,-0.004486084,-0.031845093,-0.061996460,-0.123474121,-0.487472534,-1.138763428,0.656219482,-0.069595337, 0.095169067,-0.028884888,0.009841919,-0.003433228, 0.000579834, 0.000015259,-0.000366211,-0.003082275,-0.005294800,-0.031738281,-0.067520142,-0.116577148,-0.515609741,-1.142211914,0.628295898,-0.080688477, 0.089706421,-0.029785156,0.008865356,-0.003387451, 0.000534058, 0.000015259,-0.000396729,-0.003173828,-0.006118774,-0.031478882,-0.073059082,-0.108856201,-0.543823242,-1.144287109,0.600219727,-0.090927124, 0.084182739,-0.030517578,0.007919312,-0.003326416, 0.000473022, 0.000015259])},E.subArray=function(a,b,c){if(b+c>a.length)c=a.length-b;if(c<0)c=0;var _=new Float32Array(c);return arraycopy(a,b+0,_,0,c),_},E.splitArray=function(a,b){var c=(a.length/b)|0;var d=new Array(c);for(var i=0;i<c;i++)d[i]=E.subArray(a,i*b,b);return d},E.prototype.setEQ=function(eq0){this.eq=eq0;if(this.eq==null){this.eq=new Float32Array(32);for(var i=0;i<32;i++)this.eq[i]=1}if(this.eq.length<32)throw new Error("IllegalArgumentException(eq0)")},E.prototype.reset=function(){for(var p=0;p<512;p++)this.v1[p]=this.v2[p]=0.0;for(var p2=0;p2<32;p2++)this.samples[p2]=0.0;this.actual_v=this.v1,this.actual_write_pos=15},E.prototype.input_sample=function(){},E.prototype.input_samples=function(s){for(var i=31;i>=0;i--)this.samples[i]=s[i]*this.eq[i]},E.prototype.compute_new_v=function(){var v0=0,v1=0,v2=0,v3=0,v4=0,v5=0,v6=0,v7=0,v8=0,v9=0;var v10=0,v11=0,v12=0,v13=0,v14=0,v15=0,v16=0,v17=0,v18=0,v19=0;var v20=0,v21=0,v22=0,v23=0,v24=0,v25=0,v26=0,v27=0,v28=0,v29=0;var v30=0,v31=0;var a,d,s=this.samples;var s0=s[0],s1=s[1],s2=s[2],s3=s[3],s4=s[4],s5=s[5],s6=s[6],s7=s[7],s8=s[8],s9=s[9],s10=s[10],s11=s[11],s12=s[12],s13=s[13],s14=s[14],s15=s[15],s16=s[16],s17=s[17],s18=s[18],s19=s[19],s20=s[20],s21=s[21],s22=s[22],s23=s[23],s24=s[24],s25=s[25],s26=s[26],s27=s[27],s28=s[28],s29=s[29],s30=s[30],s31=s[31];var p0=s0+s31,p1=s1+s30,p2=s2+s29,p3=s3+s28,p4=s4+s27,p5=s5+s26,p6=s6+s25,p7=s7+s24,p8=s8+s23,p9=s9+s22,p10=s10+s21,p11=s11+s20,p12=s12+s19,p13=s13+s18,p14=s14+s17,p15=s15+s16;var pp0=p0+p15,pp1=p1+p14,pp2=p2+p13,pp3=p3+p12,pp4=p4+p11,pp5=p5+p10,pp6=p6+p9,pp7=p7+p8;var pp8=(p0-p15)*E.cos1_32,pp9=(p1-p14)*E.cos3_32,pp10=(p2-p13)*E.cos5_32,pp11=(p3-p12)*E.cos7_32,pp12=(p4-p11)*E.cos9_32,pp13=(p5-p10)*E.cos11_32,pp14=(p6-p9)*E.cos13_32,pp15=(p7-p8)*E.cos15_32;p0=pp0+pp7,p1=pp1+pp6,p2=pp2+pp5,p3=pp3+pp4,p4=(pp0-pp7)*E.cos1_16,p5=(pp1-pp6)*E.cos3_16,p6=(pp2-pp5)*E.cos5_16,p7=(pp3-pp4)*E.cos7_16,p8=pp8+pp15,p9=pp9+pp14,p10=pp10+pp13,p11=pp11+pp12,p12=(pp8-pp15)*E.cos1_16,p13=(pp9-pp14)*E.cos3_16,p14=(pp10-pp13)*E.cos5_16,p15=(pp11-pp12)*E.cos7_16,pp0=p0+p3,pp1=p1+p2,pp2=(p0-p3)*E.cos1_8,pp3=(p1-p2)*E.cos3_8,pp4=p4+p7,pp5=p5+p6,pp6=(p4-p7)*E.cos1_8,pp7=(p5-p6)*E.cos3_8,pp8=p8+p11,pp9=p9+p10,pp10=(p8-p11)*E.cos1_8,pp11=(p9-p10)*E.cos3_8,pp12=p12+p15,pp13=p13+p14,pp14=(p12-p15)*E.cos1_8,pp15=(p13-p14)*E.cos3_8,p0=pp0+pp1,p1=(pp0-pp1)*E.cos1_4,p2=pp2+pp3,p3=(pp2-pp3)*E.cos1_4,p4=pp4+pp5,p5=(pp4-pp5)*E.cos1_4,p6=pp6+pp7,p7=(pp6-pp7)*E.cos1_4,p8=pp8+pp9,p9=(pp8-pp9)*E.cos1_4,p10=pp10+pp11,p11=(pp10-pp11)*E.cos1_4,p12=pp12+pp13,p13=(pp12-pp13)*E.cos1_4,p14=pp14+pp15,p15=(pp14-pp15)*E.cos1_4,v19=-(v4=(v12=p7)+p5)-p6,v27=-p6-p7-p4,v6=(v10=(v14=p15)+p11)+p13,v17=-(v2=p15+p13+p9)-p14,v21=(a=-p14-p15-p10-p11)-p13,v29=-p14-p15-p12-p8,v25=a-p12,v31=-p0,v0=p1,v23=-(v8=p3)-p2,p0=(s0-s31)*E.cos1_64,p1=(s1-s30)*E.cos3_64,p2=(s2-s29)*E.cos5_64,p3=(s3-s28)*E.cos7_64,p4=(s4-s27)*E.cos9_64,p5=(s5-s26)*E.cos11_64,p6=(s6-s25)*E.cos13_64,p7=(s7-s24)*E.cos15_64,p8=(s8-s23)*E.cos17_64,p9=(s9-s22)*E.cos19_64,p10=(s10-s21)*E.cos21_64,p11=(s11-s20)*E.cos23_64,p12=(s12-s19)*E.cos25_64,p13=(s13-s18)*E.cos27_64,p14=(s14-s17)*E.cos29_64,p15=(s15-s16)*E.cos31_64,pp0=p0+p15,pp1=p1+p14,pp2=p2+p13,pp3=p3+p12,pp4=p4+p11,pp5=p5+p10,pp6=p6+p9,pp7=p7+p8,pp8=(p0-p15)*E.cos1_32,pp9=(p1-p14)*E.cos3_32,pp10=(p2-p13)*E.cos5_32,pp11=(p3-p12)*E.cos7_32,pp12=(p4-p11)*E.cos9_32,pp13=(p5-p10)*E.cos11_32,pp14=(p6-p9)*E.cos13_32,pp15=(p7-p8)*E.cos15_32,p0=pp0+pp7,p1=pp1+pp6,p2=pp2+pp5,p3=pp3+pp4,p4=(pp0-pp7)*E.cos1_16,p5=(pp1-pp6)*E.cos3_16,p6=(pp2-pp5)*E.cos5_16,p7=(pp3-pp4)*E.cos7_16,p8=pp8+pp15,p9=pp9+pp14,p10=pp10+pp13,p11=pp11+pp12,p12=(pp8-pp15)*E.cos1_16,p13=(pp9-pp14)*E.cos3_16,p14=(pp10-pp13)*E.cos5_16,p15=(pp11-pp12)*E.cos7_16,pp0=p0+p3,pp1=p1+p2,pp2=(p0-p3)*E.cos1_8,pp3=(p1-p2)*E.cos3_8,pp4=p4+p7,pp5=p5+p6,pp6=(p4-p7)*E.cos1_8,pp7=(p5-p6)*E.cos3_8,pp8=p8+p11,pp9=p9+p10,pp10=(p8-p11)*E.cos1_8,pp11=(p9-p10)*E.cos3_8,pp12=p12+p15,pp13=p13+p14,pp14=(p12-p15)*E.cos1_8,pp15=(p13-p14)*E.cos3_8,p0=pp0+pp1,p1=(pp0-pp1)*E.cos1_4,p2=pp2+pp3,p3=(pp2-pp3)*E.cos1_4,p4=pp4+pp5,p5=(pp4-pp5)*E.cos1_4,p6=pp6+pp7,p7=(pp6-pp7)*E.cos1_4,p8=pp8+pp9,p9=(pp8-pp9)*E.cos1_4,p10=pp10+pp11,p11=(pp10-pp11)*E.cos1_4,p12=pp12+pp13,p13=(pp12-pp13)*E.cos1_4,p14=pp14+pp15,p15=(pp14-pp15)*E.cos1_4,v5=(v11=(v13=(v15=p15)+p7)+p11)+p5+p13,v7=(v9=p15+p11+p3)+p13,v16=-(v1=(a=p13+p15+p9)+p1)-p14,v18=-(v3=a+p5+p7)-p6-p14,v22=(a=-p10-p11-p14-p15)-p13-p2-p3,v20=a-p13-p5-p6-p7,v24=a-p12-p2-p3,v26=a-p12-(d=p4+p6+p7),v30=(a=-p8-p12-p14-p15)-p0,v28=a-d;var g=this.actual_v,f=this.actual_write_pos;g[0+f]=v0,g[16+f]=v1,g[32+f]=v2,g[48+f]=v3,g[64+f]=v4,g[80+f]=v5,g[96+f]=v6,g[112+f]=v7,g[128+f]=v8,g[144+f]=v9,g[160+f]=v10,g[176+f]=v11,g[192+f]=v12,g[208+f]=v13,g[224+f]=v14,g[240+f]=v15,g[256+f]=0,g[272+f]=-v15,g[288+f]=-v14,g[304+f]=-v13,g[320+f]=-v12,g[336+f]=-v11,g[352+f]=-v10,g[368+f]=-v9,g[384+f]=-v8,g[400+f]=-v7,g[416+f]=-v6,g[432+f]=-v5,g[448+f]=-v4,g[464+f]=-v3,g[480+f]=-v2,g[496+f]=-v1;g=(this.actual_v === this.v1)?this.v2:this.v1;g[0+f]=-v0,g[16+f]=v16,g[32+f]=v17,g[48+f]=v18,g[64+f]=v19,g[80+f]=v20,g[96+f]=v21,g[112+f]=v22,g[128+f]=v23,g[144+f]=v24,g[160+f]=v25,g[176+f]=v26,g[192+f]=v27,g[208+f]=v28,g[224+f]=v29,g[240+f]=v30,g[256+f]=v31,g[272+f]=v30,g[288+f]=v29,g[304+f]=v28,g[320+f]=v27,g[336+f]=v26,g[352+f]=v25,g[368+f]=v24,g[384+f]=v23,g[400+f]=v22,g[416+f]=v21,g[432+f]=v20,g[448+f]=v19,g[464+f]=v18,g[480+f]=v17,g[496+f]=v16},E.prototype.compute_pcm_samples0=function(){var vp=this.actual_v,_=this._tmpOut,dvp=0;for(var i=0;i<32;i++){var dp=E.d16[i];_[i]=((vp[0+dvp]*dp[0])+(vp[15+dvp]*dp[1])+(vp[14+dvp]*dp[2])+(vp[13+dvp]*dp[3])+(vp[12+dvp]*dp[4])+(vp[11+dvp]*dp[5])+(vp[10+dvp]*dp[6])+(vp[9+dvp]*dp[7])+(vp[8+dvp]*dp[8])+(vp[7+dvp]*dp[9])+(vp[6+dvp]*dp[10])+(vp[5+dvp]*dp[11])+(vp[4+dvp]*dp[12])+(vp[3+dvp]*dp[13])+(vp[2+dvp]*dp[14])+(vp[1+dvp]*dp[15]))*this.scalefactor;dvp+=16}},E.prototype.compute_pcm_samples1=function(){var vp=this.actual_v,_=this._tmpOut,dvp=0;for(var i=0;i<32;i++){var dp=E.d16[i];_[i]=((vp[1+dvp]*dp[0])+(vp[0+dvp]*dp[1])+(vp[15+dvp]*dp[2])+(vp[14+dvp]*dp[3])+(vp[13+dvp]*dp[4])+(vp[12+dvp]*dp[5])+(vp[11+dvp]*dp[6])+(vp[10+dvp]*dp[7])+(vp[9+dvp]*dp[8])+(vp[8+dvp]*dp[9])+(vp[7+dvp]*dp[10])+(vp[6+dvp]*dp[11])+(vp[5+dvp]*dp[12])+(vp[4+dvp]*dp[13])+(vp[3+dvp]*dp[14])+(vp[2+dvp]*dp[15]))*this.scalefactor;dvp+=16}},E.prototype.compute_pcm_samples2=function(){var vp=this.actual_v,_=this._tmpOut,dvp=0;for(var i=0;i<32;i++){var dp=E.d16[i];_[i]=((vp[2+dvp]*dp[0])+(vp[1+dvp]*dp[1])+(vp[0+dvp]*dp[2])+(vp[15+dvp]*dp[3])+(vp[14+dvp]*dp[4])+(vp[13+dvp]*dp[5])+(vp[12+dvp]*dp[6])+(vp[11+dvp]*dp[7])+(vp[10+dvp]*dp[8])+(vp[9+dvp]*dp[9])+(vp[8+dvp]*dp[10])+(vp[7+dvp]*dp[11])+(vp[6+dvp]*dp[12])+(vp[5+dvp]*dp[13])+(vp[4+dvp]*dp[14])+(vp[3+dvp]*dp[15]))*this.scalefactor;dvp+=16}},E.prototype.compute_pcm_samples3=function(){var vp=this.actual_v,_=this._tmpOut,dvp=0;for(var i=0;i<32;i++){var dp=E.d16[i];_[i]=((vp[3+dvp]*dp[0])+(vp[2+dvp]*dp[1])+(vp[1+dvp]*dp[2])+(vp[0+dvp]*dp[3])+(vp[15+dvp]*dp[4])+(vp[14+dvp]*dp[5])+(vp[13+dvp]*dp[6])+(vp[12+dvp]*dp[7])+(vp[11+dvp]*dp[8])+(vp[10+dvp]*dp[9])+(vp[9+dvp]*dp[10])+(vp[8+dvp]*dp[11])+(vp[7+dvp]*dp[12])+(vp[6+dvp]*dp[13])+(vp[5+dvp]*dp[14])+(vp[4+dvp]*dp[15]))*this.scalefactor;dvp+=16}},E.prototype.compute_pcm_samples4=function(){var vp=this.actual_v,_=this._tmpOut,dvp=0;for(var i=0;i<32;i++){var dp=E.d16[i];_[i]=((vp[4+dvp]*dp[0])+(vp[3+dvp]*dp[1])+(vp[2+dvp]*dp[2])+(vp[1+dvp]*dp[3])+(vp[0+dvp]*dp[4])+(vp[15+dvp]*dp[5])+(vp[14+dvp]*dp[6])+(vp[13+dvp]*dp[7])+(vp[12+dvp]*dp[8])+(vp[11+dvp]*dp[9])+(vp[10+dvp]*dp[10])+(vp[9+dvp]*dp[11])+(vp[8+dvp]*dp[12])+(vp[7+dvp]*dp[13])+(vp[6+dvp]*dp[14])+(vp[5+dvp]*dp[15]))*this.scalefactor;dvp+=16}},E.prototype.compute_pcm_samples5=function(){var vp=this.actual_v,_=this._tmpOut,dvp=0;for(var i=0;i<32;i++){var dp=E.d16[i];_[i]=((vp[5+dvp]*dp[0])+(vp[4+dvp]*dp[1])+(vp[3+dvp]*dp[2])+(vp[2+dvp]*dp[3])+(vp[1+dvp]*dp[4])+(vp[0+dvp]*dp[5])+(vp[15+dvp]*dp[6])+(vp[14+dvp]*dp[7])+(vp[13+dvp]*dp[8])+(vp[12+dvp]*dp[9])+(vp[11+dvp]*dp[10])+(vp[10+dvp]*dp[11])+(vp[9+dvp]*dp[12])+(vp[8+dvp]*dp[13])+(vp[7+dvp]*dp[14])+(vp[6+dvp]*dp[15]))*this.scalefactor;dvp+=16}},E.prototype.compute_pcm_samples6=function(){var vp=this.actual_v,_=this._tmpOut,dvp=0;for(var i=0;i<32;i++){var dp=E.d16[i];_[i]=((vp[6+dvp]*dp[0])+(vp[5+dvp]*dp[1])+(vp[4+dvp]*dp[2])+(vp[3+dvp]*dp[3])+(vp[2+dvp]*dp[4])+(vp[1+dvp]*dp[5])+(vp[0+dvp]*dp[6])+(vp[15+dvp]*dp[7])+(vp[14+dvp]*dp[8])+(vp[13+dvp]*dp[9])+(vp[12+dvp]*dp[10])+(vp[11+dvp]*dp[11])+(vp[10+dvp]*dp[12])+(vp[9+dvp]*dp[13])+(vp[8+dvp]*dp[14])+(vp[7+dvp]*dp[15]))*this.scalefactor;dvp+=16}},E.prototype.compute_pcm_samples7=function(){var vp=this.actual_v,_=this._tmpOut,dvp=0;for(var i=0;i<32;i++){var dp=E.d16[i];_[i]=((vp[7+dvp]*dp[0])+(vp[6+dvp]*dp[1])+(vp[5+dvp]*dp[2])+(vp[4+dvp]*dp[3])+(vp[3+dvp]*dp[4])+(vp[2+dvp]*dp[5])+(vp[1+dvp]*dp[6])+(vp[0+dvp]*dp[7])+(vp[15+dvp]*dp[8])+(vp[14+dvp]*dp[9])+(vp[13+dvp]*dp[10])+(vp[12+dvp]*dp[11])+(vp[11+dvp]*dp[12])+(vp[10+dvp]*dp[13])+(vp[9+dvp]*dp[14])+(vp[8+dvp]*dp[15]))*this.scalefactor;dvp+=16}},E.prototype.compute_pcm_samples8=function(){var vp=this.actual_v,_=this._tmpOut,dvp=0;for(var i=0;i<32;i++){var dp=E.d16[i];_[i]=((vp[8+dvp]*dp[0])+(vp[7+dvp]*dp[1])+(vp[6+dvp]*dp[2])+(vp[5+dvp]*dp[3])+(vp[4+dvp]*dp[4])+(vp[3+dvp]*dp[5])+(vp[2+dvp]*dp[6])+(vp[1+dvp]*dp[7])+(vp[0+dvp]*dp[8])+(vp[15+dvp]*dp[9])+(vp[14+dvp]*dp[10])+(vp[13+dvp]*dp[11])+(vp[12+dvp]*dp[12])+(vp[11+dvp]*dp[13])+(vp[10+dvp]*dp[14])+(vp[9+dvp]*dp[15]))*this.scalefactor;dvp+=16}},E.prototype.compute_pcm_samples9=function(){var vp=this.actual_v,_=this._tmpOut,dvp=0;for(var i=0;i<32;i++){var dp=E.d16[i];_[i]=((vp[9+dvp]*dp[0]) +(vp[8+dvp]*dp[1]) +(vp[7+dvp]*dp[2]) +(vp[6+dvp]*dp[3]) +(vp[5+dvp]*dp[4]) +(vp[4+dvp]*dp[5]) +(vp[3+dvp]*dp[6]) +(vp[2+dvp]*dp[7]) +(vp[1+dvp]*dp[8]) +(vp[0+dvp]*dp[9]) +(vp[15+dvp]*dp[10]) +(vp[14+dvp]*dp[11]) +(vp[13+dvp]*dp[12]) +(vp[12+dvp]*dp[13]) +(vp[11+dvp]*dp[14]) +(vp[10+dvp]*dp[15]))*this.scalefactor;dvp+=16}},E.prototype.compute_pcm_samples10=function(){var vp=this.actual_v,_=this._tmpOut,dvp=0;for(var i=0;i<32;i++){var dp=E.d16[i];_[i]=((vp[10+dvp]*dp[0])+(vp[9+dvp]*dp[1])+(vp[8+dvp]*dp[2])+(vp[7+dvp]*dp[3])+(vp[6+dvp]*dp[4])+(vp[5+dvp]*dp[5])+(vp[4+dvp]*dp[6])+(vp[3+dvp]*dp[7])+(vp[2+dvp]*dp[8])+(vp[1+dvp]*dp[9])+(vp[0+dvp]*dp[10])+(vp[15+dvp]*dp[11])+(vp[14+dvp]*dp[12])+(vp[13+dvp]*dp[13])+(vp[12+dvp]*dp[14])+(vp[11+dvp]*dp[15]))*this.scalefactor;dvp+=16}},E.prototype.compute_pcm_samples11=function(){var vp=this.actual_v,_=this._tmpOut,dvp=0;for(var i=0;i<32;i++){var dp=E.d16[i];_[i]=((vp[11+dvp]*dp[0])+(vp[10+dvp]*dp[1])+(vp[9+dvp]*dp[2])+(vp[8+dvp]*dp[3])+(vp[7+dvp]*dp[4])+(vp[6+dvp]*dp[5])+(vp[5+dvp]*dp[6])+(vp[4+dvp]*dp[7])+(vp[3+dvp]*dp[8])+(vp[2+dvp]*dp[9])+(vp[1+dvp]*dp[10])+(vp[0+dvp]*dp[11])+(vp[15+dvp]*dp[12])+(vp[14+dvp]*dp[13])+(vp[13+dvp]*dp[14])+(vp[12+dvp]*dp[15]))*this.scalefactor;dvp+=16}},E.prototype.compute_pcm_samples12=function(){var vp=this.actual_v,_=this._tmpOut,dvp=0;for(var i=0;i<32;i++){var dp=E.d16[i];_[i]=((vp[12+dvp]*dp[0])+(vp[11+dvp]*dp[1])+(vp[10+dvp]*dp[2])+(vp[9+dvp]*dp[3])+(vp[8+dvp]*dp[4])+(vp[7+dvp]*dp[5])+(vp[6+dvp]*dp[6])+(vp[5+dvp]*dp[7])+(vp[4+dvp]*dp[8])+(vp[3+dvp]*dp[9])+(vp[2+dvp]*dp[10])+(vp[1+dvp]*dp[11])+(vp[0+dvp]*dp[12])+(vp[15+dvp]*dp[13])+(vp[14+dvp]*dp[14])+(vp[13+dvp]*dp[15]))*this.scalefactor;dvp+=16}},E.prototype.compute_pcm_samples13=function(){var vp=this.actual_v,_=this._tmpOut,dvp=0;for(var i=0;i<32;i++){var dp=E.d16[i];_[i]=((vp[13+dvp]*dp[0])+(vp[12+dvp]*dp[1])+(vp[11+dvp]*dp[2])+(vp[10+dvp]*dp[3])+(vp[9+dvp]*dp[4])+(vp[8+dvp]*dp[5])+(vp[7+dvp]*dp[6])+(vp[6+dvp]*dp[7])+(vp[5+dvp]*dp[8])+(vp[4+dvp]*dp[9])+(vp[3+dvp]*dp[10])+(vp[2+dvp]*dp[11])+(vp[1+dvp]*dp[12])+(vp[0+dvp]*dp[13])+(vp[15+dvp]*dp[14])+(vp[14+dvp]*dp[15]))*this.scalefactor;dvp+=16}},E.prototype.compute_pcm_samples14=function(){var vp=this.actual_v,_=this._tmpOut,dvp=0;for(var i=0;i<32;i++){var dp=E.d16[i];_[i]=((vp[14+dvp]*dp[0])+(vp[13+dvp]*dp[1])+(vp[12+dvp]*dp[2])+(vp[11+dvp]*dp[3])+(vp[10+dvp]*dp[4])+(vp[9+dvp]*dp[5])+(vp[8+dvp]*dp[6])+(vp[7+dvp]*dp[7])+(vp[6+dvp]*dp[8])+(vp[5+dvp]*dp[9])+(vp[4+dvp]*dp[10])+(vp[3+dvp]*dp[11])+(vp[2+dvp]*dp[12])+(vp[1+dvp]*dp[13])+(vp[0+dvp]*dp[14])+(vp[15+dvp]*dp[15]))*this.scalefactor;dvp+=16}},E.prototype.compute_pcm_samples15=function(){var vp=this.actual_v,_=this._tmpOut,dvp=0;for(var i=0;i<32;i++){var dp=E.d16[i];_[i]=((vp[15+dvp]*dp[0])+(vp[14+dvp]*dp[1])+(vp[13+dvp]*dp[2])+(vp[12+dvp]*dp[3])+(vp[11+dvp]*dp[4])+(vp[10+dvp]*dp[5])+(vp[9+dvp]*dp[6])+(vp[8+dvp]*dp[7])+(vp[7+dvp]*dp[8])+(vp[6+dvp]*dp[9])+(vp[5+dvp]*dp[10])+(vp[4+dvp]*dp[11])+(vp[3+dvp]*dp[12])+(vp[2+dvp]*dp[13])+(vp[1+dvp]*dp[14])+(vp[0+dvp]*dp[15]))*this.scalefactor;dvp+=16}},E.prototype.compute_pcm_samples=function(_){switch (this.actual_write_pos){case 0:this.compute_pcm_samples0();break;case 1:this.compute_pcm_samples1();break;case 2:this.compute_pcm_samples2();break;case 3:this.compute_pcm_samples3();break;case 4:this.compute_pcm_samples4();break;case 5:this.compute_pcm_samples5();break;case 6:this.compute_pcm_samples6();break;case 7:this.compute_pcm_samples7();break;case 8:this.compute_pcm_samples8();break;case 9:this.compute_pcm_samples9();break;case 10:this.compute_pcm_samples10();break;case 11:this.compute_pcm_samples11();break;case 12:this.compute_pcm_samples12();break;case 13:this.compute_pcm_samples13();break;case 14:this.compute_pcm_samples14();break;case 15:this.compute_pcm_samples15();break}if(_!=null)_.appendSamples(this.channel,this._tmpOut)},E.prototype.calculate_pcm_samples=function(_){this.compute_new_v(),this.compute_pcm_samples(_),this.actual_write_pos=(this.actual_write_pos+1)&0xf,this.actual_v=(this.actual_v === this.v1)?this.v2:this.v1;for(var p=0;p<32;p++)this.samples[p]=0.0},E.MY_PI=3.14159265358979323846,E.cos1_64=(1.0/(2.0*Math.cos(E.MY_PI/64.0))),E.cos3_64=(1.0/(2.0*Math.cos(E.MY_PI*3.0/64.0))),E.cos5_64=(1.0/(2.0*Math.cos(E.MY_PI*5.0/64.0))),E.cos7_64=(1.0/(2.0*Math.cos(E.MY_PI*7.0/64.0))),E.cos9_64=(1.0/(2.0*Math.cos(E.MY_PI*9.0/64.0))),E.cos11_64=(1.0/(2.0*Math.cos(E.MY_PI*11.0/64.0))),E.cos13_64=(1.0/(2.0*Math.cos(E.MY_PI*13.0/64.0))),E.cos15_64=(1.0/(2.0*Math.cos(E.MY_PI*15.0/64.0))),E.cos17_64=(1.0/(2.0*Math.cos(E.MY_PI*17.0/64.0))),E.cos19_64=(1.0/(2.0*Math.cos(E.MY_PI*19.0/64.0))),E.cos21_64=(1.0/(2.0*Math.cos(E.MY_PI*21.0/64.0))),E.cos23_64=(1.0/(2.0*Math.cos(E.MY_PI*23.0/64.0))),E.cos25_64=(1.0/(2.0*Math.cos(E.MY_PI*25.0/64.0))),E.cos27_64=(1.0/(2.0*Math.cos(E.MY_PI*27.0/64.0))),E.cos29_64=(1.0/(2.0*Math.cos(E.MY_PI*29.0/64.0))),E.cos31_64=(1.0/(2.0*Math.cos(E.MY_PI*31.0/64.0))),E.cos1_32=(1.0/(2.0*Math.cos(E.MY_PI/ 32.0))),E.cos3_32=(1.0/(2.0*Math.cos(E.MY_PI* 3.0/32.0))),E.cos5_32=(1.0/(2.0*Math.cos(E.MY_PI* 5.0/32.0))),E.cos7_32=(1.0/(2.0*Math.cos(E.MY_PI* 7.0/32.0))),E.cos9_32=(1.0/(2.0*Math.cos(E.MY_PI* 9.0/32.0))),E.cos11_32=(1.0/(2.0*Math.cos(E.MY_PI*11.0/32.0))),E.cos13_32=(1.0/(2.0*Math.cos(E.MY_PI*13.0/32.0))),E.cos15_32=(1.0/(2.0*Math.cos(E.MY_PI*15.0/32.0))),E.cos1_16=(1.0/(2.0*Math.cos(E.MY_PI/16.0))),E.cos3_16=(1.0/(2.0*Math.cos(E.MY_PI*3.0/16.0))),E.cos5_16=(1.0/(2.0*Math.cos(E.MY_PI*5.0/16.0))),E.cos7_16=(1.0/(2.0*Math.cos(E.MY_PI*7.0/16.0))),E.cos1_8=(1.0/(2.0*Math.cos(E.MY_PI/8.0))),E.cos3_8=(1.0/(2.0*Math.cos(E.MY_PI*3.0/8.0))),E.cos1_4=(1.0/(2.0*Math.cos(E.MY_PI/4.0)));var gr_info_s=function(){this.part2_3_length=0,this.big_values=0,this.global_gain=0,this.scalefac_compress=0,this.window_switching_flag=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=new Int32Array(3),this.subblock_gain=new Int32Array(3),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0};var temporaire=function(){this.scfsi=new Int32Array(4),this.gr=[new gr_info_s(),new gr_info_s()]};var temporaire2=function(){this.l=new Int32Array(23),this.s=[new Int32Array(13),new Int32Array(13),new Int32Array(13)]};var III_side_info_t=function(){this.main_data_begin=0,this.private_bits=0,this.ch=[new temporaire(),new temporaire()]};var SBI=function(a,b){this.l=a,this.s=b};var Sftable=function(a,b){this.l=a,this.s=b};var F=function(_,a,s,d,b){D.initHuff();this.checkSumHuff=0,this.is_1d=new Int32Array(F.SBLIMIT*F.SSLIMIT+4),this.ro=new Array(2),this.lr=new Array(2),this.prevblck=new Array(2),this.k=new Array(2);for(var i=0;i<2;i++){this.ro[i]=new Array(F.SBLIMIT),this.lr[i]=new Array(F.SBLIMIT),this.prevblck[i]=new Float32Array(F.SBLIMIT*F.SSLIMIT),this.k[i]=new Float32Array(F.SBLIMIT*F.SSLIMIT);for(var j=0;j<F.SBLIMIT;j++)this.ro[i][j]=new Float32Array(F.SSLIMIT),this.lr[i][j]=new Float32Array(F.SSLIMIT)}this.out_1d=new Float32Array(F.SBLIMIT*F.SSLIMIT),this.nonzero=new Int32Array(2),this.III_scalefac_t=new Array(2),this.III_scalefac_t[0]=new temporaire2(),this.III_scalefac_t[1]=new temporaire2(),this.scalefac=this.III_scalefac_t;F.sfBandIndex=new Array(9);var l0=[0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],s0=[0,4,8,12,18,24,32,42,56,74,100,132,174,192],l1=[0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,330,394,464,540,576],s1=[0,4,8,12,18,26,36,48,62,80,104,136,180,192],l2=[0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],s2=[0,4,8,12,18,26,36,48,62,80,104,134,174,192],l3=[0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],s3=[0,4,8,12,16,22,30,40,52,66,84,106,136,192],l4=[0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],s4=[0,4,8,12,16,22,28,38,50,64,80,100,126,192],l5=[0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],s5=[0,4,8,12,16,22,30,42,58,78,104,138,180,192],l6=[0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],s6=[0,4,8,12,18,26,36,48,62,80,104,134,174,192],l7=[0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],s7=[0,4,8,12,18,26,36,48,62,80,104,134,174,192],l8=[0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],s8=[0,8,16,24,36,52,72,96,124,160,162,164,166,192];F.sfBandIndex[0]=new SBI(l0,s0),F.sfBandIndex[1]=new SBI(l1,s1),F.sfBandIndex[2]=new SBI(l2,s2),F.sfBandIndex[3]=new SBI(l3,s3),F.sfBandIndex[4]=new SBI(l4,s4),F.sfBandIndex[5]=new SBI(l5,s5),F.sfBandIndex[6]=new SBI(l6,s6),F.sfBandIndex[7]=new SBI(l7,s7),F.sfBandIndex[8]=new SBI(l8,s8);if(F.reorder_table==null){F.reorder_table=new Array(9);for(var i=0;i<9;i++)F.reorder_table[i]=F.reorder(F.sfBandIndex[i].s)}var ll0=[0,6,11,16,21],ss0=[0,6,12];this.sftable=new Sftable(ll0,ss0),this.scalefac_buffer=new Int32Array(54),this.stream=_,this.header=a,this.filter1=s,this.filter2=d,this.buffer=b,this.first_channel=0,this.last_channel=0,this.frame_start=0,this.channels=(this.header.mode()==B.SINGLE_CHANNEL)?1:2,this.max_gr=(this.header.version()==B.MPEG1)?2:1,this.sfreq=(this.header.sample_frequency()+((this.header.version()==B.MPEG1)?3:(this.header.version()==B.MPEG25_LSF)?6:0))|0;if(this.channels==2)this.first_channel=0,this.last_channel=1;else this.first_channel=this.last_channel=0;this.part2_start=0;for(var ch=0;ch<2;ch++)for(var j=0;j<576;j++)this.prevblck[ch][j]=0.0;this.nonzero[0]=this.nonzero[1]=576,this.br=new C(),this.si=new III_side_info_t(),this.samples1=new Float32Array(32),this.samples2=new Float32Array(32),this.new_slen=new Int32Array(4)};F.reorder_table=null,F.reorder=function(_){var j=0,ix=new Int32Array(576);for(var sfb=0;sfb<13;sfb++){var a=_[sfb],b=_[sfb+1];for(var _window=0;_window<3;_window++)for(var i=a;i<b;i++)ix[3*i+_window]=j++}return ix},F.SSLIMIT=18,F.SBLIMIT=32,F.slen=[[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3]],F.pretab=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0],F.d43=4/3,F.t_43=(function(){var a=new Float32Array(8192),b=(4.0/3.0);for(var i=0;i<8192;i++)a[i]=Math.pow(i,b);return a}()),F.prototype.decodeFrame=function(){this.decode()},F.prototype.decode=function(){var br=this.br,_=this.out_1d,_1=this.header.slots(),_2=0,gr=0,ch=0,ss=0,sb=0,sb18=0,_3=0,_4=0,i=0;if(this.header.crc()==0)this.stream.get_bits(16);this.get_side_info();for(i=0;i<_1;i++) br.hputbuf(this.stream.get_bits(8));_3=br.hsstell()>>>3;if((_2=(br.hsstell()&7))!=0)br.hgetbits(8-_2),_3++;_4=this.frame_start-_3-this.si.main_data_begin;this.frame_start+=_1;if(_4<0)return;if(_3>4096)this.frame_start-=4096,br.rewindNbytes(4096);for(;_4>0;_4--) br.hgetbits(8);for(gr=0;gr<this.max_gr;gr++){for(ch=0;ch<this.channels;ch++){this.part2_start=br.hsstell();if(this.header.version()==B.MPEG1) this.get_scale_factors(ch,gr);else this.get_LSF_scale_factors(ch,gr);this.huffman_decode(ch,gr),this.dequantize_sample(this.ro[ch],ch,gr)}this.stereo(gr);for(ch=this.first_channel;ch<=this.last_channel;ch++){this.reorder(this.lr[ch],ch,gr),this.antialias(ch,gr),this.hybrid(ch,gr);for(sb18=18;sb18<576;sb18+=36)for(ss=1;ss<F.SSLIMIT;ss+=2)_[sb18+ss]=-_[sb18+ss];if(ch==0){for(ss=0;ss<F.SSLIMIT;ss++){sb=0;for(sb18=0;sb18<576;sb18+=18)this.samples1[sb]=_[sb18+ss],sb++;this.filter1.input_samples(this.samples1),this.filter1.calculate_pcm_samples(this.buffer)}}else for(ss=0;ss<F.SSLIMIT;ss++){sb=0;for(sb18=0;sb18<576;sb18+=18)this.samples2[sb]=_[sb18+ss],sb++;this.filter2.input_samples(this.samples2),this.filter2.calculate_pcm_samples(this.buffer)}}}},F.prototype.get_side_info=function(){var a=this.channels,si=this.si,s=this.stream,ch=0,gr=0;if(this.header.version()==B.MPEG1){si.main_data_begin=s.get_bits(9);if(a==1)si.private_bits=s.get_bits(5);else si.private_bits=s.get_bits(3);for(ch=0;ch<a;ch++)si.ch[ch].scfsi[0]=s.get_bits(1),si.ch[ch].scfsi[1]=s.get_bits(1),si.ch[ch].scfsi[2]=s.get_bits(1),si.ch[ch].scfsi[3]=s.get_bits(1);for(gr=0;gr<2;gr++){for(ch=0;ch<a;ch++){var _=si.ch[ch].gr[gr];_.part2_3_length=s.get_bits(12),_.big_values=s.get_bits(9),_.global_gain=s.get_bits(8),_.scalefac_compress=s.get_bits(4),_.window_switching_flag=s.get_bits(1);if((_.window_switching_flag)!=0){_.block_type=s.get_bits(2),_.mixed_block_flag=s.get_bits(1),_.table_select[0]=s.get_bits(5),_.table_select[1]=s.get_bits(5),_.subblock_gain[0]=s.get_bits(3),_.subblock_gain[1]=s.get_bits(3),_.subblock_gain[2]=s.get_bits(3);if(_.block_type==0)return false;else if(_.block_type==2&&_.mixed_block_flag==0)_.region0_count=8;else _.region0_count=7;_.region1_count=20-_.region0_count}else _.table_select[0]=s.get_bits(5),_.table_select[1]=s.get_bits(5),_.table_select[2]=s.get_bits(5),_.region0_count=s.get_bits(4),_.region1_count=s.get_bits(3),_.block_type=0;_.preflag=s.get_bits(1),_.scalefac_scale=s.get_bits(1),_.count1table_select=s.get_bits(1)}}}else{si.main_data_begin=s.get_bits(8);if(a==1) si.private_bits=s.get_bits(1);else si.private_bits=s.get_bits(2);for(ch=0;ch<a;ch++){var _=si.ch[ch].gr[0];_.part2_3_length=s.get_bits(12),_.big_values=s.get_bits(9),_.global_gain=s.get_bits(8),_.scalefac_compress=s.get_bits(9),_.window_switching_flag=s.get_bits(1);if((_.window_switching_flag)!=0){_.block_type=s.get_bits(2),_.mixed_block_flag=s.get_bits(1),_.table_select[0]=s.get_bits(5),_.table_select[1]=s.get_bits(5),_.subblock_gain[0]=s.get_bits(3),_.subblock_gain[1]=s.get_bits(3),_.subblock_gain[2]=s.get_bits(3);if(_.block_type==0)return false;else if(_.block_type==2&&_.mixed_block_flag==0)_.region0_count=8;else _.region0_count=7,_.region1_count=20-_.region0_count}else _.table_select[0]=s.get_bits(5),_.table_select[1]=s.get_bits(5),_.table_select[2]=s.get_bits(5),_.region0_count=s.get_bits(4),_.region1_count=s.get_bits(3),_.block_type=0;_.scalefac_scale=s.get_bits(1),_.count1table_select=s.get_bits(1)}}return true},F.prototype.get_scale_factors=function(ch,gr){var c=this.scalefac[ch],br=this.br,cg=this.si.ch[ch],sfb=0,_w=0;var gr_info=cg.gr[gr];var g=gr_info.scalefac_compress;var l0=F.slen[0][g],l1=F.slen[1][g];if((gr_info.window_switching_flag!=0)&&(gr_info.block_type==2)){if((gr_info.mixed_block_flag)!=0){for(sfb=0;sfb<8;sfb++)c.l[sfb]=br.hgetbits(F.slen[0][gr_info.scalefac_compress]);for(sfb=3;sfb<6;sfb++)for(_w=0;_w<3;_w++)c.s[_w][sfb]=br.hgetbits(F.slen[0][gr_info.scalefac_compress]);for(sfb=6;sfb<12;sfb++)for(_w=0;_w<3;_w++)c.s[_w][sfb]=br.hgetbits(F.slen[1][gr_info.scalefac_compress]);for(sfb=12,_w=0;_w<3;_w++)c.s[_w][sfb]=0}else c.s[0][0]=br.hgetbits(l0),c.s[1][0]=br.hgetbits(l0),c.s[2][0]=br.hgetbits(l0),c.s[0][1]=br.hgetbits(l0),c.s[1][1]=br.hgetbits(l0),c.s[2][1]=br.hgetbits(l0),c.s[0][2]=br.hgetbits(l0),c.s[1][2]=br.hgetbits(l0),c.s[2][2]=br.hgetbits(l0),c.s[0][3]=br.hgetbits(l0),c.s[1][3]=br.hgetbits(l0),c.s[2][3]=br.hgetbits(l0),c.s[0][4]=br.hgetbits(l0),c.s[1][4]=br.hgetbits(l0),c.s[2][4]=br.hgetbits(l0),c.s[0][5]=br.hgetbits(l0),c.s[1][5]=br.hgetbits(l0),c.s[2][5]=br.hgetbits(l0),c.s[0][6]=br.hgetbits(l1),c.s[1][6]=br.hgetbits(l1),c.s[2][6]=br.hgetbits(l1),c.s[0][7]=br.hgetbits(l1),c.s[1][7]=br.hgetbits(l1),c.s[2][7]=br.hgetbits(l1),c.s[0][8]=br.hgetbits(l1),c.s[1][8]=br.hgetbits(l1),c.s[2][8]=br.hgetbits(l1),c.s[0][9]=br.hgetbits(l1),c.s[1][9]=br.hgetbits(l1),c.s[2][9]=br.hgetbits(l1),c.s[0][10]=br.hgetbits(l1),c.s[1][10]=br.hgetbits(l1),c.s[2][10]=br.hgetbits(l1),c.s[0][11]=br.hgetbits(l1),c.s[1][11]=br.hgetbits(l1),c.s[2][11]=br.hgetbits(l1),c.s[0][12]=0,c.s[1][12]=0,c.s[2][12]=0}else{if((cg.scfsi[0]==0)||(gr==0))c.l[0]=br.hgetbits(l0),c.l[1]=br.hgetbits(l0),c.l[2]=br.hgetbits(l0),c.l[3]=br.hgetbits(l0),c.l[4]=br.hgetbits(l0),c.l[5]=br.hgetbits(l0);if((cg.scfsi[1]==0)||(gr==0))c.l[6]=br.hgetbits(l0),c.l[7]=br.hgetbits(l0),c.l[8]=br.hgetbits(l0),c.l[9]=br.hgetbits(l0),c.l[10]=br.hgetbits(l0);if((cg.scfsi[2]==0)||(gr==0))c.l[11]=br.hgetbits(l1),c.l[12]=br.hgetbits(l1),c.l[13]=br.hgetbits(l1),c.l[14]=br.hgetbits(l1),c.l[15]=br.hgetbits(l1);if((cg.scfsi[3]==0)||(gr==0))c.l[16]=br.hgetbits(l1),c.l[17]=br.hgetbits(l1),c.l[18]=br.hgetbits(l1),c.l[19]=br.hgetbits(l1),c.l[20]=br.hgetbits(l1);c.l[21]=0,c.l[22]=0}},F.prototype.get_LSF_scale_data=function(ch,gr){var e=this.new_slen,br=this.br,d=this.header.mode_extension();var gr_info=this.si.ch[ch].gr[gr];var m,a=0,b=0,c=gr_info.scalefac_compress,f=0;if(gr_info.block_type==2){if(gr_info.mixed_block_flag==0)a=1;else if(gr_info.mixed_block_flag==1)a=2;else a=0}else a=0;if(!(((d==1)||(d==3))&&(ch==1))){if(c<400)e[0]=(c>>>4)/5,e[1]=(c>>>4)%5,e[2]=(c&0xF)>>>2,e[3]=(c&3),gr_info.preflag=0,b=0;else if(c<500)e[0]=((c-400)>>>2)/5,e[1]=((c-400)>>>2)%5,e[2]=(c-400)&3,e[3]=0,gr_info.preflag=0,b=1;else if(c<512)e[0]=(c-500)/3,e[1]=(c-500)%3,e[2]=0,e[3]=0,gr_info.preflag=1,b=2}if((((d==1)||(d==3))&&(ch==1))){f=c>>>1;if(f<180)e[0]=f/36,e[1]=(f%36)/6,e[2]=(f%36)%6,e[3]=0,gr_info.preflag=0,b=3;else if(f<244)e[0]=((f-180)&0x3F)>>>4,e[1]=((f-180)&0xF)>>>2,e[2]=(f-180)&3,e[3]=0,gr_info.preflag=0,b=4;else if(f<255)e[0]=(f-244)/3,e[1]=(f-244)%3,e[2]=0,e[3]=0,gr_info.preflag=0,b=5}for(var x=0;x<45;x++)this.scalefac_buffer[x]=0;m=0;for(var i=0;i<4;i++)for(var j=0;j<F.nr_of_sfb_block[b][a][i];j++)this.scalefac_buffer[m]=(e[i]==0)?0:br.hgetbits(e[i]),m++},F.prototype.get_LSF_scale_factors=function(ch,gr){var u=this.scalefac,m=0,sfb=0,_w=0,cr=this.si.ch[ch].gr[gr];this.get_LSF_scale_data(ch,gr);if((cr.window_switching_flag!=0)&&(cr.block_type==2)){if(cr.mixed_block_flag!=0){for(sfb=0;sfb<8;sfb++)u[ch].l[sfb]=this.scalefac_buffer[m],m++;for(sfb=3;sfb<12;sfb++)for(_w=0;_w<3;_w++)u[ch].s[_w][sfb]=this.scalefac_buffer[m],m++;for(_w=0;_w<3;_w++)u[ch].s[_w][12]=0}else{for(sfb=0;sfb<12;sfb++)for(_w=0;_w<3;_w++)u[ch].s[_w][sfb]=this.scalefac_buffer[m],m++;for(_w=0;_w<3;_w++)u[ch].s[_w][12]=0}}else{for(sfb=0;sfb<21;sfb++)u[ch].l[sfb]=this.scalefac_buffer[m],m++;u[ch].l[21]=0,u[ch].l[22]=0}};var x=new Int32Array(1),y=new Int32Array(1),v=new Int32Array(1),w=new Int32Array(1);F.prototype.huffman_decode=function(ch,gr){var br=this.br,si=this.si,_=this.is_1d,a=this.sfreq;x[0]=0,y[0]=0,v[0]=0,w[0]=0;var cr=si.ch[ch].gr[gr];var b=cr.part2_3_length;if(b==0)return _.fill(0),void 0;var c=this.part2_start+b,d=0,e=0,f=0,g=0,h=null,buf=0,buf1=0;if(((cr.window_switching_flag)!=0)&&(cr.block_type==2))e=(a==8)?72:36,f=576;else{buf=cr.region0_count+1,buf1=buf+cr.region1_count+1;if(buf1>F.sfBandIndex[a].l.length-1)buf1=F.sfBandIndex[a].l.length-1;e=F.sfBandIndex[a].l[buf],f=F.sfBandIndex[a].l[buf1]}g=0;for(var i=0;i<(cr.big_values<<1);i+=2){if(i<e) h=D.ht[cr.table_select[0]];else if(i<f) h=D.ht[cr.table_select[1]];else h=D.ht[cr.table_select[2]];D.huffman_decoder(h,x,y,v,w,br);_[g++]=x[0];_[g++]=y[0];this.checkSumHuff=this.checkSumHuff+x[0]+y[0]}h=D.ht[cr.count1table_select+32],d=br.hsstell();while((d<c)&&(g<576))D.huffman_decoder(h,x,y,v,w,br),_[g++]=v[0],_[g++]=w[0],_[g++]=x[0],_[g++]=y[0],this.checkSumHuff=this.checkSumHuff+v[0]+w[0]+x[0]+y[0],d=br.hsstell();if(d>c)br.rewindNbits(d-c),g-=4;d=br.hsstell();if(d<c)br.hgetbits(c-d);this.nonzero[ch]=Math.min(g,576);if(g<0)g=0;for(;g<576;g++)_[g]=0},F.prototype.dequantize_sample=function(xr,ch,gr){var _1=this.scalefac,_2=this.sfreq,_3=this.is_1d,_4=this.si.ch[ch].gr[gr],cb=0,_5=0,_6=0,_7=0,_8=0,_9=0,j=0,_10=0;if((_4.window_switching_flag!=0)&&(_4.block_type==2)){if(_4.mixed_block_flag!=0)_5=F.sfBandIndex[_2].l[1];else _7=F.sfBandIndex[_2].s[1],_5=(_7<<2)-_7,_6=0}else _5=F.sfBandIndex[_2].l[1];_10=Math.pow(2.0,(0.25*(_4.global_gain-210.0)));for(j=0;j<this.nonzero[ch];j++){var a=j%F.SSLIMIT;var b=((j-a)/F.SSLIMIT)|0;if(_3[j]==0) xr[b][a]=0.0;else {var abv=_3[j];if(abv<F.t_43.length){if(_3[j]>0) xr[b][a]=_10*F.t_43[abv];else {if(-abv<F.t_43.length) xr[b][a]=-_10*F.t_43[-abv];else xr[b][a]=-_10*Math.pow(-abv,F.d43)}}else{if(_3[j]>0) xr[b][a]=_10*Math.pow(abv,F.d43);else xr[b][a]=-_10*Math.pow(-abv,F.d43)}}}for(j=0;j<this.nonzero[ch];j++){var a=j%F.SSLIMIT;var b=((j-a)/F.SSLIMIT)|0;if(_8==_5){if((_4.window_switching_flag!=0)&&(_4.block_type==2)){if(_4.mixed_block_flag!=0){if(_8==F.sfBandIndex[_2].l[8])_5=F.sfBandIndex[_2].s[4],_5=(_5<<2)-_5,cb=3,_7=F.sfBandIndex[_2].s[4]-F.sfBandIndex[_2].s[3],_6=F.sfBandIndex[_2].s[3],_6=(_6<<2)-_6;else if(_8<F.sfBandIndex[_2].l[8])_5=F.sfBandIndex[_2].l[(++cb)+1];else _5=F.sfBandIndex[_2].s[(++cb)+1],_5=(_5<<2)-_5,_6=F.sfBandIndex[_2].s[cb],_7=F.sfBandIndex[_2].s[cb+1]-_6,_6=(_6<<2)-_6}else _5=F.sfBandIndex[_2].s[(++cb)+1],_5=(_5<<2)-_5,_6=F.sfBandIndex[_2].s[cb],_7=F.sfBandIndex[_2].s[cb+1]-_6,_6=(_6<<2)-_6}else _5=F.sfBandIndex[_2].l[(++cb)+1]}if((_4.window_switching_flag!=0)&&(((_4.block_type==2)&&(_4.mixed_block_flag==0))||((_4.block_type==2)&&(_4.mixed_block_flag!=0)&&(j>=36)))){_9=((_8-_6)/_7)|0;var c=_1[ch].s[_9][cb]<<_4.scalefac_scale;c+=(_4.subblock_gain[_9]<<2),xr[b][a]*=F.two_to_negative_half_pow[c]}else{var c=_1[ch].l[cb];if(_4.preflag!=0)c+=F.pretab[cb];c=c<<_4.scalefac_scale,xr[b][a]*=F.two_to_negative_half_pow[c]}_8++}for(j=this.nonzero[ch];j<576;j++){var a=j%F.SSLIMIT;var b=((j-a)/F.SSLIMIT)|0;if(a<0)a=0;if(b<0)b=0;xr[b][a]=0}},F.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var is_pos=new Int32Array(576),is_ratio=new Float32Array(576);F.io=[new Float32Array([1.0000000000E+00,8.4089641526E-01,7.0710678119E-01,5.9460355751E-01,5.0000000001E-01,4.2044820763E-01,3.5355339060E-01,2.9730177876E-01,2.5000000001E-01,2.1022410382E-01,1.7677669530E-01,1.4865088938E-01,1.2500000000E-01,1.0511205191E-01,8.8388347652E-02,7.4325444691E-02,6.2500000003E-02,5.2556025956E-02,4.4194173826E-02,3.7162722346E-02,3.1250000002E-02,2.6278012978E-02,2.2097086913E-02,1.8581361173E-02,1.5625000001E-02,1.3139006489E-02,1.1048543457E-02,9.2906805866E-03,7.8125000006E-03,6.5695032447E-03,5.5242717285E-03,4.6453402934E-03]),new Float32Array([1.0000000000E+00,7.0710678119E-01,5.0000000000E-01,3.5355339060E-01,2.5000000000E-01,1.7677669530E-01,1.2500000000E-01,8.8388347650E-02,6.2500000001E-02,4.4194173825E-02,3.1250000001E-02,2.2097086913E-02,1.5625000000E-02,1.1048543456E-02,7.8125000002E-03,5.5242717282E-03,3.9062500001E-03,2.7621358641E-03,1.9531250001E-03,1.3810679321E-03,9.7656250004E-04,6.9053396603E-04,4.8828125002E-04,3.4526698302E-04,2.4414062501E-04,1.7263349151E-04,1.2207031251E-04,8.6316745755E-05,6.1035156254E-05,4.3158372878E-05,3.0517578127E-05,2.1579186439E-05])],F.TAN12=new Float32Array([0.0,0.26794919,0.57735027,1.0,1.73205081,3.73205081,9.9999999e10,-3.73205081,-1.73205081,-1.0,-0.57735027,-0.26794919,0.0,0.26794919,0.57735027,1.0]),F.cs=new Float32Array([0.857492925712,0.881741997318,0.949628649103,0.983314592492,0.995517816065,0.999160558175,0.999899195243,0.999993155067]),F.ca=new Float32Array([-0.5144957554270,-0.4717319685650,-0.3133774542040,-0.1819131996110,-0.0945741925262,-0.0409655828852,-0.0141985685725,-0.00369997467375]),F.two_to_negative_half_pow=new Float32Array([1.0000000000E+00,7.0710678119E-01,5.0000000000E-01,3.5355339059E-01,2.5000000000E-01,1.7677669530E-01,1.2500000000E-01,8.8388347648E-02,6.2500000000E-02,4.4194173824E-02,3.1250000000E-02,2.2097086912E-02,1.5625000000E-02,1.1048543456E-02,7.8125000000E-03,5.5242717280E-03,3.9062500000E-03,2.7621358640E-03,1.9531250000E-03,1.3810679320E-03,9.7656250000E-04,6.9053396600E-04,4.8828125000E-04,3.4526698300E-04,2.4414062500E-04,1.7263349150E-04,1.2207031250E-04,8.6316745750E-05,6.1035156250E-05,4.3158372875E-05,3.0517578125E-05,2.1579186438E-05,1.5258789062E-05,1.0789593219E-05,7.6293945312E-06,5.3947966094E-06,3.8146972656E-06,2.6973983047E-06,1.9073486328E-06,1.3486991523E-06,9.5367431641E-07,6.7434957617E-07,4.7683715820E-07,3.3717478809E-07,2.3841857910E-07,1.6858739404E-07,1.1920928955E-07,8.4293697022E-08,5.9604644775E-08,4.2146848511E-08,2.9802322388E-08,2.1073424255E-08,1.4901161194E-08,1.0536712128E-08,7.4505805969E-09,5.2683560639E-09,3.7252902985E-09,2.6341780319E-09,1.8626451492E-09,1.3170890160E-09,9.3132257462E-10,6.5854450798E-10,4.6566128731E-10,3.2927225399E-10]),F.prototype.i_stereo_k_values=function(a,b,i){var k=this.k;if(a==0)k[0][i]=1.0,k[1][i]=1.0;else if((a&1)!=0)k[0][i]=F.io[b][(a+1)>>>1],k[1][i]=1.0;else k[0][i]=1.0,k[1][i]=F.io[b][a>>>1]},F.prototype.stereo=function(gr){var _1=this.sfreq,_2=this.scalefac,ro=this.ro,lr=this.lr,k=this.k,sb=0,ss=0;if(this.channels==1){for(sb=0;sb<F.SBLIMIT;sb++)for(ss=0;ss<F.SSLIMIT;ss+=3)lr[0][sb][ss]=ro[0][sb][ss],lr[0][sb][ss+1]=ro[0][sb][ss+1],lr[0][sb][ss+2]=ro[0][sb][ss+2]}else{var _3=this.si.ch[0].gr[gr],_4=this.header.mode_extension(),sfb=0,i=0,_5=0,_6=0,_7=0,_8=((this.header.mode()==B.JOINT_STEREO)&&((_4&0x2)!=0)),_9=((this.header.mode()==B.JOINT_STEREO)&&((_4&0x1)!=0)),lsf=((this.header.version()==B.MPEG2_LSF||this.header.version()==B.MPEG25_LSF));var _10=_3.scalefac_compress&1;is_pos.fill(7),is_ratio.fill(0.0);if(_9){if((_3.window_switching_flag!=0)&&(_3.block_type==2)){if(_3.mixed_block_flag!=0){var max_sfb=0;for(var j=0;j<3;j++){var sfbcnt=0;sfbcnt=2;for(sfb=12;sfb>=3;sfb--){i=F.sfBandIndex[_1].s[sfb];_5=F.sfBandIndex[_1].s[sfb+1]-i;i=(i<<2)-i+(j+1)*_5-1;while(_5>0){if(ro[1][(i/18)|0][i%18]!=0.0)sfbcnt=sfb,sfb=-10,_5=-10;_5--,i--}}sfb=sfbcnt+1;if(sfb>max_sfb)max_sfb=sfb;while(sfb<12){_6=F.sfBandIndex[_1].s[sfb],sb=F.sfBandIndex[_1].s[sfb+1]-_6,i=(_6<<2)-_6+j*sb;for(;sb>0;sb--){is_pos[i]=_2[1].s[j][sfb];if(is_pos[i]!=7)if(lsf)this.i_stereo_k_values(is_pos[i],_10,i);else is_ratio[i]=F.TAN12[is_pos[i]];i++}sfb++}sfb=F.sfBandIndex[_1].s[10],sb=F.sfBandIndex[_1].s[11]-sfb,sfb=(sfb<<2)-sfb+j*sb,_6=F.sfBandIndex[_1].s[11],sb=F.sfBandIndex[_1].s[12]-_6,i=(_6<<2)-_6+j*sb;for(;sb>0;sb--){is_pos[i]=is_pos[sfb];if(lsf)k[0][i]=k[0][sfb],k[1][i]=k[1][sfb];else is_ratio[i]=is_ratio[sfb];i++}}if(max_sfb<=3){i=2,ss=17,sb=-1;while(i>=0){if(ro[1][i][ss]!=0.0)sb=(i<<4)+(i<<1)+ss,i=-1;else{ss--;if(ss<0)i--,ss=17}}i=0;while(F.sfBandIndex[_1].l[i]<=sb)i++;sfb=i,i=F.sfBandIndex[_1].l[i];for(;sfb<8;sfb++){sb=F.sfBandIndex[_1].l[sfb+1]-F.sfBandIndex[_1].l[sfb];for(;sb>0;sb--){is_pos[i]=_2[1].l[sfb];if(is_pos[i]!=7)if(lsf)this.i_stereo_k_values(is_pos[i],_10,i);else is_ratio[i]=F.TAN12[is_pos[i]];i++}}}}else for(var j=0;j<3;j++){var sfbcnt=0;sfbcnt=-1;for(sfb=12;sfb>=0;sfb--){_6=F.sfBandIndex[_1].s[sfb],_5=F.sfBandIndex[_1].s[sfb+1]-_6,i=(_6<<2)-_6+(j+1)*_5-1;while(_5>0){if(ro[1][(i/18)|0][i%18]!=0.0)sfbcnt=sfb,sfb=-10,_5=-10;_5--,i--}}sfb=sfbcnt+1;while(sfb<12){_6=F.sfBandIndex[_1].s[sfb],sb=F.sfBandIndex[_1].s[sfb+1]-_6,i=(_6<<2)-_6+j*sb;for(;sb>0;sb--){is_pos[i]=_2[1].s[j][sfb];if(is_pos[i]!=7)if(lsf)this.i_stereo_k_values(is_pos[i],_10,i);else is_ratio[i]=F.TAN12[is_pos[i]];i++}sfb++}_6=F.sfBandIndex[_1].s[10],_7=F.sfBandIndex[_1].s[11],sb=_7-_6,sfb=(_6<<2)-_6+j*sb,sb=F.sfBandIndex[_1].s[12]-_7,i=(_7<<2)-_7+j*sb;for(;sb>0;sb--){is_pos[i]=is_pos[sfb];if(lsf)k[0][i]=k[0][sfb],k[1][i]=k[1][sfb];else is_ratio[i]=is_ratio[sfb];i++}}}else{i=31,ss=17,sb=0;while(i>=0){if(ro[1][i][ss]!=0.0)sb=(i<<4)+(i<<1)+ss,i=-1;else{ss--;if(ss<0)i--,ss=17}}i=0;while(F.sfBandIndex[_1].l[i]<=sb)i++;sfb=i;i=F.sfBandIndex[_1].l[i];for(;sfb<21;sfb++){sb=F.sfBandIndex[_1].l[sfb+1]-F.sfBandIndex[_1].l[sfb];for(;sb>0;sb--){is_pos[i]=_2[1].l[sfb];if(is_pos[i]!=7)if(lsf)this.i_stereo_k_values(is_pos[i],_10,i);else is_ratio[i]=F.TAN12[is_pos[i]];i++}}sfb=F.sfBandIndex[_1].l[20];for(sb=576-F.sfBandIndex[_1].l[21];(sb>0)&&(i<576);sb--){is_pos[i]=is_pos[sfb];if(lsf)k[0][i]=k[0][sfb],k[1][i]=k[1][sfb];else is_ratio[i]=is_ratio[sfb];i++}}}i=0;for(sb=0;sb<F.SBLIMIT;sb++)for(ss=0;ss<F.SSLIMIT;ss++){if(is_pos[i]==7){if(_8)lr[0][sb][ss]=(ro[0][sb][ss]+ro[1][sb][ss])*0.707106781,lr[1][sb][ss]=(ro[0][sb][ss]-ro[1][sb][ss])*0.707106781;else lr[0][sb][ss]=ro[0][sb][ss],lr[1][sb][ss]=ro[1][sb][ss]}else if(_9){if(lsf)lr[0][sb][ss]=ro[0][sb][ss]*k[0][i],lr[1][sb][ss]=ro[0][sb][ss]*k[1][i];else lr[1][sb][ss]=ro[0][sb][ss]/(1+is_ratio[i]),lr[0][sb][ss]=lr[1][sb][ss]*is_ratio[i]}i++}}},F.prototype.reorder=function(_6,ch,gr){var _=this.out_1d,_1=this.sfreq,_2=this.si.ch[ch].gr[gr],_3=0,_4=0,_5=0,_7=0,_8=0,sfb=0,_9=0,_10=0;if((_2.window_switching_flag!=0)&&(_2.block_type==2)){for(_5=0;_5<576;_5++)_[_5]=0;if(_2.mixed_block_flag!=0){for(_5=0;_5<36;_5++){var a=_5%F.SSLIMIT;var b=((_5-a)/F.SSLIMIT)|0;_[_5]=_6[b][a]}for(sfb=3;sfb<13;sfb++){_9=F.sfBandIndex[_1].s[sfb],_10=F.sfBandIndex[_1].s[sfb+1]-_9;var _11=(_9<<2)-_9;for(_3=0,_4=0;_3<_10;_3++,_4+=3){_7=_11+_3,_8=_11+_4;var a=_7%F.SSLIMIT;var b=((_7-a)/F.SSLIMIT)|0;_[_8]=_6[b][a],_7+=_10,_8++,a=_7%F.SSLIMIT,b=((_7-a)/F.SSLIMIT)|0,_[_8]=_6[b][a],_7+=_10,_8++,a=_7%F.SSLIMIT,b=((_7-a)/F.SSLIMIT)|0,_[_8]=_6[b][a]}}}else for(_5=0;_5<576;_5++){var j=F.reorder_table[_1][_5];var a=j%F.SSLIMIT;var b=((j-a)/F.SSLIMIT)|0;_[_5]=_6[b][a]}}else for(_5=0;_5<576;_5++){var a=_5%F.SSLIMIT;var b=((_5-a)/F.SSLIMIT)|0;_[_5]=_6[b][a]}},F.prototype.antialias=function(ch,gr){var _=this.out_1d,sb18=0,ss=0,sb18lim=0,h=this.si.ch[ch].gr[gr];if((h.window_switching_flag!=0)&&(h.block_type==2)&&!(h.mixed_block_flag!=0))return;if((h.window_switching_flag!=0)&&(h.mixed_block_flag!=0)&&(h.block_type==2))sb18lim=18;else sb18lim=558;for(sb18=0;sb18<sb18lim;sb18+=18)for(ss=0;ss<8;ss++){var a=sb18+17-ss,b=sb18+18+ss;var bu=_[a],bd=_[b];_[a]=(bu*F.cs[ss])-(bd*F.ca[ss]),_[b]=(bd*F.cs[ss])+(bu*F.ca[ss])}};var tsOutCopy=new Float32Array(18),rawout=new Float32Array(36);function arraycopy(_in,a,out,b,c){var _=0;for(var i=b;i<c;i++)out[i]=_in[a+_],_++};F.prototype.hybrid=function(ch,gr){var a=this.out_1d,bt=0,sb18=0,b=null,c=null,gr_info=this.si.ch[ch].gr[gr];for(sb18=0;sb18<576;sb18+=18)bt=((gr_info.window_switching_flag!=0)&&(gr_info.mixed_block_flag!=0)&&(sb18<36))?0:gr_info.block_type,b=a,arraycopy(b,0+sb18,tsOutCopy,0,18),this.inv_mdct(tsOutCopy,rawout,bt),arraycopy(tsOutCopy,0,b,0+sb18,18),c=this.prevblck,b[0+sb18]=rawout[0]+c[ch][sb18+0],c[ch][sb18+0]=rawout[18],b[1+sb18]=rawout[1]+c[ch][sb18+1],c[ch][sb18+1]=rawout[19],b[2+sb18]=rawout[2]+c[ch][sb18+2],c[ch][sb18+2]=rawout[20],b[3+sb18]=rawout[3]+c[ch][sb18+3],c[ch][sb18+3]=rawout[21],b[4+sb18]=rawout[4]+c[ch][sb18+4],c[ch][sb18+4]=rawout[22],b[5+sb18]=rawout[5]+c[ch][sb18+5],c[ch][sb18+5]=rawout[23],b[6+sb18]=rawout[6]+c[ch][sb18+6],c[ch][sb18+6]=rawout[24],b[7+sb18]=rawout[7]+c[ch][sb18+7],c[ch][sb18+7]=rawout[25],b[8+sb18]=rawout[8]+c[ch][sb18+8],c[ch][sb18+8]=rawout[26],b[9+sb18]=rawout[9]+c[ch][sb18+9],c[ch][sb18+9]=rawout[27],b[10+sb18]=rawout[10]+c[ch][sb18+10],c[ch][sb18+10]=rawout[28],b[11+sb18]=rawout[11]+c[ch][sb18+11],c[ch][sb18+11]=rawout[29],b[12+sb18]=rawout[12]+c[ch][sb18+12],c[ch][sb18+12]=rawout[30],b[13+sb18]=rawout[13]+c[ch][sb18+13],c[ch][sb18+13]=rawout[31],b[14+sb18]=rawout[14]+c[ch][sb18+14],c[ch][sb18+14]=rawout[32],b[15+sb18]=rawout[15]+c[ch][sb18+15],c[ch][sb18+15]=rawout[33],b[16+sb18]=rawout[16]+c[ch][sb18+16],c[ch][sb18+16]=rawout[34],b[17+sb18]=rawout[17]+c[ch][sb18+17],c[ch][sb18+17]=rawout[35]},F.win=[new Float32Array([-1.6141214951E-02,-5.3603178919E-02,-1.0070713296E-01,-1.6280817573E-01,-4.9999999679E-01,-3.8388735032E-01,-6.2061144372E-01,-1.1659756083E+00,-3.8720752656E+00,-4.2256286556E+00,-1.5195289984E+00,-9.7416483388E-01,-7.3744074053E-01,-1.2071067773E+00,-5.1636156596E-01,-4.5426052317E-01,-4.0715656898E-01,-3.6969460527E-01,-3.3876269197E-01,-3.1242222492E-01,-2.8939587111E-01,-2.6880081906E-01,-5.0000000266E-01,-2.3251417468E-01,-2.1596714708E-01,-2.0004979098E-01,-1.8449493497E-01,-1.6905846094E-01,-1.5350360518E-01,-1.3758624925E-01,-1.2103922149E-01,-2.0710679058E-01,-8.4752577594E-02,-6.4157525656E-02,-4.1131172614E-02,-1.4790705759E-02]),new Float32Array([-1.6141214951E-02,-5.3603178919E-02,-1.0070713296E-01,-1.6280817573E-01,-4.9999999679E-01,-3.8388735032E-01,-6.2061144372E-01,-1.1659756083E+00,-3.8720752656E+00,-4.2256286556E+00,-1.5195289984E+00,-9.7416483388E-01,-7.3744074053E-01,-1.2071067773E+00,-5.1636156596E-01,-4.5426052317E-01,-4.0715656898E-01,-3.6969460527E-01,-3.3908542600E-01,-3.1511810350E-01,-2.9642226150E-01,-2.8184548650E-01,-5.4119610000E-01,-2.6213228100E-01,-2.5387916537E-01,-2.3296291359E-01,-1.9852728987E-01,-1.5233534808E-01,-9.6496400054E-02,-3.3423828516E-02,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00]),new Float32Array([-4.8300800645E-02,-1.5715656932E-01,-2.8325045177E-01,-4.2953747763E-01,-1.2071067795E+00,-8.2426483178E-01,-1.1451749106E+00,-1.7695290101E+00,-4.5470225061E+00,-3.4890531002E+00,-7.3296292804E-01,-1.5076514758E-01,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00]),new Float32Array([0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,0.0000000000E+00,-1.5076513660E-01,-7.3296291107E-01,-3.4890530566E+00,-4.5470224727E+00,-1.7695290031E+00,-1.1451749092E+00,-8.3137738100E-01,-1.3065629650E+00,-5.4142014250E-01,-4.6528974900E-01,-4.1066990750E-01,-3.7004680800E-01,-3.3876269197E-01,-3.1242222492E-01,-2.8939587111E-01,-2.6880081906E-01,-5.0000000266E-01,-2.3251417468E-01,-2.1596714708E-01,-2.0004979098E-01,-1.8449493497E-01,-1.6905846094E-01,-1.5350360518E-01,-1.3758624925E-01,-1.2103922149E-01,-2.0710679058E-01,-8.4752577594E-02,-6.4157525656E-02,-4.1131172614E-02,-1.4790705759E-02])],F.prototype.inv_mdct=function(a,out,u){var k,i=0,a0=0,a1=0,a2=0,a3=0,a4=0,a5=0,a6=0,a7=0,a8=0,a9=0,a10=0,a11=0,a12=0,a13=0,a14=0,a15=0,a16=0,a17=0;if(u==2){out.fill(0);var ai=0;for(i=0;i<3;i++){a[15+i]+=a[12+i],a[12+i]+=a[9+i],a[9+i]+=a[6+i],a[6+i]+=a[3+i],a[3+i]+=a[0+i],a[15+i]+=a[9+i],a[9+i]+=a[3+i];var pp2=a[12+i]*0.500000000,pp1=a[6+i]*0.866025403;var sum=a[0+i]+pp2;a1=a[0+i]-a[12+i],a0=sum+pp1,a2=sum-pp1,pp2=a[15+i]*0.500000000,pp1=a[9+i]*0.866025403,sum=a[3+i]+pp2,a4=a[3+i]-a[15+i],a5=sum+pp1,a3=sum-pp1,a3*=1.931851653,a4*=0.707106781,a5*=0.517638090;var save=a0;a0+=a5,a5=save-a5,save=a1,a1+=a4,a4=save-a4,save=a2,a2+=a3,a3=save-a3,a0*=0.504314480,a1*=0.541196100,a2*=0.630236207,a3*=0.821339815,a4*=1.306562965,a5*=3.830648788,a8=-a0*0.793353340,a9=-a0*0.608761429,a7=-a1*0.923879532,a10=-a1*0.382683432,a6=-a2*0.991444861,a11=-a2*0.130526192,a0=a3,a1=a4*0.382683432,a2=a5*0.608761429,a3=-a5*0.793353340,a4=-a4*0.923879532,a5=-a0*0.991444861,a0*=0.130526192,out[ai+6]+=a0,out[ai+7]+=a1,out[ai+8]+=a2,out[ai+9]+=a3,out[ai+10]+=a4,out[ai+11]+=a5,out[ai+12]+=a6,out[ai+13]+=a7,out[ai+14]+=a8,out[ai+15]+=a9,out[ai+16]+=a10,out[ai+17]+=a11,ai+=6}}else{a[17]+=a[16],a[16]+=a[15],a[15]+=a[14],a[14]+=a[13],a[13]+=a[12],a[12]+=a[11],a[11]+=a[10],a[10]+=a[9],a[9]+=a[8],a[8]+=a[7],a[7]+=a[6],a[6]+=a[5],a[5]+=a[4],a[4]+=a[3],a[3]+=a[2],a[2]+=a[1],a[1]+=a[0],a[17]+=a[15],a[15]+=a[13],a[13]+=a[11],a[11]+=a[9],a[9]+=a[7],a[7]+=a[5],a[5]+=a[3],a[3]+=a[1];var i00=a[0]+a[0];var iip12=i00+a[12];var tmp0=iip12+a[4]*1.8793852415718+a[8]*1.532088886238+a[16]*0.34729635533386,tmp1=i00+a[4]-a[8]-a[12]-a[12]-a[16],tmp2=iip12-a[4]*0.34729635533386-a[8]*1.8793852415718+a[16]*1.532088886238,tmp3=iip12-a[4]*1.532088886238+a[8]*0.34729635533386-a[16]*1.8793852415718,tmp4=a[0]-a[4]+a[8]-a[12]+a[16];var i66_=a[6]*1.732050808;var tmp0_=a[2]*1.9696155060244+i66_+a[10]*1.2855752193731+a[14]*0.68404028665134,tmp1_=(a[2]-a[10]-a[14])*1.732050808,tmp2_=a[2]*1.2855752193731-i66_-a[10]*0.68404028665134+a[14]*1.9696155060244,tmp3_=a[2]*0.68404028665134-i66_+a[10]*1.9696155060244-a[14]*1.2855752193731;var i0=a[0+1]+a[0+1];var i0p12=i0+a[12+1];var tmp0o=i0p12+a[4+1]*1.8793852415718+a[8+1]*1.532088886238+a[16+1]*0.34729635533386,tmp1o=i0+a[4+1]-a[8+1]-a[12+1]-a[12+1]-a[16+1],tmp2o=i0p12-a[4+1]*0.34729635533386-a[8+1]*1.8793852415718+a[16+1]*1.532088886238,tmp3o=i0p12-a[4+1]*1.532088886238+a[8+1]*0.34729635533386-a[16+1]*1.8793852415718,tmp4o=(a[0+1]-a[4+1]+a[8+1]-a[12+1]+a[16+1])*0.707106781;var i6_=a[6+1]*1.732050808;var tmp0_o=a[2+1]*1.9696155060244+i6_+a[10+1]*1.2855752193731+a[14+1]*0.68404028665134,tmp1_o=(a[2+1]-a[10+1]-a[14+1])*1.732050808,tmp2_o=a[2+1]*1.2855752193731-i6_-a[10+1]*0.68404028665134+a[14+1]*1.9696155060244,tmp3_o=a[2+1]*0.68404028665134-i6_+a[10+1]*1.9696155060244-a[14+1]*1.2855752193731;var e,o=0;e=tmp0+tmp0_,o=(tmp0o+tmp0_o)*0.501909918,a0=e+o,a17=e-o,e=tmp1+tmp1_,o=(tmp1o+tmp1_o)*0.517638090,a1=e+o,a16=e-o,e=tmp2+tmp2_,o=(tmp2o+tmp2_o)*0.551688959,a2=e+o,a15=e-o,e=tmp3+tmp3_,o=(tmp3o+tmp3_o)*0.610387294,a3=e+o,a14=e-o,a4=tmp4+tmp4o,a13=tmp4-tmp4o,e=tmp3-tmp3_,o=(tmp3o-tmp3_o)*0.871723397,a5=e+o,a12=e-o,e=tmp2-tmp2_,o=(tmp2o-tmp2_o)*1.183100792,a6=e+o,a11=e-o,e=tmp1-tmp1_,o=(tmp1o-tmp1_o)*1.931851653,a7=e+o,a10=e-o,e=tmp0-tmp0_,o=(tmp0o-tmp0_o)*5.736856623,a8=e+o,a9=e-o,k=F.win[u];out[0]=-a9*k[0],out[1]=-a10*k[1],out[2]=-a11*k[2],out[3]=-a12*k[3],out[4]=-a13*k[4],out[5]=-a14*k[5],out[6]=-a15*k[6],out[7]=-a16*k[7],out[8]=-a17*k[8],out[9]=a17*k[9],out[10]=a16*k[10],out[11]=a15*k[11],out[12]=a14*k[12],out[13]=a13*k[13],out[14]=a12*k[14],out[15]=a11*k[15],out[16]=a10*k[16],out[17]=a9*k[17],out[18]=a8*k[18],out[19]=a7*k[19],out[20]=a6*k[20],out[21]=a5*k[21],out[22]=a4*k[22],out[23]=a3*k[23],out[24]=a2*k[24],out[25]=a1*k[25],out[26]=a0*k[26],out[27]=a0*k[27],out[28]=a1*k[28],out[29]=a2*k[29],out[30]=a3*k[30],out[31]=a4*k[31],out[32]=a5*k[32],out[33]=a6*k[33],out[34]=a7*k[34],out[35]=a8*k[35]}};var G=function(a,b){this.buffer=new Float32Array(G.OBUFFERSIZE),this.bufferp=new Int32Array(G.MAXCHANNELS),this.channels=b,this.frequency=a;for(var i=0;i<b;++i)this.bufferp[i]=i};G.OBUFFERSIZE=2*1152,G.MAXCHANNELS=2,G.prototype.getChannelCount=function(){return this.channels},G.prototype.getSampleFrequency=function(){return this.frequency},G.prototype.getBuffer=function(){return this.buffer},G.prototype.getBufferLength=function(){return this.bufferp[0]},G.prototype.write_buffer=function(){},G.prototype.clear_buffer=function(){for(var i=0;i<this.channels;++i)this.bufferp[i]=i},G.prototype.appendSamples=function(a,f){var b=this.bufferp[a];for(var i=0;i<32;)this.buffer[b]=f[i++],b+=this.channels;this.bufferp[a]=b};var H=function(){this.output=null,this.initialized=false};H.prototype.setOutputBuffer=function(_){this.output=_},H.prototype.initialize=function(_){var c=_.mode()==B.SINGLE_CHANNEL?1:2;if(this.output==null)this.output=new G(_.frequency(),c);this.filter1=new E(0,1,null);if(c==2) this.filter2=new E(1,1,null);this.outputChannels=c,this.outputFrequency=_.frequency(),this.initialized=true},H.prototype.decodeFrame=function(_,b){if(!this.initialized)this.initialize(_);this.output.clear_buffer();var a=this.retrieveDecoder(_,b);a.decodeFrame();return this.output.write_buffer(1),this.output},H.prototype.retrieveDecoder=function(header,stream){if(this.l3decoder==null)this.l3decoder=new F(stream,header,this.filter1,this.filter2,this.output);return this.l3decoder};return {BitStream:A,Decoder:H,Header:B}}());

	var libtess = (function(){var n;function t(a,b){return a.b===b.b&&a.a===b.a}function u(a,b){return a.b<b.b||a.b===b.b&&a.a<=b.a}function v(a,b,c){var d=b.b-a.b,e=c.b-b.b;return 0<d+e?d<e?b.a-a.a+d/(d+e)*(a.a-c.a):b.a-c.a+e/(d+e)*(c.a-a.a):0}function x(a,b,c){var d=b.b-a.b,e=c.b-b.b;return 0<d+e?(b.a-c.a)*d+(b.a-a.a)*e:0}function z(a,b){return a.a<b.a||a.a===b.a&&a.b<=b.b}function aa(a,b,c){var d=b.a-a.a,e=c.a-b.a;return 0<d+e?d<e?b.b-a.b+d/(d+e)*(a.b-c.b):b.b-c.b+e/(d+e)*(c.b-a.b):0}function ba(a,b,c){var d=b.a-a.a,e=c.a-b.a;return 0<d+e?(b.b-c.b)*d+(b.b-a.b)*e:0}function ca(a){return u(a.b.a,a.a)}function da(a){return u(a.a,a.b.a)}function A(a,b,c,d){a=0>a?0:a;c=0>c?0:c;return a<=c?0===c?(b+d)/2:b+a/(a+c)*(d-b):d+c/(a+c)*(b-d)};function ea(a){var b=B(a.b);C(b,a.c);C(b.b,a.c);D(b,a.a);return b}function E(a,b){var c=!1,d=!1;a!==b&&(b.a!==a.a&&(d=!0,F(b.a,a.a)),b.d!==a.d&&(c=!0,G(b.d,a.d)),H(b,a),d||(C(b,a.a),a.a.c=a),c||(D(b,a.d),a.d.a=a))}function I(a){var b=a.b,c=!1;a.d!==a.b.d&&(c=!0,G(a.d,a.b.d));a.c===a?F(a.a,null):(a.b.d.a=J(a),a.a.c=a.c,H(a,J(a)),c||D(a,a.d));b.c===b?(F(b.a,null),G(b.d,null)):(a.d.a=J(b),b.a.c=b.c,H(b,J(b)));fa(a)}function K(a){var b=B(a),c=b.b;H(b,a.e);b.a=a.b.a;C(c,b.a);b.d=c.d=a.d;b=b.b;H(a.b,J(a.b));H(a.b,b);a.b.a=b.a;b.b.a.c=b.b;b.b.d=a.b.d;b.f=a.f;b.b.f=a.b.f;return b}function L(a,b){var c=!1,d=B(a),e=d.b;b.d!==a.d&&(c=!0,G(b.d,a.d));H(d,a.e);H(e,b);d.a=a.b.a;e.a=b.a;d.d=e.d=a.d;a.d.a=e;c||D(d,a.d);return d}function B(a){var b=new M,c=new M,d=a.b.h;c.h=d;d.b.h=b;b.h=a;a.b.h=c;b.b=c;b.c=b;b.e=c;c.b=b;c.c=c;return c.e=b}function H(a,b){var c=a.c,d=b.c;c.b.e=b;d.b.e=a;a.c=d;b.c=c}function C(a,b){var c=b.f,d=new N(b,c);c.e=d;b.f=d;c=d.c=a;do c.a=d,c=c.c;while(c!==a)}function D(a,b){var c=b.d,d=new ga(b,c);c.b=d;b.d=d;d.a=a;d.c=b.c;c=a;do c.d=d,c=c.e;while(c!==a)}function fa(a){var b=a.h;a=a.b.h;b.b.h=a;a.b.h=b}function F(a,b){var c=a.c,d=c;do d.a=b,d=d.c;while(d!==c);c=a.f;d=a.e;d.f=c;c.e=d}function G(a,b){var c=a.a,d=c;do d.d=b,d=d.e;while(d!==c);c=a.d;d=a.b;d.d=c;c.b=d};function ha(a){var b=0;Math.abs(a[1])>Math.abs(a[0])&&(b=1);Math.abs(a[2])>Math.abs(a[b])&&(b=2);return b};var O=4*1E150;function P(a,b){a.f+=b.f;a.b.f+=b.b.f}function ia(a,b,c){a=a.a;b=b.a;c=c.a;if(b.b.a===a)return c.b.a===a?u(b.a,c.a)?0>=x(c.b.a,b.a,c.a):0<=x(b.b.a,c.a,b.a):0>=x(c.b.a,a,c.a);if(c.b.a===a)return 0<=x(b.b.a,a,b.a);b=v(b.b.a,a,b.a);a=v(c.b.a,a,c.a);return b>=a}function Q(a){a.a.i=null;var b=a.e;b.a.c=b.c;b.c.a=b.a;a.e=null}function ja(a,b){I(a.a);a.c=!1;a.a=b;b.i=a}function ka(a){var b=a.a.a;do a=R(a);while(a.a.a===b);a.c&&(b=L(S(a).a.b,a.a.e),ja(a,b),a=R(a));return a}function la(a,b,c){var d=new ma;d.a=c;d.e=na(a.f,b.e,d);return c.i=d}function oa(a,b){switch(a.s){case 100130:return 0!==(b&1);case 100131:return 0!==b;case 100132:return 0<b;case 100133:return 0>b;case 100134:return 2<=b||-2>=b}return!1}function pa(a){var b=a.a,c=b.d;c.c=a.d;c.a=b;Q(a)}function T(a,b,c){a=b;for(b=b.a;a!==c;){a.c=!1;var d=S(a),e=d.a;if(e.a!==b.a){if(!d.c){pa(a);break}e=L(b.c.b,e.b);ja(d,e)}b.c!==e&&(E(J(e),e),E(b,e));pa(a);b=d.a;a=d}return b}function U(a,b,c,d,e,f){var g=!0;do la(a,b,c.b),c=c.c;while(c!==d);for(null===e&&(e=S(b).a.b.c);;){d=S(b);c=d.a.b;if(c.a!==e.a)break;c.c!==e&&(E(J(c),c),E(J(e),c));d.f=b.f-c.f;d.d=oa(a,d.f);b.b=!0;!g&&qa(a,b)&&(P(c,e),Q(b),I(e));g=!1;b=d;e=c}b.b=!0;f&&ra(a,b)}function sa(a,b,c,d,e){var f=[b.g[0],b.g[1],b.g[2]];b.d=null;b.d=a.o?a.o(f,c,d,a.c)||null:null;null===b.d&&(e?a.n||(V(a,100156),a.n=!0):b.d=c[0])}function ta(a,b,c){var d=[null,null,null,null];d[0]=b.a.d;d[1]=c.a.d;sa(a,b.a,d,[.5,.5,0,0],!1);E(b,c)}function ua(a,b,c,d,e){var f=Math.abs(b.b-a.b)+Math.abs(b.a-a.a),g=Math.abs(c.b-a.b)+Math.abs(c.a-a.a),h=e+1;d[e]=.5*g/(f+g);d[h]=.5*f/(f+g);a.g[0]+=d[e]*b.g[0]+d[h]*c.g[0];a.g[1]+=d[e]*b.g[1]+d[h]*c.g[1];a.g[2]+=d[e]*b.g[2]+d[h]*c.g[2]}function qa(a,b){var c=S(b),d=b.a,e=c.a;if(u(d.a,e.a)){if(0<x(e.b.a,d.a,e.a))return!1;if(!t(d.a,e.a))K(e.b),E(d,J(e)),b.b=c.b=!0;else if(d.a!==e.a){var c=a.e,f=d.a.h;if(0<=f){var c=c.b,g=c.d,h=c.e,k=c.c,l=k[f];g[l]=g[c.a];k[g[l]]=l;l<=--c.a&&(1>=l?W(c,l):u(h[g[l>>1]],h[g[l]])?W(c,l):va(c,l));h[f]=null;k[f]=c.b;c.b=f}else for(c.c[-(f+1)]=null;0<c.a&&null===c.c[c.d[c.a-1]];)--c.a;ta(a,J(e),d)}}else{if(0>x(d.b.a,e.a,d.a))return!1;R(b).b=b.b=!0;K(d.b);E(J(e),d)}return!0}function wa(a,b){var c=S(b),d=b.a,e=c.a,f=d.a,g=e.a,h=d.b.a,k=e.b.a,l=new N;x(h,a.a,f);x(k,a.a,g);if(f===g||Math.min(f.a,h.a)>Math.max(g.a,k.a))return!1;if(u(f,g)){if(0<x(k,f,g))return!1}else if(0>x(h,g,f))return!1;var r=h,p=f,q=k,y=g,m,w;u(r,p)||(m=r,r=p,p=m);u(q,y)||(m=q,q=y,y=m);u(r,q)||(m=r,r=q,q=m,m=p,p=y,y=m);u(q,p)?u(p,y)?(m=v(r,q,p),w=v(q,p,y),0>m+w&&(m=-m,w=-w),l.b=A(m,q.b,w,p.b)):(m=x(r,q,p),w=-x(r,y,p),0>m+w&&(m=-m,w=-w),l.b=A(m,q.b,w,y.b)):l.b=(q.b+p.b)/2;z(r,p)||(m=r,r=p,p=m);z(q,y)||(m=q,q=y,y=m);z(r,q)||(m=r,r=q,q=m,m=p,p=y,y=m);z(q,p)?z(p,y)?(m=aa(r,q,p),w=aa(q,p,y),0>m+w&&(m=-m,w=-w),l.a=A(m,q.a,w,p.a)):(m=ba(r,q,p),w=-ba(r,y,p),0>m+w&&(m=-m,w=-w),l.a=A(m,q.a,w,y.a)):l.a=(q.a+p.a)/2;u(l,a.a)&&(l.b=a.a.b,l.a=a.a.a);r=u(f,g)?f:g;u(r,l)&&(l.b=r.b,l.a=r.a);if(t(l,f)||t(l,g))return qa(a,b),!1;if(!t(h,a.a)&&0<=x(h,a.a,l)||!t(k,a.a)&&0>=x(k,a.a,l)){if(k===a.a)return K(d.b),E(e.b,d),b=ka(b),d=S(b).a,T(a,S(b),c),U(a,b,J(d),d,d,!0),!0;if(h===a.a){K(e.b);E(d.e,J(e));f=c=b;g=f.a.b.a;do f=R(f);while(f.a.b.a===g);b=f;f=S(b).a.b.c;c.a=J(e);e=T(a,c,null);U(a,b,e.c,d.b.c,f,!0);return!0}0<=x(h,a.a,l)&&(R(b).b=b.b=!0,K(d.b),d.a.b=a.a.b,d.a.a=a.a.a);0>=x(k,a.a,l)&&(b.b=c.b=!0,K(e.b),e.a.b=a.a.b,e.a.a=a.a.a);return!1}K(d.b);K(e.b);E(J(e),d);d.a.b=l.b;d.a.a=l.a;d.a.h=xa(a.e,d.a);d=d.a;e=[0,0,0,0];l=[f.d,h.d,g.d,k.d];d.g[0]=d.g[1]=d.g[2]=0;ua(d,f,h,e,0);ua(d,g,k,e,2);sa(a,d,l,e,!0);R(b).b=b.b=c.b=!0;return!1}function ra(a,b){for(var c=S(b);;){for(;c.b;)b=c,c=S(c);if(!b.b&&(c=b,b=R(b),null===b||!b.b))break;b.b=!1;var d=b.a,e=c.a,f;if(f=d.b.a!==e.b.a)a:{f=b;var g=S(f),h=f.a,k=g.a,l=void 0;if(u(h.b.a,k.b.a)){if(0>x(h.b.a,k.b.a,h.a)){f=!1;break a}R(f).b=f.b=!0;l=K(h);E(k.b,l);l.d.c=f.d}else{if(0<x(k.b.a,h.b.a,k.a)){f=!1;break a}f.b=g.b=!0;l=K(k);E(h.e,k.b);l.b.d.c=f.d}f=!0}f&&(c.c?(Q(c),I(e),c=S(b),e=c.a):b.c&&(Q(b),I(d),b=R(c),d=b.a));if(d.a!==e.a)if(d.b.a===e.b.a||b.c||c.c||d.b.a!==a.a&&e.b.a!==a.a)qa(a,b);else if(wa(a,b))break;d.a===e.a&&d.b.a===e.b.a&&(P(e,d),Q(b),I(d),b=R(c))}}function ya(a,b){a.a=b;for(var c=b.c;null===c.i;)if(c=c.c,c===b.c){var c=a,d=b,e=new ma;e.a=d.c.b;var f=c.f,g=f.a;do g=g.a;while(null!==g.b&&!f.c(f.b,e,g.b));var f=g.b,h=S(f),e=f.a,g=h.a;if(0===x(e.b.a,d,e.a))e=f.a,t(e.a,d)||t(e.b.a,d)||(K(e.b),f.c&&(I(e.c),f.c=!1),E(d.c,e),ya(c,d));else{var k=u(g.b.a,e.b.a)?f:h,h=void 0;f.d||k.c?(k===f?h=L(d.c.b,e.e):h=L(g.b.c.b,d.c).b,k.c?ja(k,h):(e=c,f=la(c,f,h),f.f=R(f).f+f.a.f,f.d=oa(e,f.f)),ya(c,d)):U(c,f,d.c,d.c,null,!0)}return}c=ka(c.i);e=S(c);f=e.a;e=T(a,e,null);if(e.c===f){var f=e,e=f.c,g=S(c),h=c.a,k=g.a,l=!1;h.b.a!==k.b.a&&wa(a,c);t(h.a,a.a)&&(E(J(e),h),c=ka(c),e=S(c).a,T(a,S(c),g),l=!0);t(k.a,a.a)&&(E(f,J(k)),f=T(a,g,null),l=!0);l?U(a,c,f.c,e,e,!0):(u(k.a,h.a)?d=J(k):d=h,d=L(f.c.b,d),U(a,c,d,d.c,d.c,!1),d.b.i.c=!0,ra(a,c))}else U(a,c,e.c,f,f,!0)}function za(a,b){var c=new ma,d=ea(a.b);d.a.b=O;d.a.a=b;d.b.a.b=-O;d.b.a.a=b;a.a=d.b.a;c.a=d;c.f=0;c.d=!1;c.c=!1;c.h=!0;c.b=!1;d=a.f;d=na(d,d.a,c);c.e=d};function Aa(a){this.a=new Ba;this.b=a;this.c=ia}function na(a,b,c){do b=b.c;while(null!==b.b&&!a.c(a.b,b.b,c));a=new Ba(c,b.a,b);b.a.c=a;return b.a=a};function Ba(a,b,c){this.b=a||null;this.a=b||this;this.c=c||this};function X(){this.d=Y;this.p=this.b=this.q=null;this.j=[0,0,0];this.s=100130;this.n=!1;this.o=this.a=this.e=this.f=null;this.m=!1;this.c=this.r=this.i=this.k=this.l=this.h=null}var Y=0;n=X.prototype;n.x=function(){Z(this,Y)};n.B=function(a,b){switch(a){case 100142:return;case 100140:switch(b){case 100130:case 100131:case 100132:case 100133:case 100134:this.s=b;return}break;case 100141:this.m=!!b;return;default:V(this,100900);return}V(this,100901)};n.y=function(a){switch(a){case 100142:return 0;case 100140:return this.s;case 100141:return this.m;default:V(this,100900)}return!1};n.A=function(a,b,c){this.j[0]=a;this.j[1]=b;this.j[2]=c};n.z=function(a,b){var c=b?b:null;switch(a){case 100100:case 100106:this.h=c;break;case 100104:case 100110:this.l=c;break;case 100101:case 100107:this.k=c;break;case 100102:case 100108:this.i=c;break;case 100103:case 100109:this.p=c;break;case 100105:case 100111:this.o=c;break;case 100112:this.r=c;break;default:V(this,100900)}};n.C=function(a,b){var c=!1,d=[0,0,0];Z(this,2);for(var e=0;3>e;++e){var f=a[e];-1E150>f&&(f=-1E150,c=!0);1E150<f&&(f=1E150,c=!0);d[e]=f}c&&V(this,100155);c=this.q;null===c?(c=ea(this.b),E(c,c.b)):(K(c),c=c.e);c.a.d=b;c.a.g[0]=d[0];c.a.g[1]=d[1];c.a.g[2]=d[2];c.f=1;c.b.f=-1;this.q=c};n.u=function(a){Z(this,Y);this.d=1;this.b=new Ca;this.c=a};n.t=function(){Z(this,1);this.d=2;this.q=null};n.v=function(){Z(this,2);this.d=1};n.w=function(){Z(this,1);this.d=Y;var a=this.j[0],b=this.j[1],c=this.j[2],d=!1,e=[a,b,c];if(0===a&&0===b&&0===c){for(var b=[-2*1E150,-2*1E150,-2*1E150],f=[2*1E150,2*1E150,2*1E150],c=[],g=[],d=this.b.c,a=d.e;a!==d;a=a.e)for(var h=0;3>h;++h){var k=a.g[h];k<f[h]&&(f[h]=k,g[h]=a);k>b[h]&&(b[h]=k,c[h]=a)}a=0;b[1]-f[1]>b[0]-f[0]&&(a=1);b[2]-f[2]>b[a]-f[a]&&(a=2);if(f[a]>=b[a])e[0]=0,e[1]=0,e[2]=1;else{b=0;f=g[a];c=c[a];g=[0,0,0];f=[f.g[0]-c.g[0],f.g[1]-c.g[1],f.g[2]-c.g[2]];h=[0,0,0];for(a=d.e;a!==d;a=a.e)h[0]=a.g[0]-c.g[0],h[1]=a.g[1]-c.g[1],h[2]=a.g[2]-c.g[2],g[0]=f[1]*h[2]-f[2]*h[1],g[1]=f[2]*h[0]-f[0]*h[2],g[2]=f[0]*h[1]-f[1]*h[0],k=g[0]*g[0]+g[1]*g[1]+g[2]*g[2],k>b&&(b=k,e[0]=g[0],e[1]=g[1],e[2]=g[2]);0>=b&&(e[0]=e[1]=e[2]=0,e[ha(f)]=1)}d=!0}g=ha(e);a=this.b.c;b=(g+1)%3;c=(g+2)%3;g=0<e[g]?1:-1;for(e=a.e;e!==a;e=e.e)e.b=e.g[b],e.a=g*e.g[c];if(d){e=0;d=this.b.a;for(a=d.b;a!==d;a=a.b)if(b=a.a,!(0>=b.f)){do e+=(b.a.b-b.b.a.b)*(b.a.a+b.b.a.a),b=b.e;while(b!==a.a)}if(0>e)for(e=this.b.c,d=e.e;d!==e;d=d.e)d.a=-d.a}this.n=!1;e=this.b.b;for(a=e.h;a!==e;a=d)if(d=a.h,b=a.e,t(a.a,a.b.a)&&a.e.e!==a&&(ta(this,b,a),I(a),a=b,b=a.e),b.e===a){if(b!==a){if(b===d||b===d.b)d=d.h;I(b)}if(a===d||a===d.b)d=d.h;I(a)}this.e=e=new Da;d=this.b.c;for(a=d.e;a!==d;a=a.e)a.h=xa(e,a);Ea(e);this.f=new Aa(this);za(this,-O);for(za(this,O);null!==(e=Fa(this.e));){for(;;){a:if(a=this.e,0===a.a)d=Ga(a.b);else if(d=a.c[a.d[a.a-1]],0!==a.b.a&&(a=Ga(a.b),u(a,d))){d=a;break a}if(null===d||!t(d,e))break;d=Fa(this.e);ta(this,e.c,d.c)}ya(this,e)}this.a=this.f.a.a.b.a.a;for(e=0;null!==(d=this.f.a.a.b);)d.h||++e,Q(d);this.f=null;e=this.e;e.b=null;e.d=null;this.e=e.c=null;e=this.b;for(a=e.a.b;a!==e.a;a=d)d=a.b,a=a.a,a.e.e===a&&(P(a.c,a),I(a));if(!this.n){e=this.b;if(this.m)for(a=e.b.h;a!==e.b;a=d)d=a.h,a.b.d.c!==a.d.c?a.f=a.d.c?1:-1:I(a);else for(a=e.a.b;a!==e.a;a=d)if(d=a.b,a.c){for(a=a.a;u(a.b.a,a.a);a=a.c.b);for(;u(a.a,a.b.a);a=a.e);b=a.c.b;for(c=void 0;a.e!==b;)if(u(a.b.a,b.a)){for(;b.e!==a&&(ca(b.e)||0>=x(b.a,b.b.a,b.e.b.a));)c=L(b.e,b),b=c.b;b=b.c.b}else{for(;b.e!==a&&(da(a.c.b)||0<=x(a.b.a,a.a,a.c.b.a));)c=L(a,a.c.b),a=c.b;a=a.e}for(;b.e.e!==a;)c=L(b.e,b),b=c.b}if(this.h||this.i||this.k||this.l)if(this.m)for(e=this.b,d=e.a.b;d!==e.a;d=d.b){if(d.c){this.h&&this.h(2,this.c);a=d.a;do this.k&&this.k(a.a.d,this.c),a=a.e;while(a!==d.a);this.i&&this.i(this.c)}}else{e=this.b;d=!!this.l;a=!1;b=-1;for(c=e.a.d;c!==e.a;c=c.d)if(c.c){a||(this.h&&this.h(4,this.c),a=!0);g=c.a;do d&&(f=g.b.d.c?0:1,b!==f&&(b=f,this.l&&this.l(!!b,this.c))),this.k&&this.k(g.a.d,this.c),g=g.e;while(g!==c.a)}a&&this.i&&this.i(this.c)}if(this.r){e=this.b;for(a=e.a.b;a!==e.a;a=d)if(d=a.b,!a.c){b=a.a;c=b.e;g=void 0;do g=c,c=g.e,g.d=null,null===g.b.d&&(g.c===g?F(g.a,null):(g.a.c=g.c,H(g,J(g))),f=g.b,f.c===f?F(f.a,null):(f.a.c=f.c,H(f,J(f))),fa(g));while(g!==b);b=a.d;a=a.b;a.d=b;b.b=a}this.r(this.b);this.c=this.b=null;return}}this.b=this.c=null};function Z(a,b){if(a.d!==b)for(;a.d!==b;)if(a.d<b)switch(a.d){case Y:V(a,100151);a.u(null);break;case 1:V(a,100152),a.t()}else switch(a.d){case 2:V(a,100154);a.v();break;case 1:V(a,100153),a.w()}}function V(a,b){a.p&&a.p(b,a.c)};function ga(a,b){this.b=a||this;this.d=b||this;this.a=null;this.c=!1};function M(){this.h=this;this.i=this.d=this.a=this.e=this.c=this.b=null;this.f=0}function J(a){return a.b.e};function Ca(){this.c=new N;this.a=new ga;this.b=new M;this.d=new M;this.b.b=this.d;this.d.b=this.b};function N(a,b){this.e=a||this;this.f=b||this;this.d=this.c=null;this.g=[0,0,0];this.h=this.a=this.b=0};function Da(){this.c=[];this.d=null;this.a=0;this.e=!1;this.b=new Ha}function Ea(a){a.d=[];for(var b=0;b<a.a;b++)a.d[b]=b;a.d.sort(function(a){return function(b,e){return u(a[b],a[e])?1:-1}}(a.c));a.e=!0;Ia(a.b)}function xa(a,b){if(a.e){var c=a.b,d=++c.a;2*d>c.f&&(c.f*=2,c.c=Ja(c.c,c.f+1));var e;0===c.b?e=d:(e=c.b,c.b=c.c[c.b]);c.e[e]=b;c.c[e]=d;c.d[d]=e;c.h&&va(c,d);return e}c=a.a++;a.c[c]=b;return-(c+1)}function Fa(a){if(0===a.a)return Ka(a.b);var b=a.c[a.d[a.a-1]];if(0!==a.b.a&&u(Ga(a.b),b))return Ka(a.b);do--a.a;while(0<a.a&&null===a.c[a.d[a.a-1]]);return b};function Ha(){this.d=Ja([0],33);this.e=[null,null];this.c=[0,0];this.a=0;this.f=32;this.b=0;this.h=!1;this.d[1]=1}function Ja(a,b){for(var c=Array(b),d=0;d<a.length;d++)c[d]=a[d];for(;d<b;d++)c[d]=0;return c}function Ia(a){for(var b=a.a;1<=b;--b)W(a,b);a.h=!0}function Ga(a){return a.e[a.d[1]]}function Ka(a){var b=a.d,c=a.e,d=a.c,e=b[1],f=c[e];0<a.a&&(b[1]=b[a.a],d[b[1]]=1,c[e]=null,d[e]=a.b,a.b=e,0<--a.a&&W(a,1));return f}function W(a,b){for(var c=a.d,d=a.e,e=a.c,f=b,g=c[f];;){var h=f<<1;h<a.a&&u(d[c[h+1]],d[c[h]])&&(h+=1);var k=c[h];if(h>a.a||u(d[g],d[k])){c[f]=g;e[g]=f;break}c[f]=k;e[k]=f;f=h}}function va(a,b){for(var c=a.d,d=a.e,e=a.c,f=b,g=c[f];;){var h=f>>1,k=c[h];if(0===h||u(d[k],d[g])){c[f]=g;e[g]=f;break}c[f]=k;e[k]=f;f=h}};function ma(){this.e=this.a=null;this.f=0;this.c=this.b=this.h=this.d=!1}function S(a){return a.e.c.b}function R(a){return a.e.a.b};var _={GluTesselator:X,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901,GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111}};X.prototype.gluDeleteTess=X.prototype.x;X.prototype.gluTessProperty=X.prototype.B;X.prototype.gluGetTessProperty=X.prototype.y;X.prototype.gluTessNormal=X.prototype.A;X.prototype.gluTessCallback=X.prototype.z;X.prototype.gluTessVertex=X.prototype.C;X.prototype.gluTessBeginPolygon=X.prototype.u;X.prototype.gluTessBeginContour=X.prototype.t;X.prototype.gluTessEndContour=X.prototype.v;X.prototype.gluTessEndPolygon=X.prototype.w;return _}());
	
/*
 * AT H.263 in javscript(ES5)
 */

var AT_H263 = (function() {
  function saturatingSub(a, b) {
    return a - b;
  }
  function asU8(num) {
    return (num << 24) >>> 24;
  }
  function asI8(num) {
    return (num << 24) >> 24;
  }
  function asU16(num) {
    return (num << 16) >>> 16;
  }
  function asI16(num) {
    return (num << 16) >> 16;
  }
  function is_eof_error(type) {
    return (type == "EndOfFile") || (type == "_");
  }

  var Picture = function() {
    this.version = 0; // u8
    this.temporal_reference = 0; // u16
    this.format = null; // SourceFormat
    this.options = null; // PictureOption
    this.has_plusptype = false; // bool
    this.has_opptype = false; // bool
    this.picture_type = null; // PictureTypeCode
    this.motion_vector_range = null; // MotionVectorRange
    this.slice_submode = null; // SliceSubmode
    this.scalability_layer = null; // ScalabilityLayer
    this.reference_picture_selection_mode = null; // ReferencePictureSelectionMode
    this.prediction_reference = 0; // u16
    this.backchannel_message = null; // BackchannelMessage
    this.reference_picture_resampling = null; // ReferencePictureResampling
    this.quantizer = 0; // u8
    this.multiplex_bitstream = 0; // u8
    this.pb_reference = 0; // u8
    this.pb_quantizer = null; // BPictureQuantizer
    this.extra = []; // Vec u8
  };

  var PixelAspectRatio = function(type, value) {
    this.type = type;
    this.value = (value || null);
  }
  PixelAspectRatio.Square = 1;
  PixelAspectRatio.Par12_11 = 2;
  PixelAspectRatio.Par10_11 = 3;
  PixelAspectRatio.Par16_11 = 4;
  PixelAspectRatio.Par40_33 = 5;
  PixelAspectRatio.Reserved = 6; // u8
  PixelAspectRatio.Extended = 7; // { parWidth: u8, parHeight: u8 }

  var CustomPictureFormat = function(pixelAspectRatio, pictureWidthIndication, pictureHeightIndication) {
    this.pixelAspectRatio = pixelAspectRatio;
    this.pictureWidthIndication = pictureWidthIndication;
    this.pictureHeightIndication = pictureHeightIndication;
  }

  var MotionVectorRange = function(type) {
    this.type = type;
  }
  MotionVectorRange.Extended = 0;
  MotionVectorRange.Unlimited = 1;

  var SourceFormat = function(type, value) {
    this.type = type;
    this.value = (value || null);
  }

  SourceFormat.SubQcif = 1;
  SourceFormat.QuarterCif = 2;
  SourceFormat.FullCif = 3;
  SourceFormat.FourCif = 4;
  SourceFormat.SixteenCif = 5;
  SourceFormat.Reserved = 6;
  SourceFormat.Extended = 7; // value CustomPictureFormat

  SourceFormat.prototype.intoWidthAndHeight = function() {
    switch(this.type) {
      case SourceFormat.SubQcif:
        return [128, 96];
      case SourceFormat.QuarterCif:
        return [176, 144];
      case SourceFormat.FullCif:
        return [352, 288];
      case SourceFormat.FourCif:
        return [704, 576];
      case SourceFormat.SixteenCif:
        return [1408, 1152];
      case SourceFormat.Reserved:
        return null;
      case SourceFormat.Extended:
        return [this.value.pictureWidthIndication, this.value.pictureHeightIndication];
    }
  }

  var PictureTypeCode = function(type, value) {
    this.type = type;
    this.value = value;
  }
  PictureTypeCode.IFrame = 1;
  PictureTypeCode.PFrame = 2;
  PictureTypeCode.PbFrame = 3;
  PictureTypeCode.ImprovedPbFrame = 4;
  PictureTypeCode.BFrame = 5;
  PictureTypeCode.EiFrame = 6;
  PictureTypeCode.EpFrame = 7;
  PictureTypeCode.Reserved = 8; // u8
  PictureTypeCode.DisposablePFrame = 9;

  PictureTypeCode.prototype.is_any_pbframe = function() {
    return (this.type == PictureTypeCode.PbFrame) || (this.type == PictureTypeCode.ImprovedPbFrame);
  }
  PictureTypeCode.prototype.is_disposable = function() {
    return this.type == PictureTypeCode.DisposablePFrame;
  }
  PictureTypeCode.prototype.getType = function() {
    switch(this.type) {
      case PictureTypeCode.IFrame:
        return "IFrame";
      case PictureTypeCode.PFrame:
        return "PFrame";
      case PictureTypeCode.PbFrame:
        return "PbFrame";
      case PictureTypeCode.EiFrame:
        return "EiFrame";
      case PictureTypeCode.EpFrame:
        return "EpFrame";
      case PictureTypeCode.Reserved:
        return "Reserved";
      case PictureTypeCode.DisposablePFrame:
        return "DisposablePFrame";
    }
  }

  var DecodedDctBlock = function(type, value) {
    this.type = type;
    this.value = value;
  }
  DecodedDctBlock.Zero = 1;
  DecodedDctBlock.Dc = 2; // f32
  DecodedDctBlock.Horiz = 3; // [f32; 8]
  DecodedDctBlock.Vert = 4; // [f32; 8]
  DecodedDctBlock.Full = 5; // [[f32; 8]; 8]

  var PictureOption = function() {
    this.USE_SPLIT_SCREEN = false;
    this.USE_DOCUMENT_CAMERA = false;
    this.RELEASE_FULL_PICTURE_FREEZE = false;
    this.UNRESTRICTED_MOTION_VECTORS = false;
    this.SYNTAX_BASED_ARITHMETIC_CODING = false;
    this.ADVANCED_PREDICTION = false;
    this.ADVANCED_INTRA_CODING = false;
    this.DEBLOCKING_FILTER = false;
    this.SLICE_STRUCTURED = false;
    this.REFERENCE_PICTURE_SELECTION = false;
    this.INDEPENDENT_SEGMENT_DECODING = false;
    this.ALTERNATIVE_INTER_VLC = false;
    this.MODIFIED_QUANTIZATION = false;
    this.REFERENCE_PICTURE_RESAMPLING = false;
    this.REDUCED_RESOLUTION_UPDATE = false;
    this.ROUNDING_TYPE_ONE = false;
    this.USE_DEBLOCKER = false;
  }
  PictureOption.empty = function() {
    return new PictureOption();
  }

  function decodeSorensonPType(reader) {
    // with_transaction
    var source_format, bit_count;

    var dgf = reader.readBits(3);

    switch(dgf) {
      case 0:
        source_format = null;
        bit_count = 8;
        break;
      case 1:
        source_format = null;
        bit_count = 16;
        break;
      case 2:
        source_format = new SourceFormat(SourceFormat.FullCif);
        bit_count = 0;
        break;
      case 3:
        source_format = new SourceFormat(SourceFormat.QuarterCif);
        bit_count = 0;
        break;
      case 4:
        source_format = new SourceFormat(SourceFormat.SubQcif);
        bit_count = 0;
        break;
      case 5:
        source_format = new SourceFormat(SourceFormat.Extended, new CustomPictureFormat(new PixelAspectRatio(PixelAspectRatio.Square), 320, 240));
        bit_count = 0;
        break;
      case 6:
        source_format = new SourceFormat(SourceFormat.Extended, new CustomPictureFormat(new PixelAspectRatio(PixelAspectRatio.Square), 160, 120));
        bit_count = 0;
        break;
      default:
        source_format = new SourceFormat(SourceFormat.Reserved);
        bit_count = 0;
    }
    if (source_format === null) { // source_format.is_none()
      var customWidth = reader.readBits(bit_count);
      var customHeight = reader.readBits(bit_count);

      source_format = new SourceFormat(SourceFormat.Extended, new CustomPictureFormat(new PixelAspectRatio(PixelAspectRatio.Square), customWidth, customHeight));
    }

    var fdgd = reader.readBits(2);

    var pictureType;
    switch(fdgd) {
      case 0:
        pictureType = new PictureTypeCode(PictureTypeCode.IFrame);
        break;
      case 1:
        pictureType = new PictureTypeCode(PictureTypeCode.PFrame);
        break;
      case 2:
        pictureType = new PictureTypeCode(PictureTypeCode.DisposablePFrame);
        break;
      default:
        pictureType = new PictureTypeCode(PictureTypeCode.Reserved, fdgd);
        break;
    }

    var options = PictureOption.empty();

    if (reader.readBits(1) == 1) {
      options.USE_DEBLOCKER = true;
    }

    return [source_format, pictureType, options];
  }

  var DecodedPicture = function(picture_header, format) {
    var wh = format.intoWidthAndHeight();

    var luma_samples = wh[0] * wh[1];
    var luma = new Uint8Array(luma_samples);

    var chroma_w = Math.ceil(wh[0] / 2.0);
    var chroma_h = Math.ceil(wh[1] / 2.0);

    var chroma_samples = chroma_w * chroma_h;

    var chroma_b = new Uint8Array(chroma_samples);
    var chroma_r = new Uint8Array(chroma_samples);

    this.picture_header = picture_header; // Picture
    this.format = format; // SourceFormat
    this.luma = luma; // Vec u8
    this.chroma_b = chroma_b; // Vec u8
    this.chroma_r = chroma_r; // Vec u8
    this.chroma_samples_per_row = chroma_w;
  }
  DecodedPicture.prototype.as_yuv = function() {
    return [this.luma, this.chroma_b, this.chroma_r];
  }
  DecodedPicture.prototype.as_header = function() {
    return this.picture_header;
  }
  DecodedPicture.prototype.as_luma_mut = function() {
    return this.luma;
  }
  DecodedPicture.prototype.as_chroma_b_mut = function() {
    return this.chroma_b;
  }
  DecodedPicture.prototype.as_chroma_r_mut = function() {
    return this.chroma_r;
  }
  DecodedPicture.prototype.as_luma = function() {
    return this.luma;
  }
  DecodedPicture.prototype.as_chroma_b = function() {
    return this.chroma_b;
  }
  DecodedPicture.prototype.as_chroma_r = function() {
    return this.chroma_r;
  }
  DecodedPicture.prototype.luma_samples_per_row = function() {
    return this.format.intoWidthAndHeight()[0];
  }
  function decodePei(reader) {
    var data = [];
    while(true) {
      var hasPei = reader.readBits(1);
      if (hasPei == 1) {
        data.push(reader.readUint8());
      } else {
        break;
      }
    }
    return data;
  }

  function decodePicture(reader, decoderOptions, previous_picture) {
    //with_transaction_union

    var skippedBits = reader.recognizeStartCode(false);
    reader.skipBits(17 + skippedBits);
    var gob_id = reader.readBits(5);
    if (decoderOptions.sorensonSpark) {
      var temporalReference = reader.readUint8();
      var dpt = decodeSorensonPType(reader);
      var source_format = dpt[0], pictureType = dpt[1], options = dpt[2];
      var quantizer = reader.readBits(5);
      var extra = decodePei(reader);
      var result = new Picture();

      result.version = gob_id;
      result.temporal_reference = temporalReference;
      result.format = source_format;
      result.options = options;
      result.has_plusptype = false;
      result.has_opptype = false;
      result.picture_type = pictureType;
      result.quantizer = quantizer;
      result.extra = extra;

      result.motion_vector_range = new MotionVectorRange(MotionVectorRange.Unlimited);

      result.slice_submode = null;
      result.scalability_layer = null;
      result.reference_picture_selection_mode = null;
      result.prediction_reference = null;
      result.backchannel_message = null;
      result.reference_picture_resampling = null;
      result.multiplex_bitstream = null;
      result.pb_reference = null;
      result.pb_quantizer = null;

      return result;
    }
  }

  var CodedBlockPattern = function(codes_luma, codes_chroma_b, codes_chroma_r) {
    this.codes_luma = codes_luma;
    this.codes_chroma_b = codes_chroma_b;
    this.codes_chroma_r = codes_chroma_r;
  }

  function op_cmp(value) {
    if (value > 0) {
      return "less";
    } else if (value < 0) {
      return "greater";
    } else {
      return "equal";
    }
  }

  var HalfPel = function(n) {
    this.n = n; // i16
  }
  HalfPel.zero = function() {
    return new HalfPel(0);
  }
  HalfPel.from = function(float) {
    return new HalfPel(asI16(Math.floor(float * 2)));
  }
  HalfPel.from_unit = function(unit) {
    return new HalfPel(asI16(unit));
  }
  HalfPel.prototype.is_mv_within_range = function(range) {
    return -range.n <= this.n && this.n < range.n;
  }
  HalfPel.prototype.invert = function() {
    switch(op_cmp(this.n)) {
      case "greater":
        return new HalfPel(this.n + 64);
      case "less":
        return new HalfPel(this.n - 64);
      case "equal":
        return this;
    }
  }
  HalfPel.prototype.average_sum_of_mvs = function() {
    var whole = (this.n >> 4) << 1; // div 8
    var frac = this.n & 0x0F;
    if (asfgdgdfg(frac, 0, 2)) {
      return new HalfPel(whole);
    } else if (asfgdgdfg(frac, 14, 15)) {
      return new HalfPel(whole + 2);
    } else {
      return new HalfPel(whole + 1);
    } 
  }
  HalfPel.prototype.median_of = function(mhs, rhs) {
    var num_self = this.n;
    var num_mhs = mhs.n;
    var num_rhs = rhs.n;
    if (num_self > num_mhs) {
      if (num_rhs > num_mhs) {
        if (num_rhs > num_self) {
          return this;
        } else {
          return rhs;
        }
      } else {
        return mhs;
      }
    } else if (num_mhs > num_rhs) {
      if (num_rhs > num_self) {
        return rhs;
      } else {
        return this;
      }
    } else {
      return mhs;
    }
  }
  HalfPel.prototype.into_lerp_parameters = function() {
    if (this.n % 2 == 0) {
      return [asI16(this.n / 2), false];
    } else if (this.n < 0) {
      return [asI16(this.n / 2 - 1), true];
    } else {
      return [asI16(this.n / 2), true];
    }
  }
  HalfPel.STANDARD_RANGE = new HalfPel(32);
  HalfPel.EXTENDED_RANGE = new HalfPel(64);
  HalfPel.EXTENDED_RANGE_QUADCIF = new HalfPel(128);
  HalfPel.EXTENDED_RANGE_SIXTEENCIF = new HalfPel(256);
  HalfPel.EXTENDED_RANGE_BEYONDCIF = new HalfPel(512);

  var MotionVector = function(n1, n2) {
    this.n1 = n1;
    this.n2 = n2;
  }
  MotionVector.zero = function() {
    return new MotionVector(HalfPel.zero(), HalfPel.zero());
  }
  MotionVector.prototype.median_of = function(mhs, rhs) {
    return new MotionVector(
      this.n1.median_of(mhs.n1, rhs.n1),
      this.n2.median_of(mhs.n2, rhs.n2)
    );
  }
  MotionVector.prototype.into_lerp_parameters = function() {
    return [this.n1.into_lerp_parameters(), this.n2.into_lerp_parameters()];
  }
  MotionVector.prototype.add = function(rhs) {
    var g1 = asI16(this.n1.n + rhs.n1.n);
    var g2 = asI16(this.n2.n + rhs.n2.n);
    return new MotionVector(new HalfPel(g1), new HalfPel(g2));
  }
  MotionVector.prototype.average_sum_of_mvs = function() {
    return new MotionVector(this.n1.average_sum_of_mvs(), this.n2.average_sum_of_mvs());
  }

  var IntraDc = function(n) {
    this.n = n; // u8
  }
  IntraDc.from_u8 = function(value) {
    if (value == 0 || value == 128) {
      return null;
    } else {
      return new IntraDc(value);
    }
  }
  IntraDc.prototype.into_level = function() {
    if (this.n == 0xFF) {
      return 1024;
    } else {
      return asI16(asI16(asU16(this.n)) << 3);
    }
  }

  var TCoefficient = function(is_short, run, level) {
    this.is_short = is_short;
    this.run = run;
    this.level = level;
  }

  var Block = function(intradc, tcoef) {
    this.intradc = intradc;
    this.tcoef = tcoef;
  }

  var VlcEntry = function(type, value) {
    this.type = type;
    this.value = value;
  }
  VlcEntry.End = 1;
  VlcEntry.Fork = 2;

  var MacroblockType = function(type) {
    this.type = type;
  }
  MacroblockType.Inter = 1;
  MacroblockType.InterQ = 2;
  MacroblockType.Inter4V = 3;
  MacroblockType.Intra = 4;
  MacroblockType.IntraQ = 5;
  MacroblockType.Inter4Vq = 6;
  MacroblockType.prototype.is_inter = function() {
    return this.type == MacroblockType.Inter || this.type == MacroblockType.InterQ || this.type == MacroblockType.Inter4V || this.type == MacroblockType.Inter4Vq;
  }
  MacroblockType.prototype.is_intra = function() {
    return (this.type == MacroblockType.Intra) || (this.type == MacroblockType.IntraQ);
  }
  MacroblockType.prototype.has_fourvec = function() {
    return this.type == MacroblockType.Inter4V || this.type == MacroblockType.Inter4Vq;
  }
  MacroblockType.prototype.has_quantizer = function() {
    return this.type == MacroblockType.InterQ || this.type == MacroblockType.IntraQ || this.type == MacroblockType.Inter4Vq;
  }

  var Macroblock = function(type, value) {
    this.type = type;
    this.value = value;
  }
  Macroblock.Uncoded = 1;
  Macroblock.Stuffing = 2;
  Macroblock.Coded = 3;
  Macroblock.prototype.macroblock_type = function() {

  }

  var BlockPatternEntry = function(type, value) {
    this.type = type;
    this.value = value;
  }
  BlockPatternEntry.Stuffing = 1;
  BlockPatternEntry.Invalid = 2;
  BlockPatternEntry.Valid = 3; // (MacroblockType, bool, bool)

  var MCBPC_I_TABLE = [
    new VlcEntry(VlcEntry.Fork, [2, 1]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(
      BlockPatternEntry.Valid,
      [new MacroblockType(MacroblockType.Intra), false, false]
    )),
    new VlcEntry(VlcEntry.Fork, [6, 3]),
    new VlcEntry(VlcEntry.Fork, [4, 5]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(
      BlockPatternEntry.Valid,
      [new MacroblockType(MacroblockType.Intra), true, false]
    )),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(
      BlockPatternEntry.Valid,
      [new MacroblockType(MacroblockType.Intra), true, true]
    )),
    new VlcEntry(VlcEntry.Fork, [8, 7]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.Intra),
        false,
        true
      ]
    )),
    new VlcEntry(VlcEntry.Fork, [10, 9]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.IntraQ),
        false,
        false
      ]
    )),
    new VlcEntry(VlcEntry.Fork, [14, 11]),
    new VlcEntry(VlcEntry.Fork, [12, 13]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.IntraQ),
        true,
        false
      ]
    )),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.IntraQ),
        true,
        true
      ]
    )),
    new VlcEntry(VlcEntry.Fork, [16, 20]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Invalid)),
    new VlcEntry(VlcEntry.Fork, [17, 15]),
    new VlcEntry(VlcEntry.Fork, [18, 15]),
    new VlcEntry(VlcEntry.Fork, [15, 19]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Stuffing)),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.IntraQ),
        false,
        true
      ]
    )),
  ];
  var MCBPC_P_TABLE = [
    new VlcEntry(VlcEntry.Fork, [2, 1]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.Inter),
        false,
        false
      ]
    )),
    new VlcEntry(VlcEntry.Fork, [6, 3]),
    new VlcEntry(VlcEntry.Fork, [4, 5]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.Inter4V),
        false,
        false
      ]
    )),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.InterQ),
        false,
        false
      ]
    )),
    new VlcEntry(VlcEntry.Fork, [10, 7]),
    new VlcEntry(VlcEntry.Fork, [8, 9]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.Inter),
        true,
        false
      ]
    )),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.Inter),
        false,
        true
      ]
    )),
    new VlcEntry(VlcEntry.Fork, [16, 11]),
    new VlcEntry(VlcEntry.Fork, [13, 12]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.Intra),
        false,
        false
      ]
    )),
    new VlcEntry(VlcEntry.Fork, [14, 15]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.IntraQ),
        false,
        false
      ]
    )),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.Inter),
        true,
        true
      ]
    )),
    new VlcEntry(VlcEntry.Fork, [24, 17]),
    new VlcEntry(VlcEntry.Fork, [18, 21]),
    new VlcEntry(VlcEntry.Fork, [19, 20]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.Inter4V),
        true,
        false
      ]
    )),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.Inter4V),
        false,
        true
      ]
    )),
    new VlcEntry(VlcEntry.Fork, [22, 23]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.InterQ),
        true,
        false
      ]
    )),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.InterQ),
        false,
        true
      ]
    )),
    new VlcEntry(VlcEntry.Fork, [30, 25]),
    new VlcEntry(VlcEntry.Fork, [27, 26]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.Intra),
        true,
        true
      ]
    )),
    new VlcEntry(VlcEntry.Fork, [28, 29]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.Intra),
        false,
        true
      ]
    )),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.Inter4V),
        true,
        true
      ]
    )),
    new VlcEntry(VlcEntry.Fork, [36, 31]),
    new VlcEntry(VlcEntry.Fork, [33, 32]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.Intra),
        true,
        false
      ]
    )),
    new VlcEntry(VlcEntry.Fork, [34, 35]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.IntraQ),
        false,
        true
      ]
    )),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.InterQ),
        true,
        true
      ]
    )),
    new VlcEntry(VlcEntry.Fork, [40, 37]),
    new VlcEntry(VlcEntry.Fork, [38, 39]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.IntraQ),
        true,
        true
      ]
    )),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.IntraQ),
        true,
        false
      ]
    )),
    new VlcEntry(VlcEntry.Fork, [42, 41]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Stuffing)),
    new VlcEntry(VlcEntry.Fork, [43, 44]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Invalid)),
    new VlcEntry(VlcEntry.Fork, [45, 46]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.Inter4Vq),
        false,
        false
      ]
    )),
    new VlcEntry(VlcEntry.Fork, [47, 50]),
    new VlcEntry(VlcEntry.Fork, [48, 49]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.Inter4Vq),
        false,
        true
      ]
    )),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Invalid)),
    new VlcEntry(VlcEntry.Fork, [51, 52]),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.Inter4Vq),
        true,
        false
      ]
    )),
    new VlcEntry(VlcEntry.End, new BlockPatternEntry(BlockPatternEntry.Valid,
      [
        new MacroblockType(MacroblockType.Inter4Vq),
        true,
        true
      ]
    )),
  ];

  var MODB_TABLE = [
    new VlcEntry(VlcEntry.Fork, [1, 2]),
    new VlcEntry(VlcEntry.End, [false, false]),
    new VlcEntry(VlcEntry.Fork, [3, 4]),
    new VlcEntry(VlcEntry.End, [false, true]),
    new VlcEntry(VlcEntry.End, [true, true])
  ];

  function decode_cbpb(reader) {
    var cbp0 = reader.readBits(1) == 1;
    var cbp1 = reader.readBits(1) == 1;
    var cbp2 = reader.readBits(1) == 1;
    var cbp3 = reader.readBits(1) == 1;
    var cbp4 = reader.readBits(1) == 1;
    var cbp5 = reader.readBits(1) == 1;
    return new CodedBlockPattern([cbp0, cbp1, cbp2, cbp3], cbp4, cbp5);
  }

  var CBPY_TABLE_INTRA = [
    new VlcEntry(VlcEntry.Fork, [1, 24]),
    new VlcEntry(VlcEntry.Fork, [2, 17]),
    new VlcEntry(VlcEntry.Fork, [3, 12]),
    new VlcEntry(VlcEntry.Fork, [4, 9]),
    new VlcEntry(VlcEntry.Fork, [5, 6]),
    new VlcEntry(VlcEntry.End, null), // not a valid prefix
    new VlcEntry(VlcEntry.Fork, [7, 8]),
    new VlcEntry(VlcEntry.End, [false, true, true, false]),
    new VlcEntry(VlcEntry.End, [true, false, false, true]),
    new VlcEntry(VlcEntry.Fork, [10, 11]),
    new VlcEntry(VlcEntry.End, [true, false, false, false]),
    new VlcEntry(VlcEntry.End, [false, true, false, false]),
    new VlcEntry(VlcEntry.Fork, [13, 16]),
    new VlcEntry(VlcEntry.Fork, [14, 15]),
    new VlcEntry(VlcEntry.End, [false, false, true, false]),
    new VlcEntry(VlcEntry.End, [false, false, false, true]),
    new VlcEntry(VlcEntry.End, [false, false, false, false]),
    new VlcEntry(VlcEntry.Fork, [18, 21]),
    new VlcEntry(VlcEntry.Fork, [19, 20]),
    new VlcEntry(VlcEntry.End, [true, true, false, false]),
    new VlcEntry(VlcEntry.End, [true, false, true, false]),
    new VlcEntry(VlcEntry.Fork, [22, 23]),
    new VlcEntry(VlcEntry.End, [true, true, true, false]),
    new VlcEntry(VlcEntry.End, [false, true, false, true]),
    new VlcEntry(VlcEntry.Fork, [25, 32]),
    new VlcEntry(VlcEntry.Fork, [26, 29]),
    new VlcEntry(VlcEntry.Fork, [27, 28]),
    new VlcEntry(VlcEntry.End, [true, true, false, true]),
    new VlcEntry(VlcEntry.End, [false, false, true, true]),
    new VlcEntry(VlcEntry.Fork, [30, 31]),
    new VlcEntry(VlcEntry.End, [true, false, true, true]),
    new VlcEntry(VlcEntry.End, [false, true, true, true]),
    new VlcEntry(VlcEntry.End, [true, true, true, true]),
  ];
  function decode_dquant(reader) {
    switch(reader.readBits(2)) {
      case 0:
        return -1;
      case 1:
        return -2;
      case 2:
        return 1;
      case 3:
        return 2;
      default:
        throw new Error("InternalDecoderError");
    }
  }

  var MVD_TABLE = [
    new VlcEntry(VlcEntry.Fork, [2, 1]),
    new VlcEntry(VlcEntry.End, 0.0),
    new VlcEntry(VlcEntry.Fork, [6, 3]),
    new VlcEntry(VlcEntry.Fork, [4, 5]),
    new VlcEntry(VlcEntry.End, 0.5),
    new VlcEntry(VlcEntry.End, -0.5),
    new VlcEntry(VlcEntry.Fork, [10, 7]),
    new VlcEntry(VlcEntry.Fork, [8, 9]),
    new VlcEntry(VlcEntry.End, 1.0),
    new VlcEntry(VlcEntry.End, -1.0),
    new VlcEntry(VlcEntry.Fork, [14, 11]),
    new VlcEntry(VlcEntry.Fork, [12, 13]),
    new VlcEntry(VlcEntry.End, 1.5),
    new VlcEntry(VlcEntry.End, -1.5),
    new VlcEntry(VlcEntry.Fork, [26, 15]),
    new VlcEntry(VlcEntry.Fork, [19, 16]),
    new VlcEntry(VlcEntry.Fork, [17, 18]),
    new VlcEntry(VlcEntry.End, 2.0),
    new VlcEntry(VlcEntry.End, -2.0),
    new VlcEntry(VlcEntry.Fork, [23, 20]),
    new VlcEntry(VlcEntry.Fork, [21, 22]),
    new VlcEntry(VlcEntry.End, 2.5),
    new VlcEntry(VlcEntry.End, -2.5),
    new VlcEntry(VlcEntry.Fork, [24, 25]),
    new VlcEntry(VlcEntry.End, 3.0),
    new VlcEntry(VlcEntry.End, -3.0),
    new VlcEntry(VlcEntry.Fork, [50, 27]),
    new VlcEntry(VlcEntry.Fork, [31, 28]),
    new VlcEntry(VlcEntry.Fork, [29, 30]),
    new VlcEntry(VlcEntry.End, 3.5),
    new VlcEntry(VlcEntry.End, -3.5),
    new VlcEntry(VlcEntry.Fork, [39, 32]),
    new VlcEntry(VlcEntry.Fork, [36, 33]),
    new VlcEntry(VlcEntry.Fork, [34, 35]),
    new VlcEntry(VlcEntry.End, 4.0),
    new VlcEntry(VlcEntry.End, -4.0),
    new VlcEntry(VlcEntry.Fork, [37, 38]),
    new VlcEntry(VlcEntry.End, 4.5),
    new VlcEntry(VlcEntry.End, -4.5),
    new VlcEntry(VlcEntry.Fork, [43, 40]),
    new VlcEntry(VlcEntry.Fork, [41, 42]),
    new VlcEntry(VlcEntry.End, 5.0),
    new VlcEntry(VlcEntry.End, -5.0),
    new VlcEntry(VlcEntry.Fork, [47, 44]),
    new VlcEntry(VlcEntry.Fork, [45, 46]),
    new VlcEntry(VlcEntry.End, 5.5),
    new VlcEntry(VlcEntry.End, -5.5),
    new VlcEntry(VlcEntry.Fork, [48, 49]),
    new VlcEntry(VlcEntry.End, 6.0),
    new VlcEntry(VlcEntry.End, -6.0),
    new VlcEntry(VlcEntry.Fork, [82, 51]),
    new VlcEntry(VlcEntry.Fork, [67, 52]),
    new VlcEntry(VlcEntry.Fork, [60, 53]),
    new VlcEntry(VlcEntry.Fork, [57, 54]),
    new VlcEntry(VlcEntry.Fork, [55, 56]),
    new VlcEntry(VlcEntry.End, 6.5),
    new VlcEntry(VlcEntry.End, -6.5),
    new VlcEntry(VlcEntry.Fork, [58, 59]),
    new VlcEntry(VlcEntry.End, 7.0),
    new VlcEntry(VlcEntry.End, -7.0),
    new VlcEntry(VlcEntry.Fork, [64, 61]),
    new VlcEntry(VlcEntry.Fork, [62, 63]),
    new VlcEntry(VlcEntry.End, 7.5),
    new VlcEntry(VlcEntry.End, -7.5),
    new VlcEntry(VlcEntry.Fork, [65, 66]),
    new VlcEntry(VlcEntry.End, 8.0),
    new VlcEntry(VlcEntry.End, -8.0),
    new VlcEntry(VlcEntry.Fork, [75, 68]),
    new VlcEntry(VlcEntry.Fork, [72, 69]),
    new VlcEntry(VlcEntry.Fork, [70, 71]),
    new VlcEntry(VlcEntry.End, 8.5),
    new VlcEntry(VlcEntry.End, -8.5),
    new VlcEntry(VlcEntry.Fork, [73, 74]),
    new VlcEntry(VlcEntry.End, 9.0),
    new VlcEntry(VlcEntry.End, -9.0),
    new VlcEntry(VlcEntry.Fork, [79, 76]),
    new VlcEntry(VlcEntry.Fork, [77, 78]),
    new VlcEntry(VlcEntry.End, 9.5),
    new VlcEntry(VlcEntry.End, -9.5),
    new VlcEntry(VlcEntry.Fork, [80, 81]),
    new VlcEntry(VlcEntry.End, 10.0),
    new VlcEntry(VlcEntry.End, -10.0),
    new VlcEntry(VlcEntry.Fork, [98, 83]),
    new VlcEntry(VlcEntry.Fork, [91, 84]),
    new VlcEntry(VlcEntry.Fork, [88, 85]),
    new VlcEntry(VlcEntry.Fork, [86, 87]),
    new VlcEntry(VlcEntry.End, 10.5),
    new VlcEntry(VlcEntry.End, -10.5),
    new VlcEntry(VlcEntry.Fork, [89, 90]),
    new VlcEntry(VlcEntry.End, 11.0),
    new VlcEntry(VlcEntry.End, -11.0),
    new VlcEntry(VlcEntry.Fork, [95, 92]),
    new VlcEntry(VlcEntry.Fork, [93, 94]),
    new VlcEntry(VlcEntry.End, 11.5),
    new VlcEntry(VlcEntry.End, -11.5),
    new VlcEntry(VlcEntry.Fork, [96, 97]),
    new VlcEntry(VlcEntry.End, 12.0),
    new VlcEntry(VlcEntry.End, -12.0),
    new VlcEntry(VlcEntry.Fork, [114, 99]),
    new VlcEntry(VlcEntry.Fork, [107, 100]),
    new VlcEntry(VlcEntry.Fork, [104, 101]),
    new VlcEntry(VlcEntry.Fork, [102, 103]),
    new VlcEntry(VlcEntry.End, 12.5),
    new VlcEntry(VlcEntry.End, -12.5),
    new VlcEntry(VlcEntry.Fork, [105, 106]),
    new VlcEntry(VlcEntry.End, 13.0),
    new VlcEntry(VlcEntry.End, -13.0),
    new VlcEntry(VlcEntry.Fork, [111, 108]),
    new VlcEntry(VlcEntry.Fork, [109, 110]),
    new VlcEntry(VlcEntry.End, 13.5),
    new VlcEntry(VlcEntry.End, -13.5),
    new VlcEntry(VlcEntry.Fork, [112, 113]),
    new VlcEntry(VlcEntry.End, 14.0),
    new VlcEntry(VlcEntry.End, -14.0),
    new VlcEntry(VlcEntry.Fork, [122, 115]),
    new VlcEntry(VlcEntry.Fork, [119, 116]),
    new VlcEntry(VlcEntry.Fork, [117, 118]),
    new VlcEntry(VlcEntry.End, 14.5),
    new VlcEntry(VlcEntry.End, -14.5),
    new VlcEntry(VlcEntry.Fork, [120, 121]),
    new VlcEntry(VlcEntry.End, 15.0),
    new VlcEntry(VlcEntry.End, -15.0),
    new VlcEntry(VlcEntry.Fork, [129, 123]),
    new VlcEntry(VlcEntry.Fork, [127, 124]),
    new VlcEntry(VlcEntry.Fork, [125, 126]),
    new VlcEntry(VlcEntry.End, 15.5),
    new VlcEntry(VlcEntry.End, -15.5),
    new VlcEntry(VlcEntry.Fork, [129, 128]),
    new VlcEntry(VlcEntry.End, -16.0),
    new VlcEntry(VlcEntry.End, null)
  ];
  function decode_motion_vector(reader, picture, running_options) {
    if (running_options.UNRESTRICTED_MOTION_VECTORS && picture.has_plusptype) {
      var x = reader.read_umv();
      var y = reader.read_umv();
      return new MotionVector(x, y);
    } else {
      var res_x = reader.readVLC(MVD_TABLE);
      var res_Y = reader.readVLC(MVD_TABLE);
      if (res_x === null || res_Y === null) {
        throw new Error("InvalidMvd");
      }
      var x = HalfPel.from(res_x);
      var y = HalfPel.from(res_Y);
      return new MotionVector(x, y);
    }
  }

  function decode_macroblock(reader, picture, running_options) {
    return reader.withTransaction(function(reader) {
      // with_transaction
      var is_coded = 0;
      if (picture.picture_type.type == PictureTypeCode.IFrame) { // matches!(picture.picture_type, PictureTypeCode::IFrame)
        is_coded = 0;
      } else {
        is_coded = reader.readBits(1);
      }

      if (is_coded == 0) {
        var mcbpc = null;

        var picture_type = picture.picture_type;

        switch(picture_type.type) {
          case PictureTypeCode.IFrame:
            mcbpc = reader.readVLC(MCBPC_I_TABLE);
            break;
          case PictureTypeCode.PFrame:
            mcbpc = reader.readVLC(MCBPC_P_TABLE);
            break;
          default:
            throw new Error("UnimplementedDecoding");
        }

        var mb_type = null;
        var codes_chroma_b = null;
        var codes_chroma_r = null;

        switch(mcbpc.type) {
          case BlockPatternEntry.Stuffing:
            return new Macroblock(Macroblock.Stuffing);
          case BlockPatternEntry.Invalid:
            throw new Error("InvalidMacroblockHeader");
          case BlockPatternEntry.Valid:
            mb_type = mcbpc.value[0];
            codes_chroma_b = mcbpc.value[1];
            codes_chroma_r = mcbpc.value[2];
            break;
        }

        var has_cbpb = null;
        var has_mvdb = null;

        if (picture_type.type == PictureTypeCode.PbFrame) {
          var ergf = reader.readVLC(MODB_TABLE);
          has_cbpb = ergf[0];
          has_mvdb = ergf[1];
        } else {
          has_cbpb = false;
          has_mvdb = false;
        }

        var codes_luma = null;
        if (mb_type.is_intra()) {
          var dfgs = reader.readVLC(CBPY_TABLE_INTRA);
          if (dfgs === null)
            throw new Error("InvalidMacroblockCodedBits");
          codes_luma = dfgs;
        } else {
          var dfgs = reader.readVLC(CBPY_TABLE_INTRA);;
          if (dfgs === null)
            throw new Error("InvalidMacroblockCodedBits");
          codes_luma = [!dfgs[0], !dfgs[1], !dfgs[2], !dfgs[3]];
        }

        var coded_block_pattern_b = null;
        if (has_cbpb) {
          coded_block_pattern_b = decode_cbpb(reader);
        }

        var d_quantizer = null;

        if (running_options.MODIFIED_QUANTIZATION) {
          throw new Error("UnimplementedDecoding");
        } else if (mb_type.has_quantizer()) {
          d_quantizer = decode_dquant(reader);
        }

        var motion_vector = null;
        if (mb_type.is_inter() || picture_type.is_any_pbframe()) {
          motion_vector = decode_motion_vector(reader, picture, running_options);
        }

        var addl_motion_vectors = null;
        if (mb_type.has_fourvec()) {
          var mv2 = decode_motion_vector(reader, picture, running_options);
          var mv3 = decode_motion_vector(reader, picture, running_options);
          var mv4 = decode_motion_vector(reader, picture, running_options);
          addl_motion_vectors = [mv2, mv3, mv4];
        }
        var motion_vectors_b = null;
        if (has_mvdb) {
          var mv1 = decode_motion_vector(reader, picture, running_options);
          var mv2 = decode_motion_vector(reader, picture, running_options);
          var mv3 = decode_motion_vector(reader, picture, running_options);
          var mv4 = decode_motion_vector(reader, picture, running_options);
          motion_vectors_b = [mv1, mv2, mv3, mv4];
        }
        return new Macroblock(Macroblock.Coded, {
          mb_type: mb_type,
          coded_block_pattern: {
            codes_luma: codes_luma,
            codes_chroma_b: codes_chroma_b,
            codes_chroma_r: codes_chroma_r
          },
          coded_block_pattern_b: coded_block_pattern_b,
          d_quantizer: d_quantizer,
          motion_vector: motion_vector,
          addl_motion_vectors: addl_motion_vectors,
          motion_vectors_b: motion_vectors_b,
        });
      } else {
        return new Macroblock(Macroblock.Uncoded);
      }
    });
  }

  var ShortTCoefficient = function(type, value) {
    this.type = type;
    this.value = value;
  }
  ShortTCoefficient.EscapeToLong = 1;
  ShortTCoefficient.Run = 2;

  var TCOEF_TABLE = [
    new VlcEntry(VlcEntry.Fork, [8, 1]),
    new VlcEntry(VlcEntry.Fork, [2, 3]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 0,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [4, 5]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 1,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [6, 7]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 2,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 0,
      level: 2,
    })),
    new VlcEntry(VlcEntry.Fork, [28, 9]),
    new VlcEntry(VlcEntry.Fork, [15, 10]),
    new VlcEntry(VlcEntry.Fork, [12, 11]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 0,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [13, 14]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 4,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 3,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [16, 23]),
    new VlcEntry(VlcEntry.Fork, [17, 20]),
    new VlcEntry(VlcEntry.Fork, [18, 19]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 9,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 8,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [21, 22]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 7,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 6,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [25, 24]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 5,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [26, 27]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 1,
      level: 2,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 0,
      level: 3,
    })),
    new VlcEntry(VlcEntry.Fork, [52, 29]),
    new VlcEntry(VlcEntry.Fork, [37, 30]),
    new VlcEntry(VlcEntry.Fork, [31, 34]),
    new VlcEntry(VlcEntry.Fork, [32, 33]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 4,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 3,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [35, 36]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 2,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 1,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [38, 45]),
    new VlcEntry(VlcEntry.Fork, [39, 42]),
    new VlcEntry(VlcEntry.Fork, [40, 41]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 8,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 7,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [43, 44]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 6,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 5,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [46, 49]),
    new VlcEntry(VlcEntry.Fork, [47, 48]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 12,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 11,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [50, 51]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 10,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 0,
      level: 4,
    })),
    new VlcEntry(VlcEntry.Fork, [90, 53]),
    new VlcEntry(VlcEntry.Fork, [69, 54]),
    new VlcEntry(VlcEntry.Fork, [55, 62]),
    new VlcEntry(VlcEntry.Fork, [56, 59]),
    new VlcEntry(VlcEntry.Fork, [57, 58]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 11,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 10,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [60, 61]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 9,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 14,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [63, 66]),
    new VlcEntry(VlcEntry.Fork, [64, 65]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 13,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 2,
      level: 2,
    })),
    new VlcEntry(VlcEntry.Fork, [67, 68]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 1,
      level: 3,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 0,
      level: 5,
    })),
    new VlcEntry(VlcEntry.Fork, [77, 70]),
    new VlcEntry(VlcEntry.Fork, [71, 74]),
    new VlcEntry(VlcEntry.Fork, [72, 73]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 15,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 14,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [75, 76]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 13,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 12,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [78, 85]),
    new VlcEntry(VlcEntry.Fork, [79, 82]),
    new VlcEntry(VlcEntry.Fork, [80, 81]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 16,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 15,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [83, 84]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 4,
      level: 2,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 3,
      level: 2,
    })),
    new VlcEntry(VlcEntry.Fork, [86, 89]),
    new VlcEntry(VlcEntry.Fork, [87, 88]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 0,
      level: 7,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 0,
      level: 6,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 16,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [124, 91]),
    new VlcEntry(VlcEntry.Fork, [92, 109]),
    new VlcEntry(VlcEntry.Fork, [93, 102]),
    new VlcEntry(VlcEntry.Fork, [94, 99]),
    new VlcEntry(VlcEntry.Fork, [95, 98]),
    new VlcEntry(VlcEntry.Fork, [96, 97]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 0,
      level: 9,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 0,
      level: 8,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 24,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [100, 101]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 23,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 22,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [103, 106]),
    new VlcEntry(VlcEntry.Fork, [104, 105]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 21,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 20,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [107, 108]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 19,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 18,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [110, 117]),
    new VlcEntry(VlcEntry.Fork, [111, 114]),
    new VlcEntry(VlcEntry.Fork, [112, 113]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 17,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 0,
      level: 2,
    })),
    new VlcEntry(VlcEntry.Fork, [115, 116]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 22,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 21,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [118, 121]),
    new VlcEntry(VlcEntry.Fork, [119, 120]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 20,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 19,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [122, 123]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 18,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 17,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [174, 125]),
    new VlcEntry(VlcEntry.Fork, [127, 126]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.EscapeToLong)),
    new VlcEntry(VlcEntry.Fork, [128, 143]),
    new VlcEntry(VlcEntry.Fork, [129, 136]),
    new VlcEntry(VlcEntry.Fork, [130, 133]),
    new VlcEntry(VlcEntry.Fork, [131, 132]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 0,
      level: 12,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 1,
      level: 5,
    })),
    new VlcEntry(VlcEntry.Fork, [134, 135]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 23,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 24,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [137, 140]),
    new VlcEntry(VlcEntry.Fork, [138, 139]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 29,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 30,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [141, 142]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 31,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 32,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [144, 159]),
    new VlcEntry(VlcEntry.Fork, [145, 152]),
    new VlcEntry(VlcEntry.Fork, [146, 149]),
    new VlcEntry(VlcEntry.Fork, [147, 148]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 1,
      level: 6,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 2,
      level: 4,
    })),
    new VlcEntry(VlcEntry.Fork, [150, 151]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 4,
      level: 3,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 5,
      level: 3,
    })),
    new VlcEntry(VlcEntry.Fork, [153, 156]),
    new VlcEntry(VlcEntry.Fork, [154, 155]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 6,
      level: 3,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 10,
      level: 2,
    })),
    new VlcEntry(VlcEntry.Fork, [157, 158]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 25,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 26,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [160, 167]),
    new VlcEntry(VlcEntry.Fork, [161, 164]),
    new VlcEntry(VlcEntry.Fork, [162, 163]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 33,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 34,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [165, 166]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 35,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 36,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [168, 171]),
    new VlcEntry(VlcEntry.Fork, [169, 170]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 37,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 38,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [172, 173]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 39,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 40,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [190, 175]),
    new VlcEntry(VlcEntry.Fork, [176, 183]),
    new VlcEntry(VlcEntry.Fork, [177, 180]),
    new VlcEntry(VlcEntry.Fork, [178, 179]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 9,
      level: 2,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 8,
      level: 2,
    })),
    new VlcEntry(VlcEntry.Fork, [181, 182]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 7,
      level: 2,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 6,
      level: 2,
    })),
    new VlcEntry(VlcEntry.Fork, [184, 187]),
    new VlcEntry(VlcEntry.Fork, [185, 186]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 5,
      level: 2,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 3,
      level: 3,
    })),
    new VlcEntry(VlcEntry.Fork, [188, 189]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 2,
      level: 3,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 1,
      level: 4,
    })),
    new VlcEntry(VlcEntry.Fork, [198, 191]),
    new VlcEntry(VlcEntry.Fork, [192, 195]),
    new VlcEntry(VlcEntry.Fork, [193, 194]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 28,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 27,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [196, 197]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 26,
      level: 1,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 25,
      level: 1,
    })),
    new VlcEntry(VlcEntry.Fork, [206, 199]),
    new VlcEntry(VlcEntry.Fork, [200, 203]),
    new VlcEntry(VlcEntry.Fork, [201, 202]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 1,
      level: 2,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: true,
      run: 0,
      level: 3,
    })),
    new VlcEntry(VlcEntry.Fork, [204, 205]),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 0,
      level: 11,
    })),
    new VlcEntry(VlcEntry.End, new ShortTCoefficient(ShortTCoefficient.Run, {
      last: false,
      run: 0,
      level: 10,
    })),
    new VlcEntry(VlcEntry.End, null)
  ]

  function decode_block(reader, decoder_options, picture, running_options, macroblock_type, tcoef_present) {
    return reader.withTransaction(function(reader) {
      var intradc = null;
      if (macroblock_type.is_intra()) {
        intradc = IntraDc.from_u8(reader.readUint8());
        if (intradc === null) 
          throw new Error("InvalidIntraDc");
      }
      var tcoef = [];
      while(tcoef_present) {
        var short_tcoef = reader.readVLC(TCOEF_TABLE);
        if (short_tcoef === null) 
          throw new Error("InvalidShortCoefficient");
        switch(short_tcoef.type) {
          case ShortTCoefficient.EscapeToLong:
            var level_width = null;
            if (decoder_options.sorensonSpark && (picture.version == 1)) {
              if (reader.readBits(1) == 1) {
                level_width = 11;
              } else {
                level_width = 7;
              }
            } else {
              level_width = 8;
            }
            var last = reader.readBits(1) == 1;
            var run = reader.readBits(6);
            var level = reader.readSignedBits(level_width);
            if (level == 0) {
              throw new Error("InvalidLongCoefficient");
            }
            tcoef.push(new TCoefficient(false, run, level));
            tcoef_present = !last;
            break;
          case ShortTCoefficient.Run:
            var res = short_tcoef.value;
            var sign = reader.readBits(1);
            if (sign == 0) {
              tcoef.push(new TCoefficient(true, res.run, res.level));
            } else {
              tcoef.push(new TCoefficient(true, res.run, -res.level));
            }
            tcoef_present = !res.last;
            break;
        }  
      }
      return new Block(intradc, tcoef);
    });
  }

  var num_signum = function(num) {
    if (num > 0) {
      return 1;
    } else if (num == 0) {
      return 0;
    } else {
      return -1;
    }
  }

  var DEZIGZAG_MAPPING = [[0, 0], [1, 0], [0, 1], [0, 2], [1, 1], [2, 0], [3, 0], [2, 1], [1, 2], [0, 3], [0, 4], [1, 3], [2, 2], [3, 1], [4, 0], [5, 0], [4, 1], [3, 2], [2, 3], [1, 4], [0, 5], [0, 6], [1, 5], [2, 4], [3, 3], [4, 2], [5, 1], [6, 0], [7, 0], [6, 1], [5, 2], [4, 3], [3, 4], [2, 5], [1, 6], [0, 7], [1, 7], [2, 6], [3, 5], [4, 4], [5, 3], [6, 2], [7, 1], [7, 2], [6, 3], [5, 4], [4, 5], [3, 6], [2, 7], [3, 7], [4, 6], [5, 5], [6, 4], [7, 3], [7, 4], [6, 5], [5, 6], [4, 7], [5, 7], [6, 6], [7, 5], [7, 6], [6, 7], [7, 7]]

  function inverse_rle(encoded_block, levels, pos, blk_per_line, quant) {
    var block_id = (pos[0] / 8) + ((pos[1] / 8) * blk_per_line);
    if (encoded_block.tcoef.length == 0) {
      if (encoded_block.intradc) {
        var dc_level = encoded_block.intradc.into_level();
        if (dc_level == 0) {
          levels[block_id] = new DecodedDctBlock(DecodedDctBlock.Zero);
        } else {
          levels[block_id] = new DecodedDctBlock(DecodedDctBlock.Dc, dc_level);
        }
      } else {
        levels[block_id] = new DecodedDctBlock(DecodedDctBlock.Zero);
      }
    } else {
      var block_data = [new Float32Array(8), new Float32Array(8), new Float32Array(8), new Float32Array(8), new Float32Array(8), new Float32Array(8), new Float32Array(8), new Float32Array(8)];
      var is_horiz = true;
      var is_vert = true;
      var zigzag_index = 0;
      if (encoded_block.intradc) {
        block_data[0][0] = encoded_block.intradc.into_level();
        zigzag_index += 1;
      }
      for (var i = 0; i < encoded_block.tcoef.length; i++) {
        var tcoef = encoded_block.tcoef[i];
        zigzag_index += tcoef.run;
        if (zigzag_index >= DEZIGZAG_MAPPING.length) return;
        var zig = DEZIGZAG_MAPPING[zigzag_index];
        var dequantized_level = asI16(quant) * ((2 * Math.abs(tcoef.level)) + 1);
        var parity = null;
        if (quant % 2 == 1) {
          parity = 0;
        } else {
          parity = -1;
        }
        var val = Math.max(Math.min(num_signum(tcoef.level) * (dequantized_level + parity), 2047), -2048);
        block_data[zig[1]][zig[0]] = val;
        zigzag_index += 1;
        if (val != 0.0) {
          if (zig[1] > 0) {
            is_horiz = false;
          }
          if (zig[0] > 0) {
            is_vert = false;
          }
        }
      }
      if ((is_horiz == true) && (is_vert == true)) {
        if (block_data[0][0] == 0) {
          levels[block_id] = new DecodedDctBlock(DecodedDctBlock.Zero);
        } else {
          levels[block_id] = new DecodedDctBlock(DecodedDctBlock.Dc, block_data[0][0]);
        }
      } else if ((is_horiz == true) && (is_vert == false)) {
        levels[block_id] = new DecodedDctBlock(DecodedDctBlock.Horiz, block_data[0]);
      } else if ((is_horiz == false) && (is_vert == true)) {
        var r = new Float32Array(8);
        r[0] = block_data[0][0];
        r[1] = block_data[1][0];
        r[2] = block_data[2][0];
        r[3] = block_data[3][0];
        r[4] = block_data[4][0];
        r[5] = block_data[5][0];
        r[6] = block_data[6][0];
        r[7] = block_data[7][0];
        levels[block_id] = new DecodedDctBlock(DecodedDctBlock.Vert, r);
      } else if ((is_horiz == false) && (is_vert == false)) {
        levels[block_id] = new DecodedDctBlock(DecodedDctBlock.Full, block_data);
      }
    }
  }

  function decode_gob(reader, _decoder_options) {
    // with_transaction_union
    return reader.withTransactionUnion(function(reader) {
      var skipped_bits = reader.recognizeStartCode(false);
      if (skipped_bits === null) {
        throw new Error("InvalidGobHeader");
      }
      reader.skipBits(17 + skipped_bits);
      var gob_id = reader.readBits(5);
      if (gob_id == 0 || gob_id == 15) {
        return null;
      }
      throw new Error("UnimplementedDecoding");
    });
  }

  function read_sample(pixel_array, samples_per_row, num_rows, pos) {
    var _x = num_clamp(pos[0], 0, samples_per_row - 1);
    var _y = num_clamp(pos[1], 0, num_rows - 1);
    return pixel_array[_x + (_y * samples_per_row)];
  }
  function lerp(sample_a, sample_b, middle) {
    if (middle) {
      return asU8((sample_a + sample_b + 1) / 2);
    } else {
      return asU8(sample_a);
    }
  }

  function asfgdgdfg(value, min, max) {
    return (value >= min) && (value <= max);
  }

  function gather_block(pixel_array, samples_per_row, pos, mv, target) {
    var g = mv.into_lerp_parameters();
    var src_x = pos[0] + g[0][0];
    var src_y = pos[1] + g[1][0];
    var array_height = (pixel_array.length / samples_per_row) | 0;
    var block_cols = num_clamp((samples_per_row - pos[0]), 0, 8);
    var block_rows = num_clamp((array_height - pos[1]), 0, 8);
    if (!g[0][1] && !g[1][1]) {
      if (block_cols == 8 && block_rows == 8 && asfgdgdfg(src_x, 0, samples_per_row - 8) && asfgdgdfg(src_y, 0, array_height - 8)) {
        for (var j = 0; j < 8; j++) {
          var src_offset = src_x + ((src_y + j) * samples_per_row);
          var dest_offset = pos[0] + (pos[1] + j) * samples_per_row;
          for (var _ = 0; _ < 8; _++) {
            target[dest_offset + _] = pixel_array[src_offset + _];
          }
        }
      } else {
        for (var _j = 0; _j < block_rows; _j += 1) {
          var j = _j;
          var v = _j + src_y;
          for (var _i = 0; _i < block_cols; _i += 1) {
            var i = _i;
            var u = _i + src_x;
            target[pos[0] + i + ((pos[1] + j) * samples_per_row)] = read_sample(pixel_array, samples_per_row, array_height, [u, v]);
          }
        }
      }
    } else {
      for (var _j = 0; _j < block_rows; _j += 1) {
        var j = _j;
        var v = _j + src_y;
        for (var _i = 0; _i < block_cols; _i += 1) {
          var i = _i;
          var u = _i + src_x;
          var sample_0_0 = read_sample(pixel_array, samples_per_row, array_height, [u, v]);
          var sample_1_0 = read_sample(pixel_array, samples_per_row, array_height, [u + 1, v]);
          var sample_0_1 = read_sample(pixel_array, samples_per_row, array_height, [u, v + 1]);
          var sample_1_1 = read_sample(pixel_array, samples_per_row, array_height, [u + 1, v + 1]);
          if (g[0][1] && g[1][1]) {
            var sample = asU8((sample_0_0 + sample_1_0 + sample_0_1 + sample_1_1 + 2) / 4);
            target[pos[0] + i + ((pos[1] + j) * samples_per_row)] = sample;
          } else {
            var sample_mid_0 = lerp(sample_0_0, sample_1_0, g[0][1]);
            var sample_mid_1 = lerp(sample_0_1, sample_1_1, g[0][1]);
            target[pos[0] + i + ((pos[1] + j) * samples_per_row)] = lerp(sample_mid_0, sample_mid_1, g[1][1]);
          }
        }
      }
    }
  }

  function gather(mb_types, reference_picture, mvs, mb_per_line, new_picture) {
    for (var i = 0; i < mb_types.length; i++) { // TODO mb_types.iter().zip(mvs.iter()).enumerate()
      var mb_type = mb_types[i];
      var mv = mvs[i];
      if (mb_type.is_inter()) {
        if (!reference_picture)
          throw new Error("UncodedIFrameBlocks");
        var luma_samples_per_row = reference_picture.luma_samples_per_row();
        var pos = [
          Math.floor(i % mb_per_line) * 16,
          Math.floor(i / mb_per_line) * 16
        ];
        gather_block(reference_picture.as_luma(), luma_samples_per_row, pos, mv[0], new_picture.as_luma_mut());
        gather_block(reference_picture.as_luma(), luma_samples_per_row, [pos[0] + 8, pos[1]], mv[1], new_picture.as_luma_mut());
        gather_block(reference_picture.as_luma(), luma_samples_per_row, [pos[0], pos[1] + 8], mv[2], new_picture.as_luma_mut());
        gather_block(reference_picture.as_luma(), luma_samples_per_row, [pos[0] + 8, pos[1] + 8], mv[3], new_picture.as_luma_mut());
        var mv_chr = mv[0].add(mv[1].add(mv[2].add(mv[3]))).average_sum_of_mvs();
        var chroma_samples_per_row = reference_picture.chroma_samples_per_row;
        var chroma_pos = [Math.floor(i % mb_per_line) * 8, Math.floor(i / mb_per_line) * 8];
        gather_block(reference_picture.as_chroma_b(), chroma_samples_per_row, [chroma_pos[0], chroma_pos[1]], mv_chr, new_picture.as_chroma_b_mut());
        gather_block(reference_picture.as_chroma_r(), chroma_samples_per_row, [chroma_pos[0], chroma_pos[1]], mv_chr, new_picture.as_chroma_r_mut());
      }
    }
  }
  function num_clamp(value, a, b) {
    return Math.max(Math.min(value, b), a);
  }
  var BASIS_TABLE = [
    new Float32Array([0.70710677, 0.70710677, 0.70710677, 0.70710677, 0.70710677, 0.70710677, 0.70710677, 0.70710677]),
    new Float32Array([0.98078525, 0.8314696, 0.5555702, 0.19509023, -0.19509032, -0.55557036, -0.83146966, -0.9807853]),
    new Float32Array([0.9238795, 0.38268343, -0.38268352, -0.9238796, -0.9238795, -0.38268313, 0.3826836, 0.92387956]),
    new Float32Array([0.8314696, -0.19509032, -0.9807853, -0.55557, 0.55557007, 0.98078525, 0.19509007, -0.8314698]),
    new Float32Array([0.70710677, -0.70710677, -0.70710665, 0.707107, 0.70710677, -0.70710725, -0.70710653,  0.7071068]),
    new Float32Array([0.5555702, -0.9807853, 0.19509041, 0.83146936, -0.8314698, -0.19508928, 0.9807853, -0.55557007]),
    new Float32Array([0.38268343, -0.9238795, 0.92387974, -0.3826839, -0.38268384, 0.9238793, -0.92387974,  0.3826839]),
    new Float32Array([0.19509023, -0.55557, 0.83146936, -0.9807852, 0.98078525, -0.83147013, 0.55557114, -0.19508967])
  ];
  function idct_1d(input, output) {
    for (var i = 0; i < output.length; i++) {
      output[i] = 0;
      for (var freq = 0; freq < 8; freq++) {
        output[i] += input[freq] * BASIS_TABLE[freq][i];
      }
    }
  }
  var idct_intermediate = [new Float32Array(8), new Float32Array(8), new Float32Array(8), new Float32Array(8), new Float32Array(8), new Float32Array(8), new Float32Array(8), new Float32Array(8)];
  var idct_output = [new Float32Array(8), new Float32Array(8), new Float32Array(8), new Float32Array(8), new Float32Array(8), new Float32Array(8), new Float32Array(8), new Float32Array(8)];
  function idct_channel(block_levels, output, blk_per_line, output_samples_per_line) {
    var output_height = (output.length / output_samples_per_line) | 0;
    var blk_height = (block_levels.length / blk_per_line) | 0;
    for (var i = 0; i < 8; i++) {
      idct_intermediate[i].fill(0);
      idct_output[i].fill(0);
    }
    for (var y_base = 0; y_base < blk_height; y_base++) {
      for (var x_base = 0; x_base < blk_per_line; x_base++) {
        var block_id = x_base + (y_base * blk_per_line);
        if (block_id >= block_levels.length) continue;
        var xs = num_clamp((output_samples_per_line - x_base * 8), 0, 8);
        var ys = num_clamp((output_height - y_base * 8), 0, 8);
        var b = block_levels[block_id];
        switch(b.type) {
          case DecodedDctBlock.Zero:
            break;
          case DecodedDctBlock.Dc:
            var dc = b.value;
            var clipped_idct = num_clamp(asI16((dc * 0.5 / 4.0 + num_signum(dc) * 0.5)), -256, 255);
            for (var y_offset = 0; y_offset < ys; y_offset++) {
              for (var x_offset = 0; x_offset < xs; x_offset++) {
                var x = x_base * 8 + x_offset;
                var y = y_base * 8 + y_offset;
                var mocomp_pixel = asI16(output[x + (y * output_samples_per_line)]);
                output[x + (y * output_samples_per_line)] = num_clamp(clipped_idct + mocomp_pixel, 0, 255);
              }
            }
            break;
          case DecodedDctBlock.Horiz:
            var first_row = b.value;
            idct_1d(first_row, idct_intermediate[0]);
            for (var y_offset = 0; y_offset < ys; y_offset++) {
              var _idcts = idct_intermediate[0];
              for (var x_offset = 0; x_offset < xs; x_offset++) {
                var idct = _idcts[x_offset];
                var x = x_base * 8 + x_offset;
                var y = y_base * 8 + y_offset;
                var clipped_idct = num_clamp((asI16(idct * BASIS_TABLE[0][0] / 4.0 + num_signum(idct) * 0.5)), -256, 255);
                var mocomp_pixel = asI16(output[x + (y * output_samples_per_line)]);
                output[x + (y * output_samples_per_line)] = num_clamp((clipped_idct + mocomp_pixel), 0, 255);
              }
            }
            break;
          case DecodedDctBlock.Vert:
            var first_col = b.value;
            idct_1d(first_col, idct_intermediate[0]);
            var _idcts = idct_intermediate[0];
            for (var y_offset = 0; y_offset < ys; y_offset++) {
              var idct = _idcts[y_offset];
              for (var x_offset = 0; x_offset < xs; x_offset++) {
                var x = x_base * 8 + x_offset;
                var y = y_base * 8 + y_offset;
                var clipped_idct = num_clamp((asI16(idct * BASIS_TABLE[0][0] / 4.0 + num_signum(idct) * 0.5)), -256, 255);
                var mocomp_pixel = asI16(output[x + (y * output_samples_per_line)]);
                output[x + (y * output_samples_per_line)] = num_clamp((clipped_idct + mocomp_pixel), 0, 255);
              }
            }
            break;
          case DecodedDctBlock.Full:
            var block_data = b.value;
            for (var row = 0; row < 8; row++) {
              idct_1d(block_data[row], idct_output[row]);
              for (var i = 0; i < idct_intermediate.length; i++) {
                idct_intermediate[i][row] = idct_output[row][i];
              }
            }
            for (var row = 0; row < 8; row++) {
              idct_1d(idct_intermediate[row], idct_output[row]);
            }
            for (var x_offset = 0; x_offset < xs; x_offset++) {
              var idct_row = idct_output[x_offset];
              for (var y_offset = 0; y_offset < ys; y_offset++) {
                var idct = idct_row[y_offset];
                var x = x_base * 8 + x_offset;
                var y = y_base * 8 + y_offset;
                var clipped_idct = num_clamp((asI16(idct / 4.0 + num_signum(idct) * 0.5)), -256, 255);
                var mocomp_pixel = asI16(output[x + (y * output_samples_per_line)]);
                output[x + (y * output_samples_per_line)] = num_clamp((clipped_idct + mocomp_pixel), 0, 255);
              }
            }
            break;
        }
      }
    }
  }

  function predict_candidate(predictor_vectors, current_predictors, mb_per_line, index) {
    var current_mb = predictor_vectors.length;
    var col_index = current_mb % mb_per_line;
    var mv1_pred = null;

    switch(index) {
      case 0:
      case 2:
        if (col_index == 0) {
          mv1_pred = MotionVector.zero();
        } else {
          mv1_pred = predictor_vectors[current_mb - 1][index + 1];
        }
        break;
      case 1:
      case 3:
        mv1_pred = current_predictors[index - 1];
        break;
      default:
        throw new Error("unreachable");
    }

    /*
    let mv1_pred = match index {
        0 | 2 if col_index == 0 => MotionVector::zero(),
        0 | 2 => predictor_vectors[current_mb - 1][index + 1],
        1 | 3 => current_predictors[index - 1],
        _ => unreachable!(),
    };
    */

    var line_index = (current_mb / mb_per_line) | 0;
    var last_line_mb = (saturatingSub(line_index, 1) * mb_per_line) + col_index;
    var mv2_pred = null;
    switch(index) {
      case 0:
      case 1:
        if (line_index == 0) {
          mv2_pred = mv1_pred;
        } else {
          var r = predictor_vectors[last_line_mb];
          if (r) {
            mv2_pred = r[index + 2];
          } else {
            mv2_pred = mv1_pred;
          }
        }
        break;
      case 2:
      case 3:
        mv2_pred = current_predictors[0];
        break;
      default:
        throw new Error("unreachable");
    }
    var is_end_of_line = col_index == saturatingSub(mb_per_line, 1);
    var mv3_pred = null;
    switch(index) {
      case 0:
      case 1:
        if (is_end_of_line) {
          mv3_pred = MotionVector.zero();
        } else {
          if (line_index == 0) {
            mv3_pred = mv1_pred;
          } else {
            var r = predictor_vectors[last_line_mb + 1];
            if (r) {
              mv3_pred = r[2];
            } else {
              mv3_pred = mv1_pred;
            }
          }
        }
        break;
      case 2:
      case 3:
        mv3_pred = current_predictors[1];
        break;
      default:
        throw new Error("unreachable");
    }
    return mv1_pred.median_of(mv2_pred, mv3_pred);
  }

  function halfpel_decode(current_picture, running_options, predictor, mvd, is_x) {
    var range = HalfPel.STANDARD_RANGE;
    var out = new HalfPel(asI16(mvd.n + predictor.n));
    if (running_options.UNRESTRICTED_MOTION_VECTORS && !current_picture.as_header().has_plusptype) {
      if (predictor.is_mv_within_range(HalfPel.STANDARD_RANGE)) {
        return out;
      } else {
        range = HalfPel.EXTENDED_RANGE;
      }
    } else {
      var rrh = current_picture.as_header().motion_vector_range;
      if (rrh) rrh = rrh.type == MotionVectorRange.Extended;
      if (running_options.UNRESTRICTED_MOTION_VECTORS && rrh) {
        console.log(current_picture.format);
      }
    }
    if (!out.is_mv_within_range(range)) {
      out = new HalfPel(asI16(mvd.invert().n + predictor.n));
    }
    return out;
  }

  function mv_decode(current_picture, running_options, predictor, mvd) {
    var mvx = mvd.n1;
    var mvy = mvd.n2;
    var cpx = predictor.n1;
    var cpy = predictor.n2;
    var out_x = halfpel_decode(current_picture, running_options, cpx, mvx, true);
    var out_y = halfpel_decode(current_picture, running_options, cpy, mvy, false);
    return new MotionVector(out_x, out_y);
  }
  function map_remove_entry(_, fg) {
    return _.get(fg);
  }
  var State = function(decoderOptions) {
    this.decoderOptions = decoderOptions;
    this.last_picture = null;
    this.reference_picture = null;
    this.running_options = PictureOption.empty();
    this.reference_states = new Map();
  }
  State.prototype.isSorenson = function() {
    return this.decoderOptions.sorensonSpark;
  }
  State.prototype.getLastPicture = function() {
    if (this.last_picture === null) { // self.last_picture.is_none()
      return null;
    } else {
      return this.reference_states.get(this.last_picture);
    }
  }
  State.prototype.getReferencePicture = function() {
    if (this.reference_picture === null) {
      return null;
    } else {
      return this.reference_states.get(this.reference_picture);
    }
  }
  State.prototype.cleanup_buffers = function() {
    var r1 = this.last_picture;
    var last_picture = map_remove_entry(this.reference_states, r1);
    var r2 = this.reference_picture;
    var reference_picture = map_remove_entry(this.reference_states, r2);
    this.reference_states = new Map();
    if (last_picture) {
      this.reference_states.set(r1, last_picture);
    }
    if (reference_picture) {
      //this.reference_states.set(r2, reference_picture);
    }
  }
  State.prototype.parsePicture = function(reader, previous_picture) {
    return decodePicture(reader, this.decoderOptions, previous_picture);
  }
  State.prototype.decodeNextPicture = function(reader) {
    // with_transaction
    var next_picture = this.parsePicture(reader, this.getLastPicture());
    var next_running_options = null;
    if (next_picture.has_plusptype && next_picture.has_opptype) {
      console.log("has_plusptype has_opptype");
      next_running_options = next_picture.options;
    } else if (next_picture.has_plusptype) {
      console.log("has_plusptype");
      // (next_picture.options & !*OPPTYPE_OPTIONS) | (self.running_options & *OPPTYPE_OPTIONS)
    } else {
      next_running_options = next_picture.options;
    }
    var format = null;
    if (next_picture.format) {
      format = next_picture.format;
    } else if (next_picture.picture_type.type == PictureTypeCode.IFrame) {
      throw new Error("PictureFormatMissing");
    } else {
      var ref_format = null;
      var rfgh = this.getLastPicture();
      if (rfgh !== null) {
        ref_format = rfgh.format;
      } else {
        throw new Error("PictureFormatMissing");
      }
      format = ref_format;
    }

    var reference_picture = this.getReferencePicture();
    var output_dimensions = format.intoWidthAndHeight();
    var mb_per_line = Math.ceil(output_dimensions[0] / 16.0);
    var mb_height = Math.ceil(output_dimensions[1] / 16.0);
    var level_dimensions = [mb_per_line * 16, mb_height * 16];
    var in_force_quantizer = next_picture.quantizer;
    var MAX_L = mb_per_line * mb_height;
    var predictor_vectors = []; // all previously decoded MVDs
    var macroblock_types = [];
    var next_decoded_picture = new DecodedPicture(next_picture, format);
    var luma_levels = new Array(level_dimensions[0] * level_dimensions[1] / 64);
    var chroma_b_levels = new Array(level_dimensions[0] * level_dimensions[1] / 4 / 64);
    var chroma_r_levels = new Array(level_dimensions[0] * level_dimensions[1] / 4 / 64);
    for (var i = 0; i < luma_levels.length; i++) 
      luma_levels[i] = new DecodedDctBlock(DecodedDctBlock.Zero);
    for (var i = 0; i < chroma_b_levels.length; i++) 
      chroma_b_levels[i] = new DecodedDctBlock(DecodedDctBlock.Zero);
    for (var i = 0; i < chroma_r_levels.length; i++) 
      chroma_r_levels[i] = new DecodedDctBlock(DecodedDctBlock.Zero);
    while((reader.bitAva() > 0) && (macroblock_types.length < MAX_L)) { // TODO
      var mb;
      try {
        mb = decode_macroblock(reader, next_decoded_picture.as_header(), next_running_options);
      } catch(e) {
        mb = e.message;
      }
      var pos = [
        Math.floor(macroblock_types.length % mb_per_line) * 16,
        Math.floor(macroblock_types.length / mb_per_line) * 16
      ];
      var motion_vectors = [];
      for (var i = 0; i < 4; i++) 
        motion_vectors.push(MotionVector.zero());
      var mb_type = null;
      var isStuffing = false;
      if (typeof mb == "string") {
        if (is_eof_error(mb)) {
          break;
        } else {
          throw new Error(mb);
        }
      } else {
        switch(mb.type) {
          case Macroblock.Stuffing:
            isStuffing = true;
            break;
          case Macroblock.Uncoded: 
            if (next_decoded_picture.as_header().picture_type.type == PictureTypeCode.IFrame) {
              throw new Error("UncodedIFrameBlocks");
            }
            mb_type = new MacroblockType(MacroblockType.Inter);
            break;
          case Macroblock.Coded: 
            var res = mb.value;
            var quantizer = asI8(asI8(in_force_quantizer) + ((res.d_quantizer === null) ? 0 : res.d_quantizer));
            in_force_quantizer = num_clamp(quantizer, 1, 31);
            if (res.mb_type.is_inter()) {
              var mv1 = res.motion_vector;
              if (mv1 === null) 
                mv1 = MotionVector.zero();
              var mpred1 = predict_candidate(predictor_vectors, motion_vectors, mb_per_line, 0);
              motion_vectors[0] = mv_decode(next_decoded_picture, next_running_options, mpred1, mv1);
              var addl_motion_vectors = res.addl_motion_vectors;
              if (addl_motion_vectors) {
                var mpred2 = predict_candidate(predictor_vectors, motion_vectors, mb_per_line, 1);
                motion_vectors[1] = mv_decode(next_decoded_picture, next_running_options, mpred2, addl_motion_vectors[0]);

                var mpred3 = predict_candidate(predictor_vectors, motion_vectors, mb_per_line, 2);
                motion_vectors[2] = mv_decode(next_decoded_picture, next_running_options, mpred3, addl_motion_vectors[1]);

                var mpred4 = predict_candidate(predictor_vectors, motion_vectors, mb_per_line, 3);
                motion_vectors[3] = mv_decode(next_decoded_picture, next_running_options, mpred4, addl_motion_vectors[2]);
              } else {
                motion_vectors[1] = motion_vectors[0];
                motion_vectors[2] = motion_vectors[0];
                motion_vectors[3] = motion_vectors[0];
              };
            }

            var luma0 = decode_block(reader, this.decoderOptions, next_decoded_picture.as_header(), next_running_options, res.mb_type, res.coded_block_pattern.codes_luma[0]);
            inverse_rle(luma0, luma_levels, pos, level_dimensions[0] / 8, in_force_quantizer);
            
            var luma1 = decode_block(reader, this.decoderOptions, next_decoded_picture.as_header(), next_running_options, res.mb_type, res.coded_block_pattern.codes_luma[1]);
            inverse_rle(luma1, luma_levels, [pos[0] + 8, pos[1]], level_dimensions[0] / 8, in_force_quantizer);
           
            var luma2 = decode_block(reader, this.decoderOptions, next_decoded_picture.as_header(), next_running_options, res.mb_type, res.coded_block_pattern.codes_luma[2]);
            inverse_rle(luma2, luma_levels, [pos[0], pos[1] + 8], level_dimensions[0] / 8, in_force_quantizer);
            
            var luma3 = decode_block(reader, this.decoderOptions, next_decoded_picture.as_header(), next_running_options, res.mb_type, res.coded_block_pattern.codes_luma[3]);
            inverse_rle(luma3, luma_levels, [pos[0] + 8, pos[1] + 8], level_dimensions[0] / 8, in_force_quantizer);

            var chroma_b = decode_block(reader, this.decoderOptions, next_decoded_picture.as_header(), next_running_options, res.mb_type, res.coded_block_pattern.codes_chroma_b);
            inverse_rle(chroma_b, chroma_b_levels, [pos[0] / 2, pos[1] / 2], mb_per_line, in_force_quantizer);

            var chroma_r = decode_block(reader, this.decoderOptions, next_decoded_picture.as_header(), next_running_options, res.mb_type, res.coded_block_pattern.codes_chroma_r);
            inverse_rle(chroma_r, chroma_r_levels, [pos[0] / 2, pos[1] / 2], mb_per_line, in_force_quantizer);
            
            mb_type = res.mb_type;
            break;
        }
        if (isStuffing) continue;
      }
      predictor_vectors.push(motion_vectors);
      macroblock_types.push(mb_type);  
    }
    while (predictor_vectors.length < MAX_L) predictor_vectors.push(MotionVector.zero());
    while (macroblock_types.length < MAX_L) macroblock_types.push(new MacroblockType(MacroblockType.Inter));
    gather(macroblock_types, reference_picture, predictor_vectors, mb_per_line, next_decoded_picture);
    idct_channel(luma_levels, next_decoded_picture.as_luma_mut(), mb_per_line * 2, (output_dimensions[0]));
    var chroma_samples_per_row = next_decoded_picture.chroma_samples_per_row;
    idct_channel(chroma_b_levels, next_decoded_picture.as_chroma_b_mut(), mb_per_line, chroma_samples_per_row);
    idct_channel(chroma_r_levels, next_decoded_picture.as_chroma_r_mut(), mb_per_line, chroma_samples_per_row);
    if (next_decoded_picture.as_header().picture_type.type == PictureTypeCode.IFrame) {
      this.reference_picture = null;
    }
    var this_tr = next_decoded_picture.as_header().temporal_reference;
    this.last_picture = this_tr;
    if (!next_decoded_picture.as_header().picture_type.is_disposable()) {
      this.reference_picture = this_tr;
    }
    this.reference_states.set(this_tr, next_decoded_picture);
    this.cleanup_buffers();
  }

  var Reader = function(source) {
    this.source = source;
    this.bitsRead = 0;
  }
  Reader.prototype.readBits = function(bitsNeeded) {
    var r = this.peekBits(bitsNeeded);
    this.skipBits(bitsNeeded);
    return r;
  };
  Reader.prototype.readSignedBits = function(bitsNeeded) {
    var uval = this.readBits(bitsNeeded);
    var shift = 32 - bitsNeeded;
    return (uval << shift) >> shift;
  };
  Reader.prototype.peekBits = function(bitsNeeded) {
    if (bitsNeeded == 0) {
      return 0; // T::zero
    }
    var accum = 0; // T::zero
    var i = bitsNeeded;
    var last_bits_read = this.bitsRead;
    while (i--) {
      if (bitsNeeded == 0) 
        break;
      var bytes_read = Math.floor(this.bitsRead / 8);
      var bits_read = (this.bitsRead % 8);
      if (bytes_read >= this.source.length) {
        throw new Error("EndOfFile");
      }
      var byte = this.source[bytes_read];
      accum <<= 1;
      accum |= ((byte >> (7 - bits_read)) & 0x1);
      this.bitsRead++;
    }

    this.bitsRead = last_bits_read;

    return accum;
  }
  Reader.prototype.skipBits = function(bits_to_skip) {
    this.bitsRead += bits_to_skip;
  }
  Reader.prototype.readUint8 = function() {
    return this.readBits(8);
  }
  Reader.prototype.recognizeStartCode = function(in_error) {
    return this.withLookahead(function(reader) {
      var max_skip_bits = reader.realignmentBits();
      var skip_bits = 0;
      var maybe_code = reader.peekBits(17);
      while (maybe_code != 1) {
        if (!in_error && skip_bits > max_skip_bits) {
          return null;
        }
        reader.skipBits(1);
        skip_bits += 1;
        maybe_code = reader.peekBits(17);
      }
      return skip_bits;
    })
  }
  Reader.prototype.realignmentBits = function() {
    return (8 - (this.bitsRead % 8)) % 8;
  }
  Reader.prototype.checkpoint = function() {
    return this.bitsRead;
  }
  Reader.prototype.readVLC = function(table) {
    var index = 0;
    while(true) {
      var res = table[index];
      if (res) {
        switch(res.type) {
          case VlcEntry.End:
            return res.value; // clone
          case VlcEntry.Fork:
            var next_bit = this.readBits(1);
            if (next_bit == 0) {
              index = res.value[0];
            } else {
              index = res.value[1];
            }
            break;
        }
      } else {
        throw new Error("InternalDecoderError");
      }
    }
  }
  Reader.prototype.read_umv = function() {
    var start = this.readBits(1);
    if (start == 1) 
      return HalfPel.from_unit(0);
    var mantissa = 0;
    var bulk = 1; 
    while (bulk < 4096) {
      var r = this.readBits(2);
      switch(r) {
        case 0b00: 
          return HalfPel.from_unit(mantissa + bulk);
        case 0b10: 
          return HalfPel.from_unit(-(mantissa + bulk));
        case 0b01: 
          mantissa <<= 1;
          bulk <<= 1;
          break;
        case 0b11: 
          mantissa = mantissa << 1 | 1;
          bulk <<= 1;
          break;
      }
    }
    throw new Error("InvalidMvd");
  }
  Reader.prototype.bitAva = function() {
    return (this.source.length * 8) - this.bitsRead;
  }
  Reader.prototype.rollback = function(checkpoint) {
    if (checkpoint > (this.source.length * 8)) {
      throw new Error("InternalDecoderError");
    }
    this.bitsRead = checkpoint;
  }
  Reader.prototype.withTransaction = function(f) {
    var checkpoint = this.checkpoint();
    var result;
    try {
      result = f(this);
    } catch(e) {
      this.rollback(checkpoint);
      throw e;
    }
    return result;
  }
  Reader.prototype.withTransactionUnion = function(f) {
    var checkpoint = this.checkpoint();
    var result;
    try {
      result = f(this);
      if (result === null) this.rollback(checkpoint);
    } catch(e) {
      this.rollback(checkpoint);
      throw e;
    }
    return result;
  }
  Reader.prototype.withLookahead = function(f) {
    var checkpoint = this.checkpoint();
    var result = f(this);
    this.rollback(checkpoint);
    return result;
  }
  return {
    Reader: Reader,
    State: State
  }
}());

/*
 * AT NIHAV VP6 in javscript(ES5)
 */

var AT_NIHAV_VP6 = (function() {
  function validate(isH) {
    if (!isH) throw new Error("ValidationError");
  }
  function asU8(num) {
    return (num << 24) >>> 24;
  }
  function asU32(num) {
    return num >>> 0;
  }
  function asU16(num) {
    return (num << 16) >>> 16;
  }
  var BitReader = function(src) {
    this.src = src;
    this.bytePos = 0;
    this.bitPos = 0;
  }
  BitReader.prototype.read = function(n) {
    var value = 0;
    while (n--) (value <<= 1), (value |= this.readBit());
    return value;
  }
  BitReader.prototype.readBit = function() {
    var val = (this.src[this.bytePos] >> (7 - this.bitPos++)) & 0x1;
    if (this.bitPos > 7) {
      this.bytePos++;
      this.bitPos = 0;
    }
    return val;
  }
  BitReader.prototype.read_bool = function() {
    return !!this.readBit();
  }
  BitReader.prototype.tell = function() {
    return (this.bytePos * 8) + this.bitPos;
  }
  BitReader.prototype.peek = function(nbits) {
    var bytePos = this.bytePos
	var bitPos = this.bitPos;
    var r = this.read(nbits);
	this.bytePos = bytePos;
	this.bitPos = bitPos;
    return r;
  }
  BitReader.prototype.skip = function(nbits) {
    this.read(nbits);
  }
  BitReader.prototype.read_huff = function(huff) {
    var peekval = this.peek(16);
    for (var i = 0; i < huff.codes.length; i++) {
      var code = huff.codes[i];
      var bit = huff.bits[i];
      if (((peekval >> (16 - bit)) >>> 0) == code) {
        this.skip(bit);
        return i;
      }
    }
    throw new Error("InvalidData");
  }
  function edge_emu(src, xpos, ypos, bw, bh, dst, dstride, comp, align) {
    var stride = src.get_stride(comp);
    var offs   = src.get_offset(comp);
    var wh = src.get_dimensions(comp);
    var _h = src.get_info().get_format().get_chromaton(comp).get_subsampling();
    var data = src.get_data();
    var framebuf = data;
    var w, h;
    if (align == 0) {
      w = wh[0];
      h = wh[1];
    } else {
      var wa = (align > _h[0]) ? (1 << (align - _h[0])) - 1 : 0;
      var ha = (align > _h[1]) ? (1 << (align - _h[1])) - 1 : 0;
      w = (wh[0] + wa) - wa;
      h = (wh[1] + ha) - ha;
    }
    for (var y = 0; y < bh; y++) {
      var srcy;
      if (y + ypos < 0) {
        srcy = 0;
      } else if ((y) + ypos >= (h)) {
        srcy = h - 1;
      } else {
        srcy = ((y) + ypos);
      }
      for (var x = 0; x < bw; x++) {
        var srcx;
        if ((x) + xpos < 0) {
          srcx = 0;
        } else if ((x) + xpos >= (w)) {
          srcx = w - 1;
        } else {
          srcx = ((x) + xpos);
        }
        dst[x + y * dstride] = framebuf[offs + srcx + srcy * stride];
      }
    }
  }

  var MV = function(x, y) {
    this.x = x;
    this.y = y;
  }
  MV.prototype.add = function(other) {
    return new MV(this.x + other.x, this.y + other.y);
  }
  MV.prototype.eq = function(other) {
    return (this.x == other.x) && (this.y == other.y);
  }
  var ZERO_MV = new MV(0, 0);

  var ZIGZAG = new Uint32Array([0, 1, 8, 16, 9, 2, 3, 10, 17, 24, 32, 25, 18, 11, 4, 5, 12, 19, 26, 33, 40, 48, 41, 34, 27, 20, 13, 6, 7, 14, 21, 28, 35, 42, 49, 56, 57, 50, 43, 36, 29, 22, 15, 23, 30, 37, 44, 51, 58, 59, 52, 45, 38, 31, 39, 46, 53, 60, 61, 54, 47, 55, 62, 63]);

  //// formats ////

  var MAX_CHROMATONS = 5;

  var YUVSubmodel = function(type) {
    this.type = type;
  }
  YUVSubmodel.YCbCr = 1;
  YUVSubmodel.YIQ = 2;
  YUVSubmodel.YUVJ = 3;

  var ColorModel = function(type, value) {
    this.type = type;
    this.value = value;
  }
  ColorModel.RGB = 1; // RGBSubmodel
  ColorModel.YUV = 2; // YUVSubmodel
  ColorModel.CMYK = 3;
  ColorModel.HSV = 4;
  ColorModel.LAB = 5;
  ColorModel.XYZ = 6;

  var NAPixelChromaton = function(data) {
    this.h_ss = data.h_ss;
    this.v_ss = data.v_ss;
    this.packed = data.packed;
    this.depth = data.depth;
    this.shift = data.shift;
    this.comp_offs = data.comp_offs;
    this.next_elem = data.next_elem;
  }
  NAPixelChromaton.prototype.get_subsampling = function() {
    return [this.h_ss, this.v_ss]; // self.h_ss, self.v_ss
  }
  NAPixelChromaton.prototype.is_packed = function() {
    return this.packed;
  }
  NAPixelChromaton.prototype.get_depth = function() {
    return this.depth;
  }
  NAPixelChromaton.prototype.get_shift = function() {
    return this.shift;
  }
  NAPixelChromaton.prototype.get_offset = function() {
    return this.comp_offs;
  }
  NAPixelChromaton.prototype.get_step = function() {
    return this.next_elem;
  }
  NAPixelChromaton.prototype.get_width = function(width) {
    return (width + ((1 << this.h_ss) - 1)) >> this.h_ss;
  }
  NAPixelChromaton.prototype.get_height = function(height) {
    return (height + ((1 << this.v_ss) - 1)) >> this.v_ss;
  }
  NAPixelChromaton.prototype.get_linesize = function(width) {
    var d = this.depth;
    if (this.packed) {
      return (this.get_width(width) * d + d - 1) >> 3;
    } else {
      return this.get_width(width);
    }
  }
  NAPixelChromaton.prototype.get_data_size = function() {
    var nh = (height + ((1 << this.v_ss) - 1)) >> this.v_ss;
    return (this.get_linesize(width) * nh);
  }

  var NAPixelFormaton = function(data) {
    this.model = data.model; // ColorModel
    this.components = data.components; // u8
    this.comp_info = data.comp_info; // NAPixelChromaton MAX_CHROMATONS
    this.elem_size = data.elem_size; // u8
    this.be = data.be;
    this.alpha = data.alpha;
    this.palette = data.palette;
  }
  NAPixelFormaton.prototype.get_model = function() {
    return this.model;
  }
  NAPixelFormaton.prototype.get_num_comp = function() {
    return this.components;
  }
  NAPixelFormaton.prototype.get_chromaton = function(i) {
    return this.comp_info[i];
  }
  NAPixelFormaton.prototype.is_be = function() {
    return this.be;
  }
  NAPixelFormaton.prototype.has_alpha = function() {
    return this.alpha;
  }
  NAPixelFormaton.prototype.is_paletted = function() {
    return this.palette;
  }
  NAPixelFormaton.prototype.get_elem_size = function() {
    return this.elem_size;
  }

  var YUV420_FORMAT = new NAPixelFormaton({
    model: new ColorModel(ColorModel.YUV, new YUVSubmodel(YUVSubmodel.YUVJ)),
    components: 3,
    comp_info: [
      new NAPixelChromaton({ h_ss: 0, v_ss: 0, packed: false, depth: 8, shift: 0, comp_offs: 0, next_elem: 1 }),
      new NAPixelChromaton({ h_ss: 1, v_ss: 1, packed: false, depth: 8, shift: 0, comp_offs: 1, next_elem: 1 }),
      new NAPixelChromaton({ h_ss: 1, v_ss: 1, packed: false, depth: 8, shift: 0, comp_offs: 2, next_elem: 1 }),
      null,
      null
    ],
    elem_size: 0,
    be: false,
    alpha: false,
    palette: false
  });

  //// frame ////

  var NAVideoInfo = function(w, h, flip, fmt) {
    this.width = w;
    this.height = h;
    this.flipped = flip;
    this.format = fmt;
    this.bits = 0;
  }
  NAVideoInfo.prototype.get_width = function() {
    return this.width;
  }
  NAVideoInfo.prototype.get_height = function() {
    return this.height;
  }
  NAVideoInfo.prototype.is_flipped = function() {
    return this.flipped;
  }
  NAVideoInfo.prototype.get_format = function() {
    return this.format;
  }
  NAVideoInfo.prototype.set_width = function(w) {
    this.width = w;
  }
  NAVideoInfo.prototype.set_height = function(h) {
    this.height = h;
  }
  NAVideoInfo.prototype.eq = function(other) {
    return this.width == other.width && this.height == other.height && this.flipped == other.flipped;
  }

  function get_plane_size(info, idx) {
    var chromaton = info.get_format().get_chromaton(idx);
    if (chromaton === null) {
      return [0, 0];
    }
    var _h = chromaton.get_subsampling();
    var w = (info.get_width() + ((1 << _h[0]) - 1)) >> _h[0];
    var h = (info.get_height() + ((1 << _h[1]) - 1)) >> _h[1];
    return [w, h];
  }

  var NAVideoBuffer = function(data) {
    this.info = data.info;
    this.data = data.data;
    this.offs = data.offs;
    this.strides = data.strides;
  }
  NAVideoBuffer.prototype.get_num_refs = function() {
    return 1;
  }
  NAVideoBuffer.prototype.get_info = function() {
    return this.info;
  }
  NAVideoBuffer.prototype.get_data = function() {
    return this.data;
  }
  NAVideoBuffer.prototype.get_dimensions = function(idx) {
    return get_plane_size(this.info, idx);
  }
  NAVideoBuffer.prototype.get_offset = function(idx) {
    if (idx >= this.offs.length) {
      return 0;
    } else {
      return this.offs[idx];
    }
  }
  NAVideoBuffer.prototype.get_stride = function(idx) {
    if (idx >= this.strides.length) {
      return 0;
    }
    return this.strides[idx];
  }
  NAVideoBuffer.prototype.cloned = function() {
    return new NAVideoBuffer({
      info: this.info,
      data: this.data.slice(0),
      offs: this.offs,
      strides: this.strides
    });
  }

  var NABufferType = function(type, value) {
    this.type = type;
    this.value = value;
  }
  NABufferType.Video = 1;
  NABufferType.Video16 = 2;
  NABufferType.Video32 = 3;
  NABufferType.VideoPacked = 4;
  NABufferType.Data = 5;
  NABufferType.None = 6;
  NABufferType.prototype.get_vbuf = function() {
    return this.value;
  }

  var NA_SIMPLE_VFRAME_COMPONENTS = 4;

  var NASimpleVideoFrame = function(data) {
    this.width = data.width;
    this.height = data.height;
    this.flip = data.flip;
    this.stride = data.stride;
    this.offset = data.offset;
    this.components = data.components;
    this.data = data.data;
  }
  NASimpleVideoFrame.from_video_buf = function(vbuf) {
    var vinfo = vbuf.get_info();
    var components = vinfo.format.components;
    if (components > NA_SIMPLE_VFRAME_COMPONENTS) {
      return null;
    }
    var w = new Uint32Array(NA_SIMPLE_VFRAME_COMPONENTS);
    var h = new Uint32Array(NA_SIMPLE_VFRAME_COMPONENTS);
    var s = new Uint32Array(NA_SIMPLE_VFRAME_COMPONENTS);
    var o = new Uint32Array(NA_SIMPLE_VFRAME_COMPONENTS);
    for (var comp = 0; comp < components; comp++) {
      var wh = vbuf.get_dimensions(comp);
      w[comp] = wh[0];
      h[comp] = wh[1];
      s[comp] = vbuf.get_stride(comp);
      o[comp] = vbuf.get_offset(comp);
    }
    var flip = vinfo.flipped;
    return new NASimpleVideoFrame({
      width: w,
      height: h,
      flip,
      stride: s,
      offset: o,
      components,
      data: vbuf.data,
    });
  }

  function alloc_video_buffer(vinfo, align) {
    var fmt = vinfo.format;
    var new_size = 0;
    var offs = [];
    var strides = [];
    for (var i = 0; i < fmt.get_num_comp(); i++) {
      if (!fmt.get_chromaton(i)) {
        throw new Error("AllocatorError::FormatError");
      }
    }
    var align_mod = (1 << align) - 1;
    var width = (vinfo.width + align_mod) - align_mod;
    var height = (vinfo.height + align_mod) - align_mod;
    var max_depth = 0;
    var all_packed = true;
    var all_bytealigned = true;
    for (var i = 0; i < fmt.get_num_comp(); i++) {
      var ochr = fmt.get_chromaton(i);
      if (!ochr) continue;
      var chr = ochr;
      if (!chr.is_packed()) {
        all_packed = false;
      } else if (((chr.get_shift() + chr.get_depth()) & 7) != 0) {
        all_bytealigned = false;
      }
      max_depth = Math.max(max_depth, chr.get_depth());
    }
    var unfit_elem_size = false;
    switch(fmt.get_elem_size()) {
      case 2:
      case 4:
        unfit_elem_size = true;
        break;
    }
    unfit_elem_size = !unfit_elem_size;
    if (fmt.is_paletted()) {
      console.log("is_paletted");
    } else if (!all_packed) {
      for (var i = 0; i < fmt.get_num_comp(); i++) {
        var ochr = fmt.get_chromaton(i);
        if (!ochr) continue;
        var chr = ochr;
        offs.push(new_size);
        var stride = chr.get_linesize(width);
        var cur_h = chr.get_height(height);
        var cur_sz = (stride * cur_h);
        var new_sz = (new_size + cur_sz);
        new_size = new_sz;
        strides.push(stride);
      }
      if (max_depth <= 8) {
        var data = new Uint8Array(new_size);
        var buf = new NAVideoBuffer({
          data: data,
          info: vinfo,
          offs: offs,
          strides: strides
        });
        return new NABufferType(NABufferType.Video, buf);
      } else if (max_depth <= 16) {
        console.log("16");
      } else {
        console.log("any");
      }
    } else if (all_bytealigned || unfit_elem_size) {
      console.log("any");
    } else {
      console.log("none");
    }
  }

  var NAVideoBufferPool = function(max_len) {
    this.pool = [];
    this.max_len = max_len;
    this.add_len = 0;
  }
  NAVideoBufferPool.prototype.set_dec_bufs = function(add_len) {
    this.add_len = add_len;
  }
  NAVideoBufferPool.prototype.reset = function() {
    this.pool = [];
  }
  NAVideoBufferPool.prototype.prealloc_video = function(vinfo, align) {
    var nbufs = this.max_len + this.add_len - this.pool.length;
    for (var _ = 0; _ < nbufs; _++) {
      var vbuf = alloc_video_buffer(vinfo, align);
      var buf = vbuf.value;
      this.pool.push(buf);
    }
  }
  NAVideoBufferPool.prototype.get_free = function() {
    for (var i = 0; i < this.pool.length; i++) {
      var e = this.pool[i];
      if (e.get_num_refs() == 1) 
        return e;
    }
    return null;
  }
  NAVideoBufferPool.prototype.get_info = function() {
    if (this.pool.length) {
      return (this.pool[0].get_info())
    } else {
      return null;
    }
  }

  var NADecoderSupport = function() {
    this.pool_u8 = new NAVideoBufferPool(0); // NAVideoBufferPool<u8>; 
  }

  ////////// nihav-duck //////////

  //////// vp6data ////////

  var VERSION_VP60 = 6;
  var VERSION_VP62 = 8;
  var VP6_SIMPLE_PROFILE = 0;
  var VP6_ADVANCED_PROFILE = 3;
  var LONG_VECTOR_ORDER = new Uint32Array([0, 1, 2, 7, 6, 5, 4]);
  var NZ_PROBS = new Uint8Array([162, 164]);
  var RAW_PROBS = [new Uint8Array([247, 210, 135, 68, 138, 220, 239, 246]),new Uint8Array([244, 184, 201, 44, 173, 221, 239, 253])];
  var TREE_PROBS = [new Uint8Array([225, 146, 172, 147, 214,  39, 156]),new Uint8Array([204, 170, 119, 235, 140, 230, 228])];
  var ZERO_RUN_PROBS = [new Uint8Array([198, 197, 196, 146, 198, 204, 169, 142, 130, 136, 149, 149, 191, 249]),new Uint8Array([135, 201, 181, 154,  98, 117, 132, 126, 146, 169, 184, 240, 246, 254])];
  var HAS_NZ_PROB = new Uint8Array([237, 231]);
  var HAS_SIGN_PROB = new Uint8Array([246, 243]);
  var HAS_TREE_PROB = [new Uint8Array([253, 253, 254, 254, 254, 254, 254]), new Uint8Array([245, 253, 254, 254, 254, 254, 254])];
  var HAS_RAW_PROB = [new Uint8Array([254, 254, 254, 254, 254, 250, 250, 252]), new Uint8Array([254, 254, 254, 254, 254, 251, 251, 254])];
  var HAS_COEF_PROBS = [new Uint8Array([146, 255, 181, 207, 232, 243, 238, 251, 244, 250, 249]),new Uint8Array([179, 255, 214, 240, 250, 255, 244, 255, 255, 255, 255])];
  var HAS_SCAN_UPD_PROBS = new Uint8Array([0, 132, 132, 159, 153, 151, 161, 170, 164, 162, 136, 110, 103, 114, 129, 118, 124, 125, 132, 136, 114, 110, 142, 135, 134, 123, 143, 126, 153, 183, 166, 161, 171, 180, 179, 164, 203, 218, 225, 217, 215, 206, 203, 217, 229, 241, 248, 243, 253, 255, 253, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]);
  var HAS_ZERO_RUN_PROBS = [new Uint8Array([219, 246, 238, 249, 232, 239, 249, 255, 248, 253, 239, 244, 241, 248]),new Uint8Array([198, 232, 251, 253, 219, 241, 253, 255, 248, 249, 244, 238, 251, 255])];
  var VP6_AC_PROBS = [[[new Uint8Array([227, 246, 230, 247, 244, 255, 255, 255, 255, 255, 255]),new Uint8Array([255, 255, 209, 231, 231, 249, 249, 253, 255, 255, 255]),new Uint8Array([255, 255, 225, 242, 241, 251, 253, 255, 255, 255, 255]),new Uint8Array([255, 255, 241, 253, 252, 255, 255, 255, 255, 255, 255]),new Uint8Array([255, 255, 248, 255, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255])], [new Uint8Array([240, 255, 248, 255, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([255, 255, 240, 253, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255])]], [[new Uint8Array([206, 203, 227, 239, 247, 255, 253, 255, 255, 255, 255]),new Uint8Array([207, 199, 220, 236, 243, 252, 252, 255, 255, 255, 255]),new Uint8Array([212, 219, 230, 243, 244, 253, 252, 255, 255, 255, 255]),new Uint8Array([236, 237, 247, 252, 253, 255, 255, 255, 255, 255, 255]),new Uint8Array([240, 240, 248, 255, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255])], [new Uint8Array([230, 233, 249, 255, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([238, 238, 250, 255, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([248, 251, 255, 255, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255])]], [[new Uint8Array([225, 239, 227, 231, 244, 253, 243, 255, 255, 253, 255]),new Uint8Array([232, 234, 224, 228, 242, 249, 242, 252, 251, 251, 255]),new Uint8Array([235, 249, 238, 240, 251, 255, 249, 255, 253, 253, 255]),new Uint8Array([249, 253, 251, 250, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([251, 250, 249, 255, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255])], [new Uint8Array([243, 244, 250, 250, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([249, 248, 250, 253, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([253, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]),new Uint8Array([255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255])]]];
  var VP6_DC_WEIGHTS = [[new Int16Array([122, 133]),new Int16Array([133, 51]),new Int16Array([142, -16])], [new Int16Array([0, 1]),new Int16Array([0, 1]),new Int16Array([0, 1])], [new Int16Array([78, 171]),new Int16Array([169, 71]),new Int16Array([221, -30])], [new Int16Array([139, 117]),new Int16Array([214, 44]),new Int16Array([246, -3])], [new Int16Array([168, 79]),new Int16Array([210, 38]),new Int16Array([203, 17])]];
  var VP6_IDX_TO_AC_BAND = new Uint32Array([0, 0, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5]);
  var VP6_BICUBIC_COEFFS = [[new Int16Array([0, 128, 0, 0]), new Int16Array([-3, 122, 9, 0]), new Int16Array([-4, 109, 24, -1]), new Int16Array([-5, 91, 45, -3]), new Int16Array([-4, 68, 68, -4]), new Int16Array([-3, 45, 91, -5]), new Int16Array([-1, 24, 109, -4]), new Int16Array([ 0, 9, 122, -3])], [new Int16Array([0, 128, 0, 0]), new Int16Array([-4, 124, 9, -1]), new Int16Array([-5, 110, 25, -2]), new Int16Array([-6, 91, 46, -3]), new Int16Array([-5, 69, 69, -5]), new Int16Array([-3, 46, 91, -6]), new Int16Array([-2, 25, 110, -5]), new Int16Array([-1, 9, 124, -4])], [new Int16Array([0, 128, 0, 0]), new Int16Array([-4, 123, 10, -1]), new Int16Array([-6, 110, 26, -2]), new Int16Array([-7, 92, 47, -4]), new Int16Array([-6, 70, 70, -6]), new Int16Array([-4, 47, 92, -7]), new Int16Array([-2, 26, 110, -6]), new Int16Array([-1, 10, 123, -4])], [new Int16Array([0, 128, 0, 0]), new Int16Array([-5, 124, 10, -1]), new Int16Array([-7, 110, 27, -2]), new Int16Array([-7, 91, 48, -4]), new Int16Array([-6, 70, 70, -6]), new Int16Array([-4, 48, 92, -8]), new Int16Array([-2, 27, 110, -7]), new Int16Array([-1, 10, 124, -5])], [new Int16Array([0, 128, 0, 0]), new Int16Array([-6, 124, 11, -1]), new Int16Array([-8, 111, 28, -3]), new Int16Array([-8, 92, 49, -5]), new Int16Array([-7, 71, 71, -7]), new Int16Array([-5, 49, 92, -8]), new Int16Array([-3, 28, 111, -8]), new Int16Array([-1, 11, 124, -6])], [new Int16Array([0, 128, 0, 0]), new Int16Array([-6, 123, 12, -1]), new Int16Array([-9, 111, 29, -3]), new Int16Array([-9, 93, 50, -6]), new Int16Array([-8, 72, 72, -8]), new Int16Array([-6, 50, 93, -9]), new Int16Array([-3, 29, 111, -9]), new Int16Array([-1, 12, 123, -6])], [new Int16Array([0, 128, 0, 0]), new Int16Array([-7, 124, 12, -1]), new Int16Array([-10, 111, 30, -3]), new Int16Array([-10, 93, 51, -6]), new Int16Array([-9, 73, 73, -9]), new Int16Array([-6, 51, 93, -10]), new Int16Array([-3, 30, 111, -10]), new Int16Array([-1, 12, 124, -7])], [new Int16Array([0, 128, 0, 0]), new Int16Array([-7, 123, 13, -1]), new Int16Array([-11, 112, 31, -4]), new Int16Array([-11, 94, 52, -7]), new Int16Array([-10, 74, 74, -10]), new Int16Array([-7, 52, 94, -11]), new Int16Array([-4, 31, 112, -11]), new Int16Array([-1, 13, 123, -7])], [new Int16Array([0, 128, 0, 0]), new Int16Array([-8, 124, 13, -1]), new Int16Array([-12, 112, 32, -4]), new Int16Array([-12, 94, 53, -7]), new Int16Array([-10, 74, 74, -10]), new Int16Array([-7, 53, 94, -12]), new Int16Array([-4, 32, 112, -12]), new Int16Array([-1, 13, 124, -8])], [new Int16Array([0, 128, 0, 0]), new Int16Array([-9, 124, 14, -1]), new Int16Array([-13, 112, 33, -4]), new Int16Array([-13, 95, 54, -8]), new Int16Array([-11, 75, 75, -11]), new Int16Array([-8, 54, 95, -13]), new Int16Array([-4, 33, 112, -13]), new Int16Array([-1, 14, 124, -9])], [new Int16Array([0, 128, 0, 0]), new Int16Array([-9, 123, 15, -1]), new Int16Array([-14, 113, 34, -5]), new Int16Array([-14, 95, 55, -8]), new Int16Array([-12, 76, 76, -12]), new Int16Array([-8, 55, 95, -14]), new Int16Array([-5, 34, 112, -13]), new Int16Array([-1, 15, 123, -9])], [new Int16Array([0, 128, 0, 0]), new Int16Array([-10, 124, 15, -1]), new Int16Array([-14, 113, 34, -5]), new Int16Array([-15, 96, 56, -9]), new Int16Array([-13, 77, 77, -13]), new Int16Array([-9, 56, 96, -15]), new Int16Array([-5, 34, 113, -14]), new Int16Array([-1, 15, 124, -10])], [new Int16Array([0, 128, 0, 0]), new Int16Array([-10, 123, 16, -1]), new Int16Array([-15, 113, 35, -5]), new Int16Array([-16, 98, 56, -10]), new Int16Array([-14, 78, 78, -14]), new Int16Array([-10, 56, 98, -16]), new Int16Array([-5, 35, 113, -15]), new Int16Array([-1, 16, 123, -10])], [new Int16Array([0, 128, 0, 0]), new Int16Array([-11, 124, 17, -2]), new Int16Array([-16, 113, 36, -5]), new Int16Array([-17, 98, 57, -10]), new Int16Array([-14, 78, 78, -14]), new Int16Array([-10, 57, 98, -17]), new Int16Array([-5, 36, 113, -16]), new Int16Array([-2, 17, 124, -11])], [new Int16Array([0, 128, 0, 0]), new Int16Array([-12, 125, 17, -2]), new Int16Array([-17, 114, 37, -6]), new Int16Array([-18, 99, 58, -11]), new Int16Array([-15, 79, 79, -15]), new Int16Array([-11, 58, 99, -18]), new Int16Array([-6, 37, 114, -17]), new Int16Array([-2, 17, 125, -12])], [new Int16Array([0, 128, 0, 0]), new Int16Array([-12, 124, 18, -2]), new Int16Array([-18, 114, 38, -6]), new Int16Array([-19, 99, 59, -11]), new Int16Array([-16, 80, 80, -16]), new Int16Array([-11, 59, 99, -19]), new Int16Array([-6, 38, 114, -18]), new Int16Array([-2, 18, 124, -12])], [new Int16Array([0, 128, 0, 0]), new Int16Array([-4, 118, 16, -2]), new Int16Array([-7, 106, 34, -5]), new Int16Array([-8,  90, 53, -7]), new Int16Array([-8,  72, 72, -8]), new Int16Array([-7,  53, 90, -8]), new Int16Array([-5,  34, 106, -7]), new Int16Array([-2,  16, 118, -4])]];
  var VP6_DEFAULT_SCAN_ORDER = new Uint32Array([0, 0, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 4, 4, 4, 5, 5, 5, 5, 6, 6, 7, 7, 7, 7, 7, 8, 8, 9, 9, 9, 9, 9, 9, 10, 10, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 14, 14, 14, 14, 15, 15, 15, 15, 15, 15]);
  var VP6_INTERLACED_SCAN_ORDER = new Uint32Array([0, 1, 0, 1, 1, 2, 5, 3, 2, 2, 2, 2, 4, 7, 8, 10, 9, 7, 5, 4, 2, 3, 5, 6, 8, 9, 11, 12, 13, 12, 11, 10, 9, 7, 5, 4, 6, 7, 9, 11, 12, 12, 13, 13, 14, 12, 11, 9, 7, 9, 11, 12, 14, 14, 14, 15, 13, 11, 13, 15, 15, 15, 15, 15]);
  var VP6_COEF_ADD_BITS = new Uint8Array([1, 2, 3, 4, 5, 11]);

  //// vpcommon ////

  var VP_YUVA420_FORMAT = new NAPixelFormaton({
    model: new ColorModel(ColorModel.YUV, new YUVSubmodel(YUVSubmodel.YUVJ)),
    components: 4,
    comp_info:  [
      new NAPixelChromaton({ h_ss: 0, v_ss: 0, packed: false, depth: 8, shift: 0, comp_offs: 0, next_elem: 1}),
      new NAPixelChromaton({ h_ss: 1, v_ss: 1, packed: false, depth: 8, shift: 0, comp_offs: 1, next_elem: 1}),
      new NAPixelChromaton({ h_ss: 1, v_ss: 1, packed: false, depth: 8, shift: 0, comp_offs: 2, next_elem: 1}),
      new NAPixelChromaton({ h_ss: 0, v_ss: 0, packed: false, depth: 8, shift: 0, comp_offs: 3, next_elem: 1}),
      null],
    elem_size:  0,
    be:         false,
    alpha:      true,
    palette:    false
  });

  var VP_REF_INTER = 1;
  var VP_REF_GOLDEN = 2;

  var VPMBType = function(type) {
    this.type = type;
  }
  VPMBType.Intra = 1;
  VPMBType.InterNoMV = 2;
  VPMBType.InterMV = 3;
  VPMBType.InterNearest = 4;
  VPMBType.InterNear = 5;
  VPMBType.InterFourMV = 6;
  VPMBType.GoldenNoMV = 7;
  VPMBType.GoldenMV = 8;
  VPMBType.GoldenNearest = 9;
  VPMBType.GoldenNear = 10;
  VPMBType.prototype.is_intra = function() {
    return this.type == VPMBType.Intra;
  }
  VPMBType.prototype.get_ref_id = function() {
    switch(this.type) {
      case VPMBType.Intra:
        return 0;
      case VPMBType.InterNoMV:
      case VPMBType.InterMV:
      case VPMBType.InterNearest:
      case VPMBType.InterNear:
      case VPMBType.InterFourMV:
        return VP_REF_INTER;
      default:
        return VP_REF_GOLDEN;
    }
  }

  var VPShuffler = function() {
    this.lastframe = null;
    this.goldframe = null;
  }
  VPShuffler.prototype.clear = function() {
    this.lastframe = null;
    this.goldframe = null;
  }
  VPShuffler.prototype.add_frame = function(buf) {
    this.lastframe = null;
    this.lastframe = buf;
  }
  VPShuffler.prototype.add_golden_frame = function(buf) {
    this.goldframe = null;
    this.goldframe = buf;
  }
  VPShuffler.prototype.get_last = function() {
    return this.lastframe; // TODO cloned
  }
  VPShuffler.prototype.get_golden = function() {
    return this.goldframe; // TODO cloned
  }
  VPShuffler.prototype.has_refs = function() {
    return !!this.lastframe;
  }

  var VP56_COEF_BASE = new Int16Array([5, 7, 11, 19, 35, 67]);
  var VP56_COEF_ADD_PROBS = [
    new Uint8Array([159, 128, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]),
    new Uint8Array([165, 145, 128, 0, 0, 0, 0, 0, 0, 0, 0, 0]),
    new Uint8Array([173, 148, 140, 128, 0, 0, 0, 0, 0, 0, 0, 0]),
    new Uint8Array([176, 155, 140, 135, 128, 0, 0, 0, 0, 0, 0, 0]),
    new Uint8Array([180, 157, 141, 134, 130, 128, 0, 0, 0, 0, 0, 0]),
    new Uint8Array([254, 254, 243, 230, 196, 177, 153, 140, 133, 130, 129, 128]),
  ];

  var ff_vp56_norm_shift = new Uint8Array([8, 7, 6, 6, 5, 5, 5, 5, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);

  var BoolCoder = function(src) {
    if (src.length < 3) 
      throw new Error("DecoderError::ShortData");
    var value = asU32(asU32(src[0] << 24) | asU32(src[1] << 16) | asU32(src[2] << 8) | asU32(src[3]));
    this.src = src;
    this.pos = 4;
    this.value = value;
    this.range = 255;
    this.bits = 8;
  }
  BoolCoder.prototype.read_bool = function() {
    return this.read_prob(128);
  }
  BoolCoder.prototype.read_prob = function(prob) {
    this.renorm();
    var split = asU32(1 + asU32((asU32(this.range - 1) * asU32(prob)) >> 8));
    var bit;
    if (asU32(this.value) < asU32(split << 24)) {
      this.range = split;
      bit = false;
    } else {
      this.range -= split;
      this.range = asU32(this.range);
      this.value -= asU32(split << 24);
      this.value = asU32(this.value);
      bit = true;
    }
    return bit;
  }
  BoolCoder.prototype.read_bits = function(bits) {
    var val = 0;
    for (var i = 0; i < bits; i++) {
      val = (val << 1) | asU32(this.read_prob(128));
      val = asU32(val);
    }
    return asU32(val);
  }
  BoolCoder.prototype.read_probability = function() {
    var val = this.read_bits(7);
    if (val == 0) {
      return 1;
    } else {
      return asU8(val << 1);
    }
  }
  BoolCoder.prototype.renorm = function() {
    var shift = ff_vp56_norm_shift[this.range];
    this.range <<= asU32(shift);
    this.value <<= asU32(shift);
    this.range = asU32(this.range);
    this.value = asU32(this.value);
    this.bits -= shift;
    if ((this.bits <= 0) && (this.pos < this.src.length)) {
      this.value |= (this.src[this.pos] << asU8(-this.bits));
      this.pos += 1;
      this.bits += 8;
    }
  }
  BoolCoder.prototype.skip_bytes = function(nbytes) {
    for (var i = 0; i < nbytes; i++) {
      this.value <<= 8;
      if (this.pos < this.src.length) {
        this.value |= (this.src[this.pos]);
        this.pos += 1;
      }
    }
  }

  function rescale_prob(prob, weights, maxval) {
    return Math.max(Math.min((((prob * weights[0] + 128) >> 8) + weights[1]), maxval), 1);
  }

  var C1S7 = 64277;
  var C2S6 = 60547;
  var C3S5 = 54491;
  var C4S4 = 46341;
  var C5S3 = 36410;
  var C6S2 = 25080;
  var C7S1 = 12785;

  function mul16(a, b) {
    return (a * b) >> 16;
  }

  var tmp = new Int32Array(64);
  function vp_idct(coeffs) {
    var t_a, t_b, t_c, t_d, t_a1, t_b1, t_e, t_f, t_g, t_h, t_e1;
    for (var i = 0; i < 64; i += 8) {
      t_a = mul16(C1S7, (coeffs[i + 1])) + mul16(C7S1, coeffs[i + 7]);
      t_b = mul16(C7S1, (coeffs[i + 1])) - mul16(C1S7, coeffs[i + 7]);
      t_c = mul16(C3S5, (coeffs[i + 3])) + mul16(C5S3, coeffs[i + 5]);
      t_d = mul16(C3S5, (coeffs[i + 5])) - mul16(C5S3, coeffs[i + 3]);
      t_a1 = mul16(C4S4, t_a - t_c);
      t_b1 = mul16(C4S4, t_b - t_d);
      t_c = t_a + t_c;
      t_d = t_b + t_d;
      t_e = mul16(C4S4, (coeffs[i] + coeffs[i + 4]));
      t_f = mul16(C4S4, (coeffs[i] - coeffs[i + 4]));
      t_g = mul16(C2S6, (coeffs[i + 2])) + mul16(C6S2, (coeffs[i + 6]));
      t_h = mul16(C6S2, (coeffs[i + 2])) - mul16(C2S6, (coeffs[i + 6]));
      t_e1 = t_e - t_g;
      t_g = t_e + t_g;
      t_a = t_f + t_a1;
      t_f = t_f - t_a1;
      t_b = t_b1 - t_h;
      t_h = t_b1 + t_h;
      tmp[i] = t_g + t_c;
      tmp[i + 1] = t_a + t_h;
      tmp[i + 2] = t_a - t_h;
      tmp[i + 3] = t_e1 + t_d;
      tmp[i + 4] = t_e1 - t_d;
      tmp[i + 5] = t_f + t_b;
      tmp[i + 6] = t_f - t_b;
      tmp[i + 7] = t_g - t_c;
    }
    for (var i = 0; i < 8; i++) {
      t_a = mul16(C1S7, (tmp[8 + i])) + mul16(C7S1, tmp[56 + i]);
      t_b = mul16(C7S1, (tmp[8 + i])) - mul16(C1S7, tmp[56 + i]);
      t_c = mul16(C3S5, (tmp[24 + i])) + mul16(C5S3, tmp[40 + i]);
      t_d = mul16(C3S5, (tmp[40 + i])) - mul16(C5S3, tmp[24 + i]);
      t_a1 = mul16(C4S4, t_a - t_c);
      t_b1 = mul16(C4S4, t_b - t_d);
      t_c = t_a + t_c;
      t_d = t_b + t_d;
      t_e = mul16(C4S4, (tmp[i] + tmp[32 + i])) + 8;
      t_f = mul16(C4S4, (tmp[i] - tmp[32 + i])) + 8;
      t_g = mul16(C2S6, (tmp[16 + i])) + mul16(C6S2, (tmp[48 + i]));
      t_h = mul16(C6S2, (tmp[16 + i])) - mul16(C2S6, (tmp[48 + i]));
      t_e1 = t_e - t_g;
      t_g = t_e + t_g;
      t_a = t_f + t_a1;
      t_f = t_f - t_a1;
      t_b = t_b1 - t_h;
      t_h = t_b1 + t_h;
      coeffs[i] = (t_g + t_c) >> 4;
      coeffs[8 + i] = (t_a + t_h) >> 4;
      coeffs[16 + i] = (t_a - t_h) >> 4;
      coeffs[24 + i] = (t_e1 + t_d) >> 4;
      coeffs[32 + i] = (t_e1 - t_d) >> 4;
      coeffs[40 + i] = (t_f + t_b) >> 4;
      coeffs[48 + i] = (t_f - t_b) >> 4;
      coeffs[56 + i] = (t_g - t_c) >> 4;
    }
  }

  function vp_idct_dc(coeffs) {
    var dc = (mul16(C4S4, mul16(C4S4, coeffs[0])) + 8) >> 4;
    for (var i = 0; i < 64; i++) 
      coeffs[i] = dc;
  }

  function vp_put_block(coeffs, bx, by, plane, frm) {
    var data = frm.data;
    vp_idct(coeffs);
    var off = frm.offset[plane] + ((bx * 8) + ((by * 8) * frm.stride[plane]));
    for (var y = 0; y < 8; y++) {
      for (var x = 0; x < 8; x++) 
        data[off + x] = Math.max(Math.min((coeffs[x + (y * 8)] + 128), 255), 0);
      off += frm.stride[plane];
    }
  }

  function vp_put_block_ilace(coeffs, bx, by, plane, frm) {
    var data = frm.data;
    vp_idct(coeffs);
    var off = frm.offset[plane] + bx * 8 + ((by - 1) * 8 + (by + 1)) * frm.stride[plane];
    for (var y = 0; y < 8; y++) {
      for (var x = 0; x < 8; x++) 
        data[off + x] = Math.max(Math.min((coeffs[x + y * 8] + 128), 255), 0);
      off += frm.stride[plane] * 2;
    }
  }

  function vp_put_block_dc(coeffs, bx, by, plane, frm) {
    var data = frm.data;
    vp_idct_dc(coeffs);
    var dc = Math.max(Math.min((coeffs[0] + 128), 255), 0);
    var off = frm.offset[plane] + bx * 8 + by * 8 * frm.stride[plane];
    for (var y = 0; y < 8; y++) {
      for (var x = 0; x < 8; x++) 
        data[off + x] = dc;
      off += frm.stride[plane];
    }
  }

  function vp_add_block(coeffs, bx, by, plane, frm) {
    var data = frm.data;
    vp_idct(coeffs);
    var off = frm.offset[plane] + bx * 8 + by * 8 * frm.stride[plane];
    for (var y = 0; y < 8; y++) {
      for (var x = 0; x < 8; x++) 
        data[off + x] = Math.max(Math.min((coeffs[x + y * 8] + data[off + x]), 255), 0);
      off += frm.stride[plane];
    }
  }

  function vp_add_block_ilace(coeffs, bx, by, plane, frm) {
    var data = frm.data;
    vp_idct(coeffs);
    var off = frm.offset[plane] + bx * 8 + ((by - 1) * 8 + (by + 1)) * frm.stride[plane];
    for (var y = 0; y < 8; y++) {
      for (var x = 0; x < 8; x++) 
        data[off + x] = Math.max(Math.min((coeffs[x + y * 8] + data[off + x]), 255), 0);
      off += frm.stride[plane] * 2;
    }
  }

  function vp_add_block_dc(coeffs, bx, by, plane, frm) {
    var data = frm.data;
    vp_idct_dc(coeffs);
    var dc = coeffs[0];
    var off = frm.offset[plane] + bx * 8 + by * 8 * frm.stride[plane];
    for (var y = 0; y < 8; y++) {
      for (var x = 0; x < 8; x++) 
        data[off + x] = Math.max(Math.min((dc + data[off + x]), 255), 0);
      off += frm.stride[plane];
    }
  }

  function vp31_loop_filter(data, off, step, stride, len, loop_str) {
    for (var _ = 0; _ < len; _++) {
      var a = data[off - step * 2], b = data[off - step], c = data[off], d = data[off + step];
      var diff = ((a - d) + 3 * (c - b) + 4) >> 3;
      if (Math.abs(diff) >= 2 * loop_str) {
        diff = 0;
      } else if (Math.abs(diff) >= loop_str) {
        if (diff < 0) 
          diff = -diff - 2 * loop_str;
        else 
          diff = -diff + 2 * loop_str;
      }
      if (diff != 0) {
        data[off - step] = Math.min(Math.max((b + diff), 0), 255);
        data[off] = Math.min(Math.max((c - diff), 0), 255);
      }
      off += stride;
    }
  }

  //// vp56 ////

  var VP56Header = function() {
    this.is_intra = false;
    this.is_golden = false;
    this.quant = 0;
    this.multistream = false;
    this.use_huffman = false;
    this.version = 0;
    this.profile = 0;
    this.interlaced = false;
    this.offset = 0;
    this.mb_w = 0;
    this.mb_h = 0;
    this.disp_w = 0;
    this.disp_h = 0;
    this.scale = 0;
  }

  var CoeffReader = function(type, value) {
    this.type = type;
    this.value = value;
  }
  CoeffReader.None = 1;
  CoeffReader.Bool = 2;
  CoeffReader.Huff = 3;

  var VP56MVModel = function() {
    this.nz_prob = 0;
    this.sign_prob = 0;
    this.raw_probs = new Uint8Array(8);
    this.tree_probs = new Uint8Array(7);
  }

  var VP56MBTypeModel = function() {
    this.probs = new Uint8Array(10);
  }

  var VP56CoeffModel = function() {
    this.dc_token_probs = [[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)]];
    this.dc_value_probs = new Uint8Array(11);
    this.ac_ctype_probs = [[[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)]], [[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)]], [[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)],[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)]]];
    this.ac_type_probs = [[[[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)], [new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)], [new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)]],[[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)], [new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)], [new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)]],[[new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)], [new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)], [new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5), new Uint8Array(5)]]]];
    this.ac_val_probs = [[new Uint8Array(11), new Uint8Array(11), new Uint8Array(11), new Uint8Array(11), new Uint8Array(11), new Uint8Array(11)], [new Uint8Array(11), new Uint8Array(11), new Uint8Array(11), new Uint8Array(11), new Uint8Array(11), new Uint8Array(11)], [new Uint8Array(11), new Uint8Array(11), new Uint8Array(11), new Uint8Array(11), new Uint8Array(11), new Uint8Array(11)]];
  }

  var VP6Models = function() {
    this.scan_order = new Uint32Array(64);
    this.scan = new Uint32Array(64);
    this.zigzag = new Uint32Array(64);
    this.zero_run_probs = [new Uint8Array(14), new Uint8Array(14)]
  }

  var MAX_HUFF_ELEMS = 12;

  var _Node = function() {
    this.weight = 0;
    this.sym = 0;
    this.ch0 = 0;
    this.ch1 = 0;
  }
  _Node.prototype.clone = function() {
	var c = new _Node();
    c.weight = this.weight;
    c.sym = this.sym;
    c.ch0 = this.ch0;
    c.ch1 = this.ch1;
    return c;
  }
  _Node.prototype.copy = function(other) {
    this.weight = other.weight;
    this.sym = other.sym;
    this.ch0 = other.ch0;
    this.ch1 = other.ch1;
  }

  function prob2weight(a, b) {
    var w = asU8((a * b) >> 8);
    if (w == 0) {
      return 1;
    } else {
      return w;
    }
  }

  var VP6Huff = function() {
    this.codes = new Uint16Array(MAX_HUFF_ELEMS);
    this.bits = new Uint8Array(MAX_HUFF_ELEMS);
  }
  VP6Huff.prototype.build_codes = function(probs) {
    var weights = new Uint8Array(12);
    weights[11] = prob2weight(probs[0], probs[ 1]);
    weights[0] = prob2weight(probs[0], 255 - probs[ 1]);
    weights[1] = prob2weight(255 - probs[0], probs[ 2]);
    var lvroot = prob2weight(255 - probs[0], 255 - probs[ 2]);
    var tworoot = prob2weight(lvroot, probs[ 3]);
    var hlroot = prob2weight(lvroot, 255 - probs[ 3]);
    weights[2] = prob2weight(tworoot, probs[ 4]);
    var root34 = prob2weight(tworoot, 255 - probs[ 4]);
    weights[3] = prob2weight(root34, probs[ 5]);
    weights[4] = prob2weight(root34, 255 - probs[ 5]);
    var c1root = prob2weight(hlroot, probs[ 6]);
    var c34root = prob2weight(hlroot, 255 - probs[ 6]);
    weights[5] = prob2weight(c1root, probs[ 7]);
    weights[6] = prob2weight(c1root, 255 - probs[ 7]);
    var c3root = prob2weight(c34root, probs[ 8]);
    var c4root = prob2weight(c34root, 255 - probs[ 8]);
    weights[7] = prob2weight(c3root, probs[ 9]);
    weights[8] = prob2weight(c3root, 255 - probs[ 9]);
    weights[9] = prob2weight(c4root, probs[10]);
    weights[10] = prob2weight(c4root, 255 - probs[10]);
    this.build(weights);
  }
  VP6Huff.prototype.build_codes_zero_run = function(probs) {
    var weights = new Uint8Array(9);
    var root = prob2weight(probs[0], probs[1]);
    weights[0] = prob2weight(root, probs[2]);
    weights[1] = prob2weight(root, 255 - probs[2]);
    root = prob2weight(probs[0], 255 - probs[1]);
    weights[2] = prob2weight(root, probs[3]);
    weights[3] = prob2weight(root, 255 - probs[3]);
    root = prob2weight(255 - probs[0],  probs[4]);
    weights[8] = prob2weight(255 - probs[0], 255 - probs[4]);
    var root1 = prob2weight(root, probs[5]);
    var root2 = prob2weight(root, 255 - probs[5]);
    weights[4] = prob2weight(root1, probs[6]);
    weights[5] = prob2weight(root1, 255 - probs[6]);
    weights[6] = prob2weight(root2, probs[7]);
    weights[7] = prob2weight(root2, 255 - probs[7]);
    this.build(weights);
  }
  VP6Huff.prototype.build = function(weights) {
    var nodes = new Array(MAX_HUFF_ELEMS * 2);
    for (var _ = 0; _ < nodes.length; _++) {
      nodes[_] = new _Node();
    }
    var nlen = 0;
    for (var _i = weights.length - 1; _i >= 0; _i--) {
      var weight = weights[_i];
      var pos = nlen;
      for (var i = 0; i < nlen; i++) {
        if (nodes[i].weight > weight) {
          pos = i;
          break;
        }
      }
      for (var j = nlen - 1; j >= pos; j--) {
        nodes[j + 1].copy(nodes[j]);
      }
      nodes[pos].weight = weight;
      nodes[pos].sym = ((weights.length - nlen - 1)) << 24 >> 24;
      nlen += 1;
    }
    var low = 0;
    var _nlen = nlen;
    for (var _ = 0; _ < _nlen - 1; _++) {
      var nnode = new _Node();
      nnode.weight = (nodes[low].weight + nodes[low + 1].weight) << 16 >>> 16;
      nnode.sym = -1;
      nnode.ch0 = low;
      nnode.ch1 = low + 1;
      low += 2;
      var pos = low;
      while ((pos < nlen) && (nodes[pos].weight < nnode.weight)) {
        pos += 1;
      }
      for (var j = nlen - 1; j >= pos; j--) {
        nodes[j + 1].copy(nodes[j]);
      }
      nodes[pos].copy(nnode);
      nlen += 1;
    }
    this.get_codes(nodes, _nlen - 1, 0, 0);
    for (var i = _nlen; i < this.codes.length; i++) {
      this.codes[i] = this.codes[0];
      this.bits[i] = this.bits[0];
    }
  }
  VP6Huff.prototype.get_codes = function(nodes, pos, code, len) {
    if (nodes[pos].sym >= 0) {
      this.codes[nodes[pos].sym] = code;
      this.bits[nodes[pos].sym] = len;
    } else {
      this.get_codes(nodes, nodes[pos].ch0, (code << 1) | 0, len + 1);
      this.get_codes(nodes, nodes[pos].ch1, (code << 1) | 1, len + 1);
    }
  }

  var VP56_DC_QUANTS = new Int16Array([47, 47, 47, 47, 45, 43, 43, 43, 43, 43, 42, 41, 41, 40, 40, 40, 40, 35, 35, 35, 35, 33, 33, 33, 33, 32, 32, 32, 27, 27, 26, 26, 25, 25, 24, 24, 23, 23, 19, 19, 19, 19, 18, 18, 17, 16, 16, 16, 16, 16, 15, 11, 11, 11, 10, 10, 9, 8, 7, 5, 3, 3, 2, 2]);
  var VP56_AC_QUANTS = new Int16Array([94, 92, 90, 88, 86, 82, 78, 74, 70, 66, 62, 58, 54, 53, 52, 51, 50, 49, 48, 47, 46, 45, 44, 43, 42, 40, 39, 37, 36, 35, 34, 33, 32, 31, 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10,  9, 8, 7, 6, 5, 4, 3, 2, 1]);
  var VP56_FILTER_LIMITS = new Uint8Array([14, 14, 13, 13, 12, 12, 10, 10, 10, 10,  8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 7, 7, 7, 7, 7, 7, 6, 6, 6, 6, 6, 6, 5, 5, 5, 5, 4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 3, 2]);
  var VP56_MODE_VQ = [[new Uint8Array([9, 15, 32, 25, 7, 19, 9, 21, 1, 12, 14, 12, 3, 18, 14, 23, 3, 10, 0, 4]), new Uint8Array([48, 39, 1, 2, 11, 27, 29, 44, 7, 27, 1, 4, 0, 3, 1, 6, 1, 2, 0, 0]), new Uint8Array([21, 32, 1, 2, 4, 10, 32, 43, 6, 23, 2, 3, 1, 19, 1, 6, 12, 21, 0, 7]), new Uint8Array([69, 83, 0, 0, 0, 2, 10, 29, 3, 12, 0, 1, 0, 3, 0, 3, 2, 2, 0, 0]), new Uint8Array([11, 20, 1, 4, 18, 36, 43, 48, 13, 35, 0, 2, 0, 5, 3, 12, 1, 2, 0, 0]), new Uint8Array([70, 44, 0, 1, 2, 10, 37, 46, 8, 26, 0, 2, 0, 2, 0, 2, 0, 1, 0, 0]), new Uint8Array([8, 15, 0, 1, 8, 21, 74, 53, 22, 42, 0, 1, 0, 2, 0, 3, 1, 2, 0, 0]), new Uint8Array([141, 42, 0, 0, 1, 4, 11, 24, 1, 11, 0, 1, 0, 1, 0, 2, 0, 0, 0, 0]), new Uint8Array([8, 19, 4, 10, 24, 45, 21, 37, 9, 29, 0, 3, 1, 7, 11, 25, 0, 2, 0, 1]), new Uint8Array([46, 42, 0, 1, 2, 10, 54, 51, 10, 30, 0, 2, 0, 2, 0, 1, 0, 1, 0, 0]), new Uint8Array([28, 32, 0, 0, 3, 10, 75, 51, 14, 33, 0, 1, 0, 2, 0, 1, 1, 2, 0, 0]), new Uint8Array([100, 46, 0, 1, 3, 9, 21, 37, 5, 20, 0, 1, 0, 2, 1, 2, 0, 1, 0, 0]), new Uint8Array([27, 29, 0, 1, 9, 25, 53, 51, 12, 34, 0, 1, 0, 3, 1, 5, 0, 2, 0, 0]), new Uint8Array([80, 38, 0, 0, 1, 4, 69, 33, 5, 16, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0]), new Uint8Array([16, 20, 0, 0, 2, 8, 104, 49, 15, 33, 0, 1, 0, 1, 0, 1, 1, 1, 0, 0]), new Uint8Array([194, 16, 0, 0, 1, 1, 1, 9, 1, 3, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0])], [new Uint8Array([41, 22, 1, 0, 1, 31, 0, 0, 0, 0, 0, 1, 1, 7, 0, 1, 98, 25, 4, 10]), new Uint8Array([123, 37, 6, 4, 1, 27, 0, 0, 0, 0, 5, 8, 1, 7, 0, 1, 12, 10, 0, 2]), new Uint8Array([26, 14, 14, 12, 0, 24, 0, 0, 0, 0, 55, 17, 1, 9, 0, 36, 5, 7, 1, 3]), new Uint8Array([209, 5, 0, 0, 0, 27, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0]), new Uint8Array([2, 5, 4, 5, 0, 121, 0, 0, 0, 0, 0, 3, 2, 4, 1, 4, 2, 2, 0, 1]), new Uint8Array([175, 5, 0, 1, 0, 48, 0, 0, 0, 0, 0, 2, 0, 1, 0, 2, 0, 1, 0, 0]), new Uint8Array([83, 5, 2, 3, 0, 102, 0, 0, 0, 0, 1, 3, 0, 2, 0, 1, 0, 0, 0, 0]), new Uint8Array([233, 6, 0, 0, 0, 8, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0]), new Uint8Array([34, 16, 112, 21, 1, 28, 0, 0, 0, 0, 6, 8, 1, 7, 0, 3, 2, 5, 0, 2]), new Uint8Array([159, 35, 2, 2, 0, 25, 0, 0, 0, 0, 3, 6, 0, 5, 0, 1, 4, 4, 0, 1]), new Uint8Array([75, 39, 5, 7, 2, 48, 0, 0, 0, 0, 3, 11, 2, 16, 1, 4, 7, 10, 0, 2]), new Uint8Array([212, 21, 0, 1, 0, 9, 0, 0, 0, 0, 1, 2, 0, 2, 0, 0, 2, 2, 0, 0]), new Uint8Array([4, 2, 0, 0, 0, 172, 0, 0, 0, 0, 0, 1, 0, 2, 0, 0, 2, 0, 0, 0]), new Uint8Array([187, 22, 1, 1, 0, 17, 0, 0, 0, 0, 3, 6, 0, 4, 0, 1, 4, 4, 0, 1]), new Uint8Array([133, 6, 1, 2, 1, 70, 0, 0, 0, 0, 0, 2, 0, 4, 0, 3, 1, 1, 0, 0]), new Uint8Array([251, 1, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])], [new Uint8Array([2, 3, 2, 3, 0, 2, 0, 2, 0, 0, 11, 4, 1, 4, 0, 2, 3, 2, 0, 4]), new Uint8Array([49, 46, 3, 4, 7, 31, 42, 41, 0, 0, 2, 6, 1, 7, 1, 4, 2, 4, 0, 1]), new Uint8Array([26, 25, 1, 1, 2, 10, 67, 39, 0, 0, 1, 1, 0, 14, 0, 2, 31, 26, 1, 6]), new Uint8Array([103, 46, 1, 2, 2, 10, 33, 42, 0, 0, 1, 4, 0, 3, 0, 1, 1, 3, 0, 0]), new Uint8Array([14, 31, 9, 13, 14, 54, 22, 29, 0, 0, 2, 6, 4, 18, 6, 13, 1, 5, 0, 1]), new Uint8Array([85, 39, 0, 0, 1, 9, 69, 40, 0, 0, 0, 1, 0, 3, 0, 1, 2, 3, 0, 0]), new Uint8Array([31, 28, 0, 0, 3, 14, 130, 34, 0, 0, 0, 1, 0, 3, 0, 1, 3, 3, 0, 1]), new Uint8Array([171, 25, 0, 0, 1, 5, 25, 21, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0]), new Uint8Array([17, 21, 68, 29, 6, 15, 13, 22, 0, 0, 6, 12, 3, 14, 4, 10, 1, 7, 0, 3]), new Uint8Array([51, 39, 0, 1, 2, 12, 91, 44, 0, 0, 0, 2, 0, 3, 0, 1, 2, 3, 0, 1]), new Uint8Array([81, 25, 0, 0, 2, 9, 106, 26, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 0]), new Uint8Array([140, 37, 0, 1, 1, 8, 24, 33, 0, 0, 1, 2, 0, 2, 0, 1, 1, 2, 0, 0]), new Uint8Array([14, 23, 1, 3, 11, 53, 90, 31, 0, 0, 0, 3, 1, 5, 2, 6, 1, 2, 0, 0]), new Uint8Array([123, 29, 0, 0, 1, 7, 57, 30, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0]), new Uint8Array([13, 14, 0, 0, 4, 20, 175, 20, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 0]), new Uint8Array([202, 23, 0, 0, 1, 3, 2, 9, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0])]];

  var INVALID_REF = 42;

  var VP6HuffModels = function() {
    this.dc_token_tree = [new VP6Huff(), new VP6Huff()];
    this.ac_token_tree = [
      [
        [new VP6Huff(), new VP6Huff(), new VP6Huff(), new VP6Huff(), new VP6Huff(), new VP6Huff()],
        [new VP6Huff(), new VP6Huff(), new VP6Huff(), new VP6Huff(), new VP6Huff(), new VP6Huff()],
        [new VP6Huff(), new VP6Huff(), new VP6Huff(), new VP6Huff(), new VP6Huff(), new VP6Huff()]
      ], [
        [new VP6Huff(), new VP6Huff(), new VP6Huff(), new VP6Huff(), new VP6Huff(), new VP6Huff()],
        [new VP6Huff(), new VP6Huff(), new VP6Huff(), new VP6Huff(), new VP6Huff(), new VP6Huff()],
        [new VP6Huff(), new VP6Huff(), new VP6Huff(), new VP6Huff(), new VP6Huff(), new VP6Huff()]
      ]
    ];
    this.zero_run_tree = [new VP6Huff(), new VP6Huff()];
  }
  
  var VP56Models = function() {
    this.mv_models = [new VP56MVModel(), new VP56MVModel()];
    this.mbtype_models = [
      [new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel()],
      [new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel()],
      [new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel(), new VP56MBTypeModel()]
    ];
    this.coeff_models = [new VP56CoeffModel(), new VP56CoeffModel()];
    this.prob_xmitted = [new Uint8Array(20), new Uint8Array(20), new Uint8Array(20)];
    this.vp6models = new VP6Models();
    this.vp6huff = new VP6HuffModels();
  }

  var MBInfo = function() {
    this.mb_type = new VPMBType(VPMBType.Intra);
    this.mv = new MV(0, 0);
  }

  var FrameState = function() {
    this.mb_x = 0;
    this.mb_y = 0;
    this.plane = 0;
    this.coeff_cat = [new Uint8Array(64), new Uint8Array(64), new Uint8Array(64), new Uint8Array(64)];
    this.last_idx = new Uint32Array(4);
    this.top_ctx = 0;
    this.ctx_idx = 0;
    this.dc_quant = 0;
    this.ac_quant = 0;
    this.dc_zero_run = new Uint32Array(2);
    this.ac_zero_run = new Uint32Array(2);
  }

  var VP56DCPred = function() {
    this.dc_y = new Int16Array(0);
    this.dc_u = new Int16Array(0);
    this.dc_v = new Int16Array(0);
    this.ldc_y = new Int16Array(2);
    this.ldc_u = 0;
    this.ldc_v = 0;
    this.ref_y = new Uint8Array(0);
    this.ref_c = new Uint8Array(0);
    this.ref_left = 0;
    this.y_idx = 0;
    this.c_idx = 0;
  }
  VP56DCPred.prototype.reset = function() {
    this.update_row();
    for (var i = 1; i < this.ref_y.length; i++) {
      this.ref_y[i] = INVALID_REF;
    }
    for (var i = 1; i < this.ref_c.length; i++) {
      this.ref_c[i] = INVALID_REF;
    }
  }
  VP56DCPred.prototype.update_row = function() {
    this.y_idx = 1;
    this.c_idx = 1;
    this.ldc_y[0] = 0;
    this.ldc_y[1] = 0;
    this.ldc_u = 0;
    this.ldc_v = 0;
    this.ref_left = INVALID_REF;
  }
  VP56DCPred.prototype.resize = function(mb_w) {
    this.dc_y = new Int16Array(mb_w * 2 + 2);
    this.dc_u = new Int16Array(mb_w + 2);
    this.dc_v = new Int16Array(mb_w + 2);
    this.ref_y = new Uint8Array(mb_w * 2 + 2);
    for (var i = 0; i < this.ref_y.length; i++) {
      this.ref_y[i] = INVALID_REF;
    }
    this.ref_c = new Uint8Array(mb_w + 2);
    for (var i = 0; i < this.ref_c.length; i++) {
      this.ref_c[i] = INVALID_REF;
    }
    this.ref_c[0] = 0;
  }
  VP56DCPred.prototype.next_mb = function() {
    this.y_idx += 2;
    this.c_idx += 1;
  }

  function rescale_mb_mode_prob(prob, total) {
    return asU8(255 * prob / (1 + total));
  }

  function map_mb_type(mbtype) {
    switch(mbtype.type) {
      case VPMBType.InterNoMV    : return 0;
      case VPMBType.Intra        : return 1;
      case VPMBType.InterMV      : return 2;
      case VPMBType.InterNearest : return 3;
      case VPMBType.InterNear    : return 4;
      case VPMBType.GoldenNoMV   : return 5;
      case VPMBType.GoldenMV     : return 6;
      case VPMBType.InterFourMV  : return 7;
      case VPMBType.GoldenNearest: return 8;
      case VPMBType.GoldenNear   : return 9;
    }
  }
  var VP56Decoder = function(version, hasAlpha, flip) {
    var vt = alloc_video_buffer(new NAVideoInfo(24, 24, false, VP_YUVA420_FORMAT), 4);

    this.version = version;
    this.has_alpha = hasAlpha;
    this.flip = flip;
    this.shuf = new VPShuffler();
    this.width = 0;
    this.height = 0;
    this.mb_w = 0;
    this.mb_h = 0;
    this.models = new VP56Models();
    this.amodels = new VP56Models();
    this.coeffs = [
      new Int16Array(64),
      new Int16Array(64),
      new Int16Array(64),
      new Int16Array(64),
      new Int16Array(64),
      new Int16Array(64)
    ];
    this.last_mbt = new VPMBType(VPMBType.InterNoMV);

    this.loop_thr = 0;
    this.ilace_prob = 0;
    this.ilace_mb = false;

    this.mb_info = [];
    this.fstate = new FrameState();
    this.dc_pred = new VP56DCPred();
    this.last_dc = [new Int16Array(4), new Int16Array(4), new Int16Array(4)];
    this.top_ctx = [new Uint8Array(0), new Uint8Array(0), new Uint8Array(0), new Uint8Array(0)];

    this.mc_buf = vt.get_vbuf();
  }
  VP56Decoder.prototype.set_dimensions = function(width, height) {
    this.width = width;
    this.height = height;
    this.mb_w = (this.width + 15) >> 4;
    this.mb_h = (this.height + 15) >> 4;
    this.mb_info = [];
    for (var i = 0; i < this.mb_w * this.mb_h; i++) {
      this.mb_info.push(new MBInfo());
    }
    this.top_ctx = [
      new Uint8Array(this.mb_w * 2),
      new Uint8Array(this.mb_w),
      new Uint8Array(this.mb_w),
      new Uint8Array(this.mb_w * 2)
    ];
  }
  VP56Decoder.prototype.init = function(supp, vinfo) {
    supp.pool_u8.set_dec_bufs(3 + (vinfo.get_format().has_alpha() ? 1 : 0));
    supp.pool_u8.prealloc_video(new NAVideoInfo(vinfo.get_width(), vinfo.get_height(), false, vinfo.get_format()), 4);
    this.set_dimensions(vinfo.get_width(), vinfo.get_height());
    this.dc_pred.resize(this.mb_w);
  }
  VP56Decoder.prototype.decode_frame = function(supp, src, br) {
    var aoffset;
    var bc;
    if (this.has_alpha) {
      if (!(src.length >= 7)) throw new Error("ValidationError");
      aoffset = ((src[0]) << 16) | ((src[1]) << 8) | (src[2]);
      if (!((aoffset > 0) && (aoffset < src.length - 3))) throw new Error("ValidationError");
      bc = new BoolCoder(src.subarray(3));
    } else {
      if (!(src.length >= 4)) throw new Error("ValidationError");
      aoffset = src.length;
      bc = new BoolCoder(src);
    }
    var hdr = br.parseHeader(bc);
    if (!((hdr.offset) < aoffset)) throw new Error("ValidationError");
    if (hdr.mb_w != 0 && (hdr.mb_w != this.mb_w || hdr.mb_h != this.mb_h)) {
      this.set_dimensions(hdr.mb_w * 16, hdr.mb_h * 16);
    }
    var fmt = this.has_alpha ? VP_YUVA420_FORMAT : YUV420_FORMAT;
    var vinfo = new NAVideoInfo(this.width, this.height, this.flip, fmt);
    var ret = supp.pool_u8.get_free();
    if (ret === null) throw new Error("DecoderError::AllocError");
    var buf = ret;
    if (!buf.get_info().eq(vinfo)) {
      this.shuf.clear();
      supp.pool_u8.reset();
      supp.pool_u8.prealloc_video(vinfo, 4);
      var ret = supp.pool_u8.get_free();
      if (ret === null) throw new Error("DecoderError::AllocError");
      buf = ret;
    }
    var dframe = NASimpleVideoFrame.from_video_buf(buf);
    if (hdr.is_intra) {
      this.shuf.clear();
    } else {
      if (!this.shuf.has_refs()) {
        throw new Error("DecoderError::MissingReference");
      }
    }
    var psrc = src.subarray(this.has_alpha ? 3 : 0);
    this.decode_planes(br, dframe, bc, hdr, psrc, false);
    if (this.has_alpha) {
      var asrc = src.subarray(aoffset + 3);
      var _bc = new BoolCoder(asrc);
      var ahdr = br.parseHeader(_bc);
      if (!(ahdr.mb_w == hdr.mb_w && ahdr.mb_h == hdr.mb_h)) throw new Error("ValidationError");
      var models = this.models;
      this.models = this.amodels;
      this.decode_planes(br, dframe, _bc, ahdr, asrc, true);
      this.models = models;
      if (hdr.is_golden && ahdr.is_golden) {
        this.shuf.add_golden_frame(buf.cloned());
      } else if (hdr.is_golden && !ahdr.is_golden) {
        var cur_golden = this.shuf.get_golden();
        var off = cur_golden.get_offset(3);
        var stride = cur_golden.get_stride(3);
        var new_golden = supp.pool_u8.get_copy(buf);
        var dst = new_golden.get_data();
        var _src = cur_golden.get_data();
        dst.set(_src.subarray(off, off + (stride * this.mb_h * 16)), off);
        this.shuf.add_golden_frame(new_golden);
      } else if (!hdr.is_golden && ahdr.is_golden) {
        var cur_golden = this.shuf.get_golden();
        var off = cur_golden.get_offset(3);
        var stride = cur_golden.get_stride(3);
        var new_golden = supp.pool_u8.get_copy(cur_golden);
        var dst = new_golden.get_data();
        var _src = buf.get_data();
        dst.set(_src.subarray(off, off + (stride * this.mb_h * 16)), off);
        this.shuf.add_golden_frame(new_golden);
      }
    }
    if (hdr.is_golden && !this.has_alpha) this.shuf.add_golden_frame(buf.cloned());
    this.shuf.add_frame(buf.cloned());
    return [new NABufferType(NABufferType.Video, buf), hdr.is_intra];
  }
  var DEFAULT_XMITTED_PROBS = [
    new Uint8Array([ 42,  69, 2, 1, 7, 1, 42, 44, 22, 6, 3, 1, 2, 0, 5, 1, 1, 0, 0, 0 ]),
    new Uint8Array([  8, 229, 1, 1, 8, 0,  0,  0,  0, 0, 2, 1, 1, 0, 0, 0, 1, 1, 0, 0 ]),
    new Uint8Array([ 35, 122, 1, 1, 6, 1, 34, 46,  0, 0, 2, 1, 1, 0, 1, 0, 1, 1, 0, 0 ])
  ];
  VP56Decoder.prototype.reset_mbtype_models = function() {
    this.models.prob_xmitted[0].set(DEFAULT_XMITTED_PROBS[0], 0);
    this.models.prob_xmitted[1].set(DEFAULT_XMITTED_PROBS[1], 0);
    this.models.prob_xmitted[2].set(DEFAULT_XMITTED_PROBS[2], 0);
  }
  VP56Decoder.prototype.decode_planes = function(br, dframe, bc, hdr, src, alpha) {
    var cr;
    if (hdr.multistream) {
      var off = +hdr.offset.toString();
      if (!hdr.use_huffman) {
        var bc2 = new BoolCoder(src.subarray(off));
        cr = new CoeffReader(CoeffReader.Bool, bc2);
      } else {
        var bc3 = new BitReader(src.subarray(off));
        cr = new CoeffReader(CoeffReader.Huff, bc3);
      }
    } else {
      cr = new CoeffReader(CoeffReader.None);
    }
    if (hdr.is_intra) {
      br.reset_models(this.models);
      this.reset_mbtype_models();
    } else {
      this.decode_mode_prob_models(bc); 
      br.decode_mv_models(bc, this.models.mv_models);
    }
    br.decode_coeff_models(bc, this.models, hdr.is_intra);
    if (hdr.use_huffman) {
      for (var i = 0; i < 2; i++) {
        this.models.vp6huff.dc_token_tree[i].build_codes(this.models.coeff_models[i].dc_value_probs);
      }
      for (var i = 0; i < 2; i++) {
        for (var mode = 0; mode < 3; mode++) {
          for (var band = 0; band < 6; band++) {
            this.models.vp6huff.ac_token_tree[i][mode][band].build_codes(this.models.coeff_models[i].ac_val_probs[mode][band]);
          }
        }
      }
      for (var i = 0; i < 2; i++) {
        this.models.vp6huff.zero_run_tree[i].build_codes_zero_run(this.models.vp6models.zero_run_probs[i]);
      }
    }
    if (hdr.interlaced) 
      this.ilace_prob = bc.read_bits(8);
    this.fstate = new FrameState();
    this.fstate.dc_quant = (VP56_DC_QUANTS[hdr.quant] * 4) | 0;
    this.fstate.ac_quant = (VP56_AC_QUANTS[hdr.quant] * 4) | 0;
    this.loop_thr = (VP56_FILTER_LIMITS[hdr.quant]) | 0;
   
    this.last_mbt = new VPMBType(VPMBType.InterNoMV);

    for (var i = 0; i < this.top_ctx.length; i++) {
      var vec = this.top_ctx[i];
      vec.fill(0);
    }

	this.last_dc[0].fill(0);
	this.last_dc[1].fill(0);
	this.last_dc[2].fill(0);
    this.last_dc[0][1] = 0x80;
    this.last_dc[0][2] = 0x80;
    this.dc_pred.reset();
    
    this.ilace_mb = false;
    for (var mb_y = 0; mb_y < this.mb_h; mb_y++) {
      this.fstate.mb_y = mb_y;
      this.fstate.coeff_cat[0].fill(0);
      this.fstate.coeff_cat[1].fill(0);
      this.fstate.coeff_cat[2].fill(0);
      this.fstate.coeff_cat[3].fill(0);
      this.fstate.last_idx[0] = 24;
      this.fstate.last_idx[1] = 24;
      this.fstate.last_idx[2] = 24;
      this.fstate.last_idx[3] = 24;
      for (var mb_x = 0; mb_x < this.mb_w; mb_x++) {
        this.fstate.mb_x = mb_x;
        this.decode_mb(dframe, bc, cr, br, hdr, alpha);
        this.dc_pred.next_mb();
      }
      this.dc_pred.update_row();
    }
  }
  VP56Decoder.prototype.decode_mode_prob_models = function(bc) {
    for (var ctx = 0; ctx < 3; ctx++) {
      if (bc.read_prob(174)) {
        var idx = bc.read_bits(4);
        for (var i = 0; i < 20; i++) {
          this.models.prob_xmitted[ctx][i ^ 1] = VP56_MODE_VQ[ctx][idx][i];
        }
      }
      if (bc.read_prob(254)) {
        for (var set = 0; set < 20; set++) {
          if (bc.read_prob(205)) {
            var sign = bc.read_bool();
            var diff = (bc.read_prob(171) ? (bc.read_prob(199) ? bc.read_bits(7) : (bc.read_prob(140) ? 3 : (bc.read_prob(125) ? 4 : (bc.read_prob(104) ? 5 : 6)))) : (bc.read_prob(83) ? 1 : 2)) * 4;
            if (!(diff < 256)) throw new Error("ValidationError");
            if (!sign) {
              if (!(this.models.prob_xmitted[ctx][set ^ 1] <= 255 - diff)) throw new Error("ValidationError");
              this.models.prob_xmitted[ctx][set ^ 1] += diff;
            } else {
              if (!(this.models.prob_xmitted[ctx][set ^ 1] >= diff)) throw new Error("ValidationError");
              this.models.prob_xmitted[ctx][set ^ 1] -= diff;
            }
          }
        }
      }
    }
    for (var ctx = 0; ctx < 3; ctx++) {
      var prob_xmitted = this.models.prob_xmitted[ctx];
      for (var mode = 0; mode < 10; mode++) {
        var mdl = this.models.mbtype_models[ctx][mode];
        var cnt = new Uint32Array(10);
        var total = 0;
        for (var i = 0; i < 10; i++) {
          if (i == mode) continue;
          cnt[i] = 100 * prob_xmitted[i * 2];
          total += cnt[i];
        }
        var sum = prob_xmitted[mode * 2] + prob_xmitted[mode * 2 + 1];
        mdl.probs[9] = 255 - rescale_mb_mode_prob(prob_xmitted[mode * 2 + 1], sum);
        var inter_mv0_weight = cnt[0] + cnt[2];
        var inter_mv1_weight = cnt[3] + cnt[4];
        var gold_mv0_weight = cnt[5] + cnt[6];
        var gold_mv1_weight = cnt[8] + cnt[9];
        var mix_weight = cnt[1] + cnt[7];
        mdl.probs[0] = 1 + rescale_mb_mode_prob(inter_mv0_weight + inter_mv1_weight, total);
        mdl.probs[1] = 1 + rescale_mb_mode_prob(inter_mv0_weight, inter_mv0_weight + inter_mv1_weight);
        mdl.probs[2] = 1 + rescale_mb_mode_prob(mix_weight, mix_weight + gold_mv0_weight + gold_mv1_weight);
        mdl.probs[3] = 1 + rescale_mb_mode_prob(cnt[0], inter_mv0_weight);
        mdl.probs[4] = 1 + rescale_mb_mode_prob(cnt[3], inter_mv1_weight);
        mdl.probs[5] = 1 + rescale_mb_mode_prob(cnt[1], mix_weight);
        mdl.probs[6] = 1 + rescale_mb_mode_prob(gold_mv0_weight, gold_mv0_weight + gold_mv1_weight);
        mdl.probs[7] = 1 + rescale_mb_mode_prob(cnt[5], gold_mv0_weight);
        mdl.probs[8] = 1 + rescale_mb_mode_prob(cnt[8], gold_mv1_weight);
      }
    }
  }
  var CAND_POS = [new Int8Array([-1,  0]), new Int8Array([ 0, -1]), new Int8Array([-1, -1]), new Int8Array([-1,  1]), new Int8Array([-2,  0]), new Int8Array([ 0, -2]), new Int8Array([-1, -2]), new Int8Array([-2, -1]), new Int8Array([-2,  1]), new Int8Array([-1,  2]), new Int8Array([-2, -2]), new Int8Array([-2,  2])]; 
  VP56Decoder.prototype.find_mv_pred = function(ref_id) {
    var nearest_mv = ZERO_MV;
    var near_mv = ZERO_MV;
    var pred_mv = ZERO_MV;
    var num_mv = 0;
    for (var i = 0; i < CAND_POS.length; i++) {
      var off = CAND_POS[i];
      var cx = (this.fstate.mb_x) + off[1];
      var cy = (this.fstate.mb_y) + off[0];
      if ((cx < 0) || (cy < 0)) 
        continue;
      if ((cx >= this.mb_w) || (cy >= this.mb_h)) 
        continue;
      var mb_pos = cx + cy * this.mb_w;
      var mv = this.mb_info[mb_pos].mv;
      if ((this.mb_info[mb_pos].mb_type.get_ref_id() != ref_id) || mv.eq(ZERO_MV)) 
        continue;
      if (num_mv == 0) {
        nearest_mv = mv;
        num_mv += 1;
        if ((this.version > 5) && (i < 2)) {
          pred_mv = mv;
        }
      } else if (!(mv.eq(nearest_mv))) {
        near_mv = mv;
        num_mv += 1;
        break;
      }
    }
    return [num_mv, nearest_mv, near_mv, pred_mv];
  }
  VP56Decoder.prototype.decode_mb_type = function(bc, ctx) {
    var probs = this.models.mbtype_models[ctx][map_mb_type(this.last_mbt)].probs;
    if (!bc.read_prob(probs[9])) this.last_mbt = bc.read_prob(probs[0]) ? (bc.read_prob(probs[2]) ? (bc.read_prob(probs[6]) ? (bc.read_prob(probs[8]) ? new VPMBType(VPMBType.GoldenNear) : new VPMBType(VPMBType.GoldenNearest)) : (bc.read_prob(probs[7]) ? new VPMBType(VPMBType.GoldenMV) : new VPMBType(VPMBType.GoldenNoMV))) : (bc.read_prob(probs[5]) ? new VPMBType(VPMBType.InterFourMV) : new VPMBType(VPMBType.Intra))) : (bc.read_prob(probs[1]) ? (bc.read_prob(probs[4]) ? new VPMBType(VPMBType.InterNear) : new VPMBType(VPMBType.InterNearest)) : (bc.read_prob(probs[3]) ? new VPMBType(VPMBType.InterMV) : new VPMBType(VPMBType.InterNoMV)));
    return this.last_mbt;
  }
  VP56Decoder.prototype.decode_mb = function(frm, bc, cr, br, hdr, alpha) { // decode macroblock
    var FOURMV_SUB_TYPE = [
      new VPMBType(VPMBType.InterNoMV),
      new VPMBType(VPMBType.InterMV),
      new VPMBType(VPMBType.InterNearest),
      new VPMBType(VPMBType.InterNear)
    ];
    var mb_x = this.fstate.mb_x;
    var mb_y = this.fstate.mb_y;
    this.coeffs[0].fill(0);
    this.coeffs[1].fill(0);
    this.coeffs[2].fill(0);
    this.coeffs[3].fill(0);
    this.coeffs[4].fill(0);
    this.coeffs[5].fill(0);
    var mb_pos = mb_x + mb_y * this.mb_w;
    var four_mv = [ZERO_MV, ZERO_MV, ZERO_MV, ZERO_MV];
    var four_mbt = [new VPMBType(VPMBType.Intra), new VPMBType(VPMBType.Intra), new VPMBType(VPMBType.Intra), new VPMBType(VPMBType.Intra)];
    if (hdr.interlaced) {
      var iprob = this.ilace_prob;
      var prob;
      if (mb_x == 0) {
        prob = iprob;
      } else if (!this.ilace_mb) {
        prob = asU8(iprob + asU8(((256 - asU16(iprob)) >> 1)));
      } else {
        prob = asU8(iprob - (iprob >> 1));
      };
      this.ilace_mb = bc.read_prob(prob);
    }
    var num_mv;
    var nearest_mv;
    var near_mv;
    var pred_mv;
    if (hdr.is_intra) {
      num_mv = 0;
      nearest_mv = ZERO_MV;
      near_mv = ZERO_MV;
      pred_mv = ZERO_MV;
    } else {
      var ggdfd = this.find_mv_pred(VP_REF_INTER);
      num_mv = ggdfd[0];
      nearest_mv = ggdfd[1];
      near_mv = ggdfd[2];
      pred_mv = ggdfd[3];
    }
    var mb_type;
    if (hdr.is_intra) {
      mb_type = new VPMBType(VPMBType.Intra);
    } else {
      mb_type = this.decode_mb_type(bc, (num_mv + 1) % 3);
    }
    this.mb_info[mb_pos].mb_type = mb_type;
    if (mb_type.get_ref_id() != VP_REF_GOLDEN) {
      switch(mb_type.type) {
        case VPMBType.Intra:
        case VPMBType.InterNoMV:
          this.mb_info[mb_pos].mv = ZERO_MV;
          break;
        case VPMBType.InterMV:
          var diff_mv = this.decode_mv(bc, br);
          this.mb_info[mb_pos].mv = pred_mv.add(diff_mv);
          break;
        case VPMBType.InterNearest:
          this.mb_info[mb_pos].mv = nearest_mv;
          break;
        case VPMBType.InterNear:
          this.mb_info[mb_pos].mv = near_mv;
          break;
        case VPMBType.InterFourMV:
          for (var i = 0; i < 4; i++) {
            four_mbt[i] = FOURMV_SUB_TYPE[bc.read_bits(2)];
          }
          for (var i = 0; i < 4; i++) {
            switch(four_mbt[i].type) {
              case VPMBType.InterNoMV:
                break;
              case VPMBType.InterMV:
                var diff_mv = this.decode_mv(bc, br);
                four_mv[i] = pred_mv.add(diff_mv);
                break;
              case VPMBType.InterNearest:
                four_mv[i] = nearest_mv;
                break;
              case VPMBType.InterNear:
                four_mv[i] = near_mv;
                break;
              default:
                throw new Error("unreachable");
            }
          }
          this.mb_info[mb_pos].mv = four_mv[3];
          break;
        default:
          throw new Error("unreachable");
      }
    } else {
      var fmp = this.find_mv_pred(VP_REF_GOLDEN);
      switch(mb_type.type) {
        case VPMBType.GoldenNoMV:
          this.mb_info[mb_pos].mv = ZERO_MV;
          break;
        case VPMBType.GoldenMV:
          var diff_mv = this.decode_mv(bc, br);
          this.mb_info[mb_pos].mv = fmp[3].add(diff_mv);
          break;
        case VPMBType.GoldenNearest:
          this.mb_info[mb_pos].mv = fmp[1];
          break;
        case VPMBType.GoldenNear:
          this.mb_info[mb_pos].mv = fmp[2];
          break;
      }
    }
    if (!mb_type.is_intra() && (mb_type.type != VPMBType.InterFourMV)) {
      this.do_mc(br, frm, mb_type, this.mb_info[mb_pos].mv, alpha);
    } else if (mb_type.type == VPMBType.InterFourMV) {
      this.do_fourmv(br, frm, four_mv, alpha);
    }
    for (var blk_no = 0; blk_no < 4; blk_no++) {
      this.fstate.plane = (!alpha ? 0 : 3);
      this.fstate.ctx_idx = blk_no >> 1;
      this.fstate.top_ctx = this.top_ctx[this.fstate.plane][mb_x * 2 + (blk_no & 1)];
      switch(cr.type) {
        case CoeffReader.None:
          br.decode_block(bc, this.coeffs[blk_no], this.models.coeff_models[0], this.models.vp6models, this.fstate);
          break;
        case CoeffReader.Bool:
          br.decode_block(cr.value, this.coeffs[blk_no], this.models.coeff_models[0], this.models.vp6models, this.fstate);
          break;
        case CoeffReader.Huff:
          br.decode_block_huff(cr.value, this.coeffs[blk_no], this.models.vp6models, this.models.vp6huff, this.fstate);
          break;
      }
      this.top_ctx[this.fstate.plane][mb_x * 2 + (blk_no & 1)] = this.fstate.top_ctx;
      this.predict_dc(mb_type, mb_pos, blk_no, alpha);
      var bx = mb_x * 2 + (blk_no & 1);
      var by = mb_y * 2 + (blk_no >> 1);
      var has_ac = (this.fstate.last_idx[this.fstate.ctx_idx] > 0);
      if (mb_type.is_intra()) {
        if (!this.ilace_mb) {
          if (has_ac) {
            vp_put_block(this.coeffs[blk_no], bx, by, this.fstate.plane, frm);
          } else {
            vp_put_block_dc(this.coeffs[blk_no], bx, by, this.fstate.plane, frm);
          }
        } else {
          vp_put_block_ilace(this.coeffs[blk_no], bx, by, this.fstate.plane, frm);
        }
      } else {
        if (!this.ilace_mb) {
          if (has_ac) {
            vp_add_block(this.coeffs[blk_no], bx, by, this.fstate.plane, frm);
          } else {
            vp_add_block_dc(this.coeffs[blk_no], bx, by, this.fstate.plane, frm);
          }
        } else {
          vp_add_block_ilace(this.coeffs[blk_no], bx, by, this.fstate.plane, frm);
        }
      }
    }
    for (var blk_no = 4; blk_no < 6; blk_no++) {
      this.fstate.plane = blk_no - 3;
      this.fstate.ctx_idx = blk_no - 2;
      this.fstate.top_ctx = this.top_ctx[this.fstate.plane][mb_x];
      switch(cr.type) {
        case CoeffReader.None:
          br.decode_block(bc, this.coeffs[blk_no], this.models.coeff_models[1], this.models.vp6models, this.fstate);
          break;
        case CoeffReader.Bool:
          br.decode_block(cr.value, this.coeffs[blk_no], this.models.coeff_models[1], this.models.vp6models, this.fstate);
          break;
      }
      this.top_ctx[this.fstate.plane][mb_x] = this.fstate.top_ctx;
      this.predict_dc(mb_type, mb_pos, blk_no, alpha);
      if (!alpha) {
        var has_ac = this.fstate.last_idx[this.fstate.ctx_idx] > 0;
        if (mb_type.is_intra()) {
          if (has_ac) {
            vp_put_block(this.coeffs[blk_no], mb_x, mb_y, this.fstate.plane, frm);
          } else {
            vp_put_block_dc(this.coeffs[blk_no], mb_x, mb_y, this.fstate.plane, frm);
          }
        } else {
          if (has_ac) {
            vp_add_block(this.coeffs[blk_no], mb_x, mb_y, this.fstate.plane, frm);
          } else {
            vp_add_block_dc(this.coeffs[blk_no], mb_x, mb_y, this.fstate.plane, frm);
          }
        }
      }
    }
  }
  VP56Decoder.prototype.do_mc = function(br, frm, mb_type, mv, alpha) {
    var x = this.fstate.mb_x * 16;
    var y = this.fstate.mb_y * 16;
    var plane = ((!alpha) ? 0 : 3);
    var src;
    if (mb_type.get_ref_id() == VP_REF_INTER) {
      src = this.shuf.get_last();
    } else {
      src = this.shuf.get_golden();
    };
    br.mc_block(frm, this.mc_buf, src, plane, x + 0, y + 0, mv, this.loop_thr);
    br.mc_block(frm, this.mc_buf, src, plane, x + 8, y + 0, mv, this.loop_thr);
    br.mc_block(frm, this.mc_buf, src, plane, x + 0, y + 8, mv, this.loop_thr);
    br.mc_block(frm, this.mc_buf, src, plane, x + 8, y + 8, mv, this.loop_thr);
    if (!alpha) {
      var x = this.fstate.mb_x * 8;
      var y = this.fstate.mb_y * 8;
      br.mc_block(frm, this.mc_buf, src, 1, x, y, mv, this.loop_thr);
      br.mc_block(frm, this.mc_buf, src, 2, x, y, mv, this.loop_thr);
    }
  }
  VP56Decoder.prototype.do_fourmv = function(br, frm, mvs, alpha) {
    var x = this.fstate.mb_x * 16;
    var y = this.fstate.mb_y * 16;
    var plane;
    if (!alpha) {
      plane = 0;
    } else {
      plane = 3;
    };
    var src = this.shuf.get_last();
    for (var blk_no = 0; blk_no < 4; blk_no++) {
      br.mc_block(frm, this.mc_buf, src, plane, x + (blk_no & 1) * 8, y + (blk_no & 2) * 4, mvs[blk_no], this.loop_thr);
    }
    if (!alpha) {
      var x = this.fstate.mb_x * 8;
      var y = this.fstate.mb_y * 8;
      var sum = mvs[0].add(mvs[1].add(mvs[2].add(mvs[3])));
      var mv = new MV((sum.x / 4) | 0, (sum.y / 4) | 0);
      br.mc_block(frm, this.mc_buf, src, 1, x, y, mv, this.loop_thr);
      br.mc_block(frm, this.mc_buf, src, 2, x, y, mv, this.loop_thr);
    }
  }
  VP56Decoder.prototype.decode_mv = function(bc, br) {
    var x = br.decode_mv(bc, this.models.mv_models[0]);
    var y = br.decode_mv(bc, this.models.mv_models[1]);
    return new MV(x, y);
  }
  VP56Decoder.prototype.predict_dc = function(mb_type, _mb_pos, blk_no, _alpha) {
    var is_luma = blk_no < 4;
    var plane;
    var dcs;
    switch(blk_no) {
      case 4:
        plane = 1;
        dcs = this.dc_pred.dc_u;
        break;
      case 5:
        plane = 2;
        dcs = this.dc_pred.dc_v;
        break;
      default:
        plane = 0;
        dcs = this.dc_pred.dc_y;
    }
    var dc_ref;
    var dc_idx;
    if (is_luma) {
      dc_ref = this.dc_pred.ref_y;
      dc_idx = this.dc_pred.y_idx + (blk_no & 1);
    } else {
      dc_ref = this.dc_pred.ref_c;
      dc_idx = this.dc_pred.c_idx;
    }
    var ref_id = mb_type.get_ref_id();
    var dc_pred = 0;
    var count = 0;
    var has_left_blk = is_luma && ((blk_no & 1) == 1);
    if (has_left_blk || this.dc_pred.ref_left == ref_id) {
      var _ = 0;
      switch(blk_no) {
        case 0:
        case 1:
          _ = this.dc_pred.ldc_y[0];
          break;
        case 2:
        case 3:
          _ = this.dc_pred.ldc_y[1];
          break;
        case 4:
          _ = this.dc_pred.ldc_u;
          break;
        default:
          _ = this.dc_pred.ldc_v;
      }
      dc_pred += _;
      count += 1;
    }
    if (dc_ref[dc_idx] == ref_id) {
      dc_pred += dcs[dc_idx];
      count += 1;
    }
    if (this.version == 5) {
      if ((count < 2) && (dc_ref[dc_idx - 1] == ref_id)) {
        dc_pred += dcs[dc_idx - 1];
        count += 1;
      }
      if ((count < 2) && (dc_ref[dc_idx + 1] == ref_id)) {
        dc_pred += dcs[dc_idx + 1];
        count += 1;
      }
    }
    if (count == 0) {
      dc_pred = this.last_dc[ref_id][plane];
    } else if (count == 2) {
      dc_pred /= 2;
      dc_pred |= 0;
    }
    this.coeffs[blk_no][0] += dc_pred;
    var dc = this.coeffs[blk_no][0];
    // update top block reference only for the second chroma component
    if (blk_no != 4) 
      dc_ref[dc_idx] = ref_id;
    switch(blk_no) {
      case 0:
      case 1:
        this.dc_pred.ldc_y[0] = dc;
        break;
      case 2:
      case 3:
        this.dc_pred.ldc_y[1] = dc;
        break;
      case 4:
        this.dc_pred.ldc_u = dc;
        break;
      default:
        this.dc_pred.ldc_v = dc;
        this.dc_pred.ref_left = ref_id;
    }
    dcs[dc_idx] = dc;
    this.last_dc[ref_id][plane] = dc;
    this.coeffs[blk_no][0] *= this.fstate.dc_quant;
  }

  //// vp6 ////

  var TOKEN_LARGE = 5;
  var TOKEN_EOB = 42;

  function update_scan(model) {
    var idx = 1;
    for (var band = 0; band < 16; band++) {
      for (var i = 1; i < 64; i++) {
        if (model.scan_order[i] == band) {
          model.scan[idx] = i;
          idx += 1;
        }
      }
    }
    for (var i = 1; i < 64; i++) {
      model.zigzag[i] = ZIGZAG[model.scan[i]];
    }
  }

  function reset_scan(model, interlaced) {
    if (!interlaced) {
      model.scan_order.set(VP6_DEFAULT_SCAN_ORDER, 0);
    } else {
      model.scan_order.set(VP6_INTERLACED_SCAN_ORDER, 0);
    }
    for (var i = 0; i < 64; i++) {
      model.scan[i] = i;
    }
    model.zigzag.set(ZIGZAG, 0);
  }

  function expand_token_bc(bc, val_probs, token, version) { // i16
    var sign = false;
    var level;
    if (token < TOKEN_LARGE) {
      if (token != 0) {
        sign = bc.read_bool();
      }
      level = token;
    } else {
      var cat = bc.read_prob(val_probs[6]) ? (bc.read_prob(val_probs[8]) ? (bc.read_prob(val_probs[10]) ? 5 : 4) : (bc.read_prob(val_probs[9]) ? 3 : 2)) : (bc.read_prob(val_probs[7]) ? 1 : 0);
      if (version == 5) {
        sign = bc.read_bool();
      }
      var add = 0;
      var add_probs = VP56_COEF_ADD_PROBS[cat];
      for (var i = 0; i < add_probs.length; i++) {
        var prob = add_probs[i];
        if (prob == 128) {
          break;
        }
        add = (add << 1) | bc.read_prob(prob);
      }
      if (version != 5) {
        sign = bc.read_bool();
      }
      level = (VP56_COEF_BASE[cat] + add) | 0;
    }
    if (!sign) {
      return level;
    } else {
      return -level;
    }
  }

  function decode_token_bc(bc, probs, prob34, is_dc, has_nnz) {
    if (has_nnz && !bc.read_prob(probs[0])) {
      if (is_dc || bc.read_prob(probs[1])) {
        return 0;
      } else {
        return TOKEN_EOB;
      }
    } else {
      return (bc.read_prob(probs[2]) ? (bc.read_prob(probs[3]) ? TOKEN_LARGE : (bc.read_prob(probs[4]) ? (bc.read_prob(prob34) ? 4 : 3) : 2)) : 1) << 24 >>> 24;
    }
  }

  function decode_zero_run_bc(bc, probs) { // usize
    var val = bc.read_prob(probs[0]) ? (bc.read_prob(probs[4]) ? 42 : (bc.read_prob(probs[5]) ? (bc.read_prob(probs[7]) ? 7 : 6) : (bc.read_prob(probs[6]) ? 5 : 4))) : (bc.read_prob(probs[1]) ? (bc.read_prob(probs[3]) ? 3 : 2) : (bc.read_prob(probs[2]) ? 1 : 0));
    if (val != 42) {
      return val;
    } else {
      var nval = 8;
      for (var i = 0; i < 6; i++) {
        nval += (bc.read_prob(probs[i + 8])) << i;
      }
      return nval;
    }
  }

  function decode_eob_run_huff(br) {
    var val = br.read(2);
    switch(val) {
      case 0:
        return 0;
      case 1:
        return 1;
      case 2:
        var _val = br.read(2);
        return _val + 2;
      default:
        var r = br.read_bool();
        return r ? (br.read(6) + 10) : (br.read(2) + 6);
    }
  }

  function decode_token_huff(br, huff) {
    var tok = br.read_huff(huff);
    switch(tok) {
      case 0:
        return [0, false];
      case 1:
      case 2:
      case 3:
      case 4:
        var r = br.read_bool();
        return [r ? (-tok) : tok, false];
      case 5:
      case 6:
      case 7:
      case 8:
      case 9:
      case 10:
        var base = (tok - 5);
        var add_bits = br.read(VP6_COEF_ADD_BITS[base]);
        var val = VP56_COEF_BASE[base] + add_bits;
        var r = br.read_bool();
        return [r ? (-val) : val, false];
      default:
        return [0, true];
    }
  }

  function decode_zero_run_huff(br, huff) {
    var val = br.read_huff(huff);
    return (val < 8) ? val : (br.read(6) + 8);
  }

  function get_block(dst, dstride, src, comp, dx, dy, mv_x, mv_y) {
    var wh = src.get_dimensions(comp);
    var sx = dx + mv_x;
    var sy = dy + mv_y;
    if ((sx - 2 < 0) || (sx + 8 + 2 > (wh[0])) || (sy - 2 < 0) || (sy + 8 + 2 > (wh[1]))) {
      edge_emu(src, sx - 2, sy - 2, 8 + 2 + 2, 8 + 2 + 2, dst, dstride, comp, 0);
    } else {
      var sstride = src.get_stride(comp);
      var soff    = src.get_offset(comp);
      var sdta    = src.get_data();
      var sbuf = sdta;
      var saddr = soff + ((sx - 2)) + ((sy - 2)) * sstride;
      var _t = 12;
      var a = 0;
      var b = 0;
      while(_t--) {
        dst[a + 0] = sbuf[(saddr + b) + 0];
        dst[a + 1] = sbuf[(saddr + b) + 1];
        dst[a + 2] = sbuf[(saddr + b) + 2];
        dst[a + 3] = sbuf[(saddr + b) + 3];
        dst[a + 4] = sbuf[(saddr + b) + 4];
        dst[a + 5] = sbuf[(saddr + b) + 5];
        dst[a + 6] = sbuf[(saddr + b) + 6];
        dst[a + 7] = sbuf[(saddr + b) + 7];
        dst[a + 8] = sbuf[(saddr + b) + 8];
        dst[a + 9] = sbuf[(saddr + b) + 9];
        dst[a + 10] = sbuf[(saddr + b) + 10];
        dst[a + 11] = sbuf[(saddr + b) + 11];
        a += dstride;
        b += sstride;
      }
    }
  }

  function calc_variance(var_off, src, stride) {
    var sum = 0;
    var ssum = 0;
    var j = 0;
    for (var _ = 0; _ < 4; _++) {
      for (var a = 0; a < 4; a++) {
        var pix = src[(var_off + j) + (a * 2)];
        sum += pix;
        ssum += pix * pix;
      }
      j += stride * 2;
    }
    return asU16((ssum * 16 - sum * sum) >> 8);
  }

  function mc_filter_bilinear(a, b, c) {
    return asU8((a * (8 - c) + b * c + 4) >> 3);
  }

  var tmp2 = new Uint8Array(8);
  function mc_bilinear(dst_offest, dst, dstride, src, soff, sstride, mx, my) {
    if (my == 0) {
      var dline_offest = 0;
      for (var _ = 0; _ < 8; _++) {
        for (var i = 0; i < 8; i++) {
          dst[(dst_offest + dline_offest) + i] = mc_filter_bilinear(src[soff + i], src[soff + i + 1], mx);
        }
        soff += sstride;
        dline_offest += dstride;
      }
    } else if (mx == 0) {
      var dline_offest = 0;
      for (var _ = 0; _ < 8; _++) {
        for (var i = 0; i < 8; i++) {
          dst[(dst_offest + dline_offest) + i] = mc_filter_bilinear(src[soff + i], src[soff + i + sstride], my);
        }
        soff += sstride;
        dline_offest += dstride;
      }
    } else {
      for (var i = 0; i < 8; i++) 
        tmp2[i] = mc_filter_bilinear(src[soff + i], src[soff + i + 1], mx);
      soff += sstride;
      var dline_offest = 0;
      for (var _ = 0; _ < 8; _++) {
        for (var i = 0; i < 8; i++) {
          var cur = mc_filter_bilinear(src[soff + i], src[soff + i + 1], mx);
          dst[(dst_offest + dline_offest) + i] = mc_filter_bilinear(tmp2[i], cur, my);
          tmp2[i] = cur;
        }
        soff += sstride;
        dline_offest += dstride;
      }
    }
  }

  function mc_filter_bicubic($src, $off, $step, $coeffs) {
    return Math.max(Math.min((($src[$off - $step] * $coeffs[0] + $src[$off] * $coeffs[1] + $src[$off + $step] * $coeffs[2] + $src[$off + $step * 2] * $coeffs[3] + 64) >> 7), 255), 0);
  }

  var buf2 = new Uint8Array(16 * 11);
  function mc_bicubic(dst_offest, dst, dstride, src, soff, sstride, coeffs_w, coeffs_h) {
    if (coeffs_h[1] == 128) {
      var dline_offest = 0;
      for (var _ = 0; _ < 8; _++) {
        for (var i = 0; i < 8; i++) {
          dst[(dst_offest + dline_offest) + i] = mc_filter_bicubic(src, soff + i, 1, coeffs_w);
        }
        soff += sstride;
        dline_offest += dstride;
      }
    } else if (coeffs_w[1] == 128) { // horizontal-only interpolation
      var dline_offest = 0;
      for (var _ = 0; _ < 8; _++) {
        for (var i = 0; i < 8; i++) {
          dst[(dst_offest + dline_offest) + i] = mc_filter_bicubic(src, soff + i, sstride, coeffs_h);
        }
        soff += sstride;
        dline_offest += dstride;
      }
    } else {
      var a = 0;
      soff -= sstride;
      for (var _ = 0; _ < 11; _++) {
        for (var i = 0; i < 8; i++) {
          buf2[a + i] = mc_filter_bicubic(src, soff + i, 1, coeffs_w);
        }
        soff += sstride;
        a += 16;
      }
      var _soff = 16;
      a = 0;
      for (var _ = 0; _ < 8; _++) {
        for (var i = 0; i < 8; i++) {
          dst[(dst_offest + a) + i] = mc_filter_bicubic(buf2, _soff + i, 16, coeffs_h);
        }
        _soff += 16;
        a += dstride;
      }
    }
  }

  var VP6BR = function() {
    this.vpversion = 0;
    this.profile = 0;
    this.interlaced = false;
    this.do_pm = false;
    this.loop_mode = 0;
    this.autosel_pm = false;
    this.var_thresh = 0;
    this.mv_thresh = 0;
    this.bicubic = false;
    this.filter_alpha = 0;
  }
  VP6BR.prototype.parseHeader = function(bc) {
    var hdr = new VP56Header();
    var src = bc.src;
    var br = new BitReader(src);
    hdr.is_intra = !br.read_bool();
    hdr.is_golden = hdr.is_intra;
    hdr.quant = br.read(6);
    hdr.multistream = br.read_bool();
    if (hdr.is_intra) {
      hdr.version = br.read(5);
      validate((hdr.version >= VERSION_VP60) && (hdr.version <= VERSION_VP62));
      hdr.profile = br.read(2);
      validate((hdr.profile == VP6_SIMPLE_PROFILE) || (hdr.profile == VP6_ADVANCED_PROFILE));
      hdr.interlaced = br.read_bool();
    } else {
      hdr.version = this.vpversion;
      hdr.profile = this.profile;
      hdr.interlaced = this.interlaced;
    }
    if (hdr.multistream || (hdr.profile == VP6_SIMPLE_PROFILE)) {
      hdr.offset = br.read(16);
      validate(hdr.offset > (hdr.is_intra ? 6 : 2));
      hdr.multistream = true;
    }
    var bytes = br.tell() >> 3;
    bc.skip_bytes(bytes);
    this.loop_mode = 0;
    if (hdr.is_intra) {
      hdr.mb_h = bc.read_bits(8);
      hdr.mb_w = bc.read_bits(8);
      hdr.disp_h = bc.read_bits(8);
      hdr.disp_w = bc.read_bits(8);
      validate((hdr.mb_h > 0) && (hdr.mb_w > 0));
      hdr.scale = bc.read_bits(2);
    } else {
      hdr.is_golden = bc.read_bool();
      if (hdr.profile == VP6_ADVANCED_PROFILE) {
        this.loop_mode = +bc.read_bool();
        if (this.loop_mode != 0) {
          this.loop_mode += +bc.read_bool();
          validate(this.loop_mode <= 1);
        }
        if (hdr.version == VERSION_VP62) {
          this.do_pm = bc.read_bool();
        }
      }
    }
    if ((hdr.profile == VP6_ADVANCED_PROFILE) && (hdr.is_intra || this.do_pm)) {
      this.autosel_pm = bc.read_bool();
      if (this.autosel_pm) {
        this.var_thresh = bc.read_bits(5);
        if (hdr.version != VERSION_VP62) {
          this.var_thresh <<= 5;
        }
        this.mv_thresh = bc.read_bits(3);
      } else {
        this.bicubic = bc.read_bool();
      }
      if (hdr.version == VERSION_VP62) {
        this.filter_alpha = bc.read_bits(4);
      } else {
        this.filter_alpha = 16;
      }
    }
    hdr.use_huffman = bc.read_bool();
    this.vpversion = hdr.version;
    this.profile = hdr.profile;
    this.interlaced = hdr.interlaced;
    return hdr;
  }
  VP6BR.prototype.decode_mv = function(bc, model) {
    var val;
    if (!bc.read_prob(model.nz_prob)) {
      val = bc.read_prob(model.tree_probs[0]) ? (bc.read_prob(model.tree_probs[4]) ? (bc.read_prob(model.tree_probs[6]) ? 7 : 6) : (bc.read_prob(model.tree_probs[5]) ? 5 : 4)) : (bc.read_prob(model.tree_probs[1]) ? (bc.read_prob(model.tree_probs[3]) ? 3 : 2) : (bc.read_prob(model.tree_probs[2]) ? 1 : 0));
    } else {
      var raw = 0;
      for (var i = 0; i < LONG_VECTOR_ORDER.length; i++) {
        var ord = LONG_VECTOR_ORDER[i];
        raw |= bc.read_prob(model.raw_probs[ord]) << ord;
      }
      if ((raw & 0xF0) != 0) {
        raw |= bc.read_prob(model.raw_probs[3]) << 3;
      } else {
        raw |= 1 << 3;
      }
      val = raw;
    }
    if ((val != 0) && bc.read_prob(model.sign_prob)) {
      return -val;
    } else {
      return val;
    }
  }
  VP6BR.prototype.reset_models = function(models) {
    for (var i = 0; i < models.mv_models.length; i++) {
      var mdl = models.mv_models[i];
      mdl.nz_prob = NZ_PROBS[i];
      mdl.sign_prob = 128;
      mdl.raw_probs.set(RAW_PROBS[i], 0);
      mdl.tree_probs.set(TREE_PROBS[i], 0);
    }
    models.vp6models.zero_run_probs[0].set(ZERO_RUN_PROBS[0], 0);
    models.vp6models.zero_run_probs[1].set(ZERO_RUN_PROBS[1], 0);
    reset_scan(models.vp6models, this.interlaced);
  }
  VP6BR.prototype.decode_mv_models = function(bc, models) {
    for (var comp = 0; comp < 2; comp++) {
      if (bc.read_prob(HAS_NZ_PROB[comp])) {
        models[comp].nz_prob = bc.read_probability();
      }
      if (bc.read_prob(HAS_SIGN_PROB[comp])) {
        models[comp].sign_prob = bc.read_probability();
      }
    }
    for (var comp = 0; comp < 2; comp++) {
      for (var i = 0; i < HAS_TREE_PROB[comp].length; i++) {
        var prob = HAS_TREE_PROB[comp][i];
        if (bc.read_prob(prob)) {
          models[comp].tree_probs[i] = bc.read_probability();
        }
      }
    }
    for (var comp = 0; comp < 2; comp++) {
      for (var i = 0; i < HAS_RAW_PROB[comp].length; i++) {
        var prob = HAS_RAW_PROB[comp][i];
        if (bc.read_prob(prob)) {
          models[comp].raw_probs[i] = bc.read_probability();
        }
      }
    }
  }
  VP6BR.prototype.decode_coeff_models = function(bc, models, is_intra) {
    var def_prob = new Uint8Array(11);
    for (var i = 0; i < 11; i++) {
      def_prob[i] = 128;
    }
    for (var plane = 0; plane < 2; plane++) {
      for (var i = 0; i < 11; i++) {
        if (bc.read_prob(HAS_COEF_PROBS[plane][i])) {
          def_prob[i] = bc.read_probability();
          models.coeff_models[plane].dc_value_probs[i] = def_prob[i];
        } else if (is_intra) {
          models.coeff_models[plane].dc_value_probs[i] = def_prob[i];
        }
      }
    }
    if (bc.read_bool()) {
      for (var i = 1; i < 64; i++) {
        if (bc.read_prob(HAS_SCAN_UPD_PROBS[i])) {
          models.vp6models.scan_order[i] = bc.read_bits(4);
        }
      }
      update_scan(models.vp6models);
    } else {
      reset_scan(models.vp6models, this.interlaced);
    }
    for (var comp = 0; comp < 2; comp++) {
      for (var i = 0; i < 14; i++) {
        if (bc.read_prob(HAS_ZERO_RUN_PROBS[comp][i])) {
          models.vp6models.zero_run_probs[comp][i] = bc.read_probability();
        }
      }
    }
    for (var ctype = 0; ctype < 3; ctype++) {
      for (var plane = 0; plane < 2; plane++) {
        for (var group = 0; group < 6; group++) {
          for (var i = 0; i < 11; i++) {
            if (bc.read_prob(VP6_AC_PROBS[ctype][plane][group][i])) {
              def_prob[i] = bc.read_probability();
              models.coeff_models[plane].ac_val_probs[ctype][group][i] = def_prob[i];
            } else if (is_intra) {
              models.coeff_models[plane].ac_val_probs[ctype][group][i] = def_prob[i];
            }
          }
        }
      }
    }
    for (var plane = 0; plane < 2; plane++) {
      var mdl = models.coeff_models[plane];
      for (var i = 0; i < 3; i++) {
        for (var k = 0; k < 5; k++) {
          mdl.dc_token_probs[0][i][k] = rescale_prob(mdl.dc_value_probs[k], VP6_DC_WEIGHTS[k][i], 255);
        }
      }
    }
  }
  VP6BR.prototype.decode_block = function(bc, coeffs, model, vp6model, fstate) {
    var left_ctx = fstate.coeff_cat[fstate.ctx_idx][0];
    var top_ctx = fstate.top_ctx;
    var dc_mode = top_ctx + left_ctx;
    var token = decode_token_bc(bc, model.dc_token_probs[0][dc_mode], model.dc_value_probs[5], true, true);
    var val = expand_token_bc(bc, model.dc_value_probs, token, 6);
    coeffs[0] = val;
    fstate.last_idx[fstate.ctx_idx] = 0;
    var idx = 1;
    var last_val = val;
    while (idx < 64) {
      var ac_band = VP6_IDX_TO_AC_BAND[idx];
      var ac_mode = Math.min(Math.abs(last_val), 2);
      var has_nnz = (idx == 1) || (last_val != 0);
      var _token = decode_token_bc(bc, model.ac_val_probs[ac_mode][ac_band], model.ac_val_probs[ac_mode][ac_band][5], false, has_nnz);
      if (_token == 42) break;
      var _val = expand_token_bc(bc, model.ac_val_probs[ac_mode][ac_band], _token, 6);
      coeffs[vp6model.zigzag[idx]] = _val * fstate.ac_quant;
      idx += 1;
      last_val = _val;
      if (_val == 0) {
        idx += decode_zero_run_bc(bc, vp6model.zero_run_probs[(idx >= 7) ? 1 : 0]);
        validate(idx <= 64);
      }
    }
    fstate.coeff_cat[fstate.ctx_idx][0] = (coeffs[0] != 0) ? 1 : 0;
    fstate.top_ctx = fstate.coeff_cat[fstate.ctx_idx][0];
    fstate.last_idx[fstate.ctx_idx] = idx;
  }
  VP6BR.prototype.decode_block_huff = function(br, coeffs, vp6model, model, fstate) {
	var plane = ((fstate.plane == 0) || (fstate.plane == 3)) ? 0 : 1;
    var last_val;
    if (fstate.dc_zero_run[plane] == 0) {
      var t = decode_token_huff(br, model.dc_token_tree[plane]);
      if (t[1]) {
        return;
      }
      last_val = t[0];
      coeffs[0] = t[0];
      if (t[0] == 0) {
        fstate.dc_zero_run[plane] = decode_eob_run_huff(br);
      }
    } else {
      last_val = 0;
      fstate.dc_zero_run[plane] -= 1;
    }
    if (fstate.ac_zero_run[plane] > 0) {
      fstate.ac_zero_run[plane] -= 1;
      fstate.last_idx[fstate.ctx_idx] = 0;
      return;
    }
    var idx = 1;
    while (idx < 64) {
      var ac_band = Math.min(VP6_IDX_TO_AC_BAND[idx], 3);
      var ac_mode = Math.min(Math.abs(last_val), 2);
      var t = decode_token_huff(br, model.ac_token_tree[plane][ac_mode][ac_band]);
      if (t[1]) {
        if (idx == 1) {
          fstate.ac_zero_run[plane] = decode_eob_run_huff(br);
        }
        break;
      }
      coeffs[vp6model.zigzag[idx]] = t[0] * fstate.ac_quant;
      idx += 1;
      last_val = t[0];
      if (t[0] == 0) {
        idx += decode_zero_run_huff(br, model.zero_run_tree[(idx >= 7) ? 1 : 0]);
        if (!(idx <= 64)) throw new Error("ValidationError");
      }
    }
    fstate.last_idx[fstate.ctx_idx] = idx;
  }
  VP6BR.prototype.mc_block = function(dst, mc_buf, src, plane, x, y, mv, loop_str) {
    var is_luma = (plane != 1) && (plane != 2);
    var sx, sy, mx, my, msx, msy;
    if (is_luma) {
      sx = mv.x >> 2;
      sy = mv.y >> 2;
      mx = (mv.x & 3) << 1;
      my = (mv.y & 3) << 1;
      msx = (mv.x / 4) | 0;
      msy = (mv.y / 4) | 0;
    } else {
      sx = mv.x >> 3;
      sy = mv.y >> 3;
      mx = mv.x & 7;
      my = mv.y & 7;
      msx = (mv.x / 8) | 0;
      msy = (mv.y / 8) | 0;
    }
    var tmp_blk = mc_buf.get_data();
    get_block(tmp_blk, 16, src, plane, x, y, sx, sy);
    if ((msx & 7) != 0) {
      var foff = (8 - (sx & 7));
      var off = 2 + foff;
      vp31_loop_filter(tmp_blk, off, 1, 16, 12, loop_str);
    }
    if ((msy & 7) != 0) {
      var foff = (8 - (sy & 7));
      var off = (2 + foff) * 16;
      vp31_loop_filter(tmp_blk, off, 16, 1, 12, loop_str);
    }
    var copy_mode = (mx == 0) && (my == 0);
    var bicubic = !copy_mode && is_luma && this.bicubic;
    if (is_luma && !copy_mode && (this.profile == VP6_ADVANCED_PROFILE)) {
      if (!this.autosel_pm) {
        bicubic = true;
      } else {
        var mv_limit = 1 << (this.mv_thresh + 1);
        if ((Math.abs(mv.x) <= mv_limit) && (Math.abs(mv.y) <= mv_limit)) {
          var var_off = 16 * 2 + 2;
          if (mv.x < 0) var_off += 1;
          if (mv.y < 0) var_off += 16;
          var _var = calc_variance(var_off, tmp_blk, 16);
          if (_var >= this.var_thresh) {
            bicubic = true;
          }
        }
      }
    }
    var dstride = dst.stride[plane];
    var dbuf = dst.data;
    var dbuf_offest = dst.offset[plane] + x + y * dstride;
    if (copy_mode) {
      var src_offest = 2 * 16 + 2;
      var dline_offest = 0;
      var sline_offest = 0;
      for (var _ = 0; _ < 8; _++) {
        dbuf[(dbuf_offest + dline_offest) + 0] = tmp_blk[(src_offest + sline_offest) + 0];
        dbuf[(dbuf_offest + dline_offest) + 1] = tmp_blk[(src_offest + sline_offest) + 1];
        dbuf[(dbuf_offest + dline_offest) + 2] = tmp_blk[(src_offest + sline_offest) + 2];
        dbuf[(dbuf_offest + dline_offest) + 3] = tmp_blk[(src_offest + sline_offest) + 3];
        dbuf[(dbuf_offest + dline_offest) + 4] = tmp_blk[(src_offest + sline_offest) + 4];
        dbuf[(dbuf_offest + dline_offest) + 5] = tmp_blk[(src_offest + sline_offest) + 5];
        dbuf[(dbuf_offest + dline_offest) + 6] = tmp_blk[(src_offest + sline_offest) + 6];
        dbuf[(dbuf_offest + dline_offest) + 7] = tmp_blk[(src_offest + sline_offest) + 7];
        dline_offest += dst.stride[plane];
        sline_offest += 16;
      }
    } else if (bicubic) {
      var coeff_h = VP6_BICUBIC_COEFFS[this.filter_alpha][mx];
      var coeff_v = VP6_BICUBIC_COEFFS[this.filter_alpha][my];
      mc_bicubic(dbuf_offest, dbuf, dstride, tmp_blk, 16 * 2 + 2, 16, coeff_h, coeff_v);
    } else {
      mc_bilinear(dbuf_offest, dbuf, dstride, tmp_blk, 16 * 2 + 2, 16, mx, my);
    }
  }
  return {
    VP56Decoder: VP56Decoder,
    VP6BR: VP6BR,
    NADecoderSupport: NADecoderSupport,
    BoolCoder: BoolCoder,
    NAVideoInfo: NAVideoInfo,
    YUV420_FORMAT: YUV420_FORMAT,
    VP_YUVA420_FORMAT: VP_YUVA420_FORMAT
  };
}());
	
	var AT_JPG_Decoder = function() {
		var dctZigZag = new Int32Array([0, 1, 8, 16, 9, 2, 3, 10, 17, 24, 32, 25, 18, 11, 4, 5, 12, 19, 26, 33, 40, 48, 41, 34, 27, 20, 13, 6, 7, 14, 21, 28, 35, 42, 49, 56, 57, 50, 43, 36, 29, 22, 15, 23, 30, 37, 44, 51, 58, 59, 52, 45, 38, 31, 39, 46, 53, 60, 61, 54, 47, 55, 62, 63]);
		var dctCos1 = 4017;
		var dctSin1 = 799;
		var dctCos3 = 3406;
		var dctSin3 = 2276;
		var dctCos6 = 1567;
		var dctSin6 = 3784;
		var dctSqrt2 = 5793;
		var dctSqrt1d2 = 2896;
		function constructor() {}
		function buildHuffmanTable(codeLengths, values) {
			var k = 0, code = [], i, j, length = 16;
			while (length > 0 && !codeLengths[length - 1])
				length--;
			code.push({
				children: [],
				index: 0
			});
			var p = code[0], q;
			for (i = 0; i < length; i++) {
				for (j = 0; j < codeLengths[i]; j++) {
					p = code.pop();
					p.children[p.index] = values[k];
					while (p.index > 0) {
						p = code.pop()
					}
					p.index++;
					code.push(p);
					while (code.length <= i) {
						code.push(q = {
							children: [],
							index: 0
						});
						p.children[p.index] = q.children;
						p = q
					}
					k++
				}
				if (i + 1 < length) {
					code.push(q = {
						children: [],
						index: 0
					});
					p.children[p.index] = q.children;
					p = q
				}
			}
			return code[0].children
		}
		function decodeScan(data, offset, frame, components, resetInterval, spectralStart, spectralEnd, successivePrev, successive) {
			var precision = frame.precision;
			var samplesPerLine = frame.samplesPerLine;
			var scanLines = frame.scanLines;
			var mcusPerLine = frame.mcusPerLine;
			var progressive = frame.progressive;
			var maxH = frame.maxH
			  , maxV = frame.maxV;
			var startOffset = offset
			  , bitsData = 0
			  , bitsCount = 0;
			function readBit() {
				if (bitsCount > 0) {
					bitsCount--;
					return bitsData >> bitsCount & 1
				}
				bitsData = data[offset++];
				if (bitsData == 255) {
					var nextByte = data[offset++];
					if (nextByte) {
						throw new Error("unexpected marker: " + (bitsData << 8 | nextByte).toString(16))
					}
				}
				bitsCount = 7;
				return bitsData >>> 7
			}
			function decodeHuffman(tree) {
				var node = tree, bit;
				while ((bit = readBit()) !== null) {
					node = node[bit];
					if (typeof node === "number")
						return node;
					if (typeof node !== "object")
						throw new Error("invalid huffman sequence")
				}
				return null
			}
			function receive(length) {
				var n = 0;
				while (length > 0) {
					var bit = readBit();
					if (bit === null)
						return;
					n = n << 1 | bit;
					length--
				}
				return n
			}
			function receiveAndExtend(length) {
				var n = receive(length);
				if (n >= 1 << length - 1)
					return n;
				return n + (-1 << length) + 1
			}
			function decodeBaseline(component, zz) {
				var t = decodeHuffman(component.huffmanTableDC);
				var diff = t === 0 ? 0 : receiveAndExtend(t);
				zz[0] = component.pred += diff;
				var k = 1;
				while (k < 64) {
					var rs = decodeHuffman(component.huffmanTableAC);
					var s = rs & 15
					  , r = rs >> 4;
					if (s === 0) {
						if (r < 15)
							break;
						k += 16;
						continue
					}
					k += r;
					var z = dctZigZag[k];
					zz[z] = receiveAndExtend(s);
					k++
				}
			}
			function decodeDCFirst(component, zz) {
				var t = decodeHuffman(component.huffmanTableDC);
				var diff = t === 0 ? 0 : receiveAndExtend(t) << successive;
				zz[0] = component.pred += diff
			}
			function decodeDCSuccessive(component, zz) {
				zz[0] |= readBit() << successive
			}
			var eobrun = 0;
			function decodeACFirst(component, zz) {
				if (eobrun > 0) {
					eobrun--;
					return
				}
				var k = spectralStart
				  , e = spectralEnd;
				while (k <= e) {
					var rs = decodeHuffman(component.huffmanTableAC);
					var s = rs & 15
					  , r = rs >> 4;
					if (s === 0) {
						if (r < 15) {
							eobrun = receive(r) + (1 << r) - 1;
							break
						}
						k += 16;
						continue
					}
					k += r;
					var z = dctZigZag[k];
					zz[z] = receiveAndExtend(s) * (1 << successive);
					k++
				}
			}
			var successiveACState = 0, successiveACNextValue;
			function decodeACSuccessive(component, zz) {
				var k = spectralStart
				  , e = spectralEnd
				  , r = 0;
				while (k <= e) {
					var z = dctZigZag[k];
					var direction = zz[z] < 0 ? -1 : 1;
					switch (successiveACState) {
					case 0:
						var rs = decodeHuffman(component.huffmanTableAC);
						var s = rs & 15
						  , r = rs >> 4;
						if (s === 0) {
							if (r < 15) {
								eobrun = receive(r) + (1 << r);
								successiveACState = 4
							} else {
								r = 16;
								successiveACState = 1
							}
						} else {
							if (s !== 1)
								throw new Error("invalid ACn encoding");
							successiveACNextValue = receiveAndExtend(s);
							successiveACState = r ? 2 : 3
						}
						continue;
					case 1:
					case 2:
						if (zz[z])
							zz[z] += (readBit() << successive) * direction;
						else {
							r--;
							if (r === 0)
								successiveACState = successiveACState == 2 ? 3 : 0
						}
						break;
					case 3:
						if (zz[z])
							zz[z] += (readBit() << successive) * direction;
						else {
							zz[z] = successiveACNextValue << successive;
							successiveACState = 0
						}
						break;
					case 4:
						if (zz[z])
							zz[z] += (readBit() << successive) * direction;
						break
					}
					k++
				}
				if (successiveACState === 4) {
					eobrun--;
					if (eobrun === 0)
						successiveACState = 0
				}
			}
			function decodeMcu(component, decode, mcu, row, col) {
				var mcuRow = mcu / mcusPerLine | 0;
				var mcuCol = mcu % mcusPerLine;
				var blockRow = mcuRow * component.v + row;
				var blockCol = mcuCol * component.h + col;
				decode(component, component.blocks[blockRow][blockCol])
			}
			function decodeBlock(component, decode, mcu) {
				var blockRow = mcu / component.blocksPerLine | 0;
				var blockCol = mcu % component.blocksPerLine;
				decode(component, component.blocks[blockRow][blockCol])
			}
			var componentsLength = components.length;
			var component, i, j, k, n;
			var decodeFn;
			if (progressive) {
				if (spectralStart === 0)
					decodeFn = successivePrev === 0 ? decodeDCFirst : decodeDCSuccessive;
				else
					decodeFn = successivePrev === 0 ? decodeACFirst : decodeACSuccessive
			} else {
				decodeFn = decodeBaseline
			}
			var mcu = 0, marker;
			var mcuExpected;
			if (componentsLength == 1) {
				mcuExpected = components[0].blocksPerLine * components[0].blocksPerColumn
			} else {
				mcuExpected = mcusPerLine * frame.mcusPerColumn
			}
			if (!resetInterval)
				resetInterval = mcuExpected;
			var h, v;
			while (mcu < mcuExpected) {
				for (i = 0; i < componentsLength; i++)
					components[i].pred = 0;
				eobrun = 0;
				if (componentsLength == 1) {
					component = components[0];
					for (n = 0; n < resetInterval; n++) {
						decodeBlock(component, decodeFn, mcu);
						mcu++
					}
				} else {
					for (n = 0; n < resetInterval; n++) {
						for (i = 0; i < componentsLength; i++) {
							component = components[i];
							h = component.h;
							v = component.v;
							for (j = 0; j < v; j++) {
								for (k = 0; k < h; k++) {
									decodeMcu(component, decodeFn, mcu, j, k)
								}
							}
						}
						mcu++;
						if (mcu === mcuExpected)
							break
					}
				}
				bitsCount = 0;
				marker = data[offset] << 8 | data[offset + 1];
				if (marker < 65280) {
					throw new Error("marker was not found")
				}
				if (marker >= 65488 && marker <= 65495) {
					offset += 2
				} else
					break
			}
			return offset - startOffset
		}
		var bcd_R = new Int32Array(64), bcd_r = new Uint8Array(64);
		function buildComponentData(frame, component) {
			var lines = [];
			var blocksPerLine = component.blocksPerLine;
			var blocksPerColumn = component.blocksPerColumn;
			var samplesPerLine = blocksPerLine << 3;
			function quantizeAndInverse(zz, dataOut, dataIn) {
				var qt = component.quantizationTable;
				var v0, v1, v2, v3, v4, v5, v6, v7, t;
				var p = dataIn;
				var i;
				for (i = 0; i < 64; i++)
					p[i] = zz[i] * qt[i];
				for (i = 0; i < 8; ++i) {
					var row = 8 * i;
					if (p[1 + row] == 0 && p[2 + row] == 0 && p[3 + row] == 0 && p[4 + row] == 0 && p[5 + row] == 0 && p[6 + row] == 0 && p[7 + row] == 0) {
						t = dctSqrt2 * p[0 + row] + 512 >> 10;
						p[0 + row] = t;
						p[1 + row] = t;
						p[2 + row] = t;
						p[3 + row] = t;
						p[4 + row] = t;
						p[5 + row] = t;
						p[6 + row] = t;
						p[7 + row] = t;
						continue
					}
					v0 = dctSqrt2 * p[0 + row] + 128 >> 8;
					v1 = dctSqrt2 * p[4 + row] + 128 >> 8;
					v2 = p[2 + row];
					v3 = p[6 + row];
					v4 = dctSqrt1d2 * (p[1 + row] - p[7 + row]) + 128 >> 8;
					v7 = dctSqrt1d2 * (p[1 + row] + p[7 + row]) + 128 >> 8;
					v5 = p[3 + row] << 4;
					v6 = p[5 + row] << 4;
					t = v0 - v1 + 1 >> 1;
					v0 = v0 + v1 + 1 >> 1;
					v1 = t;
					t = v2 * dctSin6 + v3 * dctCos6 + 128 >> 8;
					v2 = v2 * dctCos6 - v3 * dctSin6 + 128 >> 8;
					v3 = t;
					t = v4 - v6 + 1 >> 1;
					v4 = v4 + v6 + 1 >> 1;
					v6 = t;
					t = v7 + v5 + 1 >> 1;
					v5 = v7 - v5 + 1 >> 1;
					v7 = t;
					t = v0 - v3 + 1 >> 1;
					v0 = v0 + v3 + 1 >> 1;
					v3 = t;
					t = v1 - v2 + 1 >> 1;
					v1 = v1 + v2 + 1 >> 1;
					v2 = t;
					t = v4 * dctSin3 + v7 * dctCos3 + 2048 >> 12;
					v4 = v4 * dctCos3 - v7 * dctSin3 + 2048 >> 12;
					v7 = t;
					t = v5 * dctSin1 + v6 * dctCos1 + 2048 >> 12;
					v5 = v5 * dctCos1 - v6 * dctSin1 + 2048 >> 12;
					v6 = t;
					p[0 + row] = v0 + v7;
					p[7 + row] = v0 - v7;
					p[1 + row] = v1 + v6;
					p[6 + row] = v1 - v6;
					p[2 + row] = v2 + v5;
					p[5 + row] = v2 - v5;
					p[3 + row] = v3 + v4;
					p[4 + row] = v3 - v4
				}
				for (i = 0; i < 8; ++i) {
					var col = i;
					if (p[1 * 8 + col] == 0 && p[2 * 8 + col] == 0 && p[3 * 8 + col] == 0 && p[4 * 8 + col] == 0 && p[5 * 8 + col] == 0 && p[6 * 8 + col] == 0 && p[7 * 8 + col] == 0) {
						t = dctSqrt2 * dataIn[i + 0] + 8192 >> 14;
						p[0 * 8 + col] = t;
						p[1 * 8 + col] = t;
						p[2 * 8 + col] = t;
						p[3 * 8 + col] = t;
						p[4 * 8 + col] = t;
						p[5 * 8 + col] = t;
						p[6 * 8 + col] = t;
						p[7 * 8 + col] = t;
						continue
					}
					v0 = dctSqrt2 * p[0 * 8 + col] + 2048 >> 12;
					v1 = dctSqrt2 * p[4 * 8 + col] + 2048 >> 12;
					v2 = p[2 * 8 + col];
					v3 = p[6 * 8 + col];
					v4 = dctSqrt1d2 * (p[1 * 8 + col] - p[7 * 8 + col]) + 2048 >> 12;
					v7 = dctSqrt1d2 * (p[1 * 8 + col] + p[7 * 8 + col]) + 2048 >> 12;
					v5 = p[3 * 8 + col];
					v6 = p[5 * 8 + col];
					t = v0 - v1 + 1 >> 1;
					v0 = v0 + v1 + 1 >> 1;
					v1 = t;
					t = v2 * dctSin6 + v3 * dctCos6 + 2048 >> 12;
					v2 = v2 * dctCos6 - v3 * dctSin6 + 2048 >> 12;
					v3 = t;
					t = v4 - v6 + 1 >> 1;
					v4 = v4 + v6 + 1 >> 1;
					v6 = t;
					t = v7 + v5 + 1 >> 1;
					v5 = v7 - v5 + 1 >> 1;
					v7 = t;
					t = v0 - v3 + 1 >> 1;
					v0 = v0 + v3 + 1 >> 1;
					v3 = t;
					t = v1 - v2 + 1 >> 1;
					v1 = v1 + v2 + 1 >> 1;
					v2 = t;
					t = v4 * dctSin3 + v7 * dctCos3 + 2048 >> 12;
					v4 = v4 * dctCos3 - v7 * dctSin3 + 2048 >> 12;
					v7 = t;
					t = v5 * dctSin1 + v6 * dctCos1 + 2048 >> 12;
					v5 = v5 * dctCos1 - v6 * dctSin1 + 2048 >> 12;
					v6 = t;
					p[0 * 8 + col] = v0 + v7;
					p[7 * 8 + col] = v0 - v7;
					p[1 * 8 + col] = v1 + v6;
					p[6 * 8 + col] = v1 - v6;
					p[2 * 8 + col] = v2 + v5;
					p[5 * 8 + col] = v2 - v5;
					p[3 * 8 + col] = v3 + v4;
					p[4 * 8 + col] = v3 - v4
				}
				for (i = 0; i < 64; ++i) {
					var sample = 128 + (p[i] + 8 >> 4);
					dataOut[i] = sample < 0 ? 0 : sample > 255 ? 255 : sample
				}
			}
			var i, j;
			for (var blockRow = 0; blockRow < blocksPerColumn; blockRow++) {
				var scanLine = blockRow << 3;
				for (i = 0; i < 8; i++)
					lines.push(new Uint8Array(samplesPerLine));
				for (var blockCol = 0; blockCol < blocksPerLine; blockCol++) {
					quantizeAndInverse(component.blocks[blockRow][blockCol], bcd_r, bcd_R);
					var offset = 0
					  , sample = blockCol << 3;
					for (j = 0; j < 8; j++) {
						var line = lines[scanLine + j];
						for (i = 0; i < 8; i++)
							line[sample + i] = bcd_r[offset++]
					}
				}
			}
			return lines
		}
		function clampTo8bit(a) {
			return a < 0 ? 0 : a > 255 ? 255 : a
		}
		constructor.prototype = {
			parse: function parse(data) {
				var offset = 0
				  , length = data.length;
				function readUint16() {
					var value = data[offset] << 8 | data[offset + 1];
					offset += 2;
					return value
				}
				function readDataBlock() {
					var length = readUint16();
					var array = data.subarray(offset, offset + length - 2);
					offset += array.length;
					return array
				}
				function prepareComponents(frame) {
					var maxH = 0
					  , maxV = 0;
					var component, componentId;
					for (componentId in frame.components) {
						if (frame.components.hasOwnProperty(componentId)) {
							component = frame.components[componentId];
							if (maxH < component.h)
								maxH = component.h;
							if (maxV < component.v)
								maxV = component.v
						}
					}
					var mcusPerLine = Math.ceil(frame.samplesPerLine / 8 / maxH);
					var mcusPerColumn = Math.ceil(frame.scanLines / 8 / maxV);
					for (componentId in frame.components) {
						if (frame.components.hasOwnProperty(componentId)) {
							component = frame.components[componentId];
							var blocksPerLine = Math.ceil(Math.ceil(frame.samplesPerLine / 8) * component.h / maxH);
							var blocksPerColumn = Math.ceil(Math.ceil(frame.scanLines / 8) * component.v / maxV);
							var blocksPerLineForMcu = mcusPerLine * component.h;
							var blocksPerColumnForMcu = mcusPerColumn * component.v;
							var blocks = [];
							for (var i = 0; i < blocksPerColumnForMcu; i++) {
								var row = [];
								for (var j = 0; j < blocksPerLineForMcu; j++)
									row.push(new Int32Array(64));
								blocks.push(row)
							}
							component.blocksPerLine = blocksPerLine;
							component.blocksPerColumn = blocksPerColumn;
							component.blocks = blocks
						}
					}
					frame.maxH = maxH;
					frame.maxV = maxV;
					frame.mcusPerLine = mcusPerLine;
					frame.mcusPerColumn = mcusPerColumn
				}
				var jfif = null;
				var adobe = null;
				var pixels = null;
				var frame, resetInterval;
				var quantizationTables = []
				  , frames = [];
				var huffmanTablesAC = []
				  , huffmanTablesDC = [];
				var fileMarker = readUint16();
				if (fileMarker != 65496) {
					throw new Error("SOI not found")
				}
				fileMarker = readUint16();
				while (fileMarker != 65497) {
					var i, j, l;
					switch (fileMarker) {
					case 65280:
						break;
					case 65504:
					case 65505:
					case 65506:
					case 65507:
					case 65508:
					case 65509:
					case 65510:
					case 65511:
					case 65512:
					case 65513:
					case 65514:
					case 65515:
					case 65516:
					case 65517:
					case 65518:
					case 65519:
					case 65534:
						var appData = readDataBlock();
						if (fileMarker === 65504) {
							if (appData[0] === 74 && appData[1] === 70 && appData[2] === 73 && appData[3] === 70 && appData[4] === 0) {
								jfif = {
									version: {
										major: appData[5],
										minor: appData[6]
									},
									densityUnits: appData[7],
									xDensity: appData[8] << 8 | appData[9],
									yDensity: appData[10] << 8 | appData[11],
									thumbWidth: appData[12],
									thumbHeight: appData[13],
									thumbData: appData.subarray(14, 14 + 3 * appData[12] * appData[13])
								}
							}
						}
						if (fileMarker === 65518) {
							if (appData[0] === 65 && appData[1] === 100 && appData[2] === 111 && appData[3] === 98 && appData[4] === 101 && appData[5] === 0) {
								adobe = {
									version: appData[6],
									flags0: appData[7] << 8 | appData[8],
									flags1: appData[9] << 8 | appData[10],
									transformCode: appData[11]
								}
							}
						}
						break;
					case 65499:
						var quantizationTablesLength = readUint16();
						var quantizationTablesEnd = quantizationTablesLength + offset - 2;
						while (offset < quantizationTablesEnd) {
							var quantizationTableSpec = data[offset++];
							var tableData = new Int32Array(64);
							if (quantizationTableSpec >> 4 === 0) {
								for (j = 0; j < 64; j++) {
									var z = dctZigZag[j];
									tableData[z] = data[offset++]
								}
							} else if (quantizationTableSpec >> 4 === 1) {
								for (j = 0; j < 64; j++) {
									var z = dctZigZag[j];
									tableData[z] = readUint16()
								}
							} else
								throw new Error("DQT: invalid table spec");
							quantizationTables[quantizationTableSpec & 15] = tableData
						}
						break;
					case 65472:
					case 65473:
					case 65474:
						readUint16();
						frame = {};
						frame.extended = fileMarker === 65473;
						frame.progressive = fileMarker === 65474;
						frame.precision = data[offset++];
						frame.scanLines = readUint16();
						frame.samplesPerLine = readUint16();
						frame.components = {};
						frame.componentsOrder = [];
						var componentsCount = data[offset++], componentId;
						var maxH = 0
						  , maxV = 0;
						for (i = 0; i < componentsCount; i++) {
							componentId = data[offset];
							var h = data[offset + 1] >> 4;
							var v = data[offset + 1] & 15;
							var qId = data[offset + 2];
							frame.componentsOrder.push(componentId);
							frame.components[componentId] = {
								h: h,
								v: v,
								quantizationIdx: qId
							};
							offset += 3
						}
						prepareComponents(frame);
						frames.push(frame);
						break;
					case 65476:
						var huffmanLength = readUint16();
						for (i = 2; i < huffmanLength; ) {
							var huffmanTableSpec = data[offset++];
							var codeLengths = new Uint8Array(16);
							var codeLengthSum = 0;
							for (j = 0; j < 16; j++,
							offset++)
								codeLengthSum += codeLengths[j] = data[offset];
							var huffmanValues = new Uint8Array(codeLengthSum);
							for (j = 0; j < codeLengthSum; j++,
							offset++)
								huffmanValues[j] = data[offset];
							i += 17 + codeLengthSum;
							(huffmanTableSpec >> 4 === 0 ? huffmanTablesDC : huffmanTablesAC)[huffmanTableSpec & 15] = buildHuffmanTable(codeLengths, huffmanValues)
						}
						break;
					case 65501:
						readUint16();
						resetInterval = readUint16();
						break;
					case 65498:
						var scanLength = readUint16();
						var selectorsCount = data[offset++];
						var components = [], component;
						for (i = 0; i < selectorsCount; i++) {
							component = frame.components[data[offset++]];
							var tableSpec = data[offset++];
							component.huffmanTableDC = huffmanTablesDC[tableSpec >> 4];
							component.huffmanTableAC = huffmanTablesAC[tableSpec & 15];
							components.push(component)
						}
						var spectralStart = data[offset++];
						var spectralEnd = data[offset++];
						var successiveApproximation = data[offset++];
						var processed = decodeScan(data, offset, frame, components, resetInterval, spectralStart, spectralEnd, successiveApproximation >> 4, successiveApproximation & 15);
						offset += processed;
						break;
					default:
						if (data[offset - 3] == 255 && data[offset - 2] >= 192 && data[offset - 2] <= 254) {
							offset -= 3;
							break
						}
						throw new Error("unknown JPEG marker " + fileMarker.toString(16))
					}
					fileMarker = readUint16()
				}
				if (frames.length != 1)
					throw new Error("only single frame JPEGs supported");
				for (var i = 0; i < frames.length; i++) {
					var cp = frames[i].components;
					for (var j in cp) {
						cp[j].quantizationTable = quantizationTables[cp[j].quantizationIdx];
						delete cp[j].quantizationIdx
					}
				}
				this.width = frame.samplesPerLine;
				this.height = frame.scanLines;
				this.jfif = jfif;
				this.adobe = adobe;
				this.components = [];
				for (var i = 0; i < frame.componentsOrder.length; i++) {
					var component = frame.components[frame.componentsOrder[i]];
					this.components.push({
						lines: buildComponentData(frame, component),
						scaleX: component.h / frame.maxH,
						scaleY: component.v / frame.maxV
					})
				}
			},
			getData: function getData(width, height) {
				var scaleX = this.width / width
				  , scaleY = this.height / height;
				var component1, component2, component3, component4;
				var component1Line, component2Line, component3Line, component4Line;
				var x, y;
				var offset = 0;
				var Y, Cb, Cr, K, C, M, Ye, R, G, B;
				var colorTransform;
				var dataLength = width * height * this.components.length;
				var data = new Uint8Array(dataLength);
				switch (this.components.length) {
				case 1:
					component1 = this.components[0];
					for (y = 0; y < height; y++) {
						component1Line = component1.lines[0 | y * component1.scaleY * scaleY];
						for (x = 0; x < width; x++) {
							Y = component1Line[0 | x * component1.scaleX * scaleX];
							data[offset++] = Y
						}
					}
					break;
				case 2:
					component1 = this.components[0];
					component2 = this.components[1];
					for (y = 0; y < height; y++) {
						component1Line = component1.lines[0 | y * component1.scaleY * scaleY];
						component2Line = component2.lines[0 | y * component2.scaleY * scaleY];
						for (x = 0; x < width; x++) {
							Y = component1Line[0 | x * component1.scaleX * scaleX];
							data[offset++] = Y;
							Y = component2Line[0 | x * component2.scaleX * scaleX];
							data[offset++] = Y
						}
					}
					break;
				case 3:
					colorTransform = true;
					if (this.adobe && this.adobe.transformCode)
						colorTransform = true;
					else if (typeof this.colorTransform !== "undefined")
						colorTransform = !!this.colorTransform;
					component1 = this.components[0];
					component2 = this.components[1];
					component3 = this.components[2];
					for (y = 0; y < height; y++) {
						component1Line = component1.lines[0 | y * component1.scaleY * scaleY];
						component2Line = component2.lines[0 | y * component2.scaleY * scaleY];
						component3Line = component3.lines[0 | y * component3.scaleY * scaleY];
						for (x = 0; x < width; x++) {
							if (!colorTransform) {
								R = component1Line[0 | x * component1.scaleX * scaleX];
								G = component2Line[0 | x * component2.scaleX * scaleX];
								B = component3Line[0 | x * component3.scaleX * scaleX]
							} else {
								Y = component1Line[0 | x * component1.scaleX * scaleX];
								Cb = component2Line[0 | x * component2.scaleX * scaleX];
								Cr = component3Line[0 | x * component3.scaleX * scaleX];
								R = clampTo8bit(Y + 1.402 * (Cr - 128));
								G = clampTo8bit(Y - .3441363 * (Cb - 128) - .71413636 * (Cr - 128));
								B = clampTo8bit(Y + 1.772 * (Cb - 128))
							}
							data[offset++] = R;
							data[offset++] = G;
							data[offset++] = B
						}
					}
					break;
				case 4:
					if (!this.adobe)
						throw "Unsupported color mode (4 components)";
					colorTransform = false;
					if (this.adobe && this.adobe.transformCode)
						colorTransform = true;
					else if (typeof this.colorTransform !== "undefined")
						colorTransform = !!this.colorTransform;
					component1 = this.components[0];
					component2 = this.components[1];
					component3 = this.components[2];
					component4 = this.components[3];
					for (y = 0; y < height; y++) {
						component1Line = component1.lines[0 | y * component1.scaleY * scaleY];
						component2Line = component2.lines[0 | y * component2.scaleY * scaleY];
						component3Line = component3.lines[0 | y * component3.scaleY * scaleY];
						component4Line = component4.lines[0 | y * component4.scaleY * scaleY];
						for (x = 0; x < width; x++) {
							if (!colorTransform) {
								C = component1Line[0 | x * component1.scaleX * scaleX];
								M = component2Line[0 | x * component2.scaleX * scaleX];
								Ye = component3Line[0 | x * component3.scaleX * scaleX];
								K = component4Line[0 | x * component4.scaleX * scaleX]
							} else {
								Y = component1Line[0 | x * component1.scaleX * scaleX];
								Cb = component2Line[0 | x * component2.scaleX * scaleX];
								Cr = component3Line[0 | x * component3.scaleX * scaleX];
								K = component4Line[0 | x * component4.scaleX * scaleX];
								C = 255 - clampTo8bit(Y + 1.402 * (Cr - 128));
								M = 255 - clampTo8bit(Y - .3441363 * (Cb - 128) - .71413636 * (Cr - 128));
								Ye = 255 - clampTo8bit(Y + 1.772 * (Cb - 128))
							}
							data[offset++] = 255 - C;
							data[offset++] = 255 - M;
							data[offset++] = 255 - Ye;
							data[offset++] = 255 - K
						}
					}
					break;
				default:
					throw "Unsupported color mode"
				}
				return data
			},
			copyToImageData: function copyToImageData(imageData) {
				var width = imageData.width
				  , height = imageData.height;
				var imageDataArray = imageData.data;
				var data = this.getData(width, height);
				var i = 0, j = 0, x, y;
				var Y, K, C, M, R, G, B;
				switch (this.components.length) {
				case 1:
					for (y = 0; y < height; y++) {
						for (x = 0; x < width; x++) {
							Y = data[i++];
							imageDataArray[j++] = Y;
							imageDataArray[j++] = Y;
							imageDataArray[j++] = Y;
							imageDataArray[j++] = 255
						}
					}
					break;
				case 3:
					for (y = 0; y < height; y++) {
						for (x = 0; x < width; x++) {
							R = data[i++];
							G = data[i++];
							B = data[i++];
							imageDataArray[j++] = R;
							imageDataArray[j++] = G;
							imageDataArray[j++] = B;
							imageDataArray[j++] = 255
						}
					}
					break;
				case 4:
					for (y = 0; y < height; y++) {
						for (x = 0; x < width; x++) {
							C = data[i++];
							M = data[i++];
							Y = data[i++];
							K = data[i++];
							R = 255 - clampTo8bit(C * (1 - K / 255) + K);
							G = 255 - clampTo8bit(M * (1 - K / 255) + K);
							B = 255 - clampTo8bit(Y * (1 - K / 255) + K);
							imageDataArray[j++] = R;
							imageDataArray[j++] = G;
							imageDataArray[j++] = B;
							imageDataArray[j++] = 255
						}
					}
					break;
				default:
					throw "Unsupported color mode"
				}
			}
		};
		function jpeg_decode(jpegData) {
			var decoder = new constructor;
			decoder.parse(jpegData);
			var image = {
				width: decoder.width,
				height: decoder.height,
				data: new Uint8Array(decoder.width * decoder.height * 4)
			};
			decoder.copyToImageData(image);
			return image
		};
		return {
			decode: jpeg_decode
		}
	}();

	var GifReader = function(buf) {
		var p = 0;
		if (buf[p++] !== 71 || buf[p++] !== 73 || buf[p++] !== 70 || buf[p++] !== 56 || (buf[p++] + 1 & 253) !== 56 || buf[p++] !== 97) {
			throw "Invalid GIF 87a/89a header."
		}
		var width = buf[p++] | buf[p++] << 8;
		var height = buf[p++] | buf[p++] << 8;
		var pf0 = buf[p++];
		var global_palette_flag = pf0 >> 7;
		var num_global_colors_pow2 = pf0 & 7;
		var num_global_colors = 1 << num_global_colors_pow2 + 1;
		var background = buf[p++];
		buf[p++];
		var global_palette_offset = null;
		if (global_palette_flag) {
			global_palette_offset = p;
			p += num_global_colors * 3
		}
		var no_eof = true;
		var frames = [];
		var delay = 0;
		var transparent_index = null;
		var disposal = 0;
		var loop_count = null;
		this.width = width;
		this.height = height;
		while (no_eof && p < buf.length) {
			switch (buf[p++]) {
			case 33:
				switch (buf[p++]) {
				case 255:
					if (buf[p] !== 11 || buf[p + 1] == 78 && buf[p + 2] == 69 && buf[p + 3] == 84 && buf[p + 4] == 83 && buf[p + 5] == 67 && buf[p + 6] == 65 && buf[p + 7] == 80 && buf[p + 8] == 69 && buf[p + 9] == 50 && buf[p + 10] == 46 && buf[p + 11] == 48 && buf[p + 12] == 3 && buf[p + 13] == 1 && buf[p + 16] == 0) {
						p += 14;
						loop_count = buf[p++] | buf[p++] << 8;
						p++
					} else {
						p += 12;
						while (true) {
							var block_size = buf[p++];
							if (block_size === 0)
								break;
							p += block_size
						}
					}
					break;
				case 249:
					if (buf[p++] !== 4 || buf[p + 4] !== 0)
						throw "Invalid graphics extension block.";
					var pf1 = buf[p++];
					delay = buf[p++] | buf[p++] << 8;
					transparent_index = buf[p++];
					if ((pf1 & 1) === 0)
						transparent_index = null;
					disposal = pf1 >> 2 & 7;
					p++;
					break;
				case 254:
					while (true) {
						var block_size = buf[p++];
						if (block_size === 0)
							break;
						p += block_size
					}
					break;
				default:
					throw "Unknown graphic control label: 0x" + buf[p - 1].toString(16)
				}
				break;
			case 44:
				var x = buf[p++] | buf[p++] << 8;
				var y = buf[p++] | buf[p++] << 8;
				var w = buf[p++] | buf[p++] << 8;
				var h = buf[p++] | buf[p++] << 8;
				var pf2 = buf[p++];
				var local_palette_flag = pf2 >> 7;
				var interlace_flag = pf2 >> 6 & 1;
				var num_local_colors_pow2 = pf2 & 7;
				var num_local_colors = 1 << num_local_colors_pow2 + 1;
				var palette_offset = global_palette_offset;
				var has_local_palette = false;
				if (local_palette_flag) {
					var has_local_palette = true;
					palette_offset = p;
					p += num_local_colors * 3
				}
				var data_offset = p;
				p++;
				while (true) {
					var block_size = buf[p++];
					if (block_size === 0)
						break;
					p += block_size
				}
				frames.push({
					x: x,
					y: y,
					width: w,
					height: h,
					has_local_palette: has_local_palette,
					palette_offset: palette_offset,
					data_offset: data_offset,
					data_length: p - data_offset,
					transparent_index: transparent_index,
					interlaced: !!interlace_flag,
					delay: delay,
					disposal: disposal
				});
				break;
			case 59:
				no_eof = false;
				break;
			default:
				throw "Unknown gif block: 0x" + buf[p - 1].toString(16);
				break
			}
		}
		;
		this.numFrames = function() {
			return frames.length
		}
		;
		this.loopCount = function() {
			return loop_count
		}
		;
		this.frameInfo = function(frame_num) {
			if (frame_num < 0 || frame_num >= frames.length)
				throw "Frame index out of range.";
			return frames[frame_num]
		}
		;
		this.decodeAndBlitFrameRGBA = function(frame_num, pixels) {
			var frame = this.frameInfo(frame_num);
			var num_pixels = frame.width * frame.height;
			var index_stream = new Uint8Array(num_pixels);
			GifReaderLZWOutputIndexStream(buf, frame.data_offset, index_stream, num_pixels);
			var palette_offset = frame.palette_offset;
			var trans = frame.transparent_index;
			if (trans === null)
				trans = 256;
			var framewidth = frame.width;
			var framestride = width - framewidth;
			var xleft = framewidth;
			var opbeg = (frame.y * width + frame.x) * 4;
			var opend = ((frame.y + frame.height) * width + frame.x) * 4;
			var op = opbeg;
			var scanstride = framestride * 4;
			if (frame.interlaced === true) {
				scanstride += width * 4 * 7
			}
			var interlaceskip = 8;
			for (var i = 0, il = index_stream.length; i < il; ++i) {
				var index = index_stream[i];
				if (xleft === 0) {
					op += scanstride;
					xleft = framewidth;
					if (op >= opend) {
						scanstride = framestride * 4 + width * 4 * (interlaceskip - 1);
						op = opbeg + (framewidth + framestride) * (interlaceskip << 1);
						interlaceskip >>= 1
					}
				}
				if (index === trans) {
					op += 4
				} else {
					var r = buf[palette_offset + index * 3];
					var g = buf[palette_offset + index * 3 + 1];
					var b = buf[palette_offset + index * 3 + 2];
					pixels[op++] = r;
					pixels[op++] = g;
					pixels[op++] = b;
					pixels[op++] = 255
				}
				--xleft
			}
		}
	}
	function GifReaderLZWOutputIndexStream(code_stream, p, output, output_length) {
		var min_code_size = code_stream[p++];
		var clear_code = 1 << min_code_size;
		var eoi_code = clear_code + 1;
		var next_code = eoi_code + 1;
		var cur_code_size = min_code_size + 1;
		var code_mask = (1 << cur_code_size) - 1;
		var cur_shift = 0;
		var cur = 0;
		var op = 0;
		var subblock_size = code_stream[p++];
		var code_table = new Int32Array(4096);
		var prev_code = null;
		while (true) {
			while (cur_shift < 16) {
				if (subblock_size === 0)
					break;
				cur |= code_stream[p++] << cur_shift;
				cur_shift += 8;
				if (subblock_size === 1) {
					subblock_size = code_stream[p++]
				} else {
					--subblock_size
				}
			}
			if (cur_shift < cur_code_size)
				break;
			var code = cur & code_mask;
			cur >>= cur_code_size;
			cur_shift -= cur_code_size;
			if (code === clear_code) {
				next_code = eoi_code + 1;
				cur_code_size = min_code_size + 1;
				code_mask = (1 << cur_code_size) - 1;
				prev_code = null;
				continue
			} else if (code === eoi_code) {
				break
			}
			var chase_code = code < next_code ? code : prev_code;
			var chase_length = 0;
			var chase = chase_code;
			while (chase > clear_code) {
				chase = code_table[chase] >> 8;
				++chase_length
			}
			var k = chase;
			var op_end = op + chase_length + (chase_code !== code ? 1 : 0);
			if (op_end > output_length) {
				console.log("Warning, gif stream longer than expected.");
				return
			}
			output[op++] = k;
			op += chase_length;
			var b = op;
			if (chase_code !== code)
				output[op++] = k;
			chase = chase_code;
			while (chase_length--) {
				chase = code_table[chase];
				output[--b] = chase & 255;
				chase >>= 8
			}
			if (prev_code !== null && next_code < 4096) {
				code_table[next_code++] = prev_code << 8 | k;
				if (next_code >= code_mask + 1 && cur_code_size < 12) {
					++cur_code_size;
					code_mask = code_mask << 1 | 1
				}
			}
			prev_code = code
		}
		if (op !== output_length) {
			console.log("Warning, gif stream shorter than expected.")
		}
		return output
	}

	var AT_UTF_8 = {
		name: "UTF-8",
		decode: function(bytes) {
			return new TextDecoder().decode(bytes.slice(0));
		}
	}
	var AT_WINDOWS_1252 = {
		name: "WINDOWS-1252",
		decode: function(bytes) {
			var t = "";
			for (var i = 0; i < bytes.length; i++) {
				t += String.fromCharCode(bytes[i]);
			}
			return t;
		}
	}
	var SwfEncoding = function() {}
	SwfEncoding.encodingForVersion = function(swf_version) {
		return (swf_version >= 6) ? AT_UTF_8 : AT_WINDOWS_1252;
	}

	var SwfInput = function(data, version) {
		this.byteStream = new ByteStream(data);
		this._swfVersion = version;
	}
	SwfInput.prototype.emitMessage = function(message, type) {
		console.log(type, message);
	}
	SwfInput.prototype.getEncoding = function() {
		return SwfEncoding.encodingForVersion(this._swfVersion);
	}
	SwfInput.prototype.isEmpty = function() {
		return this.byteStream.bytesAvailable <= 0;
	}
	SwfInput.prototype.parseTagList = function() {
		var tags = [];
		while (true) {
			var tag = this.parseTag();
			if (tag.tagcode == 0) break;
			tags.push(tag);
		}
		return tags;
	}
	SwfInput.prototype.parseTag = function() {
		var t = this.parseTagCodeLength();
		var result = this.parseTagWithCode(t.tagcode, t.length);
		result.tagcode = t.tagcode;
		result._byteLength = t.length;
		return result;
	}
	SwfInput.prototype.parseTagCodeLength = function() {
		var tagCodeAndLength = this.byteStream.readUint16();
		var tagcode = tagCodeAndLength >> 6;
		var length = (tagCodeAndLength & 0b111111);
		if (length == 0b111111) {
			// Extended tag.
			length = this.byteStream.readUint32();
		}
		return { tagcode, length };
	}
	SwfInput.prototype.parseTagWithCode = function(tagType, length) {
		var tagReader = new SwfInput(this.byteStream.readBytes(length), this._swfVersion);
		var byteStream = tagReader.byteStream;
		var obj = {};
		switch (tagType) {
			case 0: // End
			case 1: // ShowFrame
				break;
			case 2: // DefineShape
				obj = tagReader.parseDefineShape(1);
				break;
			case 22: // DefineShape2
				obj = tagReader.parseDefineShape(2);
				break;
			case 32: // DefineShape3
				obj = tagReader.parseDefineShape(3);
				break;
			case 83: // DefineShape4
				obj = tagReader.parseDefineShape(4);
				break;
			case 6: // DefineBits
				obj = tagReader.parseDefineBits(1, length);
				break;
			case 21: // DefineBitsJPEG2
				obj = tagReader.parseDefineBits(2, length);
				break;
			case 35: // DefineBitsJPEG3
				obj = tagReader.parseDefineBits(3, length);
				break;
			case 90: // DefineBitsJPEG4
				obj = tagReader.parseDefineBits(4, length);
				break;
			case 7: // DefineButton
				obj = tagReader.parseDefineButton(1, length);
				break;
			case 34: // DefineButton2
				obj = tagReader.parseDefineButton(2, length);
				break;
			case 10: // DefineFont
				obj = tagReader.parseDefineFont1(length);
				break;
			case 48: // DefineFont2
				obj = tagReader.parseDefineFont2(2, length);
				break;
			case 75: // DefineFont3
				obj = tagReader.parseDefineFont2(3, length);
				break;
			case 91: // DefineFont4
				obj = tagReader.parseDefineFont4(length);
				break;
			case 11: // DefineText
				obj = tagReader.parseDefineText(1);
				break;
			case 33: // DefineText2
				obj = tagReader.parseDefineText(2);
				break;
			case 13: // DefineFontInfo
				obj = tagReader.parseDefineFontInfo(1, length);
				break;
			case 62: // DefineFontInfo2
				obj = tagReader.parseDefineFontInfo(2, length);
				break;
			case 14: // DefineSound
				obj = tagReader.parseDefineSound(length);
				break;
			case 17: // DefineButtonSound
				obj = tagReader.parseDefineButtonSound();
				break;
			case 20: // DefineBitsLossless
				obj = tagReader.parseDefineBitsLossLess(1, length);
				break;
			case 36: // DefineBitsLossless2
				obj = tagReader.parseDefineBitsLossLess(2, length);
				break;
			case 23: // DefineButtonCxform
				obj = tagReader.parseDefineButtonCxform(length);
				break;
			case 37: // DefineEditText
				obj = tagReader.parseDefineEditText();
				break;
			case 39: // DefineSprite
				obj = tagReader.parseDefineSprite(length);
				break;
			case 46: // DefineMorphShape
				obj = tagReader.parseDefineMorphShape(1);
				break;
			case 84: // DefineMorphShape2
				obj = tagReader.parseDefineMorphShape(2);
				break;
			case 60: // DefineVideoStream
				obj = tagReader.parseDefineVideoStream();
				break;
			case 73: // DefineFontAlignZones
				obj = tagReader.parseDefineFontAlignZones(length);
				break;
			case 78: // DefineScalingGrid
				obj = tagReader.parseDefineScalingGrid();
				break;
			case 86: // DefineSceneAndFrameLabelData
				obj = tagReader.parseDefineSceneAndFrameLabelData();
				break;
			case 87: // DefineBinaryData
				obj = tagReader.parseDefineBinaryData(length);
				break;
			case 88: // DefineFontName
				obj = tagReader.parseDefineFontName();
				break;
			case 4: // PlaceObject
				obj = tagReader.parsePlaceObject(1, length);
				break;
			case 26: // PlaceObject2
				obj = tagReader.parsePlaceObject(2, length);
				break;
			case 70: // PlaceObject3
				obj = tagReader.parsePlaceObject(3, length);
				break;
			case 94: // PlaceObject4
				obj = tagReader.parsePlaceObject(4, length);
				break;
			case 5: // RemoveObject1
				obj = tagReader.parseRemoveObject(1);
				break;
			case 28: // RemoveObject2
				obj = tagReader.parseRemoveObject(2);
				break;
			case 8: // JpegTables
				obj.jpegtable = byteStream.readBytes(length);
				break;
			case 9: // SetBackgroundColor
				obj.rgb = tagReader.rgb();
				break;
			case 12: // DoAction
				obj = tagReader.parseDoAction(length);
				break;
			case 15: // StartSound
				obj = tagReader.parseStartSound(1);
				break;
			case 89: // StartSound2
				obj = tagReader.parseStartSound(2);
				break;
			case 18: // SoundStreamHead
				obj = tagReader.parseSoundStreamHead(1);
				break;
			case 45: // SoundStreamHead2
				obj = tagReader.parseSoundStreamHead(2);
				break;
			case 19: // SoundStreamBlock
				obj = tagReader.parseSoundStreamBlock(length);
				break;
			case 24: // Protect
				if (length > 0) {
					byteStream.readUint16(); // Reserved
					obj.data = byteStream.readBytes(length - 2);
				}
				break;
			case 40: // NameCharacter
				obj = tagReader.parseNameCharacter();
				break;
			case 41: // ProductInfo
				obj = tagReader.parseProductInfo();
				break;
			case 43: // FrameLabel
				obj = tagReader.parseFrameLabel(length);
				break;
			case 56: // ExportAssets
				obj = tagReader.parseExportAssets();
				break;
			case 57: // ImportAssets
				obj = tagReader.parseImportAssets(1);
				break;
			case 71: // ImportAssets2
				obj = tagReader.parseImportAssets(2);
				break;
			case 58: // EnableDebugger
				obj.debugger = byteStream.readBytesNullTerminated();
				break;
			case 64: // EnableDebugger2
				byteStream.readUint16(); // Reserved
				obj.debugger = byteStream.readBytesNullTerminated();
				break;
			case 59: // DoInitAction
				obj = tagReader.parseDoInitAction(length);
				break;
			case 61: // VideoFrame
				obj = tagReader.parseVideoFrame(length);
				break;
			case 63: // DebugID
				obj = tagReader.parseDebugID(length);
				break;
			case 65: // ScriptLimits
				obj.maxRecursionDepth = byteStream.readUint16();
				obj.timeoutSeconds = byteStream.readUint16();
				break;
			case 66: // SetTabIndex
				obj.depth = byteStream.readUint16();
				obj.tabIndex = byteStream.readUint16();
				break;
			case 69: // FileAttributes
				obj = tagReader.parseFileAttributes();
				break;
			case 72: // DoAbc
				obj = tagReader.parseDoABC(1, length);
				break;
			case 82: // DoAbc2
				obj = tagReader.parseDoABC(2, length);
				break;
			case 74: // CsmTextSettings
				obj = tagReader.parseCSMTextSettings();
				break;
			case 76: // SymbolClass
				obj = tagReader.parseSymbolClass();
				break;
			case 77: // Metadata
				obj.metadata = byteStream.readBytesNullTerminated();
				break;
			case 93: // EnableTelemetry
				byteStream.readUint16(); // Reserved
				if (length > 2) {
					obj.passwordHash = byteStream.readBytes(32);
				}
				break;
			case 38: // DefineVideo
			case 42: // DefineTextFormat
			case 44: // DefineBehavior
			case 50: // DefineCommandObject
			case 53: // DefineFunction
			case 3: // FreeCharacter
			case 16: // StopSound
			case 25: // PathsArePostScript
			case 29: // SyncFrame
			case 31: // FreeAll
			case 47: // FrameTag
			case 49: // GeProSet
			case 51: // CharacterSet
			case 52: // FontRef
			case 54: // PlaceFunction
			case 55: // GenTagObject
				console.log("[base] tagType -> " + tagType);
				break;
			case 27: // 27 (invalid)
			case 30: // 30 (invalid)
			case 67: // 67 (invalid)
			case 68: // 68 (invalid)
			case 79: // 79 (invalid)
			case 80: // 80 (invalid)
			case 81: // 81 (invalid)
			case 85: // 85 (invalid)
			case 92: // 92 (invalid)
				break;
			default: // null
				break;
		}
		return obj;
	}
	//////// color rect matrix ////////
	SwfInput.prototype.rect = function() {
		var byteStream = this.byteStream;
		byteStream.byteAlign();
		var nBits = byteStream.readUB(5);
		var obj = {};
		obj.xMin = byteStream.readSB(nBits);
		obj.xMax = byteStream.readSB(nBits);
		obj.yMin = byteStream.readSB(nBits);
		obj.yMax = byteStream.readSB(nBits);
		return obj;
	}
	SwfInput.prototype.rgb = function() {
		var byteStream = this.byteStream;
		return [byteStream.readUint8(), byteStream.readUint8(), byteStream.readUint8(), 1];
	}
	SwfInput.prototype.rgba = function() {
		var byteStream = this.byteStream;
		return [byteStream.readUint8(), byteStream.readUint8(), byteStream.readUint8(), byteStream.readUint8() / 255];
	}
	SwfInput.prototype.colorTransform = function(hasAlpha) {
		var byteStream = this.byteStream;
		byteStream.byteAlign();
		var result = [1, 1, 1, 1, 0, 0, 0, 0];
		var first6bits = byteStream.readUB(6);
		var hasAddTerms = first6bits >> 5;
		var hasMultiTerms = (first6bits >> 4) & 1;
		var nbits = first6bits & 0x0f;
		if (hasMultiTerms) {
			result[0] = byteStream.readSBFixed8(nbits);
			result[1] = byteStream.readSBFixed8(nbits);
			result[2] = byteStream.readSBFixed8(nbits);
			if (hasAlpha) {
				result[3] = byteStream.readSBFixed8(nbits);
			}
		}
		if (hasAddTerms) {
			result[4] = byteStream.readSB(nbits);
			result[5] = byteStream.readSB(nbits);
			result[6] = byteStream.readSB(nbits);
			if (hasAlpha) {
				result[7] = byteStream.readSB(nbits);
			}
		}
		return result;
	}
	SwfInput.prototype.matrix = function() {
		var byteStream = this.byteStream;
		byteStream.byteAlign();
		var result = [1, 0, 0, 1, 0, 0];
		if (byteStream.readBit()) {
			var nScaleBits = byteStream.readUB(5);
			result[0] = byteStream.readSBFixed16(nScaleBits);
			result[3] = byteStream.readSBFixed16(nScaleBits);
		}
		if (byteStream.readBit()) {
			var nRotateBits = byteStream.readUB(5);
			result[1] = byteStream.readSBFixed16(nRotateBits);
			result[2] = byteStream.readSBFixed16(nRotateBits);
		}
		var nTranslateBits = byteStream.readUB(5);
		result[4] = byteStream.readSB(nTranslateBits);
		result[5] = byteStream.readSB(nTranslateBits);
		return result;
	}
	SwfInput.prototype.fillStyleArray = function(shapeVersion) {
		var byteStream = this.byteStream;
		var count = byteStream.readUint8();
		if ((shapeVersion >= 2) && (count == 0xff)) {
			count = byteStream.readUint16();
		}
		var fillStyles = [];
		while (count--) {
			fillStyles.push(this.fillStyle(shapeVersion));
		}
		return fillStyles;
	}
	SwfInput.prototype.gradient = function(shapeVersion) {
		var byteStream = this.byteStream;
		var matrix = this.matrix();
		var flags = byteStream.readUint8();
		var spreadMode = (flags >> 6) & 0b11;
		var interpolationMode = (flags >> 4) & 0b11;
		var numGradients = (flags & 0b1111);
		var records = [];
		for (var i = numGradients; i--;) {
			var ratio = byteStream.readUint8() / 255;
			var color = ((shapeVersion >= 3) ? this.rgba() : this.rgb());
			records.push({ ratio, color });
		}
		return {
			spreadMode: spreadMode,
			interpolationMode: interpolationMode,
			records: records,
			matrix: matrix
		};
	}
	SwfInput.prototype.fillStyle = function(shapeVersion) {
		var byteStream = this.byteStream;
		var obj = {};
		var bitType = byteStream.readUint8();
		obj.type = bitType;
		switch (bitType) {
			case 0x00:
				if (shapeVersion >= 3) {
					obj.color = this.rgba();
				} else {
					obj.color = this.rgb();
				}
				break;
			case 0x10:
				obj.gradient = this.gradient(shapeVersion);
				break;
			case 0x12:
				obj.gradient = this.gradient(shapeVersion);
				break;
			case 0x13:
				obj.gradient = this.gradient(shapeVersion);
				obj.focalPoint = byteStream.readFixed8();
				break;
			case 0x40:
			case 0x41:
			case 0x42:
			case 0x43:
				obj.bitmapId = byteStream.readUint16();
				obj.bitmapMatrix = this.matrix();
				obj.isSmoothed = (this._swfVersion >= 8) && ((bitType & 0b10) == 0);
				obj.isRepeating = (bitType & 0b01) == 0;
				break;
			default:
				this.emitMessage("Invalid fill style: " + bitType, "error");
				break;
		}
		return obj;
	}
	SwfInput.prototype.lineStyleArray = function(shapeVersion) {
		var byteStream = this.byteStream;
		var count = byteStream.readUint8();
		if ((shapeVersion >= 2) && (count === 0xff)) {
			count = byteStream.readUint16();
		}
		var lineStyles = [];
		while (count--) {
			lineStyles.push(this.lineStyles(shapeVersion));
		}
		return lineStyles;
	}
	SwfInput.prototype.lineStyles = function(shapeVersion) {
		var byteStream = this.byteStream;
		var obj = {};
		obj.width = byteStream.readUint16();
		if (shapeVersion == 4) {
			obj.startCapStyle = byteStream.readUB(2);
			obj.joinStyle = byteStream.readUB(2);
			obj.hasFill = byteStream.readBit();
			obj.noHScale = byteStream.readBit();
			obj.noVScale = byteStream.readBit();
			obj.pixelHinting = byteStream.readBit();
			byteStream.readUB(5); // Reserved
			obj.noClose = byteStream.readBit();
			obj.endCapStyle = byteStream.readUB(2);
			if (obj.joinStyle === 2) {
				obj.miterLimitFactor = byteStream.readFixed8();
			}
			if (obj.hasFill) {
				obj.fillType = this.fillStyle(shapeVersion);
			} else {
				obj.color = this.rgba();
			}
		} else {
			if (shapeVersion >= 3) {
				obj.color = this.rgba();
			} else {
				obj.color = this.rgb();
			}
		}
		return obj;
	}
	SwfInput.prototype.shapeRecords = function(shapeVersion, currentNumBits) {
		var byteStream = this.byteStream;
		var shapeRecords = [];
		while (true) {
			var first6Bits = byteStream.readUB(6);
			var shape = null;
			if (first6Bits & 0x20) {
				var numBits = first6Bits & 0b1111;
				if (first6Bits & 0x10) {
					shape = this.straightEdgeRecord(numBits);
				} else {
					shape = this.curvedEdgeRecord(numBits);
				}
			} else {
				if (first6Bits) {
					shape = this.styleChangeRecord(shapeVersion, first6Bits, currentNumBits);
				}
			}
			if (!shape) {
				byteStream.byteAlign();
				break;
			} else {
				shapeRecords.push(shape);
			}
		}
		return shapeRecords;
	}
	SwfInput.prototype.straightEdgeRecord = function(numBits) {
		var byteStream = this.byteStream;
		var deltaX = 0;
		var deltaY = 0;
		var GeneralLineFlag = byteStream.readBit();
		if (GeneralLineFlag) {
			deltaX = byteStream.readSB(numBits + 2);
			deltaY = byteStream.readSB(numBits + 2);
		} else {
			var VertLineFlag = byteStream.readBit();
			if (VertLineFlag) {
				deltaX = 0;
				deltaY = byteStream.readSB(numBits + 2);
			} else {
				deltaX = byteStream.readSB(numBits + 2);
				deltaY = 0;
			}
		}
		return {
			deltaX: deltaX,
			deltaY: deltaY,
			isCurved: false,
			isChange: false
		};
	}
	SwfInput.prototype.curvedEdgeRecord = function(numBits) {
		var byteStream = this.byteStream;
		var controlDeltaX = byteStream.readSB(numBits + 2);
		var controlDeltaY = byteStream.readSB(numBits + 2);
		var anchorDeltaX = byteStream.readSB(numBits + 2);
		var anchorDeltaY = byteStream.readSB(numBits + 2);
		return {
			controlDeltaX: controlDeltaX,
			controlDeltaY: controlDeltaY,
			anchorDeltaX: anchorDeltaX,
			anchorDeltaY: anchorDeltaY,
			isCurved: true,
			isChange: false
		};
	}
	SwfInput.prototype.styleChangeRecord = function(shapeVersion, changeFlag, currentNumBits) {
		var byteStream = this.byteStream;
		var obj = {};
		obj.stateMoveTo = changeFlag & 1;
		obj.stateFillStyle0 = (changeFlag >> 1) & 1;
		obj.stateFillStyle1 = (changeFlag >> 2) & 1;
		obj.stateLineStyle = (changeFlag >> 3) & 1;
		obj.stateNewStyles = (changeFlag >> 4) & 1;
		if (obj.stateMoveTo) {
			var moveBits = byteStream.readUB(5);
			obj.moveX = byteStream.readSB(moveBits);
			obj.moveY = byteStream.readSB(moveBits);
		}
		obj.fillStyle0 = 0;
		if (obj.stateFillStyle0) {
			obj.fillStyle0 = byteStream.readUB(currentNumBits.fillBits);
		}
		obj.fillStyle1 = 0;
		if (obj.stateFillStyle1) {
			obj.fillStyle1 = byteStream.readUB(currentNumBits.fillBits);
		}
		obj.lineStyle = 0;
		if (obj.stateLineStyle) {
			obj.lineStyle = byteStream.readUB(currentNumBits.lineBits);
		}
		if (obj.stateNewStyles) {
			obj.fillStyles = this.fillStyleArray(shapeVersion);
			obj.lineStyles = this.lineStyleArray(shapeVersion);
			var numBits = byteStream.readUint8();
			currentNumBits.fillBits = obj.numFillBits = numBits >> 4;
			currentNumBits.lineBits = obj.numLineBits = numBits & 0b1111;
		}
		obj.isChange = true;
		return obj;
	}
	SwfInput.prototype.morphFillStyleArray = function(shapeVersion) {
		var byteStream = this.byteStream;
		var fillStyleCount = byteStream.readUint8();
		if ((shapeVersion >= 2) && (fillStyleCount == 0xff)) {
			fillStyleCount = byteStream.readUint16();
		}
		var fillStyles = [];
		for (var i = fillStyleCount; i--;) {
			fillStyles.push(this.morphFillStyle());
		}
		return fillStyles;
	}
	SwfInput.prototype.morphFillStyle = function() {
		var byteStream = this.byteStream;
		var obj = {};
		var bitType = byteStream.readUint8();
		obj.type = bitType;
		switch (bitType) {
			case 0x00:
				obj.startColor = this.rgba();
				obj.endColor = this.rgba();
				break;
			case 0x10:
				obj.gradient = this.morphGradient();
				break;
			case 0x12:
				obj.gradient = this.morphGradient();
				break;
			case 0x13:
				// SWF19 says focal gradients are only allowed in SWFv8+ and DefineMorphShape2,
				// but it works even in earlier tags (#2730).
				// TODO(Herschel): How is focal_point stored?
				obj.gradient = this.morphGradient();
				obj.startFocalPoint = byteStream.readFixed8();
				obj.endFocalPoint = byteStream.readFixed8();
				break;
			case 0x40:
			case 0x41:
			case 0x42:
			case 0x43:
				obj.bitmapId = byteStream.readUint16();
				obj.bitmapStartMatrix = this.matrix();
				obj.bitmapEndMatrix = this.matrix();
				obj.isSmoothed = (bitType & 0b10) == 0;
				obj.isRepeating = (bitType & 0b01) == 0;
				break;
			default:
				this.emitMessage("Invalid fill style: " + bitType, "error");
		}
		return obj;
	}
	SwfInput.prototype.morphGradient = function() {
		var obj = {};
		var byteStream = this.byteStream;
		obj.startMatrix = this.matrix();
		obj.endMatrix = this.matrix();
		var flags = byteStream.readUint8();
		obj.spreadMode = (flags >> 6) & 0b11;
		obj.interpolationMode = (flags >> 4) & 0b11;
		var numGradients = flags & 0b1111;
		var records = [];
		for (var i = numGradients; i--;) {
			records.push({
				startRatio: byteStream.readUint8() / 255,
				startColor: this.rgba(),
				endRatio: byteStream.readUint8() / 255,
				endColor: this.rgba()
			});
		}
		obj.records = records;
		return obj;
	}
	SwfInput.prototype.morphLineStyleArray = function(shapeVersion) {
		var byteStream = this.byteStream;
		var lineStyleCount = byteStream.readUint8();
		if ((shapeVersion >= 2) && (lineStyleCount == 0xff)) {
			lineStyleCount = byteStream.readUint16();
		}
		var lineStyles = [];
		for (var i = lineStyleCount; i--;) {
			lineStyles.push(this.morphLineStyle(shapeVersion));
		}
		return lineStyles;
	}
	SwfInput.prototype.morphLineStyle = function(shapeVersion) {
		var byteStream = this.byteStream;
		var obj = {};
		obj.startWidth = byteStream.readUint16();
		obj.endWidth = byteStream.readUint16();
		if (shapeVersion < 2) {
			obj.startColor = this.rgba();
			obj.endColor = this.rgba();
		} else {
			obj.startCapStyle = byteStream.readUB(2);
			obj.joinStyle = byteStream.readUB(2);
			obj.hasFill = byteStream.readBit();
			obj.noHScale = byteStream.readBit();
			obj.noVScale = byteStream.readBit();
			obj.pixelHinting = byteStream.readBit();
			byteStream.readUB(5); // Reserved
			obj.noClose = byteStream.readBit();
			obj.endCapStyle = byteStream.readUB(2);
			if (obj.joinStyle === 2) {
				obj.miterLimitFactor = byteStream.readFixed8();
			}
			if (obj.hasFill) {
				obj.fillType = this.morphFillStyle();
			} else {
				obj.startColor = this.rgba();
				obj.endColor = this.rgba();
			}
		}
		return obj;
	}
	SwfInput.prototype.morphShapeWithStyle = function(shapeVersion, t) {
		var byteStream = this.byteStream;
		var numBits = byteStream.readUint8();
		var NumFillBits = numBits >> 4;
		var NumLineBits = numBits & 0b1111;
		if (t) {
			NumFillBits = 0;
			NumLineBits = 0;
		}
		var ShapeRecords = this.shapeRecords(shapeVersion, {
			fillBits: NumFillBits,
			lineBits: NumLineBits
		});
		return ShapeRecords;
	}
	SwfInput.prototype.getTextRecords = function(ver, GlyphBits, AdvanceBits) {
		var byteStream = this.byteStream;
		var array = [];
		while (true) {
			var flags = byteStream.readUint8();
			if (flags == 0) break;
			var obj = {};
			if (flags & 0b1000) obj.fontId = byteStream.readUint16();
			if (flags & 0b100) {
				if (ver === 1) obj.textColor = this.rgb();
				else obj.textColor = this.rgba();
			}
			if (flags & 0b1) obj.x = byteStream.readInt16();
			if (flags & 0b10) obj.y = byteStream.readInt16();
			if (flags & 0b1000) {
				obj.textHeight = byteStream.readUint16();
			}
			obj.entries = this.getGlyphEntries(GlyphBits, AdvanceBits);
			array.push(obj);
		}
		return array;
	}
	SwfInput.prototype.getGlyphEntries = function(GlyphBits, AdvanceBits) {
		var byteStream = this.byteStream;
		var count = byteStream.readUint8();
		var array = [];
		while (count--) {
			array.push({
				index: byteStream.readUB(GlyphBits),
				advance: byteStream.readSB(AdvanceBits)
			});
		}
		return array;
	}
	SwfInput.prototype.buttonRecords = function(ver) {
		var records = [];
		var byteStream = this.byteStream;
		while (true) {
			var flags = byteStream.readUint8();
			if (flags == 0) break;
			var obj = {};
			obj.buttonStateUp = flags & 1;
			obj.buttonStateOver = (flags >>> 1) & 1;
			obj.buttonStateDown = (flags >>> 2) & 1;
			obj.buttonStateHitTest = (flags >>> 3) & 1;
			obj.characterId = byteStream.readUint16();
			obj.depth = byteStream.readUint16();
			obj.matrix = this.matrix();
			if (ver == 2) obj.colorTransform = this.colorTransform(true);
			if (flags & 16) obj.filters = this.getFilterList();
			if (flags & 32) obj.blendMode = this.byteStream.readUint8();
			records.push(obj);
		}
		return records;
	}
	SwfInput.prototype.buttonActions = function(endOffset) {
		var byteStream = this.byteStream;
		var results = [];
		while (true) {
			var obj = {};
			var condActionSize = byteStream.readUint16();
			var flags = byteStream.readUint16();
			obj.condIdleToOverUp = flags & 1;
			obj.condOverUpToIdle = (flags >>> 1) & 1;
			obj.condOverUpToOverDown = (flags >>> 2) & 1;
			obj.condOverDownToOverUp = (flags >>> 3) & 1;
			obj.condOverDownToOutDown = (flags >>> 4) & 1;
			obj.condOutDownToOverDown = (flags >>> 5) & 1;
			obj.condOutDownToIdle = (flags >>> 6) & 1;
			obj.condIdleToOverDown = (flags >>> 7) & 1;
			obj.condOverDownToIdle = (flags >>> 8) & 1;
			obj.condKeyPress = (flags >> 9);
			byteStream.byteAlign();
			if (condActionSize >= 4) {
				obj.actionScript = byteStream.readBytes(condActionSize - 4);
			} else if (condActionSize == 0) {
				obj.actionScript = byteStream.readBytes(endOffset - byteStream.byte_offset);
			}
			results.push(obj);
			if (condActionSize == 0) {
				break;
			}
			if (byteStream.byte_offset > endOffset) {
				break;
			}
		}
		return results;
	}
	SwfInput.prototype.parseSoundFormat = function() {
		var byteStream = this.byteStream;
		var obj = {};
		var frags = byteStream.readUint8();
		var compression;
		switch (frags >> 4) {
			case 0:
				compression = "uncompressedUnknownEndian";
				break;
			case 1:
				compression = "ADPCM";
				break;
			case 2:
				compression = "MP3";
				break;
			case 3:
				compression = "uncompressed";
				break;
			case 4:
				compression = "nellymoser16Khz";
				break;
			case 5:
				compression = "nellymoser8Khz";
				break;
			case 6:
				compression = "nellymoser";
				break;
			case 11:
				compression = "speex";
				break;
			default:
				this.emitMessage("Invalid audio format", "error");
		}
		obj.compression = compression;
		var sampleRate;
		switch ((frags & 0b1100) >> 2) {
			case 0:
				sampleRate = 5512;
				break;
			case 1:
				sampleRate = 11025;
				break;
			case 2:
				sampleRate = 22050;
				break;
			case 3:
				sampleRate = 44100;
				break;
			default:
				console.log("unreachable");
		}
		obj.sampleRate = sampleRate;
		obj.is16Bit = frags & 0b10;
		obj.isStereo = frags & 0b1;
		return obj;
	}
	SwfInput.prototype.parseClipActions = function(startOffset, length) {
		var byteStream = this.byteStream;
		byteStream.readUint16();
		var allEventFlags = this.parseClipEventFlags();
		var actionRecords = [];
		var clipActionRecord;
		while (clipActionRecord = this.parseClipActionRecord()) actionRecords.push(clipActionRecord);
		return {
			allEventFlags: allEventFlags,
			actionRecords: actionRecords
		}
	}
	SwfInput.prototype.parseClipActionRecord = function() {
		var byteStream = this.byteStream;
		var obj = {};
		var flags;
		if (this._swfVersion >= 6) {
			flags = byteStream.readUint32();
			byteStream.byte_offset -= 4;
		} else {
			flags = byteStream.readUint16();
			byteStream.byte_offset -= 2;
		}
		if (!flags) return null;
		var eventFlags = this.parseClipEventFlags();
		var length = byteStream.readUint32();
		if (eventFlags.keyPress) {
			length--;
			obj.keyCode = byteStream.readUint8();
		}
		obj.eventFlags = eventFlags;
		obj.actions = byteStream.readBytes(length);
		return obj;
	}
	SwfInput.prototype.parseClipEventFlags = function() {
		var obj = {};
		var byteStream = this.byteStream;
		obj.keyUp = byteStream.readUB(1);
		obj.keyDown = byteStream.readUB(1);
		obj.mouseUp = byteStream.readUB(1);
		obj.mouseDown = byteStream.readUB(1);
		obj.mouseMove = byteStream.readUB(1);
		obj.unload = byteStream.readUB(1);
		obj.enterFrame = byteStream.readUB(1);
		obj.load = byteStream.readUB(1);
		if (this._swfVersion >= 6) {
			obj.dragOver = byteStream.readUB(1);
			obj.rollOut = byteStream.readUB(1);
			obj.rollOver = byteStream.readUB(1);
			obj.releaseOutside = byteStream.readUB(1);
			obj.release = byteStream.readUB(1);
			obj.press = byteStream.readUB(1);
			obj.initialize = byteStream.readUB(1);
		}
		obj.data = byteStream.readUB(1);
		if (this._swfVersion >= 6) {
			byteStream.readUB(5);
			obj.construct = byteStream.readUB(1);
			obj.keyPress = byteStream.readUB(1);
			obj.dragOut = byteStream.readUB(1);
			byteStream.readUB(8);
		}
		byteStream.byteAlign();
		return obj;
	}
	SwfInput.prototype.getFilterList = function() {
		var byteStream = this.byteStream;
		var result = [];
		var numberOfFilters = byteStream.readUint8();
		while (numberOfFilters--) {
			result.push(this.getFilter());
		}
		return result;
	}
	SwfInput.prototype.getFilter = function() {
		var byteStream = this.byteStream;
		var type = byteStream.readUint8();
		var filter = {};
		switch (type) {
			case 0:
				filter = this.dropShadowFilter();
				break;
			case 1:
				filter = this.blurFilter();
				break;
			case 2:
				filter = this.glowFilter();
				break;
			case 3:
				filter = this.bevelFilter();
				break;
			case 4:
				filter = this.gradientFilter();
				break;
			case 5:
				filter = this.convolutionFilter();
				break;
			case 6:
				filter = this.colorMatrixFilter();
				break;
			case 7:
				filter = this.gradientFilter();
				break;
			default:
				this.emitMessage("Invalid filter type: " + type, "error");
		}
		filter.type = type;
		return filter;
	}
	SwfInput.prototype.dropShadowFilter = function() {
		var byteStream = this.byteStream;
		var color = this.rgba();
		var blurX = byteStream.readFixed16();
		var blurY = byteStream.readFixed16();
		var angle = byteStream.readFixed16();
		var distance = byteStream.readFixed16();
		var strength = byteStream.readFixed8();
		var flags = byteStream.readUint8();
		return {
			distance: distance,
			angle: angle,
			color: color,
			blurX: blurX,
			blurY: blurY,
			strength: strength,
			flags: flags
		}
	}
	SwfInput.prototype.blurFilter = function() {
		var byteStream = this.byteStream;
		var blurX = byteStream.readFixed16();
		var blurY = byteStream.readFixed16();
		var flags = byteStream.readUint8();
		return {
			blurX: blurX,
			blurY: blurY,
			flags: flags
		}
	}
	SwfInput.prototype.glowFilter = function() {
		var byteStream = this.byteStream;
		var color = this.rgba();
		var blurX = byteStream.readFixed16();
		var blurY = byteStream.readFixed16();
		var strength = byteStream.readFixed8();
		var flags = byteStream.readUint8();
		return {
			color: color,
			blurX: blurX,
			blurY: blurY,
			strength: strength,
			flags: flags
		}
	}
	SwfInput.prototype.bevelFilter = function() {
		var byteStream = this.byteStream;
		var highlightColor = this.rgba();
		var shadowColor = this.rgba();
		var blurX = byteStream.readFixed16();
		var blurY = byteStream.readFixed16();
		var angle = byteStream.readFixed16();
		var distance = byteStream.readFixed16();
		var strength = byteStream.readFixed8();
		var flags = byteStream.readUint8();
		return {
			distance: distance,
			angle: angle,
			highlightColor: highlightColor,
			shadowColor: shadowColor,
			blurX: blurX,
			blurY: blurY,
			strength: strength,
			flags: flags
		}
	}
	SwfInput.prototype.gradientFilter = function() {
		var byteStream = this.byteStream;
		var i;
		var numColors = byteStream.readUint8();
		var colors = [];
		for (i = 0; i < numColors; i++) {
			colors.push(this.rgba());
		}
		var gradient_records = [];
		for (i = 0; i < colors.length; i++) {
			gradient_records.push({
				color: colors[i],
				ratio: byteStream.readUint8()
			});
		}
		var blurX = byteStream.readFixed16();
		var blurY = byteStream.readFixed16();
		var angle = byteStream.readFixed16();
		var distance = byteStream.readFixed16();
		var strength = byteStream.readFixed8();
		var flags = byteStream.readUint8();
		return {
			distance: distance,
			angle: angle,
			colors: gradient_records,
			blurX: blurX,
			blurY: blurY,
			strength: strength,
			flags: flags
		}
	}
	SwfInput.prototype.convolutionFilter = function() {
		var byteStream = this.byteStream;
		var obj = {};
		obj.matrixX = byteStream.readUint8();
		obj.matrixY = byteStream.readUint8();
		obj.divisor = byteStream.readFloat32();
		obj.bias = byteStream.readFloat32();
		var count = obj.matrixX * obj.matrixY;
		var matrixArr = [];
		while (count--) {
			matrixArr.push(byteStream.readFloat32());
		}
		obj.defaultColor = this.rgba();
		byteStream.readUB(6);
		obj.clamp = byteStream.readUB(1);
		obj.preserveAlpha = byteStream.readUB(1);
		return obj;
	}
	SwfInput.prototype.colorMatrixFilter = function() {
		var byteStream = this.byteStream;
		var matrixArr = [];
		for (var i = 0; i < 20; i++) {
			matrixArr.push(byteStream.readFloat32());
		}
		return matrixArr;
	}
	SwfInput.prototype.parseSoundInfo = function() {
		var obj = {};
		var byteStream = this.byteStream;
		var flags = byteStream.readUint8();
		switch ((flags >> 4) & 0b11) {
			case 0:
				obj.event = 'event';
				break;
			case 1:
				obj.event = 'start';
				break;
			case 2:
				obj.event = 'stop';
				break;
		}
		if (flags & 0b1) obj.inSample = byteStream.readUint32();
		if (flags & 0b10) obj.outSample = byteStream.readUint32();
		if (flags & 0b100) obj.numLoops = byteStream.readUint16();
		if (flags & 0b1000) {
			var count = byteStream.readUint8();
			var envelope = [];
			while (count--) {
				envelope.push({
					sample: byteStream.readUint32(),
					leftVolume: byteStream.readUint16(),
					rightVolume: byteStream.readUint16()
				});
			}
			obj.envelope = envelope;
		}
		return obj;
	}
	SwfInput.prototype.parseDefineButton = function(ver, length) {
		var byteStream = this.byteStream;
		var obj = {};
		var endOffset = byteStream.byte_offset + length;
		obj.id = byteStream.readUint16();
		var ActionOffset = 0;
		if (ver == 2) {
			obj.flag = byteStream.readUint8();
			obj.trackAsMenu = (obj.flag & 0b1);
			ActionOffset = byteStream.readUint16();
		}
		obj.records = this.buttonRecords(ver);
		byteStream.byteAlign();
		if (ver === 1) {
			obj.actions = byteStream.readBytes(endOffset - byteStream.byte_offset);
		} else {
			if (ActionOffset > 0) {
				obj.actions = this.buttonActions(endOffset);
			}
		}
		byteStream.byteAlign();
		return obj;
	}
	SwfInput.prototype.parseDefineButtonSound = function() {
		var byteStream = this.byteStream;
		var obj = {};
		obj.buttonId = byteStream.readUint16();
		for (var i = 0; i < 4; i++) {
			var soundId = byteStream.readUint16();
			if (soundId) {
				var soundInfo = this.parseSoundInfo();
				switch (i) {
					case 0:
						obj.buttonStateUpSoundInfo = soundInfo;
						obj.buttonStateUpSoundId = soundId;
						break;
					case 1:
						obj.buttonStateOverSoundInfo = soundInfo;
						obj.buttonStateOverSoundId = soundId;
						break;
					case 2:
						obj.buttonStateDownSoundInfo = soundInfo;
						obj.buttonStateDownSoundId = soundId;
						break;
					case 3:
						obj.buttonStateHitTestSoundInfo = soundInfo;
						obj.buttonStateHitTestSoundId = soundId;
						break;
				}
			}
		}
		return obj;
	}
	SwfInput.prototype.parseDefineFont1 = function(length) {
		var byteStream = this.byteStream;
		var obj = {};
		obj.version = 1;
		var endOffset = byteStream.byte_offset + length;
		var i;
		obj.id = byteStream.readUint16();
		var offset = byteStream.byte_offset;
		var numGlyphs = byteStream.readUint16();
		var offsetTable = [];
		offsetTable.push(numGlyphs);
		numGlyphs /= 2;
		numGlyphs--;
		for (i = numGlyphs; i--;) {
			offsetTable.push(byteStream.readUint16());
		}
		numGlyphs++;
		var glyphs = [];
		for (i = 0; i < numGlyphs; i++) {
			byteStream.setOffset(offset + offsetTable[i], 0);
			var numBits = byteStream.readUint8();
			glyphs.push(this.shapeRecords(1, {
				fillBits: numBits >> 4,
				lineBits: numBits & 0b1111
			}));
		}
		obj.glyphs = glyphs;
		byteStream.byte_offset = endOffset;
		byteStream.bit_offset = 0;
		return obj;
	}
	SwfInput.prototype.parseDefineFont2 = function(ver, length) {
		var byteStream = this.byteStream;
		var startOffset = byteStream.byte_offset;
		var obj = {};
		obj.version = ver;
		obj.id = byteStream.readUint16();
		var i = 0;
		var fontFlags = byteStream.readUint8();
		obj.isBold = (fontFlags) & 1;
		obj.isItalic = (fontFlags >>> 1) & 1;
		var isWideCodes = (fontFlags >>> 2) & 1;
		obj.isWideCodes = isWideCodes;
		var isWideOffsets = (fontFlags >>> 3) & 1;
		obj.isWideOffsets = isWideOffsets;
		obj.isANSI = (fontFlags >>> 4) & 1;
		obj.isSmallText = (fontFlags >>> 5) & 1;
		obj.isShiftJIS = (fontFlags >>> 6) & 1;
		var hasLayout = (fontFlags >>> 7) & 1;
		obj.language = this.byteStream.readUint8();
		obj.fontNameData = byteStream.readNetBytes();
		var numGlyphs = byteStream.readUint16();
		obj.numGlyphs = numGlyphs;
		if (numGlyphs == 0) {
			if (isWideOffsets) {
				byteStream.readUint32();
			} else {
				byteStream.readUint16();
			}
		} else {
			var offset = byteStream.byte_offset;
			var OffsetTable = [];
			if (isWideOffsets) {
				for (i = numGlyphs; i--;) {
					OffsetTable[OffsetTable.length] = byteStream.readUint32();
				}
			} else {
				for (i = numGlyphs; i--;) {
					OffsetTable[OffsetTable.length] = byteStream.readUint16();
				}
			}
			var codeTableOffset;
			if (isWideOffsets) {
				codeTableOffset = byteStream.readUint32();
			} else {
				codeTableOffset = byteStream.readUint16();
			}
			var glyphShapeTable = [];
			for (i = 0; i < numGlyphs; i++) {
				byteStream.setOffset(offset + OffsetTable[i], 0);
				var availableBytes;
				if (i < (numGlyphs - 1)) availableBytes = (OffsetTable[i + 1] - OffsetTable[i]);
				else availableBytes = (codeTableOffset - OffsetTable[i]);

				if (availableBytes == 0) continue;
				var numBits = byteStream.readUint8();
				if (availableBytes == 1) continue;
				var numFillBits = numBits >> 4;
				var numLineBits = numBits & 0b1111;
				glyphShapeTable.push(this.shapeRecords(1, {
					fillBits: numFillBits,
					lineBits: numLineBits
				}));
			}
			obj.glyphs = glyphShapeTable;
			byteStream.setOffset(offset + codeTableOffset, 0);
			var CodeTable = [];
			if (isWideCodes) {
				for (i = numGlyphs; i--;) {
					CodeTable.push(byteStream.readUint16());
				}
			} else {
				for (i = numGlyphs; i--;) {
					CodeTable.push(byteStream.readUint8());
				}
			}
			obj.codeTables = CodeTable;
		}
		if (hasLayout) {
			obj.layout = {};
			obj.layout.ascent = byteStream.readUint16();
			obj.layout.descent = byteStream.readUint16();
			obj.layout.leading = byteStream.readInt16();
			var advanceTable = [];
			for (i = numGlyphs; i--;) {
				advanceTable.push(byteStream.readInt16());
			}
			obj.layout.advanceTable = advanceTable;
			var boundsTable = [];
			if ((byteStream.byte_offset - startOffset) < length) {
				for (i = numGlyphs; i--;) {
					boundsTable.push(this.rect());
				}
				byteStream.byteAlign();
			}
			obj.layout.boundsTable = boundsTable;
			var kernings = [];
			if ((byteStream.byte_offset - startOffset) < length) {
				var kerningCount = byteStream.readUint16();
				for (i = kerningCount; i--;) {
					var kerningCode1 = ((isWideCodes) ? byteStream.readUint16() : byteStream.readUint8());
					var kerningCode2 = ((isWideCodes) ? byteStream.readUint16() : byteStream.readUint8());
					var kerningAdjustment = byteStream.readInt16();
					kernings.push({
						leftCode: kerningCode1,
						rightCode: kerningCode2,
						adjustment: kerningAdjustment
					});
				}
			}
			obj.kernings = kernings;
		}
		return obj;
	}
	SwfInput.prototype.parseDefineFont4 = function(length) {
		var byteStream = this.byteStream;
		var startOffset = byteStream.byte_offset;
		var obj = {};
		obj.version = 4;
		obj.id = byteStream.readUint16();
		var flags = byteStream.readUint8();
		obj.name = byteStream.readBytesNullTerminated();
		if (flags & 0b100) {
			obj.data = byteStream.readBytes(length - (byteStream.byte_offset - startOffset));
		} else {
			var e = (length - (byteStream.byte_offset - startOffset));
			byteStream.byte_offset += e;
		}
		obj.isItalic = (flags & 0b10);
		obj.isBold = (flags & 0b1);
		return obj;
	}
	SwfInput.prototype.parseDefineFontInfo = function(ver, length) {
		var byteStream = this.byteStream;
		var endOffset = byteStream.byte_offset + length;
		var obj = {};
		obj.id = byteStream.readUint16();
		obj.version = ver;
		obj.fontNameData = byteStream.readNetBytes();
		var flags = byteStream.readUint8();
		obj.isWideCodes = flags & 1;
		obj.isBold = (flags >>> 1) & 1;
		obj.isItalic = (flags >>> 2) & 1;
		obj.isShiftJIS = (flags >>> 3) & 1;
		obj.isANSI = (flags >>> 4) & 1;
		obj.isSmallText = (flags >>> 5) & 1;
		byteStream.byteAlign();
		if (ver === 2) obj.language = this.byteStream.readUint8();
		var codeTable = [];
		var tLen = endOffset - byteStream.byte_offset;
		if (obj.isWideCodes) {
			while (tLen > 1) {
				codeTable[codeTable.length] = byteStream.readUint16();
				tLen -= 2;
			}
		} else {
			while (tLen > 0) {
				codeTable[codeTable.length] = byteStream.readUint8();
				tLen--;
			}
		}
		obj.codeTable = codeTable;
		return obj;
	}
	SwfInput.prototype.parseDefineEditText = function() {
		var byteStream = this.byteStream;
		var obj = {};
		obj.id = byteStream.readUint16();
		obj.bounds = this.rect();
		var flag1 = byteStream.readUint16();
		var hasFont = flag1 & 1;
		var hasMaxLength = (flag1 >>> 1) & 1;
		var hasTextColor = (flag1 >>> 2) & 1;
		var isReadOnly = (flag1 >>> 3) & 1;
		var isPassword = (flag1 >>> 4) & 1;
		var isMultiline = (flag1 >>> 5) & 1;
		var isWordWrap = (flag1 >>> 6) & 1;
		var hasInitialText = (flag1 >>> 7) & 1;
		var outlines = (flag1 >>> 8) & 1;
		var HTML = (flag1 >>> 9) & 1;
		var wasStatic = (flag1 >>> 10) & 1;
		var border = (flag1 >>> 11) & 1;
		var noSelect = (flag1 >>> 12) & 1;
		var hasLayout = (flag1 >>> 13) & 1;
		var autoSize = (flag1 >>> 14) & 1;
		var hasFontClass = (flag1 >>> 15) & 1;
		obj.isReadOnly = isReadOnly;
		obj.isPassword = isPassword;
		obj.isMultiline = isMultiline;
		obj.isWordWrap = isWordWrap;
		obj.outlines = outlines;
		obj.HTML = HTML;
		obj.wasStatic = wasStatic;
		obj.border = border;
		obj.noSelect = noSelect;
		obj.autoSize = autoSize;
		if (hasFont) obj.fontID = byteStream.readUint16();
		if (hasFontClass) obj.fontClass = byteStream.readBytesNullTerminated();
		if (hasFont && !hasFontClass) obj.fontHeight = byteStream.readUint16();
		if (hasTextColor) obj.textColor = this.rgba();
		if (hasMaxLength) obj.maxLength = byteStream.readUint16();
		if (hasLayout) {
			obj.layout = {
				align: byteStream.readUint8(),
				leftMargin: byteStream.readUint16(),
				rightMargin: byteStream.readUint16(),
				indent: byteStream.readUint16(),
				leading: byteStream.readInt16()
			}
		}
		obj.variableName = byteStream.readBytesNullTerminated();
		if (hasInitialText) {
			obj.initialText = byteStream.readBytesNullTerminated();
		}
		return obj;
	}
	SwfInput.prototype.parseDefineSprite = function() {
		var obj = {};
		var byteStream = this.byteStream;
		obj.id = byteStream.readUint16();
		obj.numFrames = byteStream.readUint16();
		obj.tags = this.parseTagList();
		return obj;
	}
	SwfInput.prototype.parseDefineShape = function(shapeVersion) {
		var byteStream = this.byteStream;
		var obj = {};
		obj.id = byteStream.readUint16();
		obj.bounds = this.rect();
		obj.version = shapeVersion;
		if (shapeVersion >= 4) {
			obj.edgeBounds = this.rect();
			var flags = byteStream.readUint8();
			obj.scalingStrokes = flags & 1;
			obj.nonScalingStrokes = (flags >>> 1) & 1;
			obj.fillWindingRule = (flags >>> 2) & 1;
		}
		var fillStyles = this.fillStyleArray(shapeVersion);
		var lineStyles = this.lineStyleArray(shapeVersion);
		var numBits = byteStream.readUint8();
		var numFillBits = numBits >> 4;
		var numLineBits = numBits & 0b1111;
		var shapeRecords = this.shapeRecords(shapeVersion, {
			fillBits: numFillBits,
			lineBits: numLineBits
		});
		obj.fillStyles = fillStyles;
		obj.lineStyles = lineStyles;
		obj.shapeRecords = shapeRecords;
		obj.numFillBits = numFillBits;
		obj.numLineBits = numLineBits;
		return obj;
	}
	SwfInput.prototype.parseDefineSound = function(length) {
		var obj = {};
		var byteStream = this.byteStream;
		var startOffset = byteStream.byte_offset;
		obj.id = byteStream.readUint16();
		obj.format = this.parseSoundFormat();
		obj.numSamples = byteStream.readUint32();
		var sub = byteStream.byte_offset - startOffset;
		var dataLength = length - sub;
		obj.data = byteStream.readBytes(dataLength);
		return obj;
	}
	SwfInput.prototype.parseDefineText = function(ver) {
		var byteStream = this.byteStream;
		var obj = {};
		obj.id = byteStream.readUint16();
		obj.bounds = this.rect();
		obj.matrix = this.matrix();
		var GlyphBits = byteStream.readUint8();
		var AdvanceBits = byteStream.readUint8();
		obj.records = this.getTextRecords(ver, GlyphBits, AdvanceBits);
		return obj;
	}
	SwfInput.prototype.parseDefineBinaryData = function(length) {
		var byteStream = this.byteStream;
		var obj = {};
		obj.id = byteStream.readUint16();
		byteStream.readUint32();
		obj.data = byteStream.readBytes(length - 6);
		return obj;
	}
	SwfInput.prototype.parseDefineScalingGrid = function() {
		var byteStream = this.byteStream;
		var obj = {};
		obj.characterId = byteStream.readUint16();
		obj.splitter = this.rect();
		byteStream.byteAlign();
		return obj;
	}
	SwfInput.prototype.parseDefineSceneAndFrameLabelData = function() {
		var byteStream = this.byteStream;
		var obj = {};
		var sceneCount = byteStream.readEncodedU32();
		obj.sceneInfo = [];
		while (sceneCount--) {
			obj.sceneInfo.push({
				offset: byteStream.readEncodedU32(),
				name: byteStream.readBytesNullTerminated()
			});
		}
		var frameLabelCount = byteStream.readEncodedU32();
		obj.frameInfo = [];
		while (frameLabelCount--) {
			obj.frameInfo.push({
				num: byteStream.readEncodedU32(),
				label: byteStream.readBytesNullTerminated()
			});
		}
		return obj;
	}
	SwfInput.prototype.parseDefineVideoStream = function() {
		var byteStream = this.byteStream;
		var obj = {};
		obj.id = byteStream.readUint16();
		obj.numFrames = byteStream.readUint16();
		obj.width = byteStream.readUint16();
		obj.height = byteStream.readUint16();
		var flags = byteStream.readUint8();
		switch (byteStream.readUint8()) {
			case 0:
				obj.codec = "none";
				break;
			case 2:
				obj.codec = "H263";
				break;
			case 3:
				obj.codec = "ScreenVideo";
				break;
			case 4:
				obj.codec = "Vp6";
				break;
			case 5:
				obj.codec = "Vp6WithAlpha";
				break;
			case 6:
				obj.codec = "ScreenVideoV2";
				break;
			default:
				this.emitMessage("Invalid video codec.", "error");
		}
		switch ((flags >> 1) & 0b111) {
			case 0:
				obj.deblocking = "useVideoPacketValue";
				break;
			case 1:
				obj.deblocking = "none";
				break;
			case 2:
				obj.deblocking = "Level1";
				break;
			case 3:
				obj.deblocking = "Level2";
				break;
			case 4:
				obj.deblocking = "Level3";
				break;
			case 5:
				obj.deblocking = "Level4";
				break;
			default:
				this.emitMessage("Invalid video deblocking value.", "error");
		}
		obj.isSmoothed = flags & 0b1;
		return obj;
	}
	SwfInput.prototype.parseDefineBitsLossLess = function(ver, length) {
		var obj = {};
		var byteStream = this.byteStream;
		var startOffset = byteStream.byte_offset;
		obj.id = byteStream.readUint16();
		obj.version = ver;
		var format = byteStream.readUint8();
		obj.width = byteStream.readUint16();
		obj.height = byteStream.readUint16();
		switch (format) {
			case 3:
				obj.numColors = byteStream.readUint8();
				break;
			case 4:
			case 5:
				break;
			default:
				this.emitMessage("Invalid bitmap format: " + format, "error");
		}
		var sub = byteStream.byte_offset - startOffset;
		obj.data = byteStream.readBytes(length - sub);
		obj.format = format;
		return obj;
	}
	SwfInput.prototype.parseDefineFontName = function() {
		var obj = {};
		var byteStream = this.byteStream;
		obj.id = byteStream.readUint16();
		obj.name = byteStream.readBytesNullTerminated();
		obj.copyrightInfo = byteStream.readBytesNullTerminated();
		return obj;
	}
	SwfInput.prototype.parseDefineBits = function(ver, length) {
		var obj = {};
		var byteStream = this.byteStream;
		var startOffset = byteStream.byte_offset;
		obj.id = byteStream.readUint16();
		if (ver <= 2) {
			obj.data = byteStream.readBytes(length - 2);
		} else {
			var dataSize = byteStream.readUint32();
			if (ver >= 4) obj.deblocking = byteStream.readUint16();
			var data = byteStream.readBytes(dataSize);
			var sub = byteStream.byte_offset - startOffset;
			var alphaData = byteStream.readBytes(length - sub);
			obj.data = data;
			obj.alphaData = alphaData;
		}
		return obj;
	}
	SwfInput.prototype.parseDefineButtonCxform = function(length) {
		var byteStream = this.byteStream;
		var startOffset = byteStream.byte_offset;
		var obj = {};
		obj.id = byteStream.readUint16();
		var colorTransforms = [];
		while ((byteStream.byte_offset - startOffset) < length) {
			colorTransforms.push(this.colorTransform(false));
			byteStream.byteAlign();
		}
		obj.colorTransforms = colorTransforms;
		return obj;
	}
	SwfInput.prototype.parseDefineMorphShape = function(ver) {
		var byteStream = this.byteStream;
		var obj = {};
		obj.id = byteStream.readUint16();
		obj.startBounds = this.rect();
		obj.endBounds = this.rect();
		if (ver == 2) {
			obj.startEdgeBounds = this.rect();
			obj.endEdgeBounds = this.rect();
			var flags = byteStream.readUint8();
			obj.isScalingStrokes = flags & 1;
			obj.isNonScalingStrokes = (flags >>> 1) & 1;
		}
		byteStream.readUint32();
		obj.morphFillStyles = this.morphFillStyleArray(ver);
		obj.morphLineStyles = this.morphLineStyleArray(ver);
		obj.startEdges = this.morphShapeWithStyle(ver, false);
		obj.endEdges = this.morphShapeWithStyle(ver, true);
		return obj;
	}
	SwfInput.prototype.parseDefineFontAlignZones = function(length) {
		var byteStream = this.byteStream;
		var tag = {};
		var startOffset = byteStream.byte_offset;
		tag.id = byteStream.readUint16();
		tag.thickness = byteStream.readUint8();
		var zones = [];
		while (byteStream.byte_offset < (startOffset + length)) {
			byteStream.readUint8();
			zones.push({
				left: byteStream.readInt16(),
				width: byteStream.readInt16(),
				bottom: byteStream.readInt16(),
				height: byteStream.readInt16()
			});
			byteStream.readUint8();
		}
		tag.zones = zones;
		return tag;
	}
	SwfInput.prototype.parsePlaceObject = function(ver, length) {
		var byteStream = this.byteStream;
		var obj = {};
		var startOffset = byteStream.byte_offset;
		obj.version = ver;
		if (ver === 1) {
			obj.isMove = false;
			obj.characterId = byteStream.readUint16();
			obj.depth = byteStream.readUint16();
			obj.matrix = this.matrix();
			byteStream.byteAlign();
			if ((byteStream.byte_offset - startOffset) < length) {
				obj.colorTransform = this.colorTransform();
			}
		} else {
			var flags;
			if (ver >= 3) flags = byteStream.readUint16();
			else flags = byteStream.readUint8();
			obj.depth = byteStream.readUint16();
			var isMove = (flags & 1);
			var hasCharacter = (flags >>> 1) & 1;
			var hasMatrix = (flags >>> 2) & 1;
			var hasColorTransform = (flags >>> 3) & 1;
			var hasRatio = (flags >>> 4) & 1;
			var hasName = (flags >>> 5) & 1;
			var hasClipDepth = (flags >>> 6) & 1;
			var hasClipActions = (flags >>> 7) & 1;
			var hasFilters = (flags >>> 8) & 1;
			var hasBlendMode = (flags >>> 9) & 1;
			var hasBitmapCache = (flags >>> 10) & 1;
			var hasClassName = (flags >>> 11) & 1;
			var hasImage = (flags >>> 12) & 1;
			var hasVisible = (flags >>> 13) & 1;
			var hasBackgroundColor = (flags >>> 14) & 1;
			obj.hasImage = hasImage;
			if ((hasClassName) || ((obj.hasImage) && !hasCharacter)) obj.className = byteStream.readBytesNullTerminated();
			obj.isMove = isMove;
			if (hasCharacter) obj.characterId = byteStream.readUint16();
			if (!obj.isMove && !hasCharacter) this.emitMessage("Invalid PlaceObject type", "error");
			if (hasMatrix) obj.matrix = this.matrix();
			if (hasColorTransform) obj.colorTransform = this.colorTransform(true);
			if (hasRatio) obj.ratio = byteStream.readUint16();
			if (hasName) obj.name = byteStream.readBytesNullTerminated();
			if (hasClipDepth) obj.clipDepth = byteStream.readUint16();
			if (hasFilters) obj.filters = this.getFilterList();
			if (hasBlendMode) obj.blendMode = this.byteStream.readUint8();
			if (hasBitmapCache) obj.bitmapCache = byteStream.readUint8();
			if (hasVisible) obj.visible = byteStream.readUint8();
			if (hasBackgroundColor) obj.backgroundColor = this.rgba();
			if (hasClipActions) obj.clipActions = this.parseClipActions(startOffset, length);
			if (ver === 4) {
				byteStream.byteAlign();
				obj.amfData = byteStream.readBytes((length - (byteStream.byte_offset - startOffset)));
			}
		}
		byteStream.byteAlign();
		return obj;
	}
	SwfInput.prototype.parseDoAction = function(length) {
		var byteStream = this.byteStream;
		var obj = {};
		obj.action = byteStream.readBytes(length);
		return obj;
	}
	SwfInput.prototype.parseDoInitAction = function(length) {
		var byteStream = this.byteStream;
		var obj = {};
		obj.spriteId = byteStream.readUint16();
		obj.action = byteStream.readBytes(length - 2);
		return obj;
	}
	SwfInput.prototype.parseDoABC = function(ver, length) {
		var byteStream = this.byteStream;
		var startOffset = byteStream.byte_offset;
		var obj = {};
		obj.version = ver;
		if (ver == 2) {
			obj.flags = byteStream.readUint32();
			obj.name = byteStream.readBytesNullTerminated();
		}
		var offset = (length - (byteStream.byte_offset - startOffset));
		obj.abc = byteStream.readBytes(offset);
		return obj;
	}
	SwfInput.prototype.parseProductInfo = function() {
		var byteStream = this.byteStream;
		var obj = {};
		obj.productID = byteStream.readUint32();
		obj.edition = byteStream.readUint32();
		obj.majorVersion = byteStream.readUint8();
		obj.minorVersion = byteStream.readUint8();
		obj.buildBumber = byteStream.readUint64();
		obj.compilationDate = byteStream.readUint64();
		return obj;
	}
	SwfInput.prototype.parseDebugID = function(length) {
		var byteStream = this.byteStream;
		var obj = {};
		obj.debugId = byteStream.readUint8();
		byteStream.byte_offset--;
		byteStream.byte_offset += length;
		return obj;
	}
	SwfInput.prototype.parseNameCharacter = function() {
		var byteStream = this.byteStream;
		var obj = {};
		obj.id = byteStream.readUint16();
		obj.name = byteStream.readBytesNullTerminated();
		return obj;
	}
	SwfInput.prototype.parseFileAttributes = function() {
		var byteStream = this.byteStream;
		var obj = {};
		var flags = byteStream.readUint32();
		obj.useDirectBlit = (flags >> 6) & 1;
		obj.useGPU = (flags >> 5) & 1;
		obj.hasMetadata = (flags >> 4) & 1;
		obj.isActionScript3 = (flags >> 3) & 1;
		obj.useNetworkSandbox = (flags >> 0) & 1;
		return obj;
	}
	SwfInput.prototype.parseSymbolClass = function() {
		var byteStream = this.byteStream;
		var obj = {};
		var symbols = [];
		var count = byteStream.readUint16();
		while (count--) {
			symbols.push({
				tagId: byteStream.readUint16(),
				path: byteStream.readBytesNullTerminated()
			});
		}
		obj.symbols = symbols;
		return obj;
	}
	SwfInput.prototype.parseFrameLabel = function(length) {
		var byteStream = this.byteStream;
		var startOffset = byteStream.byte_offset;
		var obj = {};
		obj.label = byteStream.readBytesNullTerminated();
		var isAnchor = false;
		if (this._swfVersion >= 6 && (byteStream.byte_offset - startOffset) !== length) {
			isAnchor = byteStream.readUint8() != 0;
		}
		obj.isAnchor = isAnchor;
		return obj;
	}
	SwfInput.prototype.parseRemoveObject = function(ver) {
		var obj = {};
		if (ver == 1) {
			obj.characterId = this.byteStream.readUint16();
		}
		obj.depth = this.byteStream.readUint16();
		return obj;
	}
	SwfInput.prototype.parseExportAssets = function() {
		var obj = {};
		var byteStream = this.byteStream;
		var count = byteStream.readUint16();
		var packages = [];
		while (count--) {
			var id = byteStream.readUint16();
			var name = byteStream.readBytesNullTerminated();
			packages.push([id, name]);
		}
		obj.packages = packages;
		return obj;
	}
	SwfInput.prototype.parseImportAssets = function(ver) {
		var obj = {};
		var url = this.byteStream.readBytesNullTerminated();
		if (ver == 2) {
			this.byteStream.readUint8();
			this.byteStream.readUint8();
		}
		var num_imports = this.byteStream.readUint16();
		var imports = [];
		while (num_imports--) {
			imports.push({
				id: this.byteStream.readUint16(),
				name: this.byteStream.readBytesNullTerminated()
			});
		}
		obj.url = url;
		obj.imports = imports;
		return obj;
	}
	SwfInput.prototype.parseStartSound = function(ver) {
		var byteStream = this.byteStream;
		var obj = {};
		if (ver == 2) {
			obj.className = byteStream.readBytesNullTerminated();
		} else {
			obj.id = byteStream.readUint16();
		}
		obj.info = this.parseSoundInfo();
		return obj;
	}
	SwfInput.prototype.parseSoundStreamHead = function(ver) {
		var obj = {};
		var byteStream = this.byteStream;
		obj.version = ver;
		obj.playback = this.parseSoundFormat();
		obj.stream = this.parseSoundFormat();
		obj.samplePerBlock = byteStream.readUint16();
		obj.latencySeek = 0;
		if (obj.stream.compression === "MP3") obj.latencySeek = byteStream.readInt16();
		byteStream.byteAlign();
		return obj;
	}
	SwfInput.prototype.parseSoundStreamBlock = function(length) {
		var byteStream = this.byteStream;
		var obj = {};
		obj.compressed = byteStream.readBytes(length);
		return obj;
	}
	SwfInput.prototype.parseVideoFrame = function(length) {
		var byteStream = this.byteStream;
		var startOffset = byteStream.byte_offset;
		var obj = {};
		obj.streamId = byteStream.readUint16();
		obj.frameNum = byteStream.readUint16();
		var sub = byteStream.byte_offset - startOffset;
		var dataLength = length - sub;
		obj.videoData = byteStream.readBytes(dataLength);
		return obj;
	}
	SwfInput.prototype.parseCSMTextSettings = function() {
		var obj = {};
		var byteStream = this.byteStream;
		obj.id = byteStream.readUint16();
		var flags = byteStream.readUint8();
		obj.useAdvancedRendering = flags & 0b01000000;
		switch ((flags >> 3) & 0b11) {
			case 0:
				obj.gridFit = "none";
				break;
			case 1:
				obj.gridFit = "pixel";
				break;
			case 2:
				obj.gridFit = "subPixel";
				break;
			default:
				this.emitMessage("Invalid text grid fitting", "error");
		}
		obj.thickness = byteStream.readFloat32();
		obj.sharpness = byteStream.readFloat32();
		byteStream.readUint8();
		return obj;
	}
	SwfInput.tagCodes = {0: "End", 1: "ShowFrame", 2: "DefineShape", 4: "PlaceObject", 5: "RemoveObject", 6: "DefineBits", 7: "DefineButton", 8: "JpegTables", 9: "SetBackgroundColor", 10: "DefineFont", 11: "DefineText", 12: "DoAction", 13: "DefineFontInfo", 14: "DefineSound", 15: "StartSound", 17: "DefineButtonSound", 18: "SoundStreamHead", 19: "SoundStreamBlock", 20: "DefineBitsLossless", 21: "DefineBitsJpeg2", 22: "DefineShape2", 23: "DefineButtonCxform", 24: "Protect", 26: "PlaceObject2", 28: "RemoveObject2", 32: "DefineShape3", 33: "DefineText2", 34: "DefineButton2", 35: "DefineBitsJpeg3", 36: "DefineBitsLossless2", 37: "DefineEditText", 39: "DefineSprite", 40: "NameCharacter", 41: "ProductInfo", 43: "FrameLabel", 45: "SoundStreamHead2", 46: "DefineMorphShape", 48: "DefineFont2", 56: "ExportAssets", 57: "ImportAssets", 58: "EnableDebugger", 59: "DoInitAction", 60: "DefineVideoStream", 61: "VideoFrame", 62: "DefineFontInfo2", 63: "DebugId", 64: "EnableDebugger2", 65: "ScriptLimits", 66: "SetTabIndex", 69: "FileAttributes", 70: "PlaceObject3", 71: "ImportAssets2", 73: "DefineFontAlignZones", 74: "CsmTextSettings", 75: "DefineFont3", 76: "SymbolClass", 77: "Metadata", 78: "DefineScalingGrid", 82: "DoAbc", 83: "DefineShape4", 84: "DefineMorphShape2", 86: "DefineSceneAndFrameLabelData", 87: "DefineBinaryData", 88: "DefineFontName", 89: "StartSound2", 90: "DefineBitsJpeg4", 91: "DefineFont4", 93: "EnableTelemetry", 94: "PlaceObject4"};

	var Avm1Reader = function(data) {
		var byteStream = new ByteStream(data.movie.data);
		byteStream.byte_offset = data.start;
		this.len = data.length;
		this.start = data.start;
		this.byteStream = byteStream;
	}
	Object.defineProperty(Avm1Reader.prototype, "bytesAvailable", {
		get: function() {
			return this.len - (this.byteStream.byte_offset - this.start);
		}
	});
	Avm1Reader.prototype.seek = function(offest) {
		var byte_offset = this.byteStream.byte_offset + offest;
		this.byteStream.byte_offset = byte_offset;
	}
	Avm1Reader.prototype.readAction = function() {
		var h = this.parseOpcodeAndLength();
		var startOffset = this.byteStream.byte_offset;
		var action = this.parseOpcode(h.opcode, h.length);
		action.opcode = h.opcode;
		if ((this.byteStream.byte_offset - startOffset) !== action.len) {
			console.log("Length mismatch in AVM1 action: ", h.opcode, ((this.byteStream.byte_offset - startOffset) + " = " + action.len));
			this.byteStream.byte_offset = startOffset + action.len;
		}
		return action;
	}
	Avm1Reader.prototype.parseOpcodeAndLength = function() {
		var opcode = this.byteStream.readUint8();
		var length = (opcode >= 0x80) ? this.byteStream.readUint16() : 0;
		return {
			opcode: opcode,
			length: length
		}
	}
	Avm1Reader.prototype.parseOpcode = function(opcode, length) {
		var action = {};
		var lenFix = length;
		switch (opcode) {
			case 0x00: // End
			case 0x04: // NextFrame
			case 0x05: // PreviousFrame
			case 0x06: // Play
			case 0x07: // Stop
			case 0x08: // ToggleQuality
			case 0x09: // StopSounds
			case 0x0A: // Add
			case 0x0B: // Subtract
			case 0x0C: // Multiply
			case 0x0D: // Divide
			case 0x0E: // Equals
			case 0x0F: // Less
			case 0x10: // And
			case 0x11: // Or
			case 0x12: // Not
			case 0x13: // StringEquals
			case 0x14: // StringLength
			case 0x15: // StringExtract

			case 0x17: // Pop
			case 0x18: // ToInteger

			case 0x1C: // GetVariable
			case 0x1D: // SetVariable

			case 0x20: // SetTarget2
			case 0x21: // StringAdd
			case 0x22: // GetProperty
			case 0x23: // SetProperty
			case 0x24: // CloneSprite
			case 0x25: // RemoveSprite
			case 0x26: // Trace
			case 0x27: // StartDrag
			case 0x28: // EndDrag
			case 0x29: // StringLess
			case 0x2A: // Throw
			case 0x2B: // CastOp
			case 0x2C: // ImplementsOp
			case 0x2D: // FsCommand2

			case 0x30: // RandomNumber
			case 0x31: // MBStringLength
			case 0x32: // CharToAscii
			case 0x33: // AsciiToChar
			case 0x34: // GetTime
			case 0x35: // MBStringExtract
			case 0x36: // MBCharToAscii
			case 0x37: // MBAsciiToChar

			case 0x3A: // Delete
			case 0x3B: // Delete2
			case 0x3C: // DefineLocal
			case 0x3D: // CallFunction
			case 0x3E: // Return
			case 0x3F: // Modulo
			case 0x40: // NewObject
			case 0x41: // DefineLocal2
			case 0x42: // InitArray
			case 0x43: // InitObject
			case 0x44: // TypeOf
			case 0x45: // TargetPath
			case 0x46: // Enumerate
			case 0x47: // Add2
			case 0x48: // Less2
			case 0x49: // Equals2
			case 0x4a: // ToNumber
			case 0x4b: // ToString
			case 0x4c: // PushDuplicate
			case 0x4d: // StackSwap
			case 0x4e: // GetMember
			case 0x4f: // SetMember
			case 0x50: // Increment
			case 0x51: // Decrement
			case 0x52: // CallMethod
			case 0x53: // NewMethod
			case 0x54: // InstanceOf
			case 0x55: // Enumerate2

			case 0x60: // BitAnd
			case 0x61: // BitOr
			case 0x62: // BitXor
			case 0x63: // BitLShift
			case 0x64: // BitRShift
			case 0x65: // BitURShift
			case 0x66: // StrictEquals
			case 0x67: // Greater
			case 0x68: // StringGreater
			case 0x69: // Extends

			case 0x9E: // Call
				break;
			case 0x81: // GotoFrame
				action.frame = this.byteStream.readUint16();
				break;
			case 0x83: // GetUrl
				action.url = this.byteStream.readBytesNullTerminated();
				action.target = this.byteStream.readBytesNullTerminated();
				break;
			case 0x87: // StoreRegister
				action.register = this.byteStream.readUint8();
				break;
			case 0x88: // ConstantPool
				var count = this.byteStream.readUint16();
				var strings = [];
				if (count > 0) {
					while (count--) {
						strings.push(this.byteStream.readBytesNullTerminated());
					}
				}
				action.strings = strings;
				break;
			case 0x8A: // WaitForFrame
				action.frame = this.byteStream.readUint16();
				action.numActionsToSkip = this.byteStream.readUint8();
				break;
			case 0x8B: // SetTarget
				action.target = this.byteStream.readBytesNullTerminated();
				break;
			case 0x8C: // GotoLabel
				action.label = this.byteStream.readBytesNullTerminated();
				break;
			case 0x8D: // WaitForFrame2
				action.numActionsToSkip = this.byteStream.readUint8();
				break;
			case 0x8E: // DefineFunction2
				var name = this.byteStream.readBytesNullTerminated();
				var numParams = this.byteStream.readUint16();
				var registerCount = this.byteStream.readUint8();
				var flags = this.byteStream.readUint16();
				var params = [];
				while (numParams--) {
					params.push({
						registerIndex: this.byteStream.readUint8(),
						name: this.byteStream.readBytesNullTerminated()
					});
				}
				var codeLength = this.byteStream.readUint16();
				action.name = name;
				action.params = params;
				action.registerCount = registerCount;
				action.preloadThis = flags & 1;
				action.suppressThis = (flags >>> 1) & 1;
				action.preloadArguments = (flags >>> 2) & 1;
				action.suppressArguments = (flags >>> 3) & 1;
				action.preloadSuper = (flags >>> 4) & 1;
				action.suppressSuper = (flags >>> 5) & 1;
				action.preloadRoot = (flags >>> 6) & 1;
				action.preloadParent = (flags >>> 7) & 1;
				action.preloadGlobal = (flags >>> 8) & 1;
				action.actions = this.byteStream.readBytes(codeLength);
				lenFix += codeLength;
				break;
			case 0x8F: // Try
				if (length < 7) {
					action.tryBody = [];
				} else {
					var flags = this.byteStream.readUint8();
					var trySize = this.byteStream.readUint16();
					var catchSize = this.byteStream.readUint16();
					var finallySize = this.byteStream.readUint16();
					var catchVar;
					if ((flags >>> 2) & 1) {
						catchVar = this.byteStream.readUint8();
					} else {
						catchVar = this.byteStream.readBytesNullTerminated();
					}
					var tryBody = this.byteStream.readBytes(trySize);
					var catchBody = this.byteStream.readBytes(catchSize);
					var finallyBody = this.byteStream.readBytes(finallySize);
					action.catchVar = catchVar;
					action.tryBody = tryBody;
					if (flags & 1) {
						action.catchBody = catchBody;
					}
					if ((flags >>> 1) & 1) {
						action.finallyBody = finallyBody;
					}
					lenFix += (trySize + catchSize + finallySize);
				}
				break;
			case 0x94: // With
				var codeLength = this.byteStream.readUint16();
				action.actions = this.byteStream.readBytes(codeLength);
				lenFix += codeLength;
				break;
			case 0x96: // Push
				var startOffset = this.byteStream.byte_offset;
				var values = [];
				while (this.byteStream.byte_offset < (startOffset + length)) {
					var value;
					var type = this.byteStream.readUint8();
					switch (type) {
						case 0: // String
							value = this.byteStream.readBytesNullTerminated();
							break;
						case 1: // Float
							value = this.byteStream.readFloat32();
							break;
						case 2: // Null
							value = null;
							break;
						case 3: // Undefined
							value = undefined;
							break;
						case 4: // Register
							value = this.byteStream.readUint8();
							break;
						case 5: // Boolean
							value = (this.byteStream.readUint8() != 0);
							break;
						case 6: // Double
							var dbyte = this.byteStream.readBytes(8);
							dbyte = new ByteStream(new Uint8Array([dbyte[4], dbyte[5], dbyte[6], dbyte[7], dbyte[0], dbyte[1], dbyte[2], dbyte[3]]));
							value = dbyte.readDouble();
							break;
						case 7: // Int
							value = this.byteStream.readInt32();
							break;
						case 8: // ConstantPool
							value = this.byteStream.readUint8();
							break;
						case 9: // ConstantPool
							value = this.byteStream.readUint16();
							break;
						default:
							console.log("Invalid value type: " + type + " in ActionPush");
					}
					values.push({
						type: type,
						value: value
					});
				}
				action.values = values;
				break;
			case 0x99: // Jump
				action.offset = this.byteStream.readInt16();
				break;
			case 0x9A: // GetUrl2
				action.loadVariablesFlag = this.byteStream.readUB(1); // 0=none, 1=LoadVariables
				action.loadTargetFlag = this.byteStream.readUB(1); // 0=web, 1=Sprite
				this.byteStream.readUB(4); // Reserved
				action.sendVarsMethod = this.byteStream.readUB(2); // 0=NONE, 1=GET, 2=POST
				this.byteStream.byteAlign();
				break;
			case 0x9B: // DefineFunction
				var name = this.byteStream.readBytesNullTerminated();
				var count = this.byteStream.readUint16();
				var params = [];
				if (count > 0) {
					while (count--) {
						params.push(this.byteStream.readBytesNullTerminated());
					}
				}
				var codeLength = this.byteStream.readUint16();
				action.name = name;
				action.params = params;
				action.actions = this.byteStream.readBytes(codeLength);
				lenFix += codeLength;
				break;
			case 0x9D: // If
				action.offset = this.byteStream.readInt16();
				break;
			case 0x9F: // GotoFrame2
				var flags = this.byteStream.readUint8();
				action.setPlaying = (flags & 0b1) != 0;
				action.sceneOffset = ((flags & 0b10) != 0) ? this.byteStream.readUint16() : 0;
				break;
			default:
				console.log("Unknown AVM1 opcode: " + opcode);
				this.byteStream.byte_offset += length;
		}
		action.len = lenFix;
		return action;
	}
	var Avm2Reader = function(data) {
		this.byteStream = new ByteStream(data);
	}
	Avm2Reader.prototype.read = function() {
		var byteStream = this.byteStream;
		var len;
		var i;
		var minorVersion = byteStream.readUint16();
		var majorVersion = byteStream.readUint16();
		var constantPool = this.readConstantPool();
		len = this.readU30();
		var methods = [];
		while (len--) {
			methods.push(this.readMethod());
		}
		len = this.readU30();
		var metadata = [];
		while (len--) {
			metadata.push(this.readMetadata());
		}
		len = this.readU30();
		i = len;
		var instances = [];
		while (i--) {
			instances.push(this.readInstance());
		}
		i = len;
		var classes = [];
		while (i--) {
			classes.push(this.readClass());
		}
		len = this.readU30();
		var scripts = [];
		while (len--) {
			scripts.push(this.readScript());
		}
		len = this.readU30();
		var methodBodies = [];
		while (len--) {
			methodBodies.push(this.readMethodBody());
		}
		var obj = {};
		obj.minorVersion = minorVersion;
		obj.majorVersion = majorVersion;
		obj.constantPool = constantPool;
		obj.methods = methods;
		obj.metadata = metadata;
		obj.instances = instances;
		obj.classes = classes;
		obj.scripts = scripts;
		obj.methodBodies = methodBodies;
		return obj;
	}
	Avm2Reader.prototype.readU30 = function() {
		return this.byteStream.readEncodedU32();
	}
	Avm2Reader.prototype.readI32 = function() {
		return this.byteStream.readEncodedU32() | 0;
	}
	Avm2Reader.prototype.readConstantPool = function() {
		var byteStream = this.byteStream;
		var count;
		count = this.readU30();
		var integers = [];
		for (var i = 1; count > i; i++) {
			integers[i] = this.readI32();
		}
		count = this.readU30();
		var uintegers = [];
		for (var i = 1; count > i; i++) {
			uintegers[i] = this.readU30();
		}
		count = this.readU30();
		var doubles = [];
		for (var i = 1; count > i; i++) {
			doubles[i] = byteStream.readDouble();
		}
		count = this.readU30();
		var strings = [];
		for (var i = 1; count > i; i++) {
			strings[i] = this.readString();
		}
		count = this.readU30();
		var nameSpaces = [];
		for (var i = 1; count > i; i++) {
			nameSpaces[i] = this.readNamespace();
		}
		count = this.readU30();
		var nsSets = [];
		for (var i = 1; count > i; i++) {
			var nsCount = this.readU30();
			var ns = [];
			if (nsCount) {
				for (var j = 0; j < nsCount; j++) {
					ns[j] = this.readU30();
				}
			}
			nsSets[i] = ns;
		}
		count = this.readU30();
		var multinames = [];
		for (var i = 1; count > i; i++) {
			multinames[i] = this.readMultiname();
		}
		var obj = {};
		obj.integer = integers;
		obj.uinteger = uintegers;
		obj.double = doubles;
		obj.strings = strings;
		obj.nameSpaces = nameSpaces;
		obj.nsSets = nsSets;
		obj.multinames = multinames;
		return obj;
	}
	Avm2Reader.prototype.readString = function() {
		var byteStream = this.byteStream;
		var len = this.readU30();
		var s = byteStream.readBytes(len);
		return new TextDecoder().decode(s.slice(0));
	}
	Avm2Reader.prototype.readNamespace = function() {
		var byteStream = this.byteStream;
		var obj = {};
		obj.kind = byteStream.readUint8();
		obj.name = this.readU30();
		// TODO: AVM2 specs say that "non-system" namespaces
		// should have an empty name?
		switch (obj.kind) {
			case 0x05: // Private
			case 0x08: // Namespace
			case 0x16: // Package
			case 0x17: // PackageInternal
			case 0x18: // Protected
			case 0x19: // Explicit
			case 0x1a: // StaticProtected
				break;
			default:
				throw new Error("Invalid namespace kind");
		}
		return obj;
	}
	Avm2Reader.prototype.readMultiname = function() {
		var byteStream = this.byteStream;
		var obj = {};
		obj.kind = byteStream.readUint8();
		switch (obj.kind) {
			case 0x07: // QName
			case 0x0D: // QNameA
				obj.ns = this.readU30();
				obj.name = this.readU30();
				break;
			case 0x0F: // RTQName
			case 0x10: // RTQNameA
				obj.string = this.readU30();
				break;
			case 0x11: // RTQNameL
			case 0x12: // RTQNameLA
				break;
			case 0x09: // Multiname
			case 0x0E: // MultinameA
				obj.name = this.readU30();
				obj.nsSet = this.readU30();
				break;
			case 0x1B: // MultinameL
			case 0x1C: // MultinameLA
				obj.nsSet = this.readU30();
				break;
			case 0x1d:
				obj.index = this.readU30();
				var count = this.readU30();
				var parameters = [];
				while (count--) {
					parameters.push(this.readU30());
				}
				obj.parameters = parameters;
				break;
			default:
				throw new Error("Invalid multiname kind: " + obj.kind);
		}
		return obj;
	}
	Avm2Reader.prototype.readMethod = function() {
		var byteStream = this.byteStream;
		var obj = {};
		var i;
		var count = this.readU30();
		obj.paramCount = count;
		obj.returnType = this.readU30();
		if (count) {
			var paramType = [];
			for (i = 0; i < count; i++) {
				paramType.push(this.readU30());
			}
			obj.paramType = paramType;
		}
		obj.name = this.readU30();
		var flags = byteStream.readUint8();
		obj.needArguments = flags & 1;
		obj.needActivation = (flags >>> 1) & 1;
		obj.needRest = (flags >>> 2) & 1;
		obj.ignoreRest = (flags >>> 4) & 1;
		obj.native = (flags >>> 5) & 1;
		obj.setDXNS = (flags >>> 6) & 1;
		if (8 & flags) {
			var options = [];
			var optionCount = this.readU30();
			while (optionCount--) {
				options.push(this.readConstantValue());
			}
			obj.options = options;
		}
		if (128 & flags) {
			var paramNames = [];
			if (count) {
				for (i = 0; i < count; i++) {
					paramNames.push(this.readU30());
				}
			}
			obj.paramNames = paramNames;
		}
		return obj;
	}
	Avm2Reader.prototype.readConstantValue = function() {
		var byteStream = this.byteStream;
		var obj = {};
		obj.index = this.readU30();
		obj.kind = byteStream.readUint8();
		switch (obj.kind) {
			case 0x00: // Undefined
			case 0x01: // String
			case 0x03: // Int
			case 0x04: // Uint
			case 0x05: // Private
			case 0x06: // Double
			case 0x08: // Namespace
			case 0x0a: // False
			case 0x0b: // True
			case 0x0c: // Null
			case 0x16: // Package
			case 0x17: // PackageInternal
			case 0x18: // Protected
			case 0x19: // Explicit
			case 0x1a: // StaticProtected
				break;
			default:
				throw new Error("Invalid namespace kind");
		}
		return obj;
	}
	Avm2Reader.prototype.readOptionalValue = function() {
		var byteStream = this.byteStream;
		var obj = {};
		obj.index = this.readU30();
		if (obj.index) {
			obj.kind = byteStream.readUint8();
			switch (obj.kind) {
				case 0x00: // Undefined
				case 0x01: // String
				case 0x03: // Int
				case 0x04: // Uint
				case 0x05: // Private
				case 0x06: // Double
				case 0x08: // Namespace
				case 0x0a: // False
				case 0x0b: // True
				case 0x0c: // Null
				case 0x16: // Package
				case 0x17: // PackageInternal
				case 0x18: // Protected
				case 0x19: // Explicit
				case 0x1a: // StaticProtected
					break;
				default:
					throw new Error("Invalid namespace kind");
			}
		}
		return obj;
	}
	Avm2Reader.prototype.readMetadata = function() {
		var obj = {};
		obj.name = this.readU30();
		var count = this.readU30();
		var items = [];
		while (count--) {
			items.push({
				key: this.readU30(),
				value: this.readU30()
			});
		}
		obj.items = items;
		return obj;
	}
	Avm2Reader.prototype.readInstance = function() {
		var byteStream = this.byteStream;
		var obj = {};
		obj.name = this.readU30();
		obj.superName = this.readU30();
		var flags = byteStream.readUint8();
		if (flags & 0x08) {
			obj.protectedNs = this.readU30();
		}
		var count = this.readU30();
		var interfaces = [];
		while (count--) {
			interfaces.push(this.readU30());
		}
		obj.interfaces = interfaces;
		obj.initMethod = this.readU30();
		obj.trait = this.readTrait();
		obj.isSealed = flags & 0x01;
		obj.isFinal = flags & 0x02;
		obj.isInterface = flags & 0x04;
		return obj;
	}
	Avm2Reader.prototype.readClass = function() {
		var initMethod = this.readU30();
		var trait = this.readTrait();
		return {
			initMethod: initMethod,
			trait: trait
		}
	}
	Avm2Reader.prototype.readScript = function() {
		var initMethod = this.readU30();
		var trait = this.readTrait();
		return {
			initMethod: initMethod,
			trait: trait
		}
	}
	Avm2Reader.prototype.readTrait = function() {
		var byteStream = this.byteStream;
		var count = this.readU30();
		var trait = [];
		while (count--) {
			var tObj = {};
			tObj.id = this.readU30();
			var flags = byteStream.readUint8();
			var kind = flags & 0b1111;
			var data = {};
			switch (kind) {
				case 0: // Slot
				case 6: // Const
					data.id = this.readU30();
					data.name = this.readU30();
					data.value = this.readOptionalValue();
					break;
				case 1: // Method
				case 2: // Getter
				case 3: // Setter
				case 4: // Class
				case 5: // Function
					data.id = this.readU30();
					data.info = this.readU30();
					break;
				default:
					throw new Error("Invalid trait kind: " + kind);
			}
			tObj.kind = kind;
			tObj.data = data;
			if (flags & 0x40) {
				var metadataCount = this.readU30();
				var metadata = [];
				if (metadataCount) {
					for (var j = 0; j < metadataCount; j++) {
						metadata.push(this.readU30());
					}
				}
				tObj.metadata = metadata;
			}
			tObj.isFinal = (flags & 0x10);
			tObj.isOverride = (flags & 0x20);
			trait.push(tObj);
		}
		return trait;
	}
	Avm2Reader.prototype.readMethodBody = function() {
		var byteStream = this.byteStream;
		var obj = {};
		obj.method = this.readU30();
		obj.maxStack = this.readU30();
		obj.localCount = this.readU30();
		obj.initScopeDepth = this.readU30();
		obj.maxScopeDepth = this.readU30();
		obj.codes = byteStream.readBytes(this.readU30());
		var count = this.readU30();
		var exceptions = [];
		while (count--) {
			exceptions.push(this.readException());
		}
		obj.exceptions = exceptions;
		obj.trait = this.readTrait();
		return obj;
	}
	Avm2Reader.prototype.readException = function() {
		var obj = {};
		obj.from = this.readU30();
		obj.to = this.readU30();
		obj.target = this.readU30();
		obj.excType = this.readU30();
		obj.varName = this.readU30();
		return obj;
	}
	var SwfDecompress = function(data) {
		this.byteStream = new ByteStream(data);
		this.isLoad = false;
		this.result = null;
		this.aborted = false;
		this.onload = null;
		this.onerror = null;
		this.onprogress = null;
		this._header = null;
		this._headerMovie = null;
		this._fileAttributes = null;
		this._interval = null;
		this._swfVersion = 0;
		this._stopped = false;
		this._loadedType = 0;
		this._compression = null;
		this._uncompressedLength = 0;
		this._compressStream = null;
		this._bytesLoaded = 0;
		this._bytesTotal = this.byteStream.length;
		this.tick = this.tick.bind(this);
	}
	SwfDecompress.prototype.cancel = function() {
		if (this._interval) {
			clearInterval(this._interval);
			this._interval = null;
		}
		this.onload = null;
		this.onerror = null;
		this.onprogress = null;
		this.aborted = true;
	}
	SwfDecompress.prototype.load = function() {
		this._interval = setInterval(this.tick, 5);
	}
	SwfDecompress.prototype.getProgress = function() {
		return {
			bytesLoaded: this._bytesLoaded,
			bytesTotal: this._bytesTotal
		};
	}
	SwfDecompress.prototype.tick = function() {
		if (this.isLoad) 
			return;
		if (this._stopped) 
			return;
		this._stopped = true;
		try {
			this.tickParse();
		} catch (e) {
			if (this._interval) {
				clearInterval(this._interval);
				this._interval = null;
			}
			if (this.onerror) {
				this.onerror(e);
			}
		}
		if (this.isLoad) {
			if (!this.aborted) {
				if (this.onload) {
					this.onload(this.result);
				}
			}
		}
		this._stopped = false;
	}
	SwfDecompress.prototype.tickParse = function() {
		if (this._loadedType == 3) {
			if (this._interval) {
				clearInterval(this._interval);
				this._interval = null;
			}
			this.result = {
				header: this._header,
				movieInfo: this._headerMovie,
				fileAttributes: this._fileAttributes,
				data: this.resultData
			};
			this.isLoad = true;
		} else {
			if (this._loadedType == 2) {
				if ((this.byteStream.length + 8) !== this._uncompressedLength) {
					console.log("SWF length doesn't match header, may be corrupt");
				}
				var reader = new SwfInput(this.byteStream.data, this._swfVersion);
				var bounds = reader.rect();
				var frameRate = reader.byteStream.readFixed8();
				var numFrames = reader.byteStream.readUint16();
				this._headerMovie = {
					bounds,
					frameRate,
					numFrames
				};
				var startA = reader.byteStream.byte_offset;
				this.resultData = reader.byteStream.readBytes(reader.byteStream.bytesAvailable);
				reader.byteStream.byte_offset = startA;
				var t = reader.parseTagCodeLength();
				var fileAttributes = (t.tagcode == 69) ? reader.parseFileAttributes() : {};
				this._fileAttributes = fileAttributes;
				this._loadedType++;
			} else {
				if (this._loadedType == 1) {
					if (this._compressStream) {
						this._compressStream.tick();
						this._bytesLoaded = this._compressStream.getProgress()[0];
						this._bytesTotal = this._compressStream.getProgress()[1];
						if (this.onprogress) this.onprogress(this._compressStream.loaded);
						if (this._compressStream.isLoad) {
							this.byteStream = new ByteStream(this._compressStream.result);
							this._compressStream = null;
							this._loadedType++;
						}
					} else {
						var compressStream = this.decompressStream(this._compression, this._uncompressedLength);
						if (compressStream) {
							if (compressStream instanceof Uint8Array) {
								this.byteStream = new ByteStream(compressStream);
								this._loadedType++;
							} else {
								this._compressStream = compressStream;
							}
						} else {
							this._loadedType++;
						}
					}
					if (this._loadedType == 2) {
						if (this.onprogress) this.onprogress(1);
					}
				} else {
					var header = this.parseHeader();
					this._header = header;
					this._compression = header.compression;
					this._swfVersion = header.version;
					this._uncompressedLength = header.uncompressedLength;
					if (this.onprogress) this.onprogress(0);
					this._loadedType++;
				}
			}
		}
	}
	SwfDecompress.prototype.parseHeader = function() {
		var compression = this.byteStream.readString(3);
		var version = this.byteStream.readUint8();
		if (version == 0) {
			throw new Error("Invalid SWF version");
		}
		var uncompressedLength = this.byteStream.readUint32();
		return { compression, version, uncompressedLength };
	}
	SwfDecompress.prototype.decompressStream = function(compression, size) {
		var compressed = this.byteStream.readBytes(this.byteStream.bytesAvailable);
		switch (compression) {
			case "FWS": return compressed;
			case "CWS": return pako.inflate(compressed);
			case "ZWS": return LZMA.parse(this.byteStream.data, size - 8);
			default: throw new Error("Invalid SWF");
		}
	}
	var pinkfieFont = (function() {
		var base64 = "AQCMAQpOb3RvIFNhbnMAHwKACAAAgggAAPYIAAAeCQAAjwkAAFQKAACXCwAAhQwAAJoMAAAGDQAAcg0AALUNAADbDQAAHA4AAC4OAACPDgAApQ4AAIMPAADNDwAAdRAAAIcRAADrEQAAtRIAAPkTAAAWFAAAkRUAAMsWAACLFwAAKxgAAEwYAABtGAAAjRgAAKYZAADTGgAAEhsAAKsbAAAbHAAAaxwAAJMcAAC1HAAAMR0AAFkdAACFHQAAvh0AAPIdAAAJHgAAUB4AAJoeAAAaHwAAbR8AAPsfAABZIAAAByEAACQhAAB0IQAAoyEAAAUiAAA6IgAAYCIAAIYiAACjIgAAuSIAANUiAAD2IgAACCMAADIjAADYIwAAbCQAANMkAABjJQAA6CUAADgmAADpJgAARScAAIwnAAD6JwAANigAAEgoAADRKAAAJykAAKUpAAA3KgAAwSoAAAorAACpKwAA/isAAFQsAACPLAAADS0AAEEtAACiLQAAyC0AAHkuAACMLgAARy8AAOkvAADrLwAAODAAAKcwAAATMQAAuTEAAAIyAAAjMgAAJzMAAJQzAACmNAAAMTUAAHM1AACKNQAAnDUAAKc2AAC5NgAALjcAAGQ3AADQNwAAVjgAAIA4AADROAAAEjkAAEs5AACSOQAAvzkAADY6AAB4OgAA9zoAAKE7AAB5PAAAHz0AAIY9AADtPQAAXj4AAAc/AACxPwAAVUAAAJ1AAABSQQAAoUEAAPBBAABKQgAA3UIAADBDAACDQwAA4UMAAHhEAADdRAAAkUUAADlGAADhRgAAk0cAAH1IAABoSQAAn0kAAENKAAC6SgAAMUsAALNLAABuTAAAvEwAABtNAADkTQAAsk4AAIBPAABYUAAAaFEAAHhSAACMUwAAjlQAADlVAADlVQAAkVYAAEhXAAA3WAAAcFgAAKlYAADtWAAAaVkAAB9aAADgWgAAhVsAACpcAADaXAAAwl0AAKpeAAByXwAADWAAAItgAAAJYQAAkmEAAFNiAADbYgAAa2MAADZkAACFZAAAO2UAALllAACeZgAAGmcAAP1nAACVaAAAI2kAAMVpAABeagAABGsAAKBrAAA9bAAA0GwAAE1tAAAEbgAAaW4AAA1vAABFbwAA2W8AAD9wAAACcQAAX3EAABlyAAB9cgAAPnMAAJNzAABEdAAA8nQAANV1AACPdgAAf3cAADB4AAAWeQAAuXkAAJF6AADregAAeXsAAMV7AAA1fAAAy3wAAEd9AACDfQAApH0AAA9+AABffgAAx34AAEp/AACrfwAAvX8AACCAAADSgAAAPYEAAKiBAAADggAAZoIAAKCCAADfggAAGIMAAFaDAACPgwAAzYMAAAaEAABShAAAmYQAAM2EAAD8hAAAbYUAAOuFAABchgAA2YYAAFCHAADThwAARYgAAKWIAAAciQAArIkAADmKAAD4igAAtIsAAIOMAABPjQAA0Y0AALyOAABBjwAAsY8AADaQAACmkAAAMJEAAKWRAAB7kgAAQpMAACKUAADzlAAA5pUAAMqWAACllwAAcZgAANKYAABrmQAAtZkAADGaAABjmgAAx5oAAIGbAABCnAAAopwAAAidAACXnQAALJ4AAOqeAACunwAATaAAAPKgAAB+oQAAEaIAAKaiAABWowAArqMAAEGkAADSpAAAH6UAAGylAADHpQAAIqYAAHWmAADHpgAA/KYAAKSnAABoqAAAyKgAAGKpAADMqQAAVaoAAMWqAABiqwAA6qsAAE+sAADKrAAAI60AALmtAACHrgAArq4AADGvAADgrwAAIrAAAJqwAAA9sQAAzbEAAGWyAACpsgAA6bIAAFGzAACtswAA07MAAGi0AAAAtQAAcLUAAMe1AABStgAA8rYAAKG3AABguAAADrkAAIy5AABJugAAq7oAAFm7AAD3uwAALLwAAMC8AAAqvQAAbb0AAOa9AAApvgAAm74AABS/AACivwAABMAAAEnAAADEwAAAAsEAAD7BAACzwQAANMIAAJ3CAAA4wwAAvcMAADHEAACXxAAAHMUAAI/FAAChxQAAw8UAAP/FAABLxgAA7MYAAIzHAABsyAAAusgAAD3JAAC6yQAAO8oAAPDKAACyywAAHswAAPHMAABKzQAAiM0AADXOAADfzgAAXM8AAN/PAACo0AAAd9EAAE3SAAAp0wAAIdQAAB/VAAD11QAA0dYAAFbXAAAO2AAALdkAALHZAACc2gAA89oAAATcAACU3AAASd0AAPLdAADQ3gAAMN8AAJnfAABW4AAAEOEAAN3hAACn4gAASeMAAOPjAABI5AAAvOQAADDlAADk5QAAh+YAAF/nAADA5wAANOgAAKXoAAAj6QAA7OkAACjrAACX6wAAwOwA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LwEwATEBMgEzATQBNQE2ATcBOAE5AToBOwE8AT0BPgE/AUABQQFCAUMBRAFFAUYBRwFIAUkBSgFLAUwBTQFOAU8BUAFRAVIBUwFUAVUBVgFXAVgBWQFaAVsBXAFdAV4BXwFgAWEBYgFjAWQBZQFmAWcBaAFpAWoBawFsAW0BbgFvAXABcQFyAXMBdAF1AXYBdwF4AXkBegF7AXwBfQF+AX8BgAGBAYIBgwGEAYUBhgGHAYgBiQGKAYsBjAGNAY4BjwGQAZEBkgGTAZQBlQGWAZcBmAGZAZoBmwGcAZ0BngGfAaABoQGiAaMBpAGlAaYBpwGoAakBqgGrAawBrQGuAa8BsAGxAbIBswG0AbUBtgG3AbgBuQG6AbsBvAG9Ab4BvwHAAcEBwgHDAcQBxQHGAccByAHJAcoBywHMAc0BzgHPAdAB0QHSAdMB1AHVAdYB1wHYAdkB2gHbAdwB3QHeAd8B4AHhAeIB4wHkAeUB5gHnAegB6QHqAesB7AHtAe4B7wHwAfEB8gHzAfQB9QH2AfcB+AH5AfoB+wH8Af0B/gH/AcYC3AIAIAEgAiADIAQgBSAGIAcgCCAJIAogCyAMIA0gDiAPIBIgEyAUIBUgFiAXIBggGSAaIBsgHCAdIB4gHyAgICEgIiAmICogKyAsIC0gLiAvIDAgMiAzIDQgOSA6IDwgPiBEIF4gaiBrIGwgbSBuIG8goCChIKIgoyCkIKUgpiCnIKggqSCrIKwgrSCuIK8gsCCxILIgsyC0ILUguSC6IAUhEyEWIRchIiEmIS4hTSFOIVMhVCFbIVwhXSFeIYxVcBf8HMgUtB4oKEQ0yC1AQpg6GBpIHEgcmDAQLAAUMBt8FWAiECwQLBAsECwQLBAsECwQLBAsECyYF5gXECwQLBAsaCn0RywzCDSMMnA6iCyQKUg6TDscG+AViDH0KZRIyDyAPnAwgD7EMegriCyEOgwwdErgLlAtyC2EHGAihBwQLOQgaC7sLDgxcCY4MSgtlBs4MXQxoBSgFLwqoBTYSnQxcDA4MTgxDCFcJugcdDGgKOQ+WCrIKKglQB80KxQeECzIFJAVyC3ILcgtyC0QLBgpaC6QQpgctCjILcgZkEIwG0wiyC0MHAwcaC7YMWw0fBUMEgwcFB60KDQ/ND80P8QiLDMsMywzLDMsMywzeEaMMogsiCyILIgsHBscGxwbHBtwOsg8gD6APoA+gD6APhAsgD6EOoQ6hDqEOlAtcDB4Muws7CzsLOws7CzsLCRFcCYoLSgtKC0oLaAUoBSgFKAUcDB0MXAwcDBwMHAwcDAQLHAwdDF0MXQxdDHIKDgxyCgsM+wsLDPsLCwz7CyMMnAmjDJwJowycCaMMnAmcDo4MXA6YDGILCgtiCwoLYgsKC2ILCgtiCwoLUg6ODFIOjgxSDo4MUg6ODFMO3QxTDt0MRwboBQcG6AUHBugFBwboBQcG6AU/DAsKeAVoBSIMbwqvCr0KaAU9CmgFPQpoBT0KQQa9CmgFMg8dDHIPHQxyDx0MVA3yDx0MYA+cDCAPnAwgD5wMExKtEvEMQwhxDEMIcQxDCHoK1wm6CtcJugrXCboK1wmiCzoHIgs6ByILOgchDp0MYQ6dDGEOnQxhDp0MYQ6dDGEOnQxdErkPlAtyChQLcgtqCXILaglyC2oJRgaODFwOjgxODHIMvwwjDKMMjwocDrYQDgxODFcMIgsJDsIL5ApyC1IOqAtxErkGxwbiDG8KqAUXCtsUsg8dDGUPrw+TDEEVqhD2DY4McQx6CtcJqAtxBjoHBgu6ByILGw+6DWUPgwwUC1cK8gtqCW4Lrgu2CfYJ6AtuC44Jwgl9C5UKVQpVCmQFVxnBGDMVsA/lD5UKahSfFEURiwz7CwcG6AUgD5wMIQ6dDGEOnQxhDp0MYQ6dDGEOnQxKC0sM+wsLDPsLHhGJEVIOjgxSDo4MYgxvCqAPnAwgD5wMLgu2CegFFxnBGDMVkg6ODEUS+Q0yDx0MUAz7Cx4RiRFgD5wMAAAAAAAKABQACgAUKQaABRcDcQsfBUEEAwIAAAAAAAAAAAAAMgtACgAUABQECzkIAAZ7BgAFPwNACgAKEghwBwEKQQpFB5gQAAAAAAAAAAAAAAEECReDBKoIEQv2BjYGOwnAChkCnwVAAAAAAAAAAAAAAAAyC3ILcgtyC3ILdhKyC0cPqRCmDVgMcgtyC3ILahNyC3ILUg6rDDoK4wyECzILbRBpCmkUZBC4D2UPogxwDoAIzQ/ND80PzQ/ND80PwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAA";
		var str = atob(base64);
		var data = new Uint8Array(str.length);
		for (var i = 0; i < data.length; i++) {
			data[i] = str.charCodeAt(i);
		}
		return data;
	}());
	function round_to_i32(f) {
		return Math.round(f) | 0;
	}
	var Point = function(x, y) {
		this.x = x;
		this.y = y;
	}
	Point.prototype.clone = function() {
		return new Point(this.x, this.y);
	}
	Point.prototype.add = function(other) {
		return new Point(this.x + other.x, this.y + other.y);
	}
	Point.prototype.sub = function(other) {
		return new Point(this.x - other.x, this.y - other.y);
	}
	var Rectangle = function(xMin, xMax, yMin, yMax) {
		this.xMin = xMin;
		this.xMax = xMax;
		this.yMin = yMin;
		this.yMax = yMax;
	}
	Rectangle.fromObject = function(obj) {
		return new Rectangle(obj.xMin, obj.xMax, obj.yMin, obj.yMax);
	}
	Object.defineProperties(Rectangle.prototype, {
		width: {
			get: function() {
				return this.xMax - this.xMin;
			},
			set: function(width) {
				this.xMax = this.xMin + width;
			}
		},
		height: {
			get: function() {
				return this.yMax - this.yMin;
			},
			set: function(height) {
				this.yMax = this.yMin + height;
			}
		}
	});
	Rectangle.prototype.contains = function(point) {
		return point.x >= this.xMin && point.x <= this.xMax && point.y >= this.yMin && point.y <= this.yMax;
	}
	Rectangle.prototype.clone = function() {
		return new Rectangle(this.xMin, this.xMax, this.yMin, this.yMax);
	}
	Rectangle.prototype.isValid = function() {
		return this.xMin != 0x7ffffff;
	}
	Rectangle.prototype._clamp = function(v, x, y) {
		return (x < v) ? x : ((v > y) ? y : v);
	}
	Rectangle.prototype.clamp = function(point) {
		if (this.isValid()) {
			return new Point(
				this._clamp(point.x, this.xMin, this.xMax),
				this._clamp(point.y, this.yMin, this.yMax)
			);
		} else {
			return point;
		}
	}
	Rectangle.prototype.encompass = function(point) {
		if (this.isValid()) {
			this.xMin = Math.min(this.xMin, point.x);
			this.xMax = Math.max(this.xMax, point.x);
			this.yMin = Math.min(this.yMin, point.y);
			this.yMax = Math.max(this.yMax, point.y);
		} else {
			this.xMin = point.x;
			this.xMax = point.x;
			this.yMin = point.y;
			this.yMax = point.y;
		}
		return this;
	}
	Rectangle.prototype.union = function(other) {
		if (!this.isValid()) {
			return other.clone();
		} else {
			if (other.isValid()) {
				this.xMin = Math.min(this.xMin, other.xMin);
				this.xMax = Math.max(this.xMax, other.xMax);
				this.yMin = Math.min(this.yMin, other.yMin);
				this.yMax = Math.max(this.yMax, other.yMax);
			}
			return this;
		}
	}
	Rectangle.prototype.intersects = function(other) {
		return this.isValid() && this.xMin <= other.xMax && this.xMax >= other.xMin && this.yMin <= other.yMax && this.yMax >= other.yMin;
	}
	Rectangle.INVALID = new Rectangle(0x7ffffff, 0x7ffffff, 0x7ffffff, 0x7ffffff);
	var Matrix = function(a, b, c, d, tx, ty) {
		this.abcd = new Float32Array([a, b, c, d]);
		this.txy = new Int32Array([tx, ty]);
	}
	Matrix.scale = function(scale_x, scale_y) {
		return new Matrix(scale_x, 0, 0, scale_y, 0, 0);
	}
	Matrix.rotate = function(angle) {
		return new Matrix(Math.cos(angle), Math.sin(angle), -Math.sin(angle), Math.cos(angle), 0, 0);
	}
	Matrix.translate = function(x, y) {
		return new Matrix(1, 0, 0, 1, x, y);
	}
	Matrix.fromArray = function(array) {
		return new Matrix(array[0], array[1], array[2], array[3], array[4], array[5]);
	}
	Object.defineProperties(Matrix.prototype, {
		a: {
			get: function() {
				return this.abcd[0];
			},
			set: function(value) {
				this.abcd[0] = value;
			}
		},
		b: {
			get: function() {
				return this.abcd[1];
			},
			set: function(value) {
				this.abcd[1] = value;
			}
		},
		c: {
			get: function() {
				return this.abcd[2];
			},
			set: function(value) {
				this.abcd[2] = value;
			}
		},
		d: {
			get: function() {
				return this.abcd[3];
			},
			set: function(value) {
				this.abcd[3] = value;
			}
		},
		tx: {
			get: function() {
				return this.txy[0];
			},
			set: function(value) {
				this.txy[0] = value;
			}
		},
		ty: {
			get: function() {
				return this.txy[1];
			},
			set: function(value) {
				this.txy[1] = value;
			}
		}
	});
	Matrix.prototype.toArray = function() {
		return [this.abcd[0], this.abcd[1], this.abcd[2], this.abcd[3], this.txy[0], this.txy[1]];
	}
	Matrix.prototype.clone = function() {
		return new Matrix(this.abcd[0], this.abcd[1], this.abcd[2], this.abcd[3], this.txy[0], this.txy[1]);
	}
	Matrix.prototype.copy = function(other) {
		this.abcd[0] = other.abcd[0];
		this.abcd[1] = other.abcd[1];
		this.abcd[2] = other.abcd[2];
		this.abcd[3] = other.abcd[3];
		this.txy[0] = other.txy[0];
		this.txy[1] = other.txy[1];
	}
	Matrix.prototype.mul = function(rhs) {
		var rhs_tx = rhs.txy[0];
		var rhs_ty = rhs.txy[1];
		var out_tx = round_to_i32(this.a * rhs_tx + this.c * rhs_ty) + this.txy[0];
		var out_ty = round_to_i32(this.b * rhs_tx + this.d * rhs_ty) + this.txy[1];
		return new Matrix(
			this.a * rhs.a + this.c * rhs.b,
			this.b * rhs.a + this.d * rhs.b,
			this.a * rhs.c + this.c * rhs.d,
			this.b * rhs.c + this.d * rhs.d,
			out_tx, out_ty
		);
	}
	Matrix.prototype.mulPoint = function(point) {
		var x = point.x;
		var y = point.y;
		var out_x = round_to_i32(this.a * x + this.c * y) + this.tx;
		var out_y = round_to_i32(this.b * x + this.d * y) + this.ty;
		return new Point(out_x, out_y);
	}
	Matrix.prototype.mulRectangle = function(rhs) {
		if (!rhs.isValid()) {
			return Rectangle.INVALID.clone();
		}
		var p0 = this.mulPoint(new Point(rhs.xMin, rhs.yMin));
		var p1 = this.mulPoint(new Point(rhs.xMin, rhs.yMax));
		var p2 = this.mulPoint(new Point(rhs.xMax, rhs.yMin));
		var p3 = this.mulPoint(new Point(rhs.xMax, rhs.yMax));
		return new Rectangle(
			Math.min(Math.min(Math.min(p0.x, p1.x), p2.x), p3.x),
			Math.max(Math.max(Math.max(p0.x, p1.x), p2.x), p3.x),
			Math.min(Math.min(Math.min(p0.y, p1.y), p2.y), p3.y),
			Math.max(Math.max(Math.max(p0.y, p1.y), p2.y), p3.y)
		);
	}
	Matrix.prototype.determinant = function() {
		return this.a * this.d - this.b * this.c;
	}
	Matrix.prototype.inverse = function() {
		var tx = this.tx;
		var ty = this.ty;
		var det = this.determinant();
		if (Math.abs(det) > Number.EPSILON) {
			var a = this.d / det;
			var b = this.b / -det;
			var c = this.c / -det;
			var d = this.a / det;
			var out_tx = round_to_i32((this.d * tx - this.c * ty) / -det);
			var out_ty = round_to_i32((this.b * tx - this.a * ty) / det);
			return new Matrix(a, b, c, d, out_tx, out_ty);
		} else {
			return null;
		}
	}
	Matrix.IDENTITY = new Matrix(1, 0, 0, 1, 0, 0);
	Matrix.TWIPS_TO_PIXELS = new Matrix(1 / 20, 0, 0, 1 / 20, 0, 0);
	var Bitmap = function(width, height, format, data) {
		this.width = width;
		this.height = height;
		this.format = format;
		this.data = data;
	}
	Bitmap.prototype.toRGBA = function() {
		switch (this.format) {
			case Bitmap.YUV420P:
				var luma_len = (this.width * this.height);
				var chroma_len = (this.chroma_width() * this.chroma_height());
				var y = this.data.subarray(0, luma_len);
				var u = this.data.subarray(luma_len, luma_len + chroma_len);
				var v = this.data.subarray(luma_len + chroma_len, luma_len + 2 * chroma_len);
				this.data = yuv420_to_rgba(y, u, v, this.width);
				break;
			case Bitmap.YUVA420P:
				var luma_len = (this.width * this.height);
				var chroma_len = (this.chroma_width() * this.chroma_height());
				var y = this.data.subarray(0, luma_len);
				var u = this.data.subarray(luma_len, luma_len + chroma_len);
				var v = this.data.subarray(luma_len + chroma_len, luma_len + 2 * chroma_len);
				var a = this.data.subarray(luma_len + 2 * chroma_len, 2 * luma_len + 2 * chroma_len);
				this.data = yuv420_to_rgba(y, u, v, this.width);
				for (var i = 0; i < this.data.length; i += 4) 
					this.data[i + 3] = a[(i / 4) | 0];
				break;
		}
		this.format = Bitmap.RGBA;
	};
	Bitmap.prototype.chroma_width = function() {
		return ((this.width + 1) / 2) | 0;
	};
	Bitmap.prototype.chroma_height = function() {
		return ((this.height + 1) / 2) | 0;
	};
	Bitmap.RGBA = 1;
	Bitmap.YUV420P = 2;
	Bitmap.YUVA420P = 3;
	var PixelSnapping = function(type) {
		this.type = type;
	}
	PixelSnapping.prototype.apply = function(matrix) {
		switch (this.type) {
			case PixelSnapping.Always:
				matrix[4] = Math.round(matrix[4] / 20) * 20;
				matrix[5] = Math.round(matrix[5] / 20) * 20;
				break;
			case PixelSnapping.Auto:
				if ((matrix[0] >= 0.999 && matrix[0] <= 1.001) && (matrix[3] >= 0.999 && matrix[3] <= 1.001) && matrix[1] == 0.0 && matrix[2] == 0.0) {
					matrix[0] = 1;
					matrix[3] = 1;
					matrix[4] = Math.round(matrix[4] / 20) * 20;
					matrix[5] = Math.round(matrix[5] / 20) * 20;
				}
				break;
			case PixelSnapping.Never:
				break;
		}
	}
	PixelSnapping.Always = 1;
	PixelSnapping.Auto = 2;
	PixelSnapping.Never = 3;
	PixelSnapping.INSTANCE = {
		Always: new PixelSnapping(PixelSnapping.Always),
		Auto: new PixelSnapping(PixelSnapping.Auto),
		Never: new PixelSnapping(PixelSnapping.Never),
	}
	function determineJpegTagFormat(data) {
		if ((data[0] == 0xff) && (data[1] == 0xd8)) {
			return "jpeg";
		} else if ((data[0] == 0xff) && (data[1] == 0xd9) && (data[2] == 0xff) && (data[3] == 0xd8)) { // erroneous header in SWF
			return "jpeg";
		} else if ((data[0] == 0x89) && (data[1] == 0x50) && (data[2] == 0x4e) && (data[3] == 0x47) && (data[4] == 0x0d) && (data[5] == 0x0a) && (data[6] == 0x1a) && (data[7] == 0x0a)) {
			return "png";
		} else if ((data[0] == 0x47) && (data[1] == 0x49) && (data[2] == 0x46) && (data[3] == 0x38) && (data[4] == 0x39) && (data[5] == 0x61)) {
			return "gif";
		} else {
			return "unknown";
		}
	}
	function decodeDefineBitsJpeg(data, alphaData) {
		var format = determineJpegTagFormat(data);
		var result;
		try {
			switch(format) {
				case "jpeg":
					result = decodeJpeg(data, alphaData);
					break;
				case "gif":
					result = decodeGif(data);
					break;
				case "png":
					console.log("TODO", format, data);
					break;
			}
		} catch(e) {
			console.log(e);
		}
		return result;
	}
	function glueTablesToJpeg(jpedData, jpedTable) {
		if (jpedTable) {
			if ((jpedTable.length >= 2)) {
				var len = jpedTable.length - 2;
				var full_jpeg = new Uint8Array(jpedData.length + jpedTable.length);
				full_jpeg.set(jpedTable.subarray(0, len), 0);
				full_jpeg.set(jpedData.subarray(2), len);
				return full_jpeg;	
			}
		}
		return jpedData;
	}
	function removeInvalidJpegData(JPEGData) {
		var i = 0;
		var idx = 0;
		var str = "";
		var length = JPEGData.length;
		if (JPEGData[0] === 0xFF && JPEGData[1] === 0xD9 && JPEGData[2] === 0xFF && JPEGData[3] === 0xD8) {
			for (i = 4; i < length; i++) {
				str += String.fromCharCode(JPEGData[i]);
			}
		} else if (JPEGData[i++] === 0xFF && JPEGData[i++] === 0xD8) {
			for (idx = 0; idx < i; idx++) {
				str += String.fromCharCode(JPEGData[idx]);
			}
			while (i < length) {
				if (JPEGData[i] === 0xFF) {
					if (JPEGData[i + 1] === 0xD9 && JPEGData[i + 2] === 0xFF && JPEGData[i + 3] === 0xD8) {
						i += 4;
						for (idx = i; idx < length; idx++) {
							str += String.fromCharCode(JPEGData[idx]);
						}
						break;
					} else if (JPEGData[i + 1] === 0xDA) {
						for (idx = i; idx < length; idx++) {
							str += String.fromCharCode(JPEGData[idx]);
						}
						break;
					} else {
						var segmentLength = (JPEGData[i + 2] << 8) + JPEGData[i + 3] + i + 2;
						for (idx = i; idx < segmentLength; idx++) {
							str += String.fromCharCode(JPEGData[idx]);
						}
						i += segmentLength - i;
					}
				}
			}
		} else {
			for (i = 0; i < length; i++) {
				str += String.fromCharCode(JPEGData[i]);
			}
		}
		var dfa = new Uint8Array(str.length);
		for (var i = 0; i < str.length; i++) {
			dfa[i] = str.charCodeAt(i);
		}
		return dfa;
	}
	function decodeJpeg(jpedData, alphaData) {
		var fi = removeInvalidJpegData(jpedData);
		var res = AT_JPG_Decoder.decode(fi);
		var width = res.width;
		var height = res.height;
		var pxData = res.data;
		if (alphaData) {
			var len = width * height;
			var dat = pako.inflate(alphaData);
			var adata = dat;
			var pxIdx = 3;
			for (var i = 0; i < len; i++) {
				pxData[pxIdx] = adata[i];
				pxIdx += 4;
			}
		}
		return new Bitmap(res.width, res.height, "rgba", pxData);
	}
	function decodeGif(gifData) {
		var reader = new GifReader(gifData);
		var pxData = new Uint8Array((reader.width * reader.height) * 4);
		reader.decodeAndBlitFrameRGBA(0, pxData);
		return new Bitmap(reader.width, reader.height, "rgba", pxData);
	}
	function decodeDefineBitsLossless(bitmapTag) {
		var isAlpha = (bitmapTag.version == 2);
		var width = bitmapTag.width;
		var height = bitmapTag.height;
		var format = bitmapTag.format;
		var colorTableSize = 0;
		if (format === 3) 
			colorTableSize = bitmapTag.numColors + 1;
		var decoded_data = pako.inflate(bitmapTag.data);
		var out_data = new Uint8Array((width * height) * 4);
		var idx = 0;
		var pxIdx = 0;
		var x = width;
		var y = height;
		if (format === 5 && !isAlpha) {
			idx = 0;
			pxIdx = 0;
			for (y = height; y--;) {
				for (x = width; x--;) {
					idx++;
					out_data[pxIdx++] = decoded_data[idx++];
					out_data[pxIdx++] = decoded_data[idx++];
					out_data[pxIdx++] = decoded_data[idx++];
					out_data[pxIdx++] = 255;
				}
			}
		} else {
			var bpp = (isAlpha) ? 4 : 3;
			var cmIdx = colorTableSize * bpp;
			var pad = 0;
			if (colorTableSize) 
				pad = ((width + 3) & ~3) - width;
			for (y = height; y--;) {
				for (x = width; x--;) {
					idx = (colorTableSize) ? decoded_data[cmIdx++] * bpp : cmIdx++ * bpp;
					if (!isAlpha) {
						out_data[pxIdx++] = decoded_data[idx++];
						out_data[pxIdx++] = decoded_data[idx++];
						out_data[pxIdx++] = decoded_data[idx++];
						idx++;
						out_data[pxIdx++] = 255;
					} else {
						var alpha = (format === 3) ? decoded_data[idx + 3] : decoded_data[idx++];
						out_data[pxIdx++] = decoded_data[idx++];
						out_data[pxIdx++] = decoded_data[idx++];
						out_data[pxIdx++] = decoded_data[idx++];
						out_data[pxIdx++] = alpha;
						if (format === 3) {
							idx++;
						}
					}
				}
				cmIdx += pad;
			}
		}
		return new Bitmap(width, height, Bitmap.RGBA, out_data);
	}
	var gradientSpread = function(code) {
		switch (code) {
			case 0:
			case 3:
				return "pad";
			case 1: // Reflect
				return "reflect";
			case 2: // Repeat
				return "repeat";
			default:
				return null;
		}
	}
	var gradientInterpolation = function(code) {
		switch (code) {
			case 0:
			case 2:
			case 3:
				return "rgb";
			case 1:
				return "linearRgb";
			default:
				return null;
		}
	}
	function shapeToRendererInfo(shapes) {
		if (Array.isArray(shapes[0])) {
			return [{
				type: 0,
				path2d: shapes,
				fill: {
					type: 0,
					color: [255, 255, 255, 1]
				}
			}];
		}
		var result = [];
		for (var i = 0; i < shapes.length; i++) {
			var s = shapes[i];
			var obj = s.obj;
			var cmd = s.cmd;
			result.push(lagObjToInfo(obj, cmd));
		}
		return result;
	}
	function fixedStrokeCMD(cmds) {
		var result = [];
		var posX = 0, posY = 0;
		var isM = true;
		for (var i = 0; i < cmds.length; i++) {
			var cmd = cmds[i];
			if (cmd[0] == 0) {
				if (isM || !((posX == cmd[1]) && (posY == cmd[2]))) {
					posX = cmd[1], posY = cmd[2];
					result.push([0, posX, posY]);	
					isM = false;
				}
			} else if (cmd[0] == 1) {
				result.push([1, cmd[1], cmd[2], cmd[3], cmd[4]]);
				posX = cmd[3], posY = cmd[4];
			} else if (cmd[0] == 2) {
				result.push([2, cmd[1], cmd[2]]);
				posX = cmd[1], posY = cmd[2];
			}
		}
		return {
			isClosed: false,
			result
		};
	}
	function lagObjToInfo(obj, cmd) {
		var isLine = ("width" in obj);
		if (isLine) {
			return {
				type: 1,
				width: obj.width,
				path2d: cmd,
				fill: lineToInfo(obj),
			};
		} else {
			return {
				type: 0,
				path2d: cmd,
				fill: fillToInfo(obj),
			};
		}
	}
	function fillToInfo(fill) {
		var type = fill.type;
		switch (type) {
			case 0:
				var color = fill.color;
				return {
					type: 0,
					color: color
				};
			case 0x10:
			case 0x12:
			case 0x13:
				var gradient = fill.gradient;
				var gradientMatrix = gradient.matrix;
				var isRadial = (type !== 16);
				var focal = 0;
				if (type == 19) {
					focal = fill.focalPoint;
				}
				var records = gradient.records;
				var css = [];
				for (var rIdx = 0; rIdx < records.length; rIdx++) {
					var record = records[rIdx];
					var color = record.color;
					var ratio = record.ratio;
					css.push([color, ratio]);
				}
				var spreadMode = gradientSpread(gradient.spreadMode);
				var repeatMode = 0;
				if (spreadMode == "repeat") {
					repeatMode = 1;
				}
				if (spreadMode == "reflect") {
					repeatMode = 2;
				}
				return {
					type: 1,
					matrix: gradientMatrix,
					focal: focal,
					isRadial,
					repeat: repeatMode,
					records: css
				};
			case 0x40:
			case 0x41:
			case 0x42:
			case 0x43:
				var bitmapId = fill.bitmapId;
				var bMatrix = fill.bitmapMatrix;
				return {
					type: 2,
					matrix: bMatrix,
					id: bitmapId,
					isSmoothed: fill.isSmoothed,
					isRepeating: fill.isRepeating,
				};
			default:
				return null;
		}
	}
	function lineToInfo(line) {
		if ("fillType" in line) {
			return fillToInfo(line.fillType);
		} else {
			return {
				type: 0,
				color: line.color
			};
		}
	}
	function cloneObject(src) {
		return JSON.parse(JSON.stringify(src));
	}
	var shapeUtils = (function() {
		function stroke_minimum_width(matrix) {
			var sx = Math.sqrt(matrix.a * matrix.a + matrix.b * matrix.b);
			var sy = Math.sqrt(matrix.c * matrix.c + matrix.d * matrix.d);
			var scale = Math.max(sx, sy);
			return scale;
		}
		function winding_number_line(test_point, begin, end) {
			var d0 = { x: test_point.x - begin.x, y: test_point.y - begin.y };
			var d1 = { x: end.x - begin.x, y: end.y - begin.y };
			if (begin.y < test_point.y) {
				if (end.y >= test_point.y && ((d1.x * d0.y) > (d1.y * d0.x))) {
					return 1;
				}
			} else if ((end.y < test_point.y) && ((d1.x * d0.y) < (d1.y * d0.x))) {
				return -1;
			}
			return 0;
		}
		var COEFFICIENT_EPSILON = 0.0000001;
		function solve_quadratic(a, b, c) {
			if (Math.abs(a) <= COEFFICIENT_EPSILON) {
				if (b >= 0.0) {
					return [NaN, -c / b];
				} else {
					return [-c / b, NaN];
				}
			}
			var disc = b * b - 4.0 * a * c;
			if (disc < 0.0) {
				return [NaN, NaN];
			}
			disc = Math.sqrt(disc);
			if (b >= 0.0) {
				var root0 = (-b - disc) / (2.0 * a);
				var root1 = c / (a * root0);
				return [root0, root1];
			} else {
				var root0 = (-b + disc) / (2.0 * a);
				var root1 = c / (a * root0);
				return [root1, root0];
			}
		}
		function solve_cubic(a, b, c, d) {
			var roots = [];
			if (Math.abs(a) <= COEFFICIENT_EPSILON) {
				var t = solve_quadratic(b, c, d);
				roots.push(t[0], t[1]);
				return roots;
			}
			var p = (b * b - 3.0 * a * c) / (9.0 * a * a);
			var q = (9.0 * a * b * c - 27.0 * a * a * d - 2.0 * b * b * b) / (54.0 * a * a * a);
			var offset = b / (3.0 * a);
			var disc = p * p * p - q * q;
			if (disc > 0.0) {
				var theta = Math.acos(q / (p * Math.sqrt(p)));
				var r = 2.0 * Math.sqrt(p);
				var t0 = r * Math.cos(theta / 3.0) - offset;
				var t1 = r * Math.cos((theta + 2.0 * Math.PI) / 3.0) - offset;
				var t2 = r * Math.cos((theta + 4.0 * Math.PI) / 3.0) - offset;
				roots.push(t0, t1, t2);
			} else {
				var gamma1 = Math.cbrt(q + Math.sqrt(-disc));
				var gamma2 = Math.cbrt(q - Math.sqrt(-disc));
				var t0 = gamma1 + gamma2 - offset;
				var t1 = -0.5 * (gamma1 + gamma2) - offset;
				roots.push(t0);
				if (disc == 0.0) {
					roots.push(t1);
				}
			}
			return roots;
		}
		function winding_number_curve(test_point, begin, control, anchor) {
			var d0 = { dx: begin.x - test_point.x, dy: begin.y - test_point.y };
			var d1 = { dx: control.x - test_point.x, dy: control.y - test_point.y };
			var d2 = { dx: anchor.x - test_point.x, dy: anchor.y - test_point.y };
			if ((d0.dy < 0 && d1.dy < 0 && d2.dy < 0) || (d0.dy > 0 && d1.dy > 0 && d2.dy > 0) || (d0.dx <= 0 && d1.dx <= 0 && d2.dx <= 0)) {
				return 0;
			}
			var x0 = d0.dx;
			var y0 = d0.dy;
			var x1 = d1.dx;
			var y1 = d1.dy;
			var x2 = d2.dx;
			var y2 = d2.dy;
			var a = y0 - 2.0 * y1 + y2;
			var b = 2.0 * (y1 - y0);
			var c = y0;
			var t = solve_quadratic(a, b, c);
			var t0 = t[0], t1 = t[1];
			var is_t0_valid = Number.isFinite(t0);
			var is_t1_valid = Number.isFinite(t1);
			if (!is_t0_valid && !is_t1_valid) {
				return 0;
			}
			var winding = 0;
			var ax = x0 - 2.0 * x1 + x2;
			var bx = 2.0 * (x1 - x0);
			var t_extrema = -0.5 * b / a;
			var is_monotonic = t_extrema <= 0.0 || t_extrema >= 1.0;
			if (a >= 0.0) {
				var y_min = is_monotonic ? Math.min(y0, y2) : (a * t_extrema * t_extrema + b * t_extrema + c);
				if (is_t0_valid && y0 >= 0.0 && y_min < 0.0) {
					var x = x0 + bx * t0 + ax * t0 * t0;
					if (x > 0.0) {
						winding += 1;
					}
				}
				if (is_t1_valid && y_min < 0.0 && y2 >= 0.0) {
					var x = x0 + bx * t1 + ax * t1 * t1;
					if (x > 0.0) {
						winding -= 1;
					}
				}
			} else {
				var y_max = is_monotonic ? Math.max(y0, y2) : (a * t_extrema * t_extrema + b * t_extrema + c);
				if (is_t1_valid && y0 < 0.0 && y_max >= 0.0) {
					var x = x0 + bx * t1 + ax * t1 * t1;
					if (x > 0.0) {
						winding -= 1;
					}
				}
				if (is_t0_valid && y_max >= 0.0 && y2 < 0.0) {
					var x = x0 + bx * t0 + ax * t0 * t0;
					if (x > 0.0) {
						winding += 1;
					}
				}
			}
			return winding;
		}
		function hit_test_stroke(test_point, begin, end, _stroke_width) {
			var stroke_width = _stroke_width[0];
			var stroke_width_sq = _stroke_width[1];
			var px = test_point.x;
			var py = test_point.y;
			var x0 = begin.x;
			var y0 = begin.y;
			var x1 = end.x;
			var y1 = end.y;
			var x_min = Math.min(x0, x1);
			var x_max = Math.max(x0, x1);
			if (px < x_min - stroke_width || px > x_max + stroke_width) {
				return false;
			}
			var y_min = Math.min(y0, y1);
			var y_max = Math.max(y0, y1);
			if (py < y_min - stroke_width || py > y_max + stroke_width) {
				return false;
			}
			var abx = x1 - x0;
			var aby = y1 - y0;
			var apx = px - x0;
			var apy = py - y0;
			var dot_a = abx * apx + aby * apy;
			var dist;
			if (dot_a <= 0.0) {
				dist = apx * apx + apy * apy;
			} else {
				var bpx = px - x1;
				var bpy = py - y1;
				var dot_b = abx * bpx + aby * bpy;
				if (dot_b >= 0.0) {
					dist = bpx * bpx + bpy * bpy;
				} else {
					var len = abx * abx + aby * aby;
					var ex = apx - dot_a * abx / len;
					var ey = apy - dot_a * aby / len;
					dist = ex * ex + ey * ey;
				}
			}
			return dist <= stroke_width_sq;
		}
		function hit_test_stroke_curve(test_point, begin, control, anchor, _stroke_width) {
			var stroke_width = _stroke_width[0];
			var stroke_width_sq = _stroke_width[1];
			var px = test_point.x;
			var py = test_point.y;
			var x0 = begin.x;
			var y0 = begin.y;
			var x1 = control.x;
			var y1 = control.y;
			var x2 = anchor.x;
			var y2 = anchor.y;
			var x_min = Math.min(Math.min(x0, x1), x2);
			var x_max = Math.max(Math.max(x0, x1), x2);
			if (px < x_min - stroke_width || px > x_max + stroke_width) {
				return false;
			}
			var y_min = Math.min(Math.min(y0, y1), y2);
			var y_max = Math.max(Math.max(y0, y1), y2);
			if (py < y_min - stroke_width || py > y_max + stroke_width) {
				return false;
			}
			var ax = x1 - x0;
			var ay = y1 - y0;
			var bx = x2 - x1 - ax;
			var by = y2 - y1 - ay;
			var mx = x0 - px;
			var my = y0 - py;
			var a = bx * bx + by * by;
			var b = 3.0 * (ax * bx + ay * by);
			var c = 2.0 * (ax * ax + ay * ay) + (mx * bx + my * by);
			var d = mx * ax + my * ay;
			var distance_to_curve = function(t) {
				var comp_t = 1.0 - t;
				var cx = comp_t * comp_t * x0 + 2.0 * comp_t * t * x1 + t * t * x2;
				var cy = comp_t * comp_t * y0 + 2.0 * comp_t * t * y1 + t * t * y2;
				var dx = cx - px;
				var dy = cy - py;
				return dx * dx + dy * dy;
			}
			var dist = distance_to_curve(0.0);
			dist = Math.min(dist, distance_to_curve(1.0));
			var _r = solve_cubic(a, b, c, d);
			for (var i = 0; i < _r.length; i++) {
				var t = _r[i];
				if (t >= 0.0 && t <= 1.0) {
					dist = Math.min(dist, distance_to_curve(t));
				}
			}
			return dist <= stroke_width_sq;
		}
		function shapeHitTest(shape, test_point, local_matrix) {
			var cursor = { x: 0, y: 0 };
			var winding = 0;
			var has_fill_style0 = false;
			var has_fill_style1 = false;
			var min_width = stroke_minimum_width(local_matrix);
			var stroke_width = null;
			var line_styles = shape.lineStyles;
			for (var i = 0; i < shape.shapeRecords.length; i++) {
				var record = shape.shapeRecords[i];
				if (record.isChange) {
					if (record.stateNewStyles) {
						if ((winding & 0b1) != 0) {
							return true;
						}
						line_styles = record.lineStyles;
						winding = 0;
					}
					if (record.stateMoveTo) {
						cursor.x = record.moveX;
						cursor.y = record.moveY;
					}
					if (record.stateFillStyle0) {
						has_fill_style0 = record.fillStyle0 > 0;
					}
					if (record.stateFillStyle1) {
						has_fill_style1 = record.fillStyle1 > 0;
					}
					if (record.stateLineStyle) {
						if (record.lineStyle > 0) {
							var line_style = line_styles[record.lineStyle - 1];
							if (line_style) {
								var width = line_style.width;
								var scaled_width = 0.5 * width;
								stroke_width = [scaled_width, scaled_width * scaled_width];
							} else {
								stroke_width = null;
							}
						} else {
							stroke_width = null;
						}
					}
				} else {
					if (record.isCurved) {
						var control = { x: cursor.x + record.controlDeltaX, y: cursor.y + record.controlDeltaY };
						var anchor = { x: control.x + record.anchorDeltaX, y: control.y + record.anchorDeltaY };
						if (has_fill_style1) {
							if (!has_fill_style0) {
								winding += winding_number_curve(test_point, cursor, control, anchor);
							}
						} else if (has_fill_style0) {
							winding += winding_number_curve(test_point, anchor, control, cursor);
						}
						if (stroke_width) {
							if (hit_test_stroke_curve(test_point, cursor, control, anchor, stroke_width)) return true;
						}
						cursor.x = anchor.x;
						cursor.y = anchor.y;
					} else {
						var end = { x: cursor.x + record.deltaX, y: cursor.y + record.deltaY };
						if (has_fill_style1) {
							if (!has_fill_style0) {
								winding += winding_number_line(test_point, cursor, end);
							}
						} else if (has_fill_style0) {
							winding += winding_number_line(test_point, end, cursor);
						}
						if (stroke_width) {
							if (hit_test_stroke(test_point, cursor, end, stroke_width)) return true;
						}
						cursor.x = end.x;
						cursor.y = end.y;
					}
				}
			}
			return (winding & 0b1) != 0;
		}
		function drawCommandFillHitTest(commands, test_point) {
			var cursor = { x: 0, y: 0 };
			var fillStart = { x: 0, y: 0 };
			var winding = 0;
			for (var i = 0; i < commands.length; i++) {
				var c = commands[i];
				if (c[0] == 0) {
					cursor.x = c[1];
					cursor.y = c[2];
					fillStart.x = c[1];
					fillStart.y = c[2];
				} else if (c[0] == 1) {
					winding += winding_number_curve(test_point, cursor, { x: c[1], y: c[2] }, { x: c[3], y: c[4] });
					cursor.x = c[3];
					cursor.y = c[4];
				} else if (c[0] == 2) {
					winding += winding_number_line(test_point, cursor, { x: c[1], y: c[2] });
					cursor.x = c[1];
					cursor.y = c[2];
				}
			}
			if (!((cursor.x == fillStart.x) && (cursor.y == fillStart.y))) {
				winding += winding_number_line(test_point, cursor, fillStart);
			}
			return (winding & 0b1) != 0;
		}
		return {
			shapeHitTest,
			drawCommandFillHitTest,
			shapeToRendererInfo,
			calculateShapeBounds: function(shapeRecords) {
				var xMin = Infinity;
				var yMin = Infinity;
				var xMax = -Infinity;
				var yMax = -Infinity;
				function dfgfd(x, y) {
					if (x < xMin) xMin = x;
					if (y < yMin) yMin = y;
					if (x > xMax) xMax = x;
					if (y > yMax) yMax = y;
				}
				var currentPosition = {x: 0, y: 0};
				var hasShapeRecord = false;
				for (var i = 0; i < shapeRecords.length; i++) {
					var record = shapeRecords[i];
					if (!record) continue;
					hasShapeRecord = true;
					if (record.isChange) {
						if (record.stateMoveTo) {
							currentPosition.x = record.moveX;
							currentPosition.y = record.moveY;
							dfgfd(currentPosition.x, currentPosition.y);
						}
					} else {
						var isCurved = record.isCurved;
						if (isCurved) {
							var _controlX = currentPosition.x + record.controlDeltaX;
							var _controlY = currentPosition.y + record.controlDeltaY;
							currentPosition.x = _controlX + record.anchorDeltaX;
							currentPosition.y = _controlY + record.anchorDeltaY;
							dfgfd(_controlX, _controlY);
							dfgfd(currentPosition.x, currentPosition.y);
						} else {
							currentPosition.x += record.deltaX;
							currentPosition.y += record.deltaY;
							dfgfd(currentPosition.x, currentPosition.y);
						}
					}
				}
				if (hasShapeRecord) {
					return {xMin: xMin, xMax: xMax, yMin: yMin, yMax: yMax};
				} else {
					return {xMin: 0, xMax: 0, yMin: 0, yMax: 0};
				}
			},
			convertCurrentPosition: function(src) {
				var array = [];
				var currentPosition = {x: 0, y: 0};
				for (var i = 0; i < src.length; i++) {
					var record = src[i];
					if (record) {
						if (record.isChange) {
							if (record.stateMoveTo) {
								currentPosition.x = record.moveX;
								currentPosition.y = record.moveY;
							}
							array.push(record);
						} else {
							var isCurved = record.isCurved;
							if (isCurved) {
								var _controlX = currentPosition.x + record.controlDeltaX;
								var _controlY = currentPosition.y + record.controlDeltaY;
								currentPosition.x = _controlX + record.anchorDeltaX;
								currentPosition.y = _controlY + record.anchorDeltaY;
								array.push({
									controlX: _controlX,
									controlY: _controlY,
									anchorX: currentPosition.x,
									anchorY: currentPosition.y,
									isCurved: true,
									isChange: false
								});
							} else {
								currentPosition.x += record.deltaX;
								currentPosition.y += record.deltaY;
								array.push({
									controlX: 0,
									controlY: 0,
									anchorX: currentPosition.x,
									anchorY: currentPosition.y,
									isCurved: false,
									isChange: false
								});
							}
						}
					} else {
						array.push(null);
					}
				}
				array.push(null);
				return array;
			},
			convertWithCacheCodes: function(shapeRecords) {
				var records = this.convertCurrentPosition(shapeRecords);
				var _cmd = [];
				for (var i = 0; i < records.length; i++) {
					var record = records[i];
					if (!record) {
						break;
					}
					var isCurved = record.isCurved;
					var isChange = record.isChange;
					var code;
					if (isChange) {
						code = [0, record.moveX, record.moveY];
					} else {
						if (isCurved) {
							code = [1, record.controlX, record.controlY, record.anchorX, record.anchorY];
						} else {
							code = [2, record.anchorX, record.anchorY];
						}
					}
					_cmd.push(code);
				}
				return _cmd;
			},
			convert: function(shapes, type) {
				var isMorph = (type == "morphshape");
				var lineStyles = shapes.lineStyles || [];
				var fillStyles = shapes.fillStyles || [];
				var records = this.convertCurrentPosition(shapes.shapeRecords);
				var idx = 0;
				var obj = {};
				var cache = [];
				var AnchorX = 0;
				var AnchorY = 0;
				var MoveX = 0;
				var MoveY = 0;
				var LineX = 0;
				var LineY = 0;
				var FillStyle0 = 0;
				var FillStyle1 = 0;
				var LineStyle = 0;
				var fills0 = [];
				var fills1 = [];
				var lines = [];
				var stack = [];
				var depth = 0;
				var length = records.length;
				for (var i = 0; i < length; i++) {
					var record = records[i];
					if (!record) {
						this.setStack(stack, this.fillMerge(fills0, fills1, isMorph));
						this.setStack(stack, lines);
						break;
					}
					if (record.isChange) {
						depth++;
						if (record.stateNewStyles) {
							AnchorX = 0;
							AnchorY = 0;
							this.setStack(stack, this.fillMerge(fills0, fills1, isMorph));
							this.setStack(stack, lines);
							fills0 = [];
							fills1 = [];
							lines = [];
							if (record.numFillBits) {
								fillStyles = record.fillStyles;
							}
							if (record.numLineBits) {
								lineStyles = record.lineStyles;
							}
						}
						MoveX = AnchorX;
						MoveY = AnchorY;
						if (record.stateMoveTo) {
							MoveX = record.moveX;
							MoveY = record.moveY;
						}
						LineX = MoveX;
						LineY = MoveY;
						if (record.stateFillStyle0) {
							FillStyle0 = record.fillStyle0;
						}
						if (record.stateFillStyle1) {
							FillStyle1 = record.fillStyle1;
						}
						if (record.stateLineStyle) {
							LineStyle = record.lineStyle;
						}
					} else {
						var isCurved = record.isCurved;
						AnchorX = record.anchorX;
						AnchorY = record.anchorY;
						var ControlX = record.controlX;
						var ControlY = record.controlY;
						if (FillStyle0) {
							idx = FillStyle0 - 1;
							if (!(idx in fills0)) {
								fills0[idx] = [];
							}
							if (!(depth in fills0[idx])) {
								fills0[idx][depth] = {
									obj: fillStyles[idx],
									startX: MoveX,
									startY: MoveY,
									endX: 0,
									endY: 0,
									cache: []
								};
							}
							obj = fills0[idx][depth];
							cache = obj.cache;
							cache[cache.length] = cloneObject(record);
							obj.endX = AnchorX;
							obj.endY = AnchorY;
						}
						if (FillStyle1) {
							idx = FillStyle1 - 1;
							if (!(idx in fills1)) {
								fills1[idx] = [];
							}
							if (!(depth in fills1[idx])) {
								fills1[idx][depth] = {
									obj: fillStyles[idx],
									startX: MoveX,
									startY: MoveY,
									endX: 0,
									endY: 0,
									cache: []
								};
							}
							obj = fills1[idx][depth];
							cache = obj.cache;
							cache[cache.length] = cloneObject(record);
							obj.endX = AnchorX;
							obj.endY = AnchorY;
						}
						if (LineStyle) {
							idx = LineStyle - 1;
							if (!(idx in lines)) {
								lines[idx] = {
									obj: lineStyles[idx],
									cache: []
								};
							}
							obj = lines[idx];
							cache = obj.cache;
							cache[cache.length] = [0, LineX, LineY];
							var code = [2, AnchorX, AnchorY];
							if (isCurved) {
								code = [1, ControlX, ControlY, AnchorX, AnchorY];
							}
							cache[cache.length] = code;
						}
						LineX = AnchorX;
						LineY = AnchorY;
					}
				}
				return stack;
			},
			fillMerge: function(fills0, fills1, isMorph) {
				fills0 = this.fillReverse(fills0);
				if (fills0.length) {
					for (var i in fills0) {
						if (!fills0.hasOwnProperty(i)) {
							continue;
						}
						var fills = fills0[i];
						if (i in fills1) {
							var fill1 = fills1[i];
							for (var depth in fills) {
								if (!fills.hasOwnProperty(depth)) {
									continue;
								}
								fill1[fill1.length] = fills[depth];
							}
						} else {
							fills1[i] = fills;
						}
					}
				}
				return this.coordinateAdjustment(fills1, isMorph);
			},
			fillReverse: function(fills0) {
				if (!fills0.length) {
					return fills0;
				}
				for (var i in fills0) {
					if (!fills0.hasOwnProperty(i)) {
						continue;
					}
					var fills = fills0[i];
					for (var depth in fills) {
						if (!fills.hasOwnProperty(depth)) {
							continue;
						}
						var AnchorX = 0;
						var AnchorY = 0;
						var obj = fills[depth];
						var cacheX = obj.startX;
						var cacheY = obj.startY;
						var cache = obj.cache;
						var length = cache.length;
						if (length) {
							for (var idx in cache) {
								if (!cache.hasOwnProperty(idx)) {
									continue;
								}
								var recode = cache[idx];
								AnchorX = recode.anchorX;
								AnchorY = recode.anchorY;
								recode.anchorX = cacheX;
								recode.anchorY = cacheY;
								cacheX = AnchorX;
								cacheY = AnchorY;
							}
							var array = [];
							if (length > 0) {
								while (length--) {
									array[array.length] = cache[length];
								}
							}
							obj.cache = array;
						}
						cacheX = obj.startX;
						cacheY = obj.startY;
						obj.startX = obj.endX;
						obj.startY = obj.endY;
						obj.endX = cacheX;
						obj.endY = cacheY;
					}
				}
				return fills0;
			},
			coordinateAdjustment: function(fills1, isMorph) {
				for (var i in fills1) {
					if (!fills1.hasOwnProperty(i)) {
						continue;
					}
					var array = [];
					var fills = fills1[i];
					for (var depth in fills) {
						if (!fills.hasOwnProperty(depth)) {
							continue;
						}
						array[array.length] = fills[depth];
					}
					var adjustment = [];
					if (array.length > 1 && !isMorph) {
						var nnvbn = 100000;
						while (nnvbn--) {
							if (!array.length) {
								break;
							}
							var fill = array.shift();
							if (fill.startX === fill.endX && fill.startY === fill.endY) {
								adjustment[adjustment.length] = fill;
								continue;
							}
							var mLen = array.length;
							if (mLen < 0) {
								break;
							}
							var isMatch = 0;
							while (mLen--) {
								var comparison = array[mLen];
								if (comparison.startX === fill.endX && comparison.startY === fill.endY) {
									fill.endX = comparison.endX;
									fill.endY = comparison.endY;
									var cache0 = fill.cache;
									var cache1 = comparison.cache;
									var cLen = cache1.length;
									for (var cIdx = 0; cIdx < cLen; cIdx++) {
										cache0[cache0.length] = cache1[cIdx];
									}
									array.splice(mLen, 1);
									array.unshift(fill);
									isMatch = 1;
									break;
								}
							}
							if (!isMatch) {
								array.unshift(fill);
							}
						}
					} else {
						adjustment = array;
					}
					var aLen = adjustment.length;
					var cache = [];
					var obj = {};
					for (var idx = 0; idx < aLen; idx++) {
						var data = adjustment[idx];
						obj = data.obj;
						var caches = data.cache;
						var cacheLength = caches.length;
						cache[cache.length] = [0, data.startX, data.startY];
						for (var compIdx = 0; compIdx < cacheLength; compIdx++) {
							var r = caches[compIdx];
							var code = [2, r.anchorX, r.anchorY];
							if (r.isCurved) {
								code = [1, r.controlX, r.controlY, r.anchorX, r.anchorY];
							}
							cache[cache.length] = code;
						}
					}
					fills1[i] = {cache: cache, obj: obj};
				}
				return fills1;
			},
			setStack: function(stack, array) {
				if (array.length) {
					for (var i in array) {
						if (!array.hasOwnProperty(i)) {
							continue;
						}
						var data = array[i];
						stack.push({
							obj: data.obj,
							cmd: data.cache
						});
					}
				}
			},
		}
	}());
	var CommandList = function() {
		this.commandLists = [];
		this.maskersInProgress = 0;
	}
	CommandList.prototype.execute = function(renderer) {
		for (var i = 0; i < this.commandLists.length; i++) {
			var tsd = this.commandLists[i];
			switch (tsd[0]) {
				case "render_bitmap":
					renderer.renderBitmap(tsd[1], tsd[2], tsd[3], tsd[4]);
					break;
				case "render_shape":
					renderer.renderShape(tsd[1], tsd[2]);
					break;
				case "draw_rect":
					renderer.drawRect(tsd[1], tsd[2]);
					break;
				case "push_mask":
					renderer.pushMask();
					break;
				case "pop_mask":
					renderer.popMask();
					break;
				case "activate_mask":
					renderer.activateMask();
					break;
				case "deactivate_mask":
					renderer.deactivateMask();
					break;
				case "blend":
					renderer.blend(tsd[1], tsd[2]);
					break;
			}
		}
	}
	CommandList.prototype.drawingMask = function() {
		return this.maskersInProgress > 0;
	}
	CommandList.prototype.clear = function() {
		this.commandLists = [];
	}
	CommandList.prototype.copy = function() {
		var clone = new CommandList();
		clone.commandLists = this.commandLists.slice(0);
		return clone;
	}
	CommandList.prototype.replace = function(commands) {
		this.commandLists = commands.commandLists.slice(0);
	}
	CommandList.prototype.renderBitmap = function(bitmap, transfrom, isSmoothed, pixelSnapping) {
		if (this.maskersInProgress <= 1)
			this.commandLists.push(["render_bitmap", bitmap, transfrom.toArray(), isSmoothed, pixelSnapping]);
	}
	CommandList.prototype.renderShape = function(shape, transfrom) {
		if (this.maskersInProgress <= 1)
			this.commandLists.push([
				"render_shape",
				shape,
				transfrom.toArray()
			]);
	}
	CommandList.prototype.drawRect = function(color, matrix) {
		this.commandLists.push(["draw_rect", color.slice(0), matrix.toArray()]);
	}
	CommandList.prototype.pushMask = function() {
		if (this.maskersInProgress == 0) this.commandLists.push(["push_mask"]);
		this.maskersInProgress += 1;
	}
	CommandList.prototype.activateMask = function() {
		this.maskersInProgress -= 1;
		if (this.maskersInProgress == 0) this.commandLists.push(["activate_mask"]);
	}
	CommandList.prototype.deactivateMask = function() {
		if (this.maskersInProgress == 0)
			this.commandLists.push(["deactivate_mask"]);
		this.maskersInProgress += 1;
	}
	CommandList.prototype.popMask = function() {
		this.maskersInProgress -= 1;
		if (this.maskersInProgress == 0) this.commandLists.push(["pop_mask"]);
	}
	CommandList.prototype.blend = function(commands, blendMode) {
		this.commandLists.push(["blend", commands, blendMode]);
	}
	var AT_Tess = (function() {
		var tessy = (function initTesselator() {
			function vertexCallback(data, polyVertArray) {
				polyVertArray[polyVertArray.length] = data[0];
				polyVertArray[polyVertArray.length] = data[1];
			}
			function begincallback(type) {
				if (type !== libtess.primitiveType.GL_TRIANGLES) {
					console.log('expected TRIANGLES but got type: ' + type);
				}
			}
			function errorcallback(errno) {
				console.log('error callback');
				console.log('error number: ' + errno);
			}
			function combinecallback(coords, data, weight) {
				return [coords[0], coords[1], coords[2]];
			}
			function edgeCallback(flag) {
				// console.log('edge flag: ' + flag);
			}
			var tessy = new libtess.GluTesselator();
			// tessy.gluTessProperty(libtess.gluEnum.GLU_TESS_WINDING_RULE, libtess.windingRule.GLU_TESS_WINDING_POSITIVE);
			tessy.gluTessCallback(libtess.gluEnum.GLU_TESS_VERTEX_DATA, vertexCallback);
			tessy.gluTessCallback(libtess.gluEnum.GLU_TESS_BEGIN, begincallback);
			tessy.gluTessCallback(libtess.gluEnum.GLU_TESS_ERROR, errorcallback);
			tessy.gluTessCallback(libtess.gluEnum.GLU_TESS_COMBINE, combinecallback);
			tessy.gluTessCallback(libtess.gluEnum.GLU_TESS_EDGE_FLAG, edgeCallback);
			return tessy;
		})();
		function TaskList() {
			this.list = [];
			this.hash = Object.create(null);
		}
		TaskList.prototype.push = function(index) {
			if (this.hash[index]) return;
			this.hash[index] = true;
			this.list.push(index);
		};
		TaskList.prototype.pop = function() {
			if (this.list.length) {
				var value = this.list.pop();
				delete this.hash[value];
				return value;
			} else return null;
		};
		function unionFindUnion(obj1, obj2) {
			var root1 = unionFindFind(obj1);
			var root2 = unionFindFind(obj2);
			if (root1 !== root2) {
				if (root1.rank < root2.rank) {
					root1.parent = root2;
				} else {
					root2.parent = root1;
					if (root1.rank === root2.rank) root1.rank += 1;
				}
			}
		}
		function unionFindFind(x) {
			if (x.parent !== x) x.parent = unionFindFind(x.parent);
			return x.parent;
		}
		function subTest(p1, p2 , r) {
			var position;
			var norm = norm2(p1, p2);
			var product, localPosition;
			for (var i = 0; i < 4; i++) {
				product = innerProduct(p1, p2, p1, r[i]);
				if (product <= 0) localPosition = -1;
				else if (product >= norm) localPosition = 1;
				else return false;
				if (i === 0) {
					position = localPosition;
				} else {
					if (localPosition !== position) {
						return false;
					}
				}
			}
			return true;
		}
		function rectanglesCollide(r1, r2) {
			return !(subTest(r1[0], r1[1], r2) || subTest(r1[1], r1[2], r2) || subTest(r2[0], r2[1], r1) || subTest(r2[1], r2[2], r1));
		}
		function innerProduct(p1, p2, p3, p4) {
			return (p2[0] - p1[0]) * (p4[0] - p3[0]) + (p2[1] - p1[1]) * (p4[1] - p3[1]);
		}
		function norm2(p1, p2) {
			var dx = p2[0] - p1[0];
			var dy = p2[1] - p1[1];
			return dx * dx + dy * dy;
		}
		function segmentIntersection(p1, p2, p3, p4) {
			var dx = p2[0] - p1[0];
			var dy = p2[1] - p1[1];
			var dx2 = p4[0] - p3[0];
			var dy2 = p4[1] - p3[1];
			var lambda = ((p2[0] - p3[0]) * dy - dx * (p2[1] - p3[1])) / (dx2 * dy - dx * dy2);
			return [p3[0] + lambda * dx2, p3[1] + lambda * dy2];
		}
		function rayIntersection(p1, p2, p3, p4) {
			var dx = p2[0] - p1[0];
			var dy = p2[1] - p1[1];
			var dx2 = p4[0] - p3[0];
			var dy2 = p4[1] - p3[1];
			var denom = dx2 * dy - dx * dy2;
			if (denom === 0) return {point: p1, valid: true};
			var lambda = ((p2[0] - p3[0]) * dy - dx * (p2[1] - p3[1])) / denom;
			var inter = [p3[0] + lambda * dx2, p3[1] + lambda * dy2];
			if (lambda > 1 || innerProduct(p2, inter, p2, p1) < 0) return {point: inter, valid: false};
			else return {point: inter, valid: true};
		}
		function getData(from, to, w) {
			var ux = to[0] - from[0];
			var uy = to[1] - from[1];
			var Nu = Math.sqrt(ux * ux + uy * uy);
			var theta = Math.acos(ux / Nu);
			if (uy < 0) theta *= -1;
			return {
				angle: theta,
				norm: Nu,
				dir: [ux, uy],
				ortho: [- w * uy / Nu, w * ux / Nu]
			};
		}
		function graphDraw(graph, width, cb, maxAngle) {
			var w = width / 2;
			maxAngle = Math.max(Math.PI, maxAngle || 2 * Math.PI);
			var vertices = graph.vertices.map(function(coords) {
				return {
					coords: coords,
					neighList: []
				};
			});
			var edges = graph.edges.map(function(edge, index) {
				var from = edge[0];
				var to = edge[1];
				var vertexFrom = vertices[from];
				var vertexTo = vertices[to];
				var data = getData(vertexFrom.coords, vertexTo.coords, w);
				vertexFrom.neighList.push({
					to: to,
					angle: data.angle,
					dir: data.dir,
					ortho: data.ortho,
					index: index
				});
				vertexTo.neighList.push({
					to: from,
					angle: data.angle <= 0 ? data.angle + Math.PI : data.angle - Math.PI,
					dir: [-data.dir[0], -data.dir[1]],
					ortho: [-data.ortho[0], -data.ortho[1]],
					index: index
				});
				var obj = {
					rank: 0,
					edge: edge,
					points: {}
				};
				obj.points[to] = {};
				obj.points[from] = {};
				obj.parent = obj;
				return obj;
			});
			var toPostProcess = [];
			vertices.forEach(function(vertex, vindex) {
				var point = vertex.coords;
				var prepared = vertex.neighList;
				prepared.sort(function(a, b) {return a.angle - b.angle;});
				var n = prepared.length;
				if (n === 1) {
					var edge = prepared[0];
					var p1 = [point[0] + edge.ortho[0], point[1] + edge.ortho[1]];
					var p2 = [point[0] - edge.ortho[0], point[1] - edge.ortho[1]];
					var edgePoints = edges[edge.index].points;
					edgePoints[vindex].first_vertex = edge.index;
					edgePoints[vindex].last_vertex = edge.index;
					edgePoints[vindex].first = p1;
					edgePoints[vindex].remove_middle_first = true;
					edgePoints[vindex].remove_middle_last = true;
					edgePoints[vindex].last = p2;
				} else {
					prepared.forEach(function(edge, index) {
						var last = (index === n - 1);
						var next = prepared[last ? 0 : index + 1];
						var edgePoints = edges[edge.index].points;
						var nextPoints = edges[next.index].points;
						edgePoints[vindex].first_vertex = next.index;
						nextPoints[vindex].last_vertex = edge.index;
						var p1 = [point[0] + edge.ortho[0], point[1] + edge.ortho[1]];
						var p2 = [p1[0] + edge.dir[0], p1[1] + edge.dir[1]];
						var p3 = [point[0] - next.ortho[0], point[1] - next.ortho[1]];
						var p4 = [p3[0] + next.dir[0], p3[1] + next.dir[1]];
						var intersection = rayIntersection(p1, p2, p3, p4);
						var newPoint = intersection.point;
						if (intersection.valid) {
							var nextAngle = last ? next.angle + 2 * Math.PI : next.angle;
							if (nextAngle - edge.angle > maxAngle) {
								edgePoints[vindex].first = p1;
								nextPoints[vindex].last = p3;
								var vec = [newPoint[0] - point[0], newPoint[1] - point[1]];
								var invNorm = 1 / Math.sqrt(vec[0] * vec[0] + vec[1] * vec[1]);
								edgePoints[vindex].miter_first = nextPoints[vindex].miter_last = [
									point[0] + w * vec[0] * invNorm,
									point[1] + w * vec[1] * invNorm
								];
							} else {
								edgePoints[vindex].first = newPoint;
								nextPoints[vindex].last = newPoint;
							}
							if (n === 2) {
								edgePoints[vindex].remove_middle_first = true;
								nextPoints[vindex].remove_middle_last = true;
							}
						} else {
							var q1 = [newPoint[0] - edge.ortho[0], newPoint[1] - edge.ortho[1]];
							var q3 = [newPoint[0] + next.ortho[0], newPoint[1] + next.ortho[1]];
		
							toPostProcess.push({
								done: [edge.index, next.index],
								todo: [vindex, edge.to, next.to],
								rectangles: [[p1, newPoint, q1, point], [p3, newPoint, q3, point]]
							});
		
							edgePoints[vindex].first = p1;
							nextPoints[vindex].last = p3;
						}
					});
				}
			});
			edges.forEach(function(obj) {
				var edge = obj.edge;
				var from = edge[0];
				var to = edge[1];
				var obj1 = obj.points[from];
				var obj2 = obj.points[to];
				var fromCoords = vertices[from].coords;
				var toCoords = vertices[to].coords;
				var newPoly = obj.polygon = [];
				if (innerProduct(obj1.last, obj2.first, fromCoords, toCoords) < 0) {
					var i1 = obj1.last_vertex;
					var i2 = obj2.first_vertex;
					unionFindUnion(edges[i1], edges[i2]);
					newPoly.push(segmentIntersection(obj1.miter_last || fromCoords, obj1.last, obj2.first, obj2.miter_first || toCoords));
				} else {
					newPoly.push(obj1.last, obj2.first);
				}
				if (obj2.miter_first) newPoly.push(obj2.miter_first);
				if (!(obj2.remove_middle_first && obj2.remove_middle_last)) newPoly.push(toCoords);
				if (obj2.miter_last) newPoly.push(obj2.miter_last);
				if (innerProduct(obj1.first, obj2.last, fromCoords, toCoords) < 0) {
					var i1 = obj1.first_vertex;
					var i2 = obj2.last_vertex;
					unionFindUnion(edges[i1], edges[i2]);
					newPoly.push(segmentIntersection(obj1.first, obj1.miter_first || fromCoords, obj2.miter_last || toCoords, obj2.last));
				} else {
					newPoly.push(obj2.last, obj1.first);
				}
				if (obj1.miter_first) newPoly.push(obj1.miter_first);
				if (!(obj1.remove_middle_first && obj1.remove_middle_last)) newPoly.push(fromCoords);
				if (obj1.miter_last) newPoly.push(obj1.miter_last);
			});
			var shapeMemo = Object.create(null);
			toPostProcess.forEach(function(obj) {
				var done = Object.create(null);
				var i1 = obj.done[0];
				var i2 = obj.done[1];
				var e1 = edges[i1];
				var e2 = edges[i2];
				unionFindUnion(e1, e2);
				done[i1] = true;
				done[i2] = true;
				var todo = new TaskList();
				obj.todo.forEach(function(vertex) {
					todo.push(vertex);
				});
				var from;
				var r1 = obj.rectangles[0];
				var r2 = obj.rectangles[1];
				while((from = todo.pop()) !== null) {
					vertices[from].neighList.forEach(function(neigh) {
						var index = neigh.index;
						if (done[index]) return;
						var to = neigh.to;
						var rectangle = shapeMemo[index];
						if (!rectangle) {
							var fromCoords = vertices[from].coords;
							var toCoords = vertices[to].coords;
							var p1 = [fromCoords[0] + neigh.ortho[0], fromCoords[1] + neigh.ortho[1]];
							var p2 = [toCoords[0] + neigh.ortho[0], toCoords[1] + neigh.ortho[1]];
							var p3 = [toCoords[0] - neigh.ortho[0], toCoords[1] - neigh.ortho[1]];
							var p4 = [fromCoords[0] - neigh.ortho[0], fromCoords[1] - neigh.ortho[1]];
							rectangle = shapeMemo[index] = [p1, p2, p3, p4];
						}
						done[index] = true;
						if (rectanglesCollide(rectangle, r1) || rectanglesCollide(rectangle, r2)) {
							unionFindUnion(e1, edges[index]);
							todo.push(to);
						}
					});
				}
			});
			var needUnion = [];
			edges.forEach(function(obj, index) {
				if (obj.rank > 0 && obj.parent === obj) {
					obj.union = obj.union || [];
					obj.union.push(obj.polygon);
					needUnion.push(index);
				} else {
					if (obj.parent === obj) {
						cb(obj.polygon);
					} else {
						var root = unionFindFind(obj);
						root.union = root.union || [];
						root.union.push(obj.polygon);
					}
				}
			});
		}
		function triangulate(contours) {
			tessy.gluTessNormal(0, 0, 1);
			var triangleVerts = [];
			tessy.gluTessBeginPolygon(triangleVerts);
			for (var i = 0; i < contours.length; i++) {
				tessy.gluTessBeginContour();
				var contour = contours[i];
				for (var j = 0; j < contour.length; j += 2) {
					var coords = [contour[j], contour[j + 1], 0];
					tessy.gluTessVertex(coords, coords);
				}
				tessy.gluTessEndContour();
			}
			tessy.gluTessEndPolygon();
			return triangleVerts;
		}	
		return {
			stroke: function(arrs, width) {
				var vex = [];
				for (var i = 0; i < arrs.length; i++) {
					var _arr = arrs[i];
					if (_arr.length < 4) continue;
					var vertices = [];
					var edges = [];
					var id = 0;
					for (var j = 0; j < _arr.length; j+=2) {
						var fs1 = _arr[j];
						var fs2 = _arr[j + 1];
						if (j == 0) {
							vertices.push([fs1, fs2])
						} else {
							vertices.push([fs1, fs2])
							edges.push([id - 1, id]);
						}
						id++;
					}
					graphDraw({vertices, edges}, width, function(res) {
						if (res.length == 4) { // TODO
							var x1 = res[0][0];
							var y1 = res[0][1];
							var x2 = res[1][0];
							var y2 = res[1][1];
							var x3 = res[2][0];
							var y3 = res[2][1];
							var x4 = res[3][0];
							var y4 = res[3][1];
							if (isFinite(x1) && isFinite(y1) && isFinite(x2) && isFinite(y2) && isFinite(x3) && isFinite(y3) && isFinite(x4) && isFinite(y4)) {
								vex.push(x1, y1);
								vex.push(x2, y2);
								vex.push(x3, y3);
								vex.push(x1, y1);
								vex.push(x3, y3);
								vex.push(x4, y4);	
							}
						}
					});
				}
				return vex;
			},
			fill: function(data) {
				return triangulate(data);
			}
		}
	}());
	var Filter = function() {}
	Filter.from = function(filter) {
		var type = filter.type;
		switch(type) {
			case 0:
				return DropShadowFilter.from(filter);
			case 1:
				return BlurFilter.from(filter);
			case 2:
				return GlowFilter.from(filter);
			case 3:
				return BevelFilter.from(filter);
			case 6:
				return ColorMatrixFilter.from(filter);
			default:
				console.log(type, filter);
				return null;
		}
	}
	Filter.prototype.scale = function(_x, _y) {}
	Filter.prototype.impotent = function(_x, _y) {
		return false;
	}
	Filter.prototype.calculateDestRect = function(sourceRect) {
		return new Rectangle(sourceRect.xMin, sourceRect.xMax, sourceRect.yMin, sourceRect.yMax);
	}
	var PASS_SCALES = [1.0, 2.1, 2.7, 3.1, 3.5, 3.8, 4.0, 4.2, 4.4, 4.6, 5.0, 6.0, 6.0, 7.0, 7.0];
	var BlurFilter = function(blurX, blurY, passes) {
		Filter.call(this);
		this.blurX = blurX;
		this.blurY = blurY;
		this.passes = passes;
	}
	BlurFilter.prototype = Object.create(Filter.prototype);
	BlurFilter.prototype.constructor = BlurFilter;
	BlurFilter.from = function(filter) {
		return new BlurFilter(filter.blurX, filter.blurY, (filter.flags & (0b11111 << 3)) >> 3);
	}
	BlurFilter.scaleBlur = function(blur, factor) {
		return (blur - 1) * factor + 1;
	}
	BlurFilter.prototype.type = "blur";
	BlurFilter.prototype.clone = function() {
		return new BlurFilter(this.blurX, this.blurY, this.passes);
	}
	BlurFilter.prototype.scale = function(x, y) {
		this.blurX = BlurFilter.scaleBlur(this.blurX, x);
		this.blurY = BlurFilter.scaleBlur(this.blurY, y);
	}
	BlurFilter.prototype.impotent = function(_x, _y) {
		return (this.passes == 0) || (this.blurX <= 1 && this.blurY <= 1);
	}
	BlurFilter.prototype.calculateDestRect = function(sourceRect) {
		var scale = PASS_SCALES[Math.max(Math.min(this.passes, 15), 1) - 1];
		var mx = this.blurX * scale;
		var my = this.blurY * scale;
		var x = (Math.max(mx, 0) * 10) | 0;
		var y = (Math.max(my, 0) * 10) | 0;
		return new Rectangle(
			sourceRect.xMin - x,
			sourceRect.xMax + x,
			sourceRect.yMin - y,
			sourceRect.yMax + y
		)
	}
	var GlowFilter = function(blurX, blurY, color, strength, is_inner, is_knockout, composite_source, num_passes) {
		Filter.call(this);
		this.blurX = blurX;
		this.blurY = blurY;
		this.color = color;
		this.strength = strength;
		this.is_inner = is_inner;
		this.is_knockout = is_knockout;
		this.composite_source = composite_source;
		this.passes = num_passes;
	}
	GlowFilter.prototype = Object.create(Filter.prototype);
	GlowFilter.prototype.constructor = GlowFilter;
	GlowFilter.from = function(filter) {
		var is_inner = filter.flags & (1 << 7);
		var is_knockout = filter.flags & (1 << 6);
		var composite_source = filter.flags & (1 << 5);
		var num_passes = filter.flags & 0b11111;
		return new GlowFilter(filter.blurX, filter.blurY, filter.color.slice(0), filter.strength, is_inner, is_knockout, composite_source, num_passes);
	}
	GlowFilter.prototype.type = "glow";
	GlowFilter.prototype.clone = function() {
		return new GlowFilter(this.blurX, this.blurY, this.color.slice(0), this.strength, this.is_inner, this.is_knockout, this.composite_source, this.passes);
	}
	GlowFilter.prototype.scale = function(x, y) {
		this.blurX = BlurFilter.scaleBlur(this.blurX, x);
		this.blurY = BlurFilter.scaleBlur(this.blurY, y);
	}
	GlowFilter.prototype.impotent = function() {
		return false;
	}
	GlowFilter.prototype.innerBlurFilter = function() {
		return new BlurFilter(this.blurX, this.blurY, this.passes);
	}
	GlowFilter.prototype.calculateDestRect = function(sourceRect) {
		return this.innerBlurFilter().calculateDestRect(sourceRect);
	}
	var DropShadowFilter = function(blurX, blurY, color, angle, distance, strength, is_inner, is_knockout, composite_source, num_passes) {
		Filter.call(this);
		this.color = color;
		this.blurX = blurX;
		this.blurY = blurY;
		this.angle = angle;
		this.distance = distance;
		this.strength = strength;
		this.is_inner = is_inner;
		this.is_knockout = is_knockout;
		this.composite_source = composite_source;
		this.passes = num_passes;
	}
	DropShadowFilter.prototype = Object.create(Filter.prototype);
	DropShadowFilter.prototype.constructor = DropShadowFilter;
	DropShadowFilter.from = function(filter) {
		var is_inner = filter.flags & (1 << 7);
		var is_knockout = filter.flags & (1 << 6);
		var composite_source = filter.flags & (1 << 5);
		var num_passes = filter.flags & 0b11111;
		return new DropShadowFilter(filter.blurX, filter.blurY, filter.color.slice(0), filter.angle, filter.distance, filter.strength, is_inner, is_knockout, composite_source, num_passes);
	}
	DropShadowFilter.prototype.type = "drop_shadow";
	DropShadowFilter.prototype.clone = function() {
		return new DropShadowFilter(this.blurX, this.blurY, this.color.slice(0), this.angle, this.distance, this.strength, this.is_inner, this.is_knockout, this.composite_source, this.passes);
	}
	DropShadowFilter.prototype.scale = function(x, y) {
		this.blurX = BlurFilter.scaleBlur(this.blurX, x);
		this.blurY = BlurFilter.scaleBlur(this.blurY, y);
		this.distance *= y;
	}
	DropShadowFilter.prototype.impotent = function() {
		return false;
	}
	DropShadowFilter.prototype.innerGlowFilter = function() {
		return new GlowFilter(this.blurX, this.blurY, this.color.slice(0), this.strength, this.is_inner, this.is_knockout, this.composite_source, this.passes);
	}
	DropShadowFilter.prototype.calculateDestRect = function(sourceRect) {
		var result = this.innerGlowFilter().calculateDestRect(sourceRect);
		var distance = this.distance;
		var angle = this.angle;
		var x = ((Math.cos(angle) * distance) * 20) | 0;
		var y = ((Math.sin(angle) * distance) * 20) | 0;
		if (x < 0) result.xMin += x;
		else result.xMax += x;
		if (y < 0) result.yMin += y;
		else result.yMax += y;
		return result;
	}
	var BevelFilter = function(blurX, blurY, num_passes, angle, distance, strength, shadow_color, highlight_color, is_inner, is_knockout, is_on_top) {
		Filter.call(this);
		this.blurX = blurX;
		this.blurY = blurY;
		this.passes = num_passes;
		this.angle = angle;
		this.distance = distance;
		this.strength = strength;
		this.shadow_color = shadow_color;
		this.highlight_color = highlight_color;
		this.is_inner = is_inner;
		this.is_knockout = is_knockout;
		this.is_on_top = is_on_top;
	}
	BevelFilter.prototype = Object.create(Filter.prototype);
	BevelFilter.prototype.constructor = BevelFilter;
	BevelFilter.from = function(filter) {
		var is_inner = filter.flags & (1 << 7);
		var is_knockout = filter.flags & (1 << 6);
		var composite_source = filter.flags & (1 << 5);
		var on_top = filter.flags & (1 << 4);
		var num_passes = filter.flags & 0b1111;
		return new BevelFilter(filter.blurX, filter.blurY, num_passes, filter.angle, filter.distance, filter.strength, filter.shadowColor, filter.highlightColor, is_inner, is_knockout, on_top);
	}
	BevelFilter.prototype.type = "bevel";
	BevelFilter.prototype.scale = function(x, y) {
		this.blurX *= x;
		this.blurY *= y;
		this.distance *= y;
	}
	BevelFilter.prototype.impotent = function() {
		return false;
	}
	BevelFilter.prototype.clone = function() {
		return new BevelFilter(this.blurX, this.blurY, this.passes, this.angle, this.distance, this.strength, this.shadow_color.slice(0), this.highlight_color.slice(0), this.is_inner, this.is_knockout, this.is_on_top);
	}
	BevelFilter.prototype.innerBlurFilter = function() {
		return new BlurFilter(this.blurX, this.blurY, this.passes);
	}
	BevelFilter.prototype.calculateDestRect = function(sourceRect) {
		var result = this.innerBlurFilter().calculateDestRect(sourceRect);
		var distance = this.distance;
		var angle = this.angle;
		var x = ((Math.cos(angle) * distance) * 20) | 0;
		var y = ((Math.sin(angle) * distance) * 20) | 0;
		if (x < 0) result.xMin += x;
		else result.xMax += x;
		if (y < 0) result.yMin += y;
		else result.yMax += y;
		return result;
	}
	var ColorMatrixFilter = function(matrix) {
		Filter.call(this);
		this.matrix = matrix;
	}
	ColorMatrixFilter.prototype = Object.create(Filter.prototype);
	ColorMatrixFilter.prototype.constructor = ColorMatrixFilter;
	ColorMatrixFilter.from = function(filter) {
		return new ColorMatrixFilter(filter.slice(0));
	}
	ColorMatrixFilter.prototype.type = "color_matrix";
	ColorMatrixFilter.prototype.clone = function() {
		return new ColorMatrixFilter(this.matrix.slice(0));
	}
	var StageQuality = function(type) {
		this.type = type;
	}
	StageQuality.fromStr = function(s) {
		switch (s.toLowerCase()) {
			case "low": return new StageQuality(StageQuality.Low);
			case "medium": return new StageQuality(StageQuality.Medium);
			case "high": return new StageQuality(StageQuality.High);
			default: return null;
		}
	}
	StageQuality.prototype.toString = function() {
		switch (this.type) {
			case StageQuality.Low: return "low";
			case StageQuality.Medium: return "medium";
			case StageQuality.High: return "high";
			default: return null;
		}
	}
	StageQuality.prototype.set = function(other) {
		this.type = other.type;
	}
	StageQuality.Low = 1;
	StageQuality.Medium = 2;
	StageQuality.High = 3;
	StageQuality.Best = 4;
	StageQuality.High8x8 = 5;
	StageQuality.High8x8Linear = 6;
	StageQuality.High16x16 = 7;
	StageQuality.High16x16Linear = 8;
	var RenderCanvas2dShapeInterval = function(renderer, interval) {
		this.renderer = renderer;
		this.shapeIntervalData = interval;
	}
	RenderCanvas2dShapeInterval.prototype.delete = function() {}
	var RenderCanvas2dTexture = function(renderer) {
		this.renderer = renderer;
		this.width = 0;
		this.height = 0;
		this.texture = null;
		this.ctx = null;
		this.isColorTransformCache = false;
		this.c = [NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN];
	}
	RenderCanvas2dTexture.prototype._initColorTransformCache = function() {
		this.tmpCanvas = document.createElement("canvas");
		this.tmpCtx = this.tmpCanvas.getContext("2d");
		this.isColorTransformCache = true;
	}
	RenderCanvas2dTexture.prototype.getTexture = function(color) {
		if (color && checkImageColorTransform(color)) {
			if (!this.isColorTransformCache) this._initColorTransformCache();
			if (this.c[0] != color[0] || this.c[1] != color[1] || this.c[2] != color[2] || this.c[3] != color[3] || this.c[4] != color[4] || this.c[5] != color[5] || this.c[6] != color[6] || this.c[7] != color[7]) {
				var width = this.texture.width;
				var height = this.texture.height;
				this.tmpCanvas.width = width;
				this.tmpCanvas.height = height;
				this.tmpCtx.drawImage(this.texture, 0, 0);
				var imgData = this.tmpCtx.getImageData(0, 0, width, height);
				var pxData = imgData.data;
				var idx = 0;
				var RedMultiTerm = color[0];
				var GreenMultiTerm = color[1];
				var BlueMultiTerm = color[2];
				var AlphaMultiTerm = color[3];
				var RedAddTerm = color[4];
				var GreenAddTerm = color[5];
				var BlueAddTerm = color[6];
				var AlphaAddTerm = color[7];
				var length = width * height;
				if (length > 0) {
					while (length--) {
						var R = pxData[idx++];
						var G = pxData[idx++];
						var B = pxData[idx++];
						var A = pxData[idx++];
						pxData[idx - 4] = Math.max(0, Math.min((R * RedMultiTerm) + RedAddTerm, 255)) | 0;
						pxData[idx - 3] = Math.max(0, Math.min((G * GreenMultiTerm) + GreenAddTerm, 255)) | 0;
						pxData[idx - 2] = Math.max(0, Math.min((B * BlueMultiTerm) + BlueAddTerm, 255)) | 0;
						pxData[idx - 1] = Math.max(0, Math.min((A * AlphaMultiTerm) + AlphaAddTerm, 255));
					}
				}
				this.tmpCtx.putImageData(imgData, 0, 0);
				this.c[0] = color[0];
				this.c[1] = color[1];
				this.c[2] = color[2];
				this.c[3] = color[3];
				this.c[4] = color[4];
				this.c[5] = color[5];
				this.c[6] = color[6];
				this.c[7] = color[7];
			}
			return this.tmpCanvas;
		} else {
			return this.texture;
		}
	}
	RenderCanvas2dTexture.prototype.emptyImage = function(width, height) {
		this.setImageData(null);
	}
	RenderCanvas2dTexture.prototype.setImageData = function(image) {
		this.c = [NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN];
		this.isColorTransformCache = false;
		if (!this.texture) {
			this.texture = document.createElement("canvas");
			this.ctx = this.texture.getContext("2d");
		}
		if (!image) {
			this.texture.width = 1;
			this.texture.height = 1;
			this.width = 0;
			this.height = 0;
			return;
		}
		this.width = image.width;
		this.height = image.height;
		var imageData = this.ctx.createImageData(image.width, image.height);
		imageData.data.set(image.data, 0);
		this.texture.width = image.width;
		this.texture.height = image.height;
		this.ctx.putImageData(imageData, 0, 0);
	}
	RenderCanvas2dTexture.prototype.setImage = function(image) {
		this.setImageData(image);
	}
	RenderCanvas2dTexture.prototype.delete = function() {
		if (this.texture) {
			this.texture.width = 1;
			this.texture.height = 1;
		}
		this.width = 0;
		this.height = 0;
	}
	function sameBlendMode(first, second) {
		return first == second;
	}
	function twipsToNumber(twips) {
		var n = ((twips || 0) / 20);
		return +n.toFixed(2);
	}
	function twipsToMatrix(matrix) {
		return [matrix[0], matrix[1], matrix[2], matrix[3], matrix[4] / 20, matrix[5] / 20];
	}
	function twipsToBitmapMatrix(matrix) {
		return [matrix[0] / 20, matrix[1] / 20, matrix[2] / 20, matrix[3] / 20, matrix[4] / 20, matrix[5] / 20];
	}
	function executePathCmd(ctx, cmd) {
		for (var i = 0; i < cmd.length; i++) {
			switch (cmd[i]) {
				case 0:
					ctx.moveTo(cmd[i + 1] / 20, cmd[i + 2] / 20);
					i += 2;
					break;
				case 1:
					ctx.quadraticCurveTo(cmd[i + 1] / 20, cmd[i + 2] / 20, cmd[i + 3] / 20, cmd[i + 4] / 20);
					i += 4;
					break;
				case 2:
					ctx.lineTo(cmd[i + 1] / 20, cmd[i + 2] / 20);
					i += 2;
					break;
			}
		}
	}
	var RenderCanvas2d = function() {
		this.canvas = document.createElement("canvas");
		this.ctx = this.canvas.getContext("2d");
		this.quality = "high";
		this.width = 640;
		this.height = 480;
		this.canvas.width = this.width;
		this.canvas.height = this.height;
		this.maskState = 0;
		this.blendModes = ["normal"];
	}
	RenderCanvas2d.prototype.setQuality = function(quality) {
		this.quality = quality;
	}
	RenderCanvas2d.prototype.submitFrame = function(clear, commands, _cache_entries) {
		this.ctx.setTransform(1, 0, 0, 1, 0, 0);
		this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
		var css = "rgba(" + [clear[0], clear[1], clear[2], 1] + ")";
		this.ctx.fillStyle = css;
		this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
		commands.execute(this);
	}
	RenderCanvas2d.prototype.isAllowImageColorTransform = function() {
		return (this.quality == "high");
	}
	RenderCanvas2d.prototype.buildCmd2dPath = function(cmd) {
		var result = [];
		for (var i = 0; i < cmd.length; i++) {
			var h = cmd[i];
			if (h) Array.prototype.push.apply(result, h);
		}
		return new Int32Array(result);
	}
	RenderCanvas2d.prototype.shapeToInterval = function(shapeCache, library) {
		var result = [];
		for (var i = 0; i < shapeCache.length; i++) {
			var si = shapeCache[i];
			result.push(this.shapeToCanvas(si, library));
		}
		return new RenderCanvas2dShapeInterval(this, result);
	}
	RenderCanvas2d.prototype.shapeToCanvas = function(shape, library) {
		var isStroke = (shape.type == 1);
		var width = twipsToNumber(shape.width);
		var fillInfo = shape.fill;
		if (!fillInfo) return;
		var cmdResult = this.buildCmd2dPath(shape.path2d);
		if (fillInfo.type == 0) {
			return {
				type: 0,
				cmd: cmdResult,
				color: fillInfo.color.slice(0),
				isStroke: isStroke,
				width: width
			};
		} else if (fillInfo.type == 1) {
			return {
				type: 1,
				cmd: cmdResult,
				isRadial: fillInfo.isRadial,
				focal: fillInfo.focal,
				matrix: fillInfo.matrix,
				records: cloneObject(fillInfo.records),
				isStroke: isStroke,
				width: width
			};
		} else if (fillInfo.type == 2) {
			var id = fillInfo.id;
			var texture = library.bitmapHandle(id, this);
			return {
				type: 2,
				cmd: cmdResult,
				matrix: fillInfo.matrix,
				texture,
				isSmoothed: fillInfo.isSmoothed,
				isRepeating: fillInfo.isRepeating,
				isStroke: isStroke,
				width: width
			};
		}
	}
	RenderCanvas2d.prototype.applyBlendMode = function(blendMode) {
		var mode = 'source-over';
		switch(blendMode) {
			case "multiply":
				mode = 'multiply';
				break;
			case "screen":
				mode = 'screen';
				break;
			case "lighten":
				mode = 'lighten';
				break;
			case "darken":
				mode = 'darken';
				break;
			case "difference":
			case "subtract":
				mode = 'difference';
				break;
			case "add":
				mode = 'lighter';
				break;
			case "overlay":
				mode = 'overlay';
				break;
			case "hardlight":
				mode = 'hard-light';
				break;
		}
		this.ctx.globalCompositeOperation = mode;
	}
	RenderCanvas2d.prototype.pushBlendMode = function(blendMode) {
		if (!sameBlendMode(this.blendModes[this.blendModes.length - 1], blendMode)) this.applyBlendMode(blendMode);
		this.blendModes.push(blendMode);
	}
	RenderCanvas2d.prototype.popBlendMode = function() {
		var old = this.blendModes.pop();
		var current = this.blendModes[this.blendModes.length - 1] || "normal";
		if (!sameBlendMode(old, current)) this.applyBlendMode(current);
	}
	RenderCanvas2d.prototype.destroy = function() {
	}
	RenderCanvas2d.prototype.is_offscreen_supported = function() {
		return false;
	}
	RenderCanvas2d.prototype.debugInfo = function() {
		return "Renderer: Canvas";
	} 
	RenderCanvas2d.prototype.name = "canvas";
	RenderCanvas2d.prototype.resize = function(w, h) {
		this.width = w;
		this.height = h;
		this.canvas.width = this.width;
		this.canvas.height = this.height;
	}
	RenderCanvas2d.prototype.registerShape = function(shapes, library) {
		return this.shapeToInterval(shapes, library);
	}
	RenderCanvas2d.prototype.createEmptyTexture = function(width, height) {
		var tex = new RenderCanvas2dTexture(this);
		tex.emptyImage(width, height);
		return tex;
	}
	RenderCanvas2d.prototype.registerBitmap = function(image) {
		image.toRGBA();
		var tex = new RenderCanvas2dTexture(this);
		tex.setImage(image);
		return tex;
	}
	RenderCanvas2d.prototype.updateTexture = function(handle, image) {
		if (handle) {
			image.toRGBA();
			handle.setImage(image);
		}
	}
	RenderCanvas2d.prototype.renderBitmap = function(texture, transform, isSmoothed, _pixelSnapping) {
		var matrixTransform = transform.matrix;
		var colorTransform = transform.colorTransform;
		var tMatrix = twipsToMatrix(matrixTransform);
		var isA = this.isAllowImageColorTransform();
		this.ctx.imageSmoothingEnabled = (isSmoothed || false);
		if (texture) {
			this.ctx.setTransform.apply(this.ctx, tMatrix);
			if ((!isA) || (!checkImageColorTransform(colorTransform))) this.ctx.globalAlpha = Math.max(0, Math.min((255 * colorTransform[3]) + colorTransform[7], 255)) / 255;
			this.ctx.drawImage(texture.getTexture(isA ? colorTransform : null), 0, 0);
			this.ctx.globalAlpha = 1;
		}
	}
	RenderCanvas2d.prototype.renderShape = function(shapeInterval, transform) {
		var matrixTransform = transform.matrix;
		var colorTransform = transform.colorTransform;
		var tMatrix = twipsToMatrix(matrixTransform);
		var shapeRecords = shapeInterval.shapeIntervalData;
		var isA = this.isAllowImageColorTransform();
		for (var i = 0; i < shapeRecords.length; i++) {
			var si = shapeRecords[i];
			if (!si) return;
			var isStroke = si.isStroke;
			var cmd = si.cmd;
			var width = si.width || 0;
			if (this.maskState == 1) {
				this.ctx.setTransform.apply(this.ctx, tMatrix);
				executePathCmd(this.ctx, cmd);
			} else if (this.maskState == 2) {
				// Canvas backend doesn't have to do anything to clear masks.
			} else {
				if (si.type == 0) {
					var color = si.color;
					this.ctx.setTransform.apply(this.ctx, tMatrix);
					this.ctx.beginPath();
					executePathCmd(this.ctx, cmd);
					var css = 'rgba(' + generateColorTransform(color, colorTransform).join(',') + ')';
					if (isStroke) {
						this.ctx.lineWidth = width;
						this.ctx.lineCap = "round";
						this.ctx.lineJoin = "round";
						this.ctx.strokeStyle = css;
						this.ctx.stroke();
					} else {
						this.ctx.fillStyle = css;
						this.ctx.fill();
					}
				} else if (si.type == 1) {
					var isRadial = si.isRadial;
					this.ctx.setTransform.apply(this.ctx, tMatrix);
					this.ctx.beginPath();
					executePathCmd(this.ctx, cmd);
					var css;
					if (isRadial) {
						css = this.ctx.createRadialGradient((16384 * Math.min(Math.max(si.focal, -0.98), 0.98)), 0, 0, 0, 0, 16384);
					} else {
						css = this.ctx.createLinearGradient(-16384, -16384, 16384, -16384);
					}
					for (var j = 0; j < si.records.length; j++) {
						var rc = si.records[j];
						css.addColorStop(rc[1], 'rgba(' + generateColorTransform(rc[0], colorTransform).join(',') + ')');
					}
					this.ctx.save();
					this.ctx.transform.apply(this.ctx, twipsToBitmapMatrix(si.matrix));
					if (isStroke) {
						this.ctx.lineWidth = width;
						this.ctx.lineCap = "round";
						this.ctx.lineJoin = "round";
						this.ctx.strokeStyle = css;
						this.ctx.stroke();
					} else {
						this.ctx.fillStyle = css;
						this.ctx.fill();
					}
					this.ctx.restore();
				} else if (si.type == 2) {
					var bMatrix = twipsToBitmapMatrix(si.matrix);
					var repeat = si.isRepeating ? "repeat" : "no-repeat";
					var texture = si.texture;
					if (texture) {
						this.ctx.setTransform.apply(this.ctx, tMatrix);
						this.ctx.beginPath();
						executePathCmd(this.ctx, cmd);
						this.ctx.save();
						this.ctx.transform.apply(this.ctx, bMatrix);
						this.ctx.imageSmoothingEnabled = (si.isSmoothed || false);
						var image = texture.getTexture(isA ? colorTransform : null);
						if ((!isA) || (!checkImageColorTransform(colorTransform))) this.ctx.globalAlpha = Math.max(0, Math.min((255 * colorTransform[3]) + colorTransform[7], 255)) / 255;
						var p = this.ctx.createPattern(image, repeat);
						this.ctx.fillStyle = p;
						this.ctx.fill();
						this.ctx.globalAlpha = 1;
						this.ctx.restore();
					}
				}
			}
		}
	}
	RenderCanvas2d.prototype.drawRect = function(color, matrix) {
		var tMatrix = twipsToMatrix(matrix);
		if (this.maskState == 1) {
			this.ctx.setTransform.apply(this.ctx, tMatrix);
			this.ctx.beginPath();
			this.ctx.moveTo(0, 0);
			this.ctx.lineTo(1, 0);
			this.ctx.lineTo(1, 1);
			this.ctx.lineTo(0, 1);
			this.ctx.lineTo(0, 0);
		} else if (this.maskState == 0) {
			this.ctx.setTransform.apply(this.ctx, tMatrix);
			var css = "rgba(" + [color[0], color[1], color[2], color[3]] + ")";
			this.ctx.fillStyle = css;
			this.ctx.fillRect(0, 0, 1, 1);
		}
	}
	RenderCanvas2d.prototype.pushMask = function() {
		// Save the current mask layer so that it can be restored when the mask is popped.
		if (this.maskState == 0) {
			this.ctx.beginPath();
			this.ctx.save();
			this.maskState = 1;
		}
	}
	RenderCanvas2d.prototype.activateMask = function() {
		this.ctx.clip();
		this.maskState = 0;
	}
	RenderCanvas2d.prototype.deactivateMask = function() {
		if (this.maskState == 0) {
			this.maskState = 2;
		}
	}
	RenderCanvas2d.prototype.popMask = function() {
		if (this.maskState == 2) {
			// Pop the previous clipping state.
			this.ctx.restore();
			this.maskState = 0;
		}
	}
	RenderCanvas2d.prototype.blend = function(commands, blendMode) {
		this.pushBlendMode(blendMode);
		commands.execute(this);
		this.popBlendMode();
	}
	function QuadraticBezierP0( t, p ) {
		var k = 1 - t;
		return k * k * p;
	}
	function QuadraticBezierP1( t, p ) {
		return 2 * (1 - t) * t * p;
	}
	function QuadraticBezierP2( t, p ) {
		return t * t * p;
	}
	function QuadraticBezier(t, p0, p1, p2) {
		return QuadraticBezierP0(t, p0) + QuadraticBezierP1(t, p1) + QuadraticBezierP2(t, p2);
	}
	function swf_to_gl_matrix(m) {
		var tx = m[4];
		var ty = m[5];
		var det = m[0] * m[3] - m[2] * m[1];
		var a = m[3] / det;
		var b = -m[2] / det;
		var c = -(tx * m[3] - m[2] * ty) / det;
		var d = -m[1] / det;
		var e = m[0] / det;
		var f = (tx * m[1] - m[0] * ty) / det;
		a *= 20 / 32768.0;
		b *= 20 / 32768.0;
		d *= 20 / 32768.0;
		e *= 20 / 32768.0;
		c /= 32768.0;
		f /= 32768.0;
		c += 0.5;
		f += 0.5;
		return [a, d, 0.0, b, e, 0.0, c, f, 1.0];
	}
	function swf_bitmap_to_gl_matrix(m, bitmap_width, bitmap_height) {
		var tx = m[4];
		var ty = m[5];
		var det = m[0] * m[3] - m[2] * m[1];
		var a = m[3] / det;
		var b = -m[2] / det;
		var c = -(tx * m[3] - m[2] * ty) / det;
		var d = -m[1] / det;
		var e = m[0] / det;
		var f = (tx * m[1] - m[0] * ty) / det;
		a *= 20 / bitmap_width;
		b *= 20 / bitmap_width;
		d *= 20 / bitmap_height;
		e *= 20 / bitmap_height;
		c /= bitmap_width;
		f /= bitmap_height;
		return [a, d, 0.0, b, e, 0.0, c, f, 1.0];
	}
	var RenderWebGLShapeInterval = function(renderer, interval) {
		this.renderer = renderer;
		this.shapeIntervalData = interval;
	}
	RenderWebGLShapeInterval.prototype.delete = function() {}
	var RenderWebGLImageInterval = function(renderer, width, height, texture) {
		this.renderer = renderer;
		this.width = width;
		this.height = height;
		this.texture = texture;
	}
	RenderWebGLImageInterval.prototype.delete = function() {
		if (this.texture) {
			this.renderer.gl.deleteTexture(this.texture);
		}
	}
	var Shader = function(gl, program) {
		this.gl = gl;
		this.program = program;
		this.uniformLocations = {};
		this.attributeLocations = {};
		var activeUniforms = gl.getProgramParameter(program, this.gl.ACTIVE_UNIFORMS);
		for (var index = 0; index < activeUniforms; index++) {
			var info = gl.getActiveUniform(program, index);
			if (!info) {
				throw new Error('uniform at index ' + index + ' does not exist');
			}
			var name = info.name;
			var location = gl.getUniformLocation(program, name);
			if (!location) {
				throw new Error('uniform named ' + name + ' does not exist');
			}
			this.uniformLocations[name] = location;
		}
		var activeAttributes = gl.getProgramParameter(program, this.gl.ACTIVE_ATTRIBUTES);
		for (var index = 0; index < activeAttributes; index++) {
			var info = gl.getActiveAttrib(program, index);
			if (!info) {
				throw new Error('attribute at index ' + index + ' does not exist');
			}
			this.attributeLocations[info.name] = gl.getAttribLocation(program, info.name);
		}
	}
	Shader.prototype.uniform1f = function(name, value) {
		var location = this.getUniform(name);
		this.gl.uniform1f(location, value);
	}
	Shader.prototype.uniform1i = function(name, value) {
		var location = this.getUniform(name);
		this.gl.uniform1i(location, value);
	}
	Shader.prototype.uniform1fv = function(name, value) {
		var location = this.getUniform(name);
		this.gl.uniform1fv(location, value);
	}
	Shader.prototype.uniform4fv = function(name, value) {
		var location = this.getUniform(name);
		this.gl.uniform4fv(location, value);
	}
	Shader.prototype.uniform2f = function(name, a, b) {
		var location = this.getUniform(name);
		this.gl.uniform2f(location, a, b);
	}
	Shader.prototype.uniform3f = function(name, a, b, c) {
		var location = this.getUniform(name);
		this.gl.uniform3f(location, a, b, c);
	}
	Shader.prototype.uniform4f = function(name, a, b, c, d) {
		var location = this.getUniform(name);
		this.gl.uniform4f(location, a, b, c, d);
	}
	Shader.prototype.uniformMatrix3 = function(name, value) {
		var location = this.getUniform(name);
		this.gl.uniformMatrix3fv(location, false, value);
	}
	Shader.prototype.uniformMatrix4 = function(name, value) {
		var location = this.getUniform(name);
		this.gl.uniformMatrix4fv(location, false, value);
	}
	Shader.prototype.hasUniform = function(name) {
		return this.uniformLocations.hasOwnProperty(name);
	}
	Shader.prototype.getUniform = function(name) {
		if (!this.hasUniform(name)) {
			throw new Error('uniform of name ' + name + ' does not exist');
		}
		return this.uniformLocations[name];
	}
	var Shaders = function(gl) {
		this.isFilter = false;
		this.gl = gl;
		this.shaderTexture = this.createShader(Shaders.shader_texture, Shaders.shader_bitmap);
		this.shaderColor = this.createShader(Shaders.shader_color_vertex, Shaders.shader_color_fragment);
		this.shaderGradient = this.createShader(Shaders.shader_texture, Shaders.shader_gradient);
		this.shaderCopy = this.createShader(Shaders.shader_texture, Shaders.shader_copy);

		// blends
		this.shaderBlendNormal = this.createShader(Shaders.shader_texture, Shaders.shader_blend_normal);
		this.shaderBlendAdd = this.createShader(Shaders.shader_texture, Shaders.shader_blend_add);
		this.shaderBlendSubtract = this.createShader(Shaders.shader_texture, Shaders.shader_blend_subtract);
		this.shaderBlendMultiply = this.createShader(Shaders.shader_texture, Shaders.shader_blend_multiply);
		this.shaderBlendLighten = this.createShader(Shaders.shader_texture, Shaders.shader_blend_lighten);
		this.shaderBlendDarken = this.createShader(Shaders.shader_texture, Shaders.shader_blend_darken);
		this.shaderBlendScreen = this.createShader(Shaders.shader_texture, Shaders.shader_blend_screen);
		this.shaderBlendOverlay = this.createShader(Shaders.shader_texture, Shaders.shader_blend_overlay);
		this.shaderBlendHardlight = this.createShader(Shaders.shader_texture, Shaders.shader_blend_hardlight);
		this.shaderBlendDifference = this.createShader(Shaders.shader_texture, Shaders.shader_blend_difference);
		this.shaderBlendInvert = this.createShader(Shaders.shader_texture, Shaders.shader_blend_invert);
		this.shaderBlendAlpha = this.createShader(Shaders.shader_texture, Shaders.shader_blend_alpha);
		this.shaderBlendErase = this.createShader(Shaders.shader_texture, Shaders.shader_blend_erase);

		// filters
		try {
			this.shaderFilterBlur = this.createShader(Shaders.shader_filter_blur_vertex, Shaders.shader_filter_blur_fragment);
			this.shaderFilterGlow = this.createShader(Shaders.shader_filter_glow_vertex, Shaders.shader_filter_glow_fragment);
			this.shaderFilterBevel = this.createShader(Shaders.shader_filter_bevel_vertex, Shaders.shader_filter_bevel_fragment);
			this.shaderFilterColorMatrix = this.createShader(Shaders.shader_filter_color_matrix_vertex, Shaders.shader_filter_color_matrix_fragment);
			this.isFilter = true;
		} catch(e) {
		}
	}
	Shaders.prototype.createShader = function(vs, fs, definitions) {
		var program = this.compileProgram(vs, fs, definitions);
		return new Shader(this.gl, program);
	}
	Shaders.prototype.compileProgram = function(vs, fs, definitions) {
		var vertexShader = this.compileShader(this.gl.VERTEX_SHADER, vs, definitions);
		var fragmentShader = this.compileShader(this.gl.FRAGMENT_SHADER, fs, definitions);
		var program = this.gl.createProgram();
		if (!program) {
			throw new Error('Cannot create program');
		}
		this.gl.attachShader(program, vertexShader);
		this.gl.attachShader(program, fragmentShader);
		this.gl.linkProgram(program);
		if (!this.gl.getProgramParameter(program, this.gl.LINK_STATUS)) {
			var error = this.gl.getProgramInfoLog(program);
			this.gl.deleteProgram(program);
			throw new Error('Program compilation error: ' + error);
		}
		return program;
	}
	Shaders.prototype.compileShader = function(type, source, definitions) {
		if (definitions) {
			for (var def of definitions) {
				source = '#define ' + def + '\n' + source;
			}
		}
		var shader = this.gl.createShader(type);
		if (!shader) {
			throw new Error('Cannot create shader');
		}
		this.gl.shaderSource(shader, source);
		this.gl.compileShader(shader);
		if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)) {
			var error = this.gl.getShaderInfoLog(shader);
			this.gl.deleteShader(shader);
			throw new Error('Shader compilation error: ' + error);
		}
		return shader;
	}
	Shaders.shader_texture = `
#version 100

#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform mat4 view_matrix;
uniform mat4 world_matrix;
uniform vec4 mult_color;
uniform vec4 add_color;
uniform mat3 u_matrix;

attribute vec2 position;

varying vec2 frag_uv;

void main() {
	frag_uv = vec2(u_matrix * vec3(position, 1.0));
	gl_Position = view_matrix * world_matrix * vec4(position, 0.0, 1.0);
}`;
Shaders.shader_bitmap = `
#version 100

#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform mat4 view_matrix;
uniform mat4 world_matrix;
uniform vec4 mult_color;
uniform vec4 add_color;
uniform mat3 u_matrix;

uniform sampler2D u_texture;

varying vec2 frag_uv;

void main() {
	vec4 color = texture2D(u_texture, frag_uv);

	// Unmultiply alpha before apply color transform.
	if( color.a > 0.0 ) {
		color.rgb /= color.a;
		color = clamp(mult_color * color + add_color, 0.0, 1.0);
		float alpha = clamp(color.a, 0.0, 1.0);
		color = vec4(color.rgb * alpha, alpha);
	}

	gl_FragColor = color;
}`;
Shaders.shader_copy = `
#version 100

#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform mat4 view_matrix;
uniform mat4 world_matrix;
uniform vec4 mult_color;
uniform vec4 add_color;
uniform mat3 u_matrix;

uniform sampler2D u_texture;

varying vec2 frag_uv;

void main() {
gl_FragColor = texture2D(u_texture, frag_uv);
}`;
Shaders.shader_color_vertex = `
#version 100

#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform mat4 view_matrix;
uniform mat4 world_matrix;
uniform vec4 mult_color;
uniform vec4 add_color;
uniform vec4 u_color;

attribute vec2 position;

varying vec4 frag_color;

void main() {
  frag_color = clamp(u_color * mult_color + add_color, 0.0, 1.0);
  float alpha = clamp(frag_color.a, 0.0, 1.0);
  frag_color = vec4(frag_color.rgb * alpha, alpha);

  gl_Position =  view_matrix * world_matrix * vec4(position, 0.0, 1.0);
}`;
Shaders.shader_color_fragment = `
#version 100

#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

varying vec4 frag_color;

void main() {
  gl_FragColor = frag_color;
}`;
Shaders.shader_gradient = `
#version 100

#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform mat4 view_matrix;
uniform mat4 world_matrix;
uniform vec4 mult_color;
uniform vec4 add_color;
uniform mat3 u_matrix;

uniform int u_gradient_type;
uniform float u_ratios[16];
uniform vec4 u_colors[16];
uniform int u_repeat_mode;
uniform float u_focal_point;
uniform int u_interpolation;

varying vec2 frag_uv;

vec4 interpolate(float t, float ratio1, float ratio2, vec4 color1, vec4 color2) {
	color1 = clamp(mult_color * color1 + add_color, 0.0, 1.0);
	color2 = clamp(mult_color * color2 + add_color, 0.0, 1.0);
	float a = (t - ratio1) / (ratio2 - ratio1);
	return mix(color1, color2, a);
}

vec3 linear_to_srgb(vec3 linear) {
	vec3 a = 12.92 * linear;
	vec3 b = 1.055 * pow(linear, vec3(1.0 / 2.4)) - 0.055;
	vec3 c = step(vec3(0.0031308), linear);
	return mix(a, b, c);
}

void main() {
	float t;
	if( u_gradient_type == 0 )
	{
		t = frag_uv.x;
	}
	else if( u_gradient_type == 1 )
	{
		t = length(frag_uv * 2.0 - 1.0);
	}
	else if( u_gradient_type == 2 )
	{
		vec2 uv = frag_uv * 2.0 - 1.0;
		vec2 d = vec2(u_focal_point, 0.0) - uv;
		float l = length(d);
		d /= l;
		t = l / (sqrt(1.0 -  u_focal_point*u_focal_point*d.y*d.y) + u_focal_point*d.x);
	}
	if( u_repeat_mode == 0 )
	{
		// Clamp
		t = clamp(t, 0.0, 1.0);
	}
	else if( u_repeat_mode == 1 )
	{
		// Repeat
		t = fract(t);
	}
	else
	{
		// Mirror
		if( t < 0.0 )
		{
			t = -t;
		}

		if( int(mod(t, 2.0)) == 0 ) {
			t = fract(t);
		} else {
			t = 1.0 - fract(t);
		}
	}

	// TODO: No non-constant array access in WebGL 1, so the following is kind of painful.
	// We'd probably be better off passing in the gradient as a texture and sampling from there.
	vec4 color;
	if( t <= u_ratios[0] ) {
		color = clamp(mult_color * u_colors[0] + add_color, 0.0, 1.0);
	} else if( t <= u_ratios[1] ) {
		color = interpolate(t, u_ratios[0], u_ratios[1], u_colors[0], u_colors[1]);
	} else if( t <= u_ratios[2] ) {
		color = interpolate(t, u_ratios[1], u_ratios[2], u_colors[1], u_colors[2]);
	} else if( t <= u_ratios[3] ) {
		color = interpolate(t, u_ratios[2], u_ratios[3], u_colors[2], u_colors[3]);
	} else if( t <= u_ratios[4] ) {
		color = interpolate(t, u_ratios[3], u_ratios[4], u_colors[3], u_colors[4]);
	} else if( t <= u_ratios[5] ) {
		color = interpolate(t, u_ratios[4], u_ratios[5], u_colors[4], u_colors[5]);
	} else if( t <= u_ratios[6] ) {
		color = interpolate(t, u_ratios[5], u_ratios[6], u_colors[5], u_colors[6]);
	} else if( t <= u_ratios[7] ) {
		color = interpolate(t, u_ratios[6], u_ratios[7], u_colors[6], u_colors[7]);
	} else if( t <= u_ratios[8] ) {
		color = interpolate(t, u_ratios[7], u_ratios[8], u_colors[7], u_colors[8]);
	} else if( t <= u_ratios[9] ) {
		color = interpolate(t, u_ratios[8], u_ratios[9], u_colors[8], u_colors[9]);
	} else if( t <= u_ratios[10] ) {
		color = interpolate(t, u_ratios[9], u_ratios[10], u_colors[9], u_colors[10]);
	} else if( t <= u_ratios[11] ) {
		color = interpolate(t, u_ratios[10], u_ratios[11], u_colors[10], u_colors[11]);
	} else if( t <= u_ratios[12] ) {
		color = interpolate(t, u_ratios[11], u_ratios[12], u_colors[11], u_colors[12]);
	} else if( t <= u_ratios[13] ) {
		color = interpolate(t, u_ratios[12], u_ratios[13], u_colors[12], u_colors[13]);
	} else if( t <= u_ratios[14] ) {
		color = interpolate(t, u_ratios[13], u_ratios[14], u_colors[13], u_colors[14]);
	} else {
		color = clamp(mult_color * u_colors[14] + add_color, 0.0, 1.0);
	}

	if( u_interpolation != 0 ) {
		color = vec4(linear_to_srgb(vec3(color)), color.a);
	}

	float alpha = clamp(color.a, 0.0, 1.0);
	gl_FragColor = vec4(color.rgb * alpha, alpha);
}`;

//////// blend shaders ////////

Shaders.shader_blend_normal = `
	#version 100

	#ifdef GL_FRAGMENT_PRECISION_HIGH
	precision highp float;
	#else
	precision mediump float;
	#endif

	uniform mat4 view_matrix;
	uniform mat4 world_matrix;
	uniform vec4 mult_color;
	uniform vec4 add_color;
	uniform mat3 u_matrix;

	uniform sampler2D current_texture;
	uniform sampler2D parent_texture;

	varying vec2 frag_uv;

	vec4 blend (in vec4 src, in vec4 dst) {
		return src + dst - dst * src.a;
	}

	void main() {
		vec4 src = texture2D(current_texture, frag_uv);
		vec4 dst = texture2D(parent_texture, frag_uv);
		gl_FragColor = blend(src, dst);
	}`;
	Shaders.shader_blend_add = `
	#version 100

	#ifdef GL_FRAGMENT_PRECISION_HIGH
	precision highp float;
	#else
	precision mediump float;
	#endif

	uniform mat4 view_matrix;
	uniform mat4 world_matrix;
	uniform vec4 mult_color;
	uniform vec4 add_color;
	uniform mat3 u_matrix;

	uniform sampler2D current_texture;
	uniform sampler2D parent_texture;

	varying vec2 frag_uv;

	vec4 blend (in vec4 src, in vec4 dst) {
		vec4 c = vec4(dst.rgb + src.rgb, dst.a + src.a);
		return mix(c, src, step(1.0, 0.0));
	}

	void main() {
		vec4 src = texture2D(current_texture, frag_uv);
		vec4 dst = texture2D(parent_texture, frag_uv);
		gl_FragColor = blend(src, dst);
	}`;
	Shaders.shader_blend_subtract = `
	#version 100

	#ifdef GL_FRAGMENT_PRECISION_HIGH
	precision highp float;
	#else
	precision mediump float;
	#endif

	uniform mat4 view_matrix;
	uniform mat4 world_matrix;
	uniform vec4 mult_color;
	uniform vec4 add_color;
	uniform mat3 u_matrix;

	uniform sampler2D current_texture;
	uniform sampler2D parent_texture;

	varying vec2 frag_uv;

	vec4 blend (in vec4 src, in vec4 dst) {
		vec4 c = vec4(dst.rgb - src.rgb, dst.a + src.a);
		return mix(c, src, step(dst.a, 0.0));
	}

	void main() {
		vec4 src = texture2D(current_texture, frag_uv);
		vec4 dst = texture2D(parent_texture, frag_uv);
		gl_FragColor = blend(src, dst);
	}`;
	Shaders.shader_blend_multiply = `
	#version 100

	#ifdef GL_FRAGMENT_PRECISION_HIGH
	precision highp float;
	#else
	precision mediump float;
	#endif

	uniform mat4 view_matrix;
	uniform mat4 world_matrix;
	uniform vec4 mult_color;
	uniform vec4 add_color;
	uniform mat3 u_matrix;

	uniform sampler2D current_texture;
	uniform sampler2D parent_texture;

	varying vec2 frag_uv;

	vec4 blend (in vec4 src, in vec4 dst) {
		vec4 a = src - src * dst.a;
		vec4 b = dst - dst * src.a;
		vec4 c = src * dst;
		return a + b + c;
	}

	void main() {
		vec4 src = texture2D(current_texture, frag_uv);
		vec4 dst = texture2D(parent_texture, frag_uv);
		gl_FragColor = blend(src, dst);
	}`;
	Shaders.shader_blend_lighten = `
	#version 100

	#ifdef GL_FRAGMENT_PRECISION_HIGH
	precision highp float;
	#else
	precision mediump float;
	#endif

	uniform mat4 view_matrix;
	uniform mat4 world_matrix;
	uniform vec4 mult_color;
	uniform vec4 add_color;
	uniform mat3 u_matrix;

	uniform sampler2D current_texture;
	uniform sampler2D parent_texture;

	varying vec2 frag_uv;

	vec4 blend (in vec4 src, in vec4 dst) {
		if (src.a > 0.0) {
			src.rgb /= src.a;
			vec4 c = vec4(mix(dst.rgb, src.rgb, step(dst.rgb, src.rgb)), 1.0) * src.a;
			return c + dst * (1.0 - src.a);
		} else {
			 return dst;
		}
	}

	void main() {
		vec4 src = texture2D(current_texture, frag_uv);
		vec4 dst = texture2D(parent_texture, frag_uv);
		gl_FragColor = blend(src, dst);
	}`;
	Shaders.shader_blend_darken = `
	#version 100

	#ifdef GL_FRAGMENT_PRECISION_HIGH
	precision highp float;
	#else
	precision mediump float;
	#endif

	uniform mat4 view_matrix;
	uniform mat4 world_matrix;
	uniform vec4 mult_color;
	uniform vec4 add_color;
	uniform mat3 u_matrix;

	uniform sampler2D current_texture;
	uniform sampler2D parent_texture;

	varying vec2 frag_uv;

	vec4 blend (in vec4 src, in vec4 dst) {
		if (dst.a == 0.0) {
			return src;
		} else if (src.a > 0.0) {
			src.rgb /= src.a;
			vec4 c = vec4(mix(dst.rgb, src.rgb, step(src.rgb, dst.rgb)), 1.0) * src.a;
			return c + dst * (1.0 - src.a);
		} else {
			 return dst;
		}
	}

	void main() {
		vec4 src = texture2D(current_texture, frag_uv);
		vec4 dst = texture2D(parent_texture, frag_uv);
		gl_FragColor = blend(src, dst);
	}`;
	Shaders.shader_blend_screen = `
	#version 100

	#ifdef GL_FRAGMENT_PRECISION_HIGH
	precision highp float;
	#else
	precision mediump float;
	#endif

	uniform mat4 view_matrix;
	uniform mat4 world_matrix;
	uniform vec4 mult_color;
	uniform vec4 add_color;
	uniform mat3 u_matrix;

	uniform sampler2D current_texture;
	uniform sampler2D parent_texture;

	varying vec2 frag_uv;

	vec4 blend (in vec4 src, in vec4 dst) {
		if (src.a > 0.0) {
			vec4 _src = src;
			vec4 _dst = dst;
			_src.rgb /= src.a;
			_dst.rgb /= dst.a;
			vec4 _out = _src;
			_out.r = (1.0 - ((1.0 - _src.r) * (1.0 - _dst.r)));
			_out.g = (1.0 - ((1.0 - _src.g) * (1.0 - _dst.g)));
			_out.b = (1.0 - ((1.0 - _src.b) * (1.0 - _dst.b)));
			return vec4(src.rgb * (1.0 - dst.a) + dst.rgb * (1.0 - src.a) + src.a * dst.a * _out.rgb, src.a + dst.a * (1.0 - src.a));
		} else {
			return dst;
		}
	}

	void main() {
		vec4 src = texture2D(current_texture, frag_uv);
		vec4 dst = texture2D(parent_texture, frag_uv);
		gl_FragColor = blend(src, dst);
	}`;
	Shaders.shader_blend_overlay = `
	#version 100

	#ifdef GL_FRAGMENT_PRECISION_HIGH
	precision highp float;
	#else
	precision mediump float;
	#endif

	uniform mat4 view_matrix;
	uniform mat4 world_matrix;
	uniform vec4 mult_color;
	uniform vec4 add_color;
	uniform mat3 u_matrix;

	uniform sampler2D parent_texture;
	uniform sampler2D current_texture;

	varying vec2 frag_uv;

	void main() {
		vec4 dst = texture2D(parent_texture, frag_uv);
		vec4 src = texture2D(current_texture, frag_uv);
		if (src.a > 0.0) {
			vec4 _src = src;
			vec4 _dst = dst;
			_src.rgb /= src.a;
			_dst.rgb /= dst.a;
			vec4 _out = _src;
			if (_dst.r <= 0.5) { _out.r = (2.0 * _src.r * _dst.r); } else { _out.r = (1.0 - 2.0 * (1.0 - _dst.r) * (1.0 - _src.r)); }
			if (_dst.g <= 0.5) { _out.g = (2.0 * _src.g * _dst.g); } else { _out.g = (1.0 - 2.0 * (1.0 - _dst.g) * (1.0 - _src.g)); }
			if (_dst.b <= 0.5) { _out.b = (2.0 * _src.b * _dst.b); } else { _out.b = (1.0 - 2.0 * (1.0 - _dst.b) * (1.0 - _src.b)); }
			gl_FragColor = vec4(src.rgb * (1.0 - dst.a) + dst.rgb * (1.0 - src.a) + src.a * dst.a * _out.rgb, src.a + dst.a * (1.0 - src.a));
		} else {
			gl_FragColor = dst;
		}
	}`;
	Shaders.shader_blend_hardlight = `
	#version 100

	#ifdef GL_FRAGMENT_PRECISION_HIGH
	precision highp float;
	#else
	precision mediump float;
	#endif

	uniform mat4 view_matrix;
	uniform mat4 world_matrix;
	uniform vec4 mult_color;
	uniform vec4 add_color;
	uniform mat3 u_matrix;

	uniform sampler2D current_texture;
	uniform sampler2D parent_texture;

	varying vec2 frag_uv;

	vec4 blend (in vec4 src, in vec4 dst) {
		if (src.a > 0.0) {
			vec4 _src = src;
			vec4 _dst = dst;
			_src.rgb /= src.a;
			_dst.rgb /= dst.a;
			vec4 _out = _src;
			if (_src.r <= 0.5) { _out.r = (2.0 * _src.r * _dst.r); } else { _out.r = (1.0 - 2.0 * (1.0 - _dst.r) * (1.0 - _src.r)); }
			if (_src.g <= 0.5) { _out.g = (2.0 * _src.g * _dst.g); } else { _out.g = (1.0 - 2.0 * (1.0 - _dst.g) * (1.0 - _src.g)); }
			if (_src.b <= 0.5) { _out.b = (2.0 * _src.b * _dst.b); } else { _out.b = (1.0 - 2.0 * (1.0 - _dst.b) * (1.0 - _src.b)); }
			_out.a = 1.0;
			return vec4(src.rgb * (1.0 - dst.a) + dst.rgb * (1.0 - src.a) + src.a * dst.a * _out.rgb, src.a + dst.a * (1.0 - src.a));
		} else {
			 return dst;
		}
	}

	void main() {
		vec4 src = texture2D(current_texture, frag_uv);
		vec4 dst = texture2D(parent_texture, frag_uv);
		gl_FragColor = blend(src, dst);
	}`;
	Shaders.shader_blend_difference = `
	#version 100

	#ifdef GL_FRAGMENT_PRECISION_HIGH
	precision highp float;
	#else
	precision mediump float;
	#endif

	uniform mat4 view_matrix;
	uniform mat4 world_matrix;
	uniform vec4 mult_color;
	uniform vec4 add_color;
	uniform mat3 u_matrix;

	uniform sampler2D current_texture;
	uniform sampler2D parent_texture;

	varying vec2 frag_uv;

	vec4 blend (in vec4 src, in vec4 dst) {
		if (src.a > 0.0) {
			return vec4(src.rgb * (1.0 - dst.a) + dst.rgb * (1.0 - src.a) + src.a * dst.a * (1.0 - dst.rgb / dst.a), src.a + dst.a * (1.0 - src.a));
		} else {
			 return dst;
		}
	}

	void main() {
		vec4 src = texture2D(current_texture, frag_uv);
		vec4 dst = texture2D(parent_texture, frag_uv);
		gl_FragColor = blend(src, dst);
	}`;
	Shaders.shader_blend_invert = `
	#version 100

	#ifdef GL_FRAGMENT_PRECISION_HIGH
	precision highp float;
	#else
	precision mediump float;
	#endif

	uniform mat4 view_matrix;
	uniform mat4 world_matrix;
	uniform vec4 mult_color;
	uniform vec4 add_color;
	uniform mat3 u_matrix;

	uniform sampler2D parent_texture;
	uniform sampler2D current_texture;

	varying vec2 frag_uv;

	vec4 blend (in vec4 src, in vec4 dst) {
		if (src.a > 0.0) {
			vec4 c = vec4(1.0 - dst.rgb, 1.0) * src.a;
			return c + dst * (1.0 - src.a);
		} else {
			 return dst;
		}
	}

	void main() {
		vec4 dst = texture2D(parent_texture, frag_uv);
		vec4 src = texture2D(current_texture, frag_uv);
		gl_FragColor = blend(src, dst);
	}`;
	Shaders.shader_blend_alpha = `
	#version 100

	#ifdef GL_FRAGMENT_PRECISION_HIGH
	precision highp float;
	#else
	precision mediump float;
	#endif

	uniform mat4 view_matrix;
	uniform mat4 world_matrix;
	uniform vec4 mult_color;
	uniform vec4 add_color;
	uniform mat3 u_matrix;

	uniform sampler2D parent_texture;
	uniform sampler2D current_texture;

	varying vec2 frag_uv;

	vec4 blend (in vec4 src, in vec4 dst) {
		if (src.a > 0.0) {
			return vec4(dst.rgb * src.a, src.a * dst.a);
		} else {
			return dst;
		}
	}

	void main() {
		vec4 dst = texture2D(parent_texture, frag_uv);
		vec4 src = texture2D(current_texture, frag_uv);
		gl_FragColor = blend(src, dst);
	}`;
	Shaders.shader_blend_erase = `
	#version 100

	#ifdef GL_FRAGMENT_PRECISION_HIGH
	precision highp float;
	#else
	precision mediump float;
	#endif

	uniform mat4 view_matrix;
	uniform mat4 world_matrix;
	uniform vec4 mult_color;
	uniform vec4 add_color;
	uniform mat3 u_matrix;

	uniform sampler2D parent_texture;
	uniform sampler2D current_texture;

	varying vec2 frag_uv;

	vec4 blend (in vec4 src, in vec4 dst) {
		if (src.a > 0.0) {
			return vec4(dst.rgb * (1.0 - src.a), (1.0 - src.a) * dst.a);
		} else {
			return dst;
		}
	}

	void main() {
		vec4 dst = texture2D(parent_texture, frag_uv);
		vec4 src = texture2D(current_texture, frag_uv);
		gl_FragColor = blend(src, dst);
	}`;

	//////// filter shaders ////////
	Shaders.shader_filter_blur_vertex = `
#version 100

#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform mat4 view_matrix;
uniform mat4 world_matrix;
uniform vec4 mult_color;
uniform vec4 add_color;
uniform mat3 u_matrix;
uniform float u_dir_x;
uniform float u_dir_y;
uniform float u_full_size;
uniform float u_m;
uniform float u_m2;
uniform float u_first_weight;
uniform float u_last_offset;
uniform float u_last_weight;

attribute vec2 position;

varying vec2 frag_uv;

void main() {
	frag_uv = vec2(u_matrix * vec3(position, 1.0));
	vec2 direction = vec2(u_dir_x, u_dir_y);
	frag_uv -= direction * u_m;
	gl_Position = view_matrix * world_matrix * vec4(position, 0.0, 1.0);
}`;
	Shaders.shader_filter_blur_fragment = `
#version 100

#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform mat4 view_matrix;
uniform mat4 world_matrix;
uniform vec4 mult_color;
uniform vec4 add_color;
uniform mat3 u_matrix;
uniform float u_dir_x;
uniform float u_dir_y;
uniform float u_full_size;
uniform float u_m;
uniform float u_m2;
uniform float u_first_weight;
uniform float u_last_offset;
uniform float u_last_weight;

uniform sampler2D u_texture;

varying vec2 frag_uv;

void main() {
	vec2 direction = vec2(u_dir_x, u_dir_y);
	vec4 total = vec4(0.0);
	total += texture2D(u_texture, frag_uv - direction) * u_first_weight;
	vec4 center = vec4(0.0);
	float i = 0.5;
	for (float _i = 0.0; _i < 512.0; _i += 1.0) {
		if (i >= u_m2) {
			break;
		}
		center += texture2D(u_texture, frag_uv + direction * i);
		i += 2.0;
	}
	total += center * 2.0;
	vec2 last_location = frag_uv + direction * (u_m2 + u_last_offset);
	total += texture2D(u_texture, last_location) * u_last_weight;
	   vec4 result = total / u_full_size;
	gl_FragColor = floor(result * 255.0) / 255.0;
}`;
Shaders.shader_filter_glow_vertex = `
#version 100

#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform mat4 view_matrix;
uniform mat4 world_matrix;
uniform vec4 mult_color;
uniform vec4 add_color;
uniform mat3 u_matrix;
uniform vec4 u_color;
uniform float strength;
uniform int inner;
uniform int knockout;
uniform int composite_source;
uniform float u_dir_x;
uniform float u_dir_y;

attribute vec2 position;

varying vec2 frag_uv;

void main() {
frag_uv = vec2(u_matrix * vec3(position, 1.0));
gl_Position = view_matrix * world_matrix * vec4(position, 0.0, 1.0);
}`;
Shaders.shader_filter_glow_fragment = `
#version 100

#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform mat4 view_matrix;
uniform mat4 world_matrix;
uniform vec4 mult_color;
uniform vec4 add_color;
uniform mat3 u_matrix;
uniform float strength;
uniform int inner;
uniform int knockout;
uniform int composite_source;
uniform float u_dir_x;
uniform float u_dir_y;
uniform vec4 u_color;

uniform sampler2D u_blurred;
uniform sampler2D u_texture;

varying vec2 frag_uv;

void main() {
vec2 direction = vec2(u_dir_x, u_dir_y);
vec2 blur_dir = frag_uv - direction;
float blur = texture2D(u_texture, blur_dir).a;
vec4 dest = texture2D(u_blurred, frag_uv);
if (blur_dir.x < 0.0 || blur_dir.x > 1.0 || blur_dir.y < 0.0 || blur_dir.y > 1.0) {
	blur *= 0.0;
}
vec4 color = vec4(u_color.r, u_color.g, u_color.b, 1.0);
if (inner > 0) {
	float alpha2 = u_color.a * ((1.0 - blur) * strength);
	if (alpha2 > 1.0) {
		alpha2 = 1.0;
	}
	if (alpha2 < 0.0) {
		alpha2 = 0.0;
	}
	if (knockout > 0) {
		color = color * alpha2 * dest.a;
	} else if (composite_source > 0) {
		color = color * alpha2 * dest.a + dest * (1.0 - alpha2);
	} else {
		color = color * alpha2 * dest.a;
	}
} else {
	float alpha = u_color.a * (blur * strength);
	if (alpha > 1.0) {
		alpha = 1.0;
	}
	if (alpha < 0.0) {
		alpha = 0.0;
	}
	if (knockout > 0) {
		color = color * alpha * (1.0 - dest.a);
	} else if (composite_source > 0) {
		color = color * alpha * (1.0 - dest.a) + dest;
	} else {
		color = color * alpha;
	}
}
gl_FragColor = color;
}`;
Shaders.shader_filter_bevel_vertex = `
#version 100

#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform mat4 view_matrix;
uniform mat4 world_matrix;
uniform vec4 mult_color;
uniform vec4 add_color;
uniform mat3 u_matrix;

uniform vec4 highlight_color;
uniform vec4 shadow_color;
uniform float strength;
uniform int bevel_type;
uniform int knockout;
uniform int composite_source;
uniform float u_dir_x;
uniform float u_dir_y;

attribute vec2 position;

varying vec2 frag_uv;

void main() {
frag_uv = vec2(u_matrix * vec3(position, 1.0));
gl_Position = view_matrix * world_matrix * vec4(position, 0.0, 1.0);
}`;
Shaders.shader_filter_bevel_fragment = `
#version 100

#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform mat4 view_matrix;
uniform mat4 world_matrix;
uniform vec4 mult_color;
uniform vec4 add_color;
uniform mat3 u_matrix;

uniform vec4 highlight_color;
uniform vec4 shadow_color;
uniform float strength;
uniform int bevel_type;
uniform int knockout;
uniform int composite_source;
uniform float u_dir_x;
uniform float u_dir_y;

uniform sampler2D u_blurred;
uniform sampler2D u_texture;

varying vec2 frag_uv;

void main() {
vec2 direction = vec2(u_dir_x, u_dir_y);
vec2 direction2 = vec2(0.0 - u_dir_x, 0.0 - u_dir_y);
vec2 blur_left_dir = frag_uv - direction2;
vec2 blur_right_dir = frag_uv - direction;
float blur_left = texture2D(u_texture, blur_left_dir).a;
float blur_right = texture2D(u_texture, blur_right_dir).a;
vec4 dest = texture2D(u_blurred, frag_uv);
if (blur_left_dir.x < 0.0 || blur_left_dir.x > 1.0 || blur_left_dir.y < 0.0 || blur_left_dir.y > 1.0) {
	blur_left *= 0.0;
}
if (blur_right_dir.x < 0.0 || blur_right_dir.x > 1.0 || blur_right_dir.y < 0.0 || blur_right_dir.y > 1.0) {
	blur_right *= 0.0;
}
int outer = ((bevel_type == 0) || (bevel_type == 2)) ? 1 : 0;
int inner = ((bevel_type == 1) || (bevel_type == 2)) ? 1 : 0;
float highlight_alpha = (blur_left - blur_right) * strength;
float shadow_alpha = (blur_right - blur_left) * strength;
if (highlight_alpha > 1.0) {
	highlight_alpha = 1.0;
}
if (highlight_alpha < 0.0) {
	highlight_alpha = 0.0;
}
if (shadow_alpha > 1.0) {
	shadow_alpha = 1.0;
}
if (shadow_alpha < 0.0) {
	shadow_alpha = 0.0;
}
vec4 glow = (highlight_color * highlight_alpha) + (shadow_color * shadow_alpha);
if ((inner > 0) && (outer > 0)) {
	if (knockout > 0) {
		gl_FragColor = glow;
	} else {
		gl_FragColor = dest - dest * glow.a + glow;
	}
} else if (inner > 0) {
	if (knockout > 0) {
		gl_FragColor = glow * dest.a;
	} else {
		gl_FragColor = glow * dest.a + dest * (1.0 - glow.a);
	}
} else {
	if (knockout > 0) {
		gl_FragColor = glow - glow * dest.a;
	} else {
		gl_FragColor = dest + glow - glow * dest.a;
	}
}
}`;
Shaders.shader_filter_color_matrix_vertex = `
#version 100

#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform mat4 view_matrix;
uniform mat4 world_matrix;
uniform vec4 mult_color;
uniform vec4 add_color;
uniform mat3 u_matrix;

uniform float r_to_r;
uniform float g_to_r;
uniform float b_to_r;
uniform float a_to_r;
uniform float r_extra;
uniform float r_to_g;
uniform float g_to_g;
uniform float b_to_g;
uniform float a_to_g;
uniform float g_extra;
uniform float r_to_b;
uniform float g_to_b;
uniform float b_to_b;
uniform float a_to_b;
uniform float b_extra;
uniform float r_to_a;
uniform float g_to_a;
uniform float b_to_a;
uniform float a_to_a;
uniform float a_extra;

attribute vec2 position;

varying vec2 frag_uv;

void main() {
frag_uv = vec2(u_matrix * vec3(position, 1.0));
gl_Position = view_matrix * world_matrix * vec4(position, 0.0, 1.0);
}`;
Shaders.shader_filter_color_matrix_fragment = `
#version 100

#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform mat4 view_matrix;
uniform mat4 world_matrix;
uniform vec4 mult_color;
uniform vec4 add_color;
uniform mat3 u_matrix;

uniform float r_to_r;
uniform float g_to_r;
uniform float b_to_r;
uniform float a_to_r;
uniform float r_extra;
uniform float r_to_g;
uniform float g_to_g;
uniform float b_to_g;
uniform float a_to_g;
uniform float g_extra;
uniform float r_to_b;
uniform float g_to_b;
uniform float b_to_b;
uniform float a_to_b;
uniform float b_extra;
uniform float r_to_a;
uniform float g_to_a;
uniform float b_to_a;
uniform float a_to_a;
uniform float a_extra;

uniform sampler2D u_texture;

varying vec2 frag_uv;

void main() {
vec4 src = texture2D(u_texture, frag_uv);
vec4 color = vec4(
	clamp((r_to_r * src.r / src.a) + (g_to_r * src.g / src.a) + (b_to_r * src.b / src.a) + (a_to_r * src.a) + (r_extra / 255.0), 0.0, 1.0),
	clamp((r_to_g * src.r / src.a) + (g_to_g * src.g / src.a) + (b_to_g * src.b / src.a) + (a_to_g * src.a) + (g_extra / 255.0), 0.0, 1.0),
	clamp((r_to_b * src.r / src.a) + (g_to_b * src.g / src.a) + (b_to_b * src.b / src.a) + (a_to_b * src.a) + (b_extra / 255.0), 0.0, 1.0),
	clamp((r_to_a * src.r / src.a) + (g_to_a * src.g / src.a) + (b_to_a * src.b / src.a) + (a_to_a * src.a) + (a_extra / 255.0), 0.0, 1.0)
);
gl_FragColor = vec4(color.rgb * color.a, color.a);
}`;
	var RenderWebGLSurface = function(renderer, w, h, useMultisample) {
		this.renderer = renderer;
		this.shaders = renderer.shaders;
		this.quatVao = renderer.quatVao;
		this.gl = this.renderer.gl;
		this.blendIndex = 0;
		this.maskStateDirty = true;
		this.maskState = 0;
		this.numMasks = 0;
		this.blendType = [];
		this.view_matrix = [
			1.0 / (w / 2.0), 0.0, 0.0, 0.0,
			0.0, 1.0 / (h / 2.0), 0.0, 0.0,
			0.0, 0.0, 1.0, 0.0,
			-1.0, -1.0, 0.0, 1.0
		];
		this.renderbuffer_width = w;
		this.renderbuffer_height = h;
		this.useMultisample = useMultisample;
		this.build_msaa_buffers();
	}
	RenderWebGLSurface.prototype.build_msaa_buffers = function() {
		var framebuffer_texture = this.renderer.createTexture();
		this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, this.renderbuffer_width, this.renderbuffer_height, 0, this.gl.RGBA, this.gl.UNSIGNED_BYTE, null);
		var stencil_renderbuffer = null;
		var render_framebuffer = null;
		var color_framebuffer = null;
		var color_renderbuffer = null;
		if (this.useMultisample) {
			render_framebuffer = this.gl.createFramebuffer();
			color_framebuffer = this.gl.createFramebuffer();
			color_renderbuffer = this.gl.createRenderbuffer();
			this.gl.bindRenderbuffer(this.gl.RENDERBUFFER, color_renderbuffer);
			this.gl.renderbufferStorageMultisample(this.gl.RENDERBUFFER, this.renderer.get_msaa_sample_count(), this.gl.RGBA8, this.renderbuffer_width, this.renderbuffer_height);
			stencil_renderbuffer = this.gl.createRenderbuffer();
			this.gl.bindRenderbuffer(this.gl.RENDERBUFFER, stencil_renderbuffer);
			this.gl.renderbufferStorageMultisample(this.gl.RENDERBUFFER, this.renderer.get_msaa_sample_count(), this.gl.STENCIL_INDEX8, this.renderbuffer_width, this.renderbuffer_height);
			this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, render_framebuffer);
			this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER, this.gl.COLOR_ATTACHMENT0,  this.gl.RENDERBUFFER, color_renderbuffer);
			this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER, this.gl.STENCIL_ATTACHMENT,  this.gl.RENDERBUFFER, stencil_renderbuffer);
			this.gl.bindTexture(this.gl.TEXTURE_2D, framebuffer_texture);
			this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, color_framebuffer);
			this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER, this.gl.COLOR_ATTACHMENT0, this.gl.TEXTURE_2D, framebuffer_texture, 0);
		} else {
			stencil_renderbuffer = this.renderer.createStencilRenderbuffer(this.renderbuffer_width, this.renderbuffer_height);
			render_framebuffer = this.renderer.createFramebuffer(framebuffer_texture, stencil_renderbuffer);	
		}
		this.gl.bindTexture(this.gl.TEXTURE_2D, null);
		this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, null);
		var blend = [];
		this.msaa_buffers = {
			stencil_renderbuffer,
			render_framebuffer,
			framebuffer_texture,
			color_framebuffer,
			color_renderbuffer,
			// blend
			blend,
			blend_back: null
		};
	}
	RenderWebGLSurface.prototype.delete = function(not_delete_texture) {
		if (this.msaa_buffers) {
			var gl = this.gl;
			if (this.msaa_buffers.color_framebuffer) gl.deleteFramebuffer(this.msaa_buffers.color_framebuffer);
			if (this.msaa_buffers.color_renderbuffer) gl.deleteRenderbuffer(this.msaa_buffers.color_renderbuffer);
			gl.deleteRenderbuffer(this.msaa_buffers.stencil_renderbuffer);
			gl.deleteFramebuffer(this.msaa_buffers.render_framebuffer);
			if (!not_delete_texture) gl.deleteTexture(this.msaa_buffers.framebuffer_texture);
			var bb = this.msaa_buffers.blend_back;
			if (bb) {
				gl.deleteFramebuffer(bb.framebuffer);
				gl.deleteTexture(bb.texture);		
			}
			for (var i = 0; i < this.msaa_buffers.blend.length; i++) {
				var a = this.msaa_buffers.blend[i];
				gl.deleteFramebuffer(a.framebuffer);
				gl.deleteTexture(a.texture);
			}
		}
	}
	RenderWebGLSurface.prototype.createblendBuffer = function() {
		var gl = this.gl;
		var texture = gl.createTexture(); 
		gl.bindTexture(gl.TEXTURE_2D, texture);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
		gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.renderbuffer_width, this.renderbuffer_height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);
		var framebuffer = this.renderer.createFramebuffer(texture);
		return {
			framebuffer,
			texture
		}
	}
	RenderWebGLSurface.prototype.getBlendShader = function(blendMode) {
		switch (blendMode) {
			case "add":
				return this.shaders.shaderBlendAdd;
			case "subtract":
				return this.shaders.shaderBlendSubtract;
			case "multiply":
				return this.shaders.shaderBlendMultiply;
			case "lighten":
				return this.shaders.shaderBlendLighten;
			case "darken":
				return this.shaders.shaderBlendDarken;
			case "screen":
				return this.shaders.shaderBlendScreen;
			case "overlay":
				return this.shaders.shaderBlendOverlay;
			case "hardlight":
				return this.shaders.shaderBlendHardlight;
			case "difference":
				return this.shaders.shaderBlendDifference;
			case "invert":
				return this.shaders.shaderBlendInvert;
			case "alpha":
				return this.shaders.shaderBlendAlpha;
			case "erase":
				return this.shaders.shaderBlendErase;
			case "layer":
				return this.shaders.shaderBlendNormal;
			default:
				return this.shaders.shaderBlendNormal;
		}
	}
	RenderWebGLSurface.prototype.getBlendBack = function() {
		if (!this.msaa_buffers.blend_back) {
			this.msaa_buffers.blend_back = this.createblendBuffer();
		}
		return this.msaa_buffers.blend_back;
	}
	RenderWebGLSurface.prototype.pushBlendMode = function(blendMode) {
		var gl = this.gl;
		if (this.maskState == 0) {
			if (this.blendIndex >= this.msaa_buffers.blend.length) {
				this.msaa_buffers.blend.push(this.createblendBuffer());
			}
			var blendShader = this.getBlendShader(blendMode);
			this.blendType.push(blendShader);
			var blendBuffer = this.msaa_buffers.blend[this.blendIndex];
			this.blendIndex++;
			gl.disable(gl.STENCIL_TEST);
			gl.colorMask(true, true, true, true);
			var renderTexture = this.getRenderTexture();
			gl.bindFramebuffer(gl.FRAMEBUFFER, blendBuffer.framebuffer);
			gl.clear(gl.COLOR_BUFFER_BIT);
			this.renderer.useShader(this.shaders.shaderCopy);
			this.shaders.shaderCopy.uniformMatrix4("view_matrix", [1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]);
			this.shaders.shaderCopy.uniformMatrix4("world_matrix", [2.0, 0.0, 0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, -1.0, -1.0, 0.0, 1.0]);
			this.shaders.shaderCopy.uniformMatrix3("u_matrix", [1, 0, 0, 0, 1, 0, 0, 0, 1]);
			this.gl.enableVertexAttribArray(0);
			gl.bindBuffer(gl.ARRAY_BUFFER, this.quatVao);
			this.gl.vertexAttribPointer(0, 2, this.gl.FLOAT, false, 0, 0);
			gl.bindTexture(gl.TEXTURE_2D, renderTexture);
			gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
			gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
			gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
			gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
			gl.drawArrays(gl.TRIANGLES, 0, 12);
			gl.bindFramebuffer(gl.FRAMEBUFFER, this.msaa_buffers.render_framebuffer);
			gl.clearColor(0, 0, 0, 0);
			gl.stencilMask(0xff);
			gl.clear(gl.COLOR_BUFFER_BIT | gl.STENCIL_BUFFER_BIT);
		} else {
			this.blendType.push(null);
		}
	}
	RenderWebGLSurface.prototype.popBlendMode = function() {
		var gl = this.gl;
		var blendShader = this.blendType.pop();
		if (blendShader) {
			this.blendIndex--;
			var blendBack = this.getBlendBack();
			var blendBuffer = this.msaa_buffers.blend[this.blendIndex];
			gl.disable(gl.STENCIL_TEST);
			gl.colorMask(true, true, true, true);
			var renderTexture = this.getRenderTexture();
			gl.bindFramebuffer(gl.FRAMEBUFFER, blendBack.framebuffer);
			gl.clear(gl.COLOR_BUFFER_BIT);
			this.renderer.useShader(this.shaders.shaderCopy);
			this.shaders.shaderCopy.uniformMatrix4("view_matrix", [1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]);
			this.shaders.shaderCopy.uniformMatrix4("world_matrix", [2.0, 0.0, 0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, -1.0, -1.0, 0.0, 1.0]);
			this.shaders.shaderCopy.uniformMatrix3("u_matrix", [1, 0, 0, 0, 1, 0, 0, 0, 1]);
			this.gl.enableVertexAttribArray(0);
			gl.bindBuffer(gl.ARRAY_BUFFER, this.quatVao);
			this.gl.vertexAttribPointer(0, 2, this.gl.FLOAT, false, 0, 0);
			gl.bindTexture(gl.TEXTURE_2D, renderTexture);
			gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
			gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
			gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
			gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
			gl.drawArrays(gl.TRIANGLES, 0, 12);
			gl.bindFramebuffer(gl.FRAMEBUFFER, this.msaa_buffers.render_framebuffer);
			gl.clearColor(0, 0, 0, 0);
			gl.stencilMask(0xff);
			gl.clear(gl.COLOR_BUFFER_BIT | gl.STENCIL_BUFFER_BIT);
			this.renderer.useShader(blendShader);
			blendShader.uniformMatrix4("view_matrix", [1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]);
			blendShader.uniformMatrix4("world_matrix", [2.0, 0.0, 0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, -1.0, -1.0, 0.0, 1.0]);
			blendShader.uniformMatrix3("u_matrix", [1, 0, 0, 0, 1, 0, 0, 0, 1]);
			blendShader.uniform1i('parent_texture', 0);
			blendShader.uniform1i('current_texture', 1);
			this.gl.enableVertexAttribArray(0);
			gl.bindBuffer(gl.ARRAY_BUFFER, this.quatVao);
			this.gl.vertexAttribPointer(0, 2, this.gl.FLOAT, false, 0, 0);
			gl.bindTexture(gl.TEXTURE_2D, blendBuffer.texture);
			gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
			gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
			gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
			gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
			gl.activeTexture(gl.TEXTURE1);
			gl.bindTexture(gl.TEXTURE_2D, blendBack.texture);
			gl.activeTexture(gl.TEXTURE1);
			gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
			gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
			gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
			gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
			gl.activeTexture(gl.TEXTURE0);
			gl.drawArrays(gl.TRIANGLES, 0, 12);
			gl.bindFramebuffer(gl.FRAMEBUFFER, this.msaa_buffers.render_framebuffer);
		}
	}
	RenderWebGLSurface.prototype.setStencilState = function() {
		if (this.maskStateDirty) {
			switch(this.maskState) {
				case 0:
					this.gl.disable(this.gl.STENCIL_TEST);
					this.gl.colorMask(true, true, true, true);
					break;
				case 1:
					this.gl.enable(this.gl.STENCIL_TEST);
					this.gl.stencilFunc(this.gl.EQUAL, this.numMasks - 1, 0xff);
					this.gl.stencilOp(this.gl.KEEP, this.gl.KEEP, this.gl.INCR);
					this.gl.colorMask(false, false, false, false);
					break;
				case 2:
					this.gl.enable(this.gl.STENCIL_TEST);
					this.gl.stencilFunc(this.gl.EQUAL, this.numMasks, 0xff);
					this.gl.stencilOp(this.gl.KEEP, this.gl.KEEP, this.gl.KEEP);
					this.gl.colorMask(true, true, true, true);
					break;
				case 3:
					this.gl.enable(this.gl.STENCIL_TEST);
					this.gl.stencilFunc(this.gl.EQUAL, this.numMasks, 0xff);
					this.gl.stencilOp(this.gl.KEEP, this.gl.KEEP, this.gl.DECR);
					this.gl.colorMask(false, false, false, false);
					break;
			}	
		}
	}
	RenderWebGLSurface.prototype.getRenderTexture = function() {
		var gl = this.gl;
		if (this.useMultisample) {
			gl.bindFramebuffer(gl.READ_FRAMEBUFFER, this.msaa_buffers.render_framebuffer);
			gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, this.msaa_buffers.color_framebuffer);
			gl.blitFramebuffer(0, 0, this.renderbuffer_width, this.renderbuffer_height, 0, 0, this.renderbuffer_width, this.renderbuffer_height, gl.COLOR_BUFFER_BIT, gl.NEAREST);
		}
		return this.msaa_buffers.framebuffer_texture;
	}
	RenderWebGLSurface.prototype.drawCommands = function(commands, clear) {
		this.blendType = [];
		this.blendIndex = 0;
		this.maskState = 0;
		this.numMasks = 0;
		this.maskStateDirty = true;
		var gl = this.gl;
		gl.bindFramebuffer(gl.FRAMEBUFFER, this.msaa_buffers.render_framebuffer);
		gl.viewport(0, 0, this.renderbuffer_width, this.renderbuffer_height);
		this.setStencilState();
		if (clear) {
			gl.clearColor(clear[0] / 255, clear[1] / 255, clear[2] / 255, clear[3]);
		} else {
			gl.clearColor(0, 0, 0, 0);
		}
		gl.stencilMask(0xff);
		gl.clear(gl.COLOR_BUFFER_BIT | gl.STENCIL_BUFFER_BIT);
		commands.execute(this);
		gl.disable(gl.STENCIL_TEST);
		gl.colorMask(true, true, true, true);
		var renderTexture = this.getRenderTexture();
		gl.bindFramebuffer(gl.FRAMEBUFFER, null);
		return renderTexture;
	}
	// CommandHandler
	RenderWebGLSurface.prototype.renderBitmap = function(imageInterval, transform, isSmoothed, pixelSnapping) {
		if (!imageInterval) return;
		var matrix = transform.matrix.slice(0);
		pixelSnapping.apply(matrix);
		var colorTransform = transform.colorTransform;
		matrix = multiplicationMatrix(matrix, [imageInterval.width, 0, 0, imageInterval.height, 0, 0])
		var world_matrix = [
			matrix[0], matrix[1], 0.0, 0.0,
			matrix[2], matrix[3], 0.0, 0.0,
			0.0, 0.0, 1.0, 0.0,
			(matrix[4] / 20), (matrix[5] / 20), 0.0, 1.0,
		];
		this.setStencilState();
		this.renderer.useShader(this.shaders.shaderTexture);
		this.shaders.shaderTexture.uniformMatrix4("view_matrix", this.view_matrix);
		this.shaders.shaderTexture.uniformMatrix4("world_matrix", world_matrix);
		this.shaders.shaderTexture.uniformMatrix3("u_matrix", [1, 0, 0, 0, 1, 0, 0, 0, 1]);
		this.shaders.shaderTexture.uniform4f('mult_color', colorTransform[0], colorTransform[1], colorTransform[2], colorTransform[3]);
		this.shaders.shaderTexture.uniform4f('add_color', colorTransform[4] / 255, colorTransform[5] / 255, colorTransform[6] / 255, colorTransform[7] / 255);
		this.gl.enableVertexAttribArray(0);
		this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.quatVao);
		this.gl.vertexAttribPointer(0, 2, this.gl.FLOAT, false, 0, 0);
		var filter = isSmoothed ? this.gl.LINEAR : this.gl.NEAREST;
		this.gl.bindTexture(this.gl.TEXTURE_2D, imageInterval.texture);
		this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, filter);
		this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, filter);
		var wrap = this.gl.CLAMP_TO_EDGE;
		this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, wrap);
		this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, wrap);
		this.gl.drawArrays(this.gl.TRIANGLES, 0, 12);
	}
	RenderWebGLSurface.prototype.renderShape = function(shapeInterval, transform) {
		if (!shapeInterval) return;
		var matrix = transform.matrix;
		var colorTransform = transform.colorTransform;
		var array = shapeInterval.shapeIntervalData;
		this.setStencilState();
		var world_matrix = [
			matrix[0], matrix[1], 0.0, 0.0,
			matrix[2], matrix[3], 0.0, 0.0,
			0.0, 0.0, 1.0, 0.0,
			(matrix[4] / 20), (matrix[5] / 20), 0.0, 1.0,
		];
		for (var i = 0; i < array.length; i++) {
			var si = array[i];
			var shader;
			if (si.type == 0) {
				shader = this.shaders.shaderColor;
			} else if (si.type == 1) {
				shader = this.shaders.shaderGradient;
			} else if (si.type == 2) {
				shader = this.shaders.shaderTexture;
			}
			this.renderer.useShader(shader);
			this.gl.enableVertexAttribArray(0);
			this.gl.bindBuffer(this.gl.ARRAY_BUFFER, si.vao);
			this.gl.vertexAttribPointer(0, 2, this.gl.FLOAT, false, 0, 0);
			if (si.type == 0) {
				shader.uniform4f("u_color", si.color[0], si.color[1], si.color[2], si.color[3]);
			} else if (si.type == 1) {
				shader.uniformMatrix3("u_matrix", si.matrix);
				shader.uniform1fv("u_ratios[0]", si.ratios);
				shader.uniform4fv("u_colors[0]", si.colors);
				shader.uniform1i("u_gradient_type", si.isRadial ? 2 : 0);
				shader.uniform1i("u_repeat_mode", si.repeat);
				shader.uniform1f("u_focal_point", si.focal);
				shader.uniform1i("u_interpolation", 0);
			} else if (si.type == 2) {
				var filter = si.isSmoothed ? this.gl.LINEAR : this.gl.NEAREST;
				this.gl.bindTexture(this.gl.TEXTURE_2D, si.texture);
				this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, filter);
				this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, filter);
				var wrap = si.isRepeating ? this.gl.REPEAT : this.gl.CLAMP_TO_EDGE;
				this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, wrap);
				this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, wrap);
				shader.uniformMatrix3("u_matrix", si.matrix);
			}
			shader.uniformMatrix4("view_matrix", this.view_matrix);
			shader.uniformMatrix4("world_matrix", world_matrix);
			shader.uniform4f('mult_color', colorTransform[0], colorTransform[1], colorTransform[2], colorTransform[3]);
			shader.uniform4f('add_color', colorTransform[4] / 255, colorTransform[5] / 255, colorTransform[6] / 255, colorTransform[7] / 255);
			this.gl.drawArrays(this.gl.TRIANGLES, 0, si.num);
		}
	}
	RenderWebGLSurface.prototype.drawRect = function(color, matrix) {
		var world_matrix = [
			matrix[0], matrix[1], 0.0, 0.0,
			matrix[2], matrix[3], 0.0, 0.0,
			0.0, 0.0, 1.0, 0.0,
			(matrix[4] / 20), (matrix[5] / 20), 0.0, 1.0,
		];
		this.setStencilState();
		var shaderColor = this.shaders.shaderColor;
		this.renderer.useShader(shaderColor);
		this.gl.enableVertexAttribArray(0);
		this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.quatVao);
		this.gl.vertexAttribPointer(0, 2, this.gl.FLOAT, false, 0, 0);
		shaderColor.uniform4f("u_color", color[0] / 255, color[1] / 255, color[2] / 255, color[3]);
		shaderColor.uniformMatrix4("view_matrix", this.view_matrix);
		shaderColor.uniformMatrix4("world_matrix", world_matrix);
		shaderColor.uniform4f('mult_color', 1, 1, 1, 1);
		shaderColor.uniform4f('add_color', 0, 0, 0, 0);
		this.gl.drawArrays(this.gl.TRIANGLES, 0, 6);
	}
	RenderWebGLSurface.prototype.pushMask = function() {
		this.numMasks += 1;
		this.maskState = 1;
		this.maskStateDirty = true;
	}
	RenderWebGLSurface.prototype.activateMask = function() {
		this.maskState = 2;
		this.maskStateDirty = true;
	}
	RenderWebGLSurface.prototype.deactivateMask = function() {
		this.maskState = 3;
		this.maskStateDirty = true;
	}
	RenderWebGLSurface.prototype.popMask = function() {
		this.numMasks -= 1;
		if (this.numMasks == 0) this.maskState = 0;
		else this.maskState = 2;
		this.maskStateDirty = true;
	}
	RenderWebGLSurface.prototype.blend = function(commands, blendMode) {
		this.pushBlendMode(blendMode);
		commands.execute(this);
		this.popBlendMode();
	}
	function isMobileOrTablet() {
		if (window) {
			return ("orientation" in window);
		}
		return false;
	}
	function createCanvas() {
		var canvas = document.createElement('canvas');
		canvas.width = 480;
		canvas.height = 360;
		return canvas;
	}
	var RenderWebGL = function() {
		var options = {
			stencil: true,
			alpha: true,
			antialias: false,
			depth: false,
			premultipliedAlpha: true
		}
		var isGL2;
		var msaa_sample_count;
		var canvas = createCanvas();
		var gl = canvas.getContext('webgl2', options);
		if (gl) {
			msaa_sample_count = isMobileOrTablet() ? 2 : 4;
			var max_samples = gl.getParameter(gl.MAX_SAMPLES);
			if (max_samples != null) {
				max_samples = (max_samples || 0) >>> 0;
				if (max_samples > 0 && max_samples < msaa_sample_count) {
					msaa_sample_count = max_samples;
				}
			}
			isGL2 = true;
		} else {
			isGL2 = false;
			options.antialias = true;
			canvas = createCanvas();
			gl = canvas.getContext('webgl', options);
			if (gl) {
				msaa_sample_count = 1;
			} else {
				throw new Error("Couldn't create GL context");
			}
		}
		this.isGL2 = isGL2;
		this.useMultisample = true;
		this.quality = "high";
		this.canvas = canvas;
		this.gl = gl;
		this.msaa_sample_count = msaa_sample_count;
		this.shaders = new Shaders(this.gl);
		this.gl.enable(this.gl.BLEND);
		this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT, 1);
		this.quatVao = this.buildQuadMesh();
		this.gl.blendEquationSeparate(this.gl.FUNC_ADD, this.gl.FUNC_ADD);
		this.gl.blendFuncSeparate(this.gl.ONE, this.gl.ONE_MINUS_SRC_ALPHA, this.gl.ONE, this.gl.ONE_MINUS_SRC_ALPHA);
		this.surface = null;
		this.resize(480, 360);
	}
	RenderWebGL.prototype.get_msaa_sample_count = function() {
		return Math.min(this.get_quality_msaa_sample_count(), this.msaa_sample_count);
	}
	RenderWebGL.prototype.get_quality_msaa_sample_count = function() {
		return (this.quality == "high") ? 4 : 2;
	}
	RenderWebGL.prototype.createStencilRenderbuffer = function(width, height) {
		var gl = this.gl;
		var stencilBuffer = gl.createRenderbuffer();
		if (!stencilBuffer)
			throw new Error('Cannot create rendebuffer');
		gl.bindRenderbuffer(gl.RENDERBUFFER, stencilBuffer);
		gl.renderbufferStorage(gl.RENDERBUFFER, gl.STENCIL_INDEX8, width, height);
		return stencilBuffer;
	}
	RenderWebGL.prototype.createFramebuffer = function(texture, stencil) {
		var gl = this.gl;
		var framebuffer = gl.createFramebuffer();
		gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);
		gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);
		if (stencil) {
			gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.STENCIL_ATTACHMENT, gl.RENDERBUFFER, stencil);
		}
		return framebuffer;
	}
	RenderWebGL.prototype.buildQuadMesh = function() {
		var gl = this.gl;
		var quatBuffer = gl.createBuffer();
		gl.bindBuffer(gl.ARRAY_BUFFER, quatBuffer);
		gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 1]), gl.STATIC_DRAW);
		return quatBuffer;
	}
	RenderWebGL.prototype.createTexture = function(a) {
		var filtering = (a == null) ? this.gl.NEAREST : a;
		var texture = this.gl.createTexture();
		this.gl.bindTexture(this.gl.TEXTURE_2D, texture);
		this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);
		this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE);
		this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, filtering);
		this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, filtering);
		return texture;
	}
	RenderWebGL.prototype.useShader = function(shader) {
		if (this.currentShader !== shader) {
			this.gl.useProgram(shader.program);
			this.currentShader = shader;
		}
	}
	RenderWebGL.prototype.shapeToInterval = function(shapeCache, library) {
		var result = [];
		for (var _i = 0; _i < shapeCache.length; _i++) {
			var shape = shapeCache[_i];
			if (!shape) continue;
			var fill = shape.fill;
			if (!fill) continue;
			var r = (shape.type == 1) ? this.createStroke(shape.path2d, Math.max(shape.width / 20, 1)) : this.createFill(shape.path2d);
			var num = r.length / 2;
			var bufferPos = this.gl.createBuffer();
			this.gl.bindBuffer(this.gl.ARRAY_BUFFER, bufferPos);
			this.gl.bufferData(this.gl.ARRAY_BUFFER, r, this.gl.STATIC_DRAW);
			if (fill.type == 0) {
				var color = fill.color;
				result.push({
					type: 0,
					color: [color[0] / 255, color[1] / 255, color[2] / 255, color[3]],
					num: num,
					vao: bufferPos
				});
			} else if (fill.type == 1) {
				var ratios = [];
				var colors = [];
				var re = fill.records;
				for (var i = 0; i < 16; i++) {
					var g = re[Math.min(i, re.length - 1)];
					colors.push(g[0][0] / 255);
					colors.push(g[0][1] / 255);
					colors.push(g[0][2] / 255);
					colors.push(g[0][3]);
					ratios.push(g[1]);
				}
				result.push({
					type: 1,
					num: num,
					ratios: ratios,
					colors: colors,
					focal: fill.focal || 0,
					isRadial: fill.isRadial,
					repeat: fill.repeat,
					matrix: swf_to_gl_matrix(fill.matrix),
					vao: bufferPos
				});
			} else if (fill.type == 2) {
				var id = fill.id;
				var texture = library.bitmapHandle(id, this);
				result.push({
					type: 2,
					num: num,
					texture: texture.texture,
					isRepeating: fill.isRepeating,
					isSmoothed: fill.isSmoothed,
					matrix: swf_bitmap_to_gl_matrix(fill.matrix, texture.width, texture.height),
					vao: bufferPos
				});
			}
		}
		return new RenderWebGLShapeInterval(this, result);
	}
	RenderWebGL.prototype.allowMultisample = function() {
		return (this.isGL2 && (this.msaa_sample_count >= 2)) && this.useMultisample && this.quality != "low";
	}
	RenderWebGL.prototype.submitFrame = function(clear, commands, cache_entries) {
		var gl = this.gl;
		// for like: (Ruffle WebGL) Bitmap caching is unavailable on the webgl backend
		if (cache_entries.length) {
			for (var i = 0; i < cache_entries.length; i++) {
				var entry = cache_entries[i];
				var texture = entry.handle;
				var filters = entry.filters;
				var surface = new RenderWebGLSurface(this, texture.width, texture.height, this.checkFiltersSurfaceMultisamples(filters));
				var copyTexture = surface.drawCommands(entry.commands, entry.clear);
				surface.delete(true);
				var resultTexture = null;
				resultTexture = this.applyFilters(texture, filters, copyTexture);
				if (!resultTexture) resultTexture = copyTexture;
				if (texture.texture) this.gl.deleteTexture(texture.texture);
				texture.texture = resultTexture;
			}
		}
		var gfhf = this.surface.drawCommands(commands, clear);
		gl.clear(gl.COLOR_BUFFER_BIT);
		gl.viewport(0, 0, this.canvas.width, this.canvas.height);
		this.useShader(this.shaders.shaderCopy);
		this.currentShader.uniformMatrix4("view_matrix", [1.0, 0.0, 0.0, 0.0, 0.0, -1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]);
		this.currentShader.uniformMatrix4("world_matrix", [2.0, 0.0, 0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, -1.0, -1.0, 0.0, 1.0]);
		this.currentShader.uniformMatrix3("u_matrix", [1, 0, 0, 0, 1, 0, 0, 0, 1]);
		this.gl.enableVertexAttribArray(0);
		gl.bindBuffer(gl.ARRAY_BUFFER, this.quatVao);
		this.gl.vertexAttribPointer(0, 2, this.gl.FLOAT, false, 0, 0);
		gl.bindTexture(gl.TEXTURE_2D, gfhf);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
		gl.drawArrays(gl.TRIANGLES, 0, 12);
	}
	RenderWebGL.prototype.checkFiltersSurfaceMultisamples = function(filters) {
		var result = true;
		for (var i = 0; i < filters.length; i++) {
			var filter = filters[i];
			switch(filter.type) {
				case "blur":
					if ((filter.blurX >= 3) || (filter.blurY >= 3)) {
						result = false;
					}
					break;
			}
		}
		return result && this.allowMultisample();
	}
	RenderWebGL.prototype.applyFilters = function(texture, filters, _in) {
		var gl = this.gl;
		var h = _in;
		var result = null;
		for (var i = 0; i < filters.length; i++) {
			var filter = filters[i];
			var res = null;
			switch(filter.type) {
				case "blur":
					res = this.applyBlurFilter(texture, filter, h);
					break;
				case "glow":
					res = this.applyGlowFilter(texture, filter, h, 0, 0);
					break;
				case "drop_shadow":
					res = this.applyDropShadowFilter(texture, filter, h);
					break;
				case "bevel":
					res = this.applyBevelFilter(texture, filter, h);
					break;
				case "color_matrix":
					res = this.applyColorMatrixFilter(texture, filter, h);
					break;
			}
			if (res) {
				if (h) gl.deleteTexture(h);
				result = res;
				h = res;
			}
		}
		return result;
	}
	RenderWebGL.prototype.applyBlurFilter = function(texture, filter, _in) {
		var gl = this.gl;
		var filterShader = this.shaders.shaderFilterBlur;
		var flipTexture = this.createTexture();
		this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, texture.width, texture.height, 0, this.gl.RGBA, this.gl.UNSIGNED_BYTE, null);
		var flipFrameBuffer = this.createFramebuffer(flipTexture);
		var flopTexture = this.createTexture();
		this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, texture.width, texture.height, 0, this.gl.RGBA, this.gl.UNSIGNED_BYTE, null);
		var flopFrameBuffer = this.createFramebuffer(flopTexture);
		var first = true;
		for (var _ = 0; _ < filter.passes; _++) {
			for (var i = 0; i < 2; i++) {
				var horizontal = (i % 2) == 0;
				var strength = horizontal ? filter.blurX : filter.blurY;
				var full_size = Math.min(strength, 255);
				if (full_size <= 1.0) continue;
				var previous_view = null;
				if (first) {
					first = false;
					previous_view = _in;
				} else {
					previous_view = flipTexture;
				}
				var radius = (full_size - 1.0) / 2.0;
				var m = Math.ceil(radius) - 1.0;
				var alpha = Math.floor((radius - m) * 255.0) / 255.0;
				var last_offset = 1.0 / ((1.0 / alpha) + 1.0);
				var last_weight = alpha + 1.0;
				this.gl.bindFramebuffer(gl.FRAMEBUFFER, flopFrameBuffer);
				gl.clear(gl.COLOR_BUFFER_BIT);
				gl.viewport(0, 0, texture.width, texture.height);
				this.useShader(filterShader);
				filterShader.uniformMatrix4("view_matrix", [1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]);
				filterShader.uniformMatrix4("world_matrix", [2.0, 0.0, 0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, -1.0, -1.0, 0.0, 1.0]);
				filterShader.uniformMatrix3("u_matrix", [1, 0, 0, 0, 1, 0, 0, 0, 1]);
				filterShader.uniform1f("u_m", m);
				filterShader.uniform1f("u_m2", m * 2.0);
				filterShader.uniform1f("u_dir_x", horizontal ? (1 / texture.width) : 0);
				filterShader.uniform1f("u_dir_y", horizontal ? 0 : (1 / texture.height));
				filterShader.uniform1f("u_full_size", full_size);
				filterShader.uniform1f("u_first_weight", alpha);
				filterShader.uniform1f("u_last_offset", last_offset);
				filterShader.uniform1f("u_last_weight", last_weight);
				this.gl.enableVertexAttribArray(0);
				this.gl.bindBuffer(gl.ARRAY_BUFFER, this.quatVao);
				this.gl.vertexAttribPointer(0, 2, this.gl.FLOAT, false, 0, 0);
				this.gl.bindTexture(this.gl.TEXTURE_2D, previous_view);
				gl.drawArrays(gl.TRIANGLES, 0, 12);
				var _00 = flipTexture;
				var _01 = flipFrameBuffer;
				var _10 = flopTexture;
				var _11 = flopFrameBuffer;
				flipTexture = _10;
				flipFrameBuffer = _11;
				flopTexture = _00;
				flopFrameBuffer = _01;
			}
		}
		if (first) {
			this.gl.deleteTexture(flipTexture);
			this.gl.deleteFramebuffer(flipFrameBuffer);
			this.gl.deleteTexture(flopTexture);
			this.gl.deleteFramebuffer(flopFrameBuffer);
			return null;
		} else {
			this.gl.deleteFramebuffer(flipFrameBuffer);
			this.gl.deleteTexture(flopTexture);
			this.gl.deleteFramebuffer(flopFrameBuffer);
			return flipTexture;
		}
	}
	RenderWebGL.prototype.applyGlowFilter = function(texture, filter, _in, dir_x, dir_y) {
		var gl = this.gl;
		var isInner = !!filter.is_inner;
		var is_knockout = !!filter.is_knockout;
		var is_composite_source = !!filter.composite_source;
		var filterShader = this.shaders.shaderFilterGlow;
		var txt = this.applyBlurFilter(texture, filter.innerBlurFilter(), _in);
		if (!txt) txt = _in;
		var copyTexture2 = this.createTexture();
		this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, texture.width, texture.height, 0, this.gl.RGBA, this.gl.UNSIGNED_BYTE, null);
		var copyFramebuffer2 = this.createFramebuffer(copyTexture2);
		this.gl.bindFramebuffer(gl.FRAMEBUFFER, copyFramebuffer2);
		gl.clear(gl.COLOR_BUFFER_BIT);
		gl.viewport(0, 0, texture.width, texture.height);
		this.useShader(filterShader);
		filterShader.uniformMatrix4("view_matrix", [1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]);
		filterShader.uniformMatrix4("world_matrix", [2.0, 0.0, 0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, -1.0, -1.0, 0.0, 1.0]);
		filterShader.uniformMatrix3("u_matrix", [1, 0, 0, 0, 1, 0, 0, 0, 1]);
		filterShader.uniform1i('u_texture', 0);
		filterShader.uniform1i('u_blurred', 1);
		filterShader.uniform4f("u_color", filter.color[0] / 255, filter.color[1] / 255, filter.color[2] / 255, filter.color[3]);
		filterShader.uniform1f("u_dir_x", (dir_x / texture.width));
		filterShader.uniform1f("u_dir_y", (dir_y / texture.height));
		filterShader.uniform1f("strength", filter.strength || 0);
		filterShader.uniform1i("inner", isInner ? 1 : 0);
		filterShader.uniform1i("knockout", is_knockout ? 1 : 0);
		filterShader.uniform1i("composite_source", is_composite_source ? 1 : 0);
		this.gl.enableVertexAttribArray(0);
		gl.bindBuffer(gl.ARRAY_BUFFER, this.quatVao);
		this.gl.vertexAttribPointer(0, 2, this.gl.FLOAT, false, 0, 0);
		this.gl.bindTexture(this.gl.TEXTURE_2D, txt);
		gl.activeTexture(gl.TEXTURE1);
		this.gl.bindTexture(this.gl.TEXTURE_2D, _in);
		gl.activeTexture(gl.TEXTURE0);
		gl.drawArrays(gl.TRIANGLES, 0, 12);
		this.gl.deleteFramebuffer(copyFramebuffer2);
		this.gl.deleteTexture(_in);
		this.gl.deleteTexture(txt);
		return copyTexture2;
	}
	RenderWebGL.prototype.applyBevelFilter = function(texture, filter, _in) {
		var dir_x = (Math.cos(filter.angle) * filter.distance);
		var dir_y = (Math.sin(filter.angle) * filter.distance);
		var gl = this.gl;
		var is_inner = !!filter.is_inner;
		var is_on_top = !!filter.is_on_top;
		var bevel_type = 0;
		if (is_on_top) {
			bevel_type = 2;
		} else if (is_inner) {
			bevel_type = 1;
		} else {
			bevel_type = 0;
		}
		var is_knockout = !!filter.is_knockout;
		var filterShader = this.shaders.shaderFilterBevel;
		var txt = this.applyBlurFilter(texture, filter.innerBlurFilter(), _in);
		if (!txt) txt = _in;
		var copyTexture2 = this.createTexture();
		this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, texture.width, texture.height, 0, this.gl.RGBA, this.gl.UNSIGNED_BYTE, null);
		var copyFramebuffer2 = this.createFramebuffer(copyTexture2);
		this.gl.bindFramebuffer(gl.FRAMEBUFFER, copyFramebuffer2);
		gl.clear(gl.COLOR_BUFFER_BIT);
		gl.viewport(0, 0, texture.width, texture.height);
		this.useShader(filterShader);
		filterShader.uniformMatrix4("view_matrix", [1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]);
		filterShader.uniformMatrix4("world_matrix", [2.0, 0.0, 0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, -1.0, -1.0, 0.0, 1.0]);
		filterShader.uniformMatrix3("u_matrix", [1, 0, 0, 0, 1, 0, 0, 0, 1]);
		filterShader.uniform1i('u_texture', 0);
		filterShader.uniform1i('u_blurred', 1);
		var highlight_color = [filter.highlight_color[0] / 255, filter.highlight_color[1] / 255, filter.highlight_color[2] / 255, filter.highlight_color[3]];
		highlight_color[0] *= highlight_color[3];
		highlight_color[1] *= highlight_color[3];
		highlight_color[2] *= highlight_color[3];
		var shadow_color = [filter.shadow_color[0] / 255, filter.shadow_color[1] / 255, filter.shadow_color[2] / 255, filter.shadow_color[3]];
		shadow_color[0] *= shadow_color[3];
		shadow_color[1] *= shadow_color[3];
		shadow_color[2] *= shadow_color[3];
		filterShader.uniform4f("highlight_color", highlight_color[0], highlight_color[1], highlight_color[2], highlight_color[3]);
		filterShader.uniform4f("shadow_color", shadow_color[0], shadow_color[1], shadow_color[2], shadow_color[3]);
		filterShader.uniform1f("u_dir_x", ((dir_x || 0) / texture.width));
		filterShader.uniform1f("u_dir_y", ((dir_y || 0) / texture.height));
		filterShader.uniform1f("strength", filter.strength || 0);
		filterShader.uniform1i("knockout", is_knockout ? 1 : 0);
		filterShader.uniform1i("bevel_type", bevel_type);
		this.gl.enableVertexAttribArray(0);
		gl.bindBuffer(gl.ARRAY_BUFFER, this.quatVao);
		this.gl.vertexAttribPointer(0, 2, this.gl.FLOAT, false, 0, 0);
		this.gl.bindTexture(this.gl.TEXTURE_2D, txt);
		gl.activeTexture(gl.TEXTURE1);
		this.gl.bindTexture(this.gl.TEXTURE_2D, _in);
		gl.activeTexture(gl.TEXTURE0);
		gl.drawArrays(gl.TRIANGLES, 0, 12);
		this.gl.deleteFramebuffer(copyFramebuffer2);
		this.gl.deleteTexture(_in);
		this.gl.deleteTexture(txt);
		return copyTexture2;
	}
	RenderWebGL.prototype.applyDropShadowFilter = function(texture, filter, _in) {
		var dir_x = (Math.cos(filter.angle) * filter.distance);
		var dir_y = (Math.sin(filter.angle) * filter.distance);
		return this.applyGlowFilter(texture, filter.innerGlowFilter(), _in, dir_x, dir_y);
	}
	RenderWebGL.prototype.applyColorMatrixFilter = function(texture, filter, _in) {
		var gl = this.gl;
		var filterShader = this.shaders.shaderFilterColorMatrix;
		var copyTexture = this.createTexture();
		this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, texture.width, texture.height, 0, this.gl.RGBA, this.gl.UNSIGNED_BYTE, null);
		var copyFramebuffer = this.createFramebuffer(copyTexture);
		this.gl.bindFramebuffer(gl.FRAMEBUFFER, copyFramebuffer);
		gl.clear(gl.COLOR_BUFFER_BIT);
		gl.viewport(0, 0, texture.width, texture.height);
		this.useShader(filterShader);
		filterShader.uniformMatrix4("view_matrix", [1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]);
		filterShader.uniformMatrix4("world_matrix", [2.0, 0.0, 0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, -1.0, -1.0, 0.0, 1.0]);
		filterShader.uniformMatrix3("u_matrix", [1, 0, 0, 0, 1, 0, 0, 0, 1]);
		filterShader.uniform1f("r_to_r", filter.matrix[0]);
		filterShader.uniform1f("g_to_r", filter.matrix[1]);
		filterShader.uniform1f("b_to_r", filter.matrix[2]);
		filterShader.uniform1f("a_to_r", filter.matrix[3]);
		filterShader.uniform1f("r_extra", filter.matrix[4]);
		filterShader.uniform1f("r_to_g", filter.matrix[5]);
		filterShader.uniform1f("g_to_g", filter.matrix[6]);
		filterShader.uniform1f("b_to_g", filter.matrix[7]);
		filterShader.uniform1f("a_to_g", filter.matrix[8]);
		filterShader.uniform1f("g_extra", filter.matrix[9]);
		filterShader.uniform1f("r_to_b", filter.matrix[10]);
		filterShader.uniform1f("g_to_b", filter.matrix[11]);
		filterShader.uniform1f("b_to_b", filter.matrix[12]);
		filterShader.uniform1f("a_to_b", filter.matrix[13]);
		filterShader.uniform1f("b_extra", filter.matrix[14]);
		filterShader.uniform1f("r_to_a", filter.matrix[15]);
		filterShader.uniform1f("g_to_a", filter.matrix[16]);
		filterShader.uniform1f("b_to_a", filter.matrix[17]);
		filterShader.uniform1f("a_to_a", filter.matrix[18]);
		filterShader.uniform1f("a_extra", filter.matrix[19]);
		this.gl.enableVertexAttribArray(0);
		gl.bindBuffer(gl.ARRAY_BUFFER, this.quatVao);
		this.gl.vertexAttribPointer(0, 2, this.gl.FLOAT, false, 0, 0);
		this.gl.bindTexture(this.gl.TEXTURE_2D, _in);
		gl.drawArrays(gl.TRIANGLES, 0, 12);
		this.gl.deleteFramebuffer(copyFramebuffer);
		this.gl.deleteTexture(_in);
		return copyTexture;
	}
	RenderWebGL.prototype.path2dToVex = function(path2d) {
		var arrs = [];
		var arr = [];
		var posX = 0;
		var posY = 0;
		for (var i = 0; i < path2d.length; i++) {
			var a = path2d[i];
			switch (a[0]) {
				case 0:
					arr = [(a[1] || 0) / 20, (a[2] || 0) / 20];
					arrs.push(arr);
					posX = a[1] || 0;
					posY = a[2] || 0;
					break;
				case 1:
					for (var _ = 1; _ <= 5; _++) {
						var x = QuadraticBezier(_ / 5, posX, a[1] || 0, a[3] || 0) | 0;
						var y = QuadraticBezier(_ / 5, posY, a[2] || 0, a[4] || 0) | 0;
						arr.push(x / 20, y / 20);
					}
					posX = a[3];
					posY = a[4];
					break;
				case 2:
					if (!(((a[1] || 0) == posX) && ((a[2] || 0) == posY))) {
						arr.push((a[1] || 0) / 20, (a[2] || 0) / 20);
						posX = a[1] || 0;
						posY = a[2] || 0;	
					}
					break;
			}
		}
		return arrs;
	}
	RenderWebGL.prototype.createFill = function(path2d) {
		return new Float32Array(AT_Tess.fill(this.path2dToVex(path2d)));
	}
	RenderWebGL.prototype.createStroke = function(path2d, width) {
		var arrs = this.path2dToVex(path2d);
		return new Float32Array(AT_Tess.stroke(arrs, width));
	}
	RenderWebGL.prototype.resetSurface = function() {
		if (this.surface) this.surface.delete(false);
		this.surface = new RenderWebGLSurface(this, this.width, this.height, this.allowMultisample());
	}
	// RenderBackend
	RenderWebGL.prototype.destroy = function() {
		var ext = this.gl.getExtension("WEBGL_lose_context");
		if (ext) {
			ext.loseContext();
		}
	}
	RenderWebGL.prototype.setQuality = function(quality) {
		this.quality = quality;
		this.resetSurface();
	}
	RenderWebGL.prototype.is_offscreen_supported = function() {
		return this.shaders.isFilter;
	}
	RenderWebGL.prototype.debugInfo = function() {
		var result = [];
		if (this.isGL2) {
			result.push("Renderer: WebGL 2.0");
		} else {
			result.push("Renderer: WebGL 1.0");
		}

		var add_line = function(name, val) {
			if (val) {
				result.push(name + ": " + (val ? val : "<unknown>"));
			}
		}
		
		var driver_info = this.gl.getExtension("WEBGL_debug_renderer_info");
		if (driver_info) add_line("Adapter Name", this.gl.getParameter(driver_info.UNMASKED_RENDERER_WEBGL));
		add_line("Adapter Vendor", this.gl.getParameter(this.gl.VENDOR));
		add_line("Adapter Renderer", this.gl.getParameter(this.gl.RENDERER));
		add_line("Adapter Version", this.gl.getParameter(this.gl.VERSION));

		result.push("Surface samples: x" + this.msaa_sample_count);
		result.push("Surface size: " + this.width + "x" + this.height);

		return result.join("\n");
	} 
	RenderWebGL.prototype.name = "webgl";
	RenderWebGL.prototype.resize = function(w, h) {
		this.width = w;
		this.height = h;
		this.canvas.width = this.width;
		this.canvas.height = this.height;
		this.gl.viewport(0, 0, this.canvas.width, this.canvas.height);
		this.resetSurface();
	}
	RenderWebGL.prototype.registerShape = function(shapes, library) {
		return this.shapeToInterval(shapes, library);
	}
	RenderWebGL.prototype.createEmptyTexture = function(width, height) {
		var texture = this.createTexture(this.gl.LINEAR);
		return new RenderWebGLImageInterval(this, width, height, texture);
	}
	RenderWebGL.prototype.registerBitmap = function(image) {
		image.toRGBA();
		var texture = this.createTexture(this.gl.LINEAR);
		this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, image.width, image.height, 0, this.gl.RGBA, this.gl.UNSIGNED_BYTE, image.data);
		return new RenderWebGLImageInterval(this, image.width, image.height, texture);
	}
	RenderWebGL.prototype.updateTexture = function(handle, image) {
		var gl = this.gl;
		if (handle) {
			image.toRGBA();
			var texture = handle.texture;
			gl.bindTexture(gl.TEXTURE_2D, texture);
			gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, image.width, image.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, image.data);
			handle.width = image.width;
			handle.height = image.height;
		}
	}
	var MAX_SOUND = 32;
	var AudioManager = function() {
		this.sounds = [];
		this.globalSoundTransform = new SoundTransform();
		this.transformsDirty = false;
	}
	AudioManager.prototype.startSound = function(audio, sound, settings, display_object, avm1_object) {
		if (this.sounds.length < MAX_SOUND) {
			var handle = audio.startSound(sound, settings);
			var instance = {
				sound,
				instance: handle,
				display_object,
				transform: new SoundTransform(),
				stream_start_frame: null,
				avm1_object
			}
			audio.setSoundTransform(handle, this.transformForSound(instance));
			this.sounds.push(instance);
			return handle;
		} else {
			return null;
		}
	}
	AudioManager.prototype.startStream = function(audio, movie_clip, clip_frame, data, stream_info) {
		if (this.sounds.length < MAX_SOUND) {
			var handle = audio.startStream(data, stream_info);
			var instance = {
				sound: null,
				instance: handle,
				display_object: movie_clip,
				transform: new SoundTransform(),
				stream_start_frame: clip_frame,
				avm1_object: null
			}
			audio.setSoundTransform(handle, this.transformForSound(instance));
			this.sounds.push(instance);
			return handle;	
		} else {
			return null;
		}
	}
	AudioManager.prototype.stopSound = function(audio, instance) {
		for (var i = 0; i < this.sounds.length; i++) {
			var other = this.sounds[i];
			if (other.instance === instance) {
				audio.stopSound(other.instance);
				this.sounds.splice(i, 1);
				return;
			}
		}
	}
	AudioManager.prototype.stopSoundsWithHandle = function(audio, sound) {
		var newSounds = [];
		for (var i = 0; i < this.sounds.length; i++) {
			var s = this.sounds[i];
			if (s.sound === sound) {
				audio.stopSound(s.instance);
			} else {
				newSounds.push(s);
			}
		}
		this.sounds = newSounds;
	}
	AudioManager.prototype.stopSoundsWithDisplayObject = function(audio, display_object) {
		var newSounds = [];
		for (var i = 0; i < this.sounds.length; i++) {
			var s = this.sounds[i];
			var h = false;
			if (s.display_object === display_object) {
				if ((s.display_object.getName() == display_object.getName()) && (s.display_object.path() == display_object.path())) {
					h = true;
				}
			}
			if (h) {
				audio.stopSound(s.instance);
			} else {
				newSounds.push(s);
			}
		}
		this.sounds = newSounds;
	}
	AudioManager.prototype.isSoundPlaying = function(sound) {
		for (var i = 0; i < this.sounds.length; i++) {
			var other = this.sounds[i];
			if (other.instance === sound) return true;
		}
		return false;
	}
	AudioManager.prototype.isSoundPlayingWithHandle = function(sound) {
		for (var i = 0; i < this.sounds.length; i++) {
			var other = this.sounds[i];
			if (other.sound === sound) {
				return true;
			}
		}
		return false;
	}
	AudioManager.prototype.stopAllSounds = function(audio) {
		this.sounds = [];
		audio.stopAllSounds();
	}
	AudioManager.prototype.updateSounds = function(context) {
		var newSounds = [];
		for (var i = 0; i < this.sounds.length; i++) {
			var sound = this.sounds[i];
			var pos = context.audio.getSoundPosition(sound.instance);
			if (pos != null) {
				newSounds.push(sound);
			} else {
				var object = sound.avm1_object;
				if (object) {
					var native = object.getNative();
					if (native.type == Avm1NativeObject.Sound) {
						var root = context.stage.getRootClip();
						if (root) {
							context.actionQueue.queueAction(root, {
								type: "method",
								object,
								name: "onSoundComplete",
								args: []
							}, false);
						}
					}
				}
			}
		}
		this.sounds = newSounds;
		context.audioManager.updateSoundTransforms(context.audio);
	}
	AudioManager.prototype.audioSkewTime = function(audio, offest_ms) {
		var g = [];
		for (var i = 0; i < this.sounds.length; i++) {
			var sound = this.sounds[i];
			if (sound.stream_start_frame != null) g.push(sound);
		}
		for (var i = 0; i < g.length; i++) {
			var element = g[i];
			this.stopSound(audio, element.instance);
		}
	}
	AudioManager.prototype.setGlobalSoundTransform = function(sound_transform) {
		this.globalSoundTransform = sound_transform;
		this.transformsDirty = true;
	}
	AudioManager.prototype.setSoundTransformsDirty = function() {
		this.transformsDirty = true;
	}
	AudioManager.prototype.transformForSound = function(sound) {
		var transform = sound.transform.clone();
		var parent = sound.display_object;
		if (parent) {
			transform.concat(parent.soundTransform);
			parent = parent.getParent();
		}
		transform.concat(this.globalSoundTransform);
		return AudioSoundTransform.from(transform);
	}
	AudioManager.prototype.updateSoundTransforms = function(audio) {
		if (this.transformsDirty) {
			for (var i = 0; i < this.sounds.length; i++) {
				var sound = this.sounds[i];
				var transform = this.transformForSound(sound);
				audio.setSoundTransform(sound.instance, transform);
			}
			this.transformsDirty = false;
		}
	}
	var AudioSoundTransform = function(data) {
		this.left_to_left = data.left_to_left;
		this.left_to_right = data.left_to_right;
		this.right_to_left = data.right_to_left;
		this.right_to_right = data.right_to_right;
	}
	AudioSoundTransform.from = function(other) {
		return new AudioSoundTransform({
			left_to_left: (other.left_to_left * other.volume) / Math.pow(100, 2),
			left_to_right: (other.left_to_right * other.volume) / Math.pow(100, 2),
			right_to_left: (other.right_to_left * other.volume) / Math.pow(100, 2),
			right_to_right: (other.right_to_right * other.volume) / Math.pow(100, 2)
		});
	}
	AudioSoundTransform.createNew = function() {
		return new AudioSoundTransform({
			left_to_left: 1.0,
			left_to_right: 0.0,
			right_to_left: 0.0,
			right_to_right: 1.0,
		});
	}
	var DByteReader = function() {}
	DByteReader.prototype.read = function() {
		return null;
	}
	DByteReader.prototype.setData = function(data) {
		this.data = data;
		this.bytePos = 0;
	}
	DByteReader.prototype.readData = function() {
		var result = this.read();
		if (result) {
			this.data = result;
		}
		this.bytePos = 0;
		return !!result;
	}
	DByteReader.prototype.bytesAvailable = function() {
		return this.data.length - this.bytePos;
	}
	DByteReader.prototype.readUint8 = function() {
		return this.data[this.bytePos++];
	}
	DByteReader.prototype.readInt16 = function() {
		return (this.data[this.bytePos++] + (this.data[this.bytePos++] << 8)) << 16 >> 16;
	}
	DByteReader.prototype.readByte = function() {
		return (this.data[this.bytePos++] << 24) >> 24;
	}
	DByteReader.prototype.readInt32 = function() {
		return (this.data[this.bytePos++] << 24) + (this.data[this.bytePos++] << 16) + (this.data[this.bytePos++] << 8) + this.data[this.bytePos++];
	}
	DByteReader.prototype.readSub = function(n) {
		var r = this.data.subarray(this.bytePos, this.bytePos + n);
		this.bytePos += n;
		return r;
	}
	DByteReader.prototype.readString = function(n) {
		var r = this.data.slice(this.bytePos, this.bytePos + n);
		this.bytePos += n;
		return String.fromCharCode.apply(null, r);
	}
	DByteReader.prototype.isEOF = function() {
		return this.bytePos >= this.data.length;
	}
	var RawDecoder = function(inner, sample_rate, isStereo, is_16_bit) {
		this.inner = inner;
		this.isStereo = isStereo;
		this.is_16_bit = is_16_bit;
		this._sample_rate = sample_rate;
	}
	RawDecoder.prototype.debugType = function() {
		return "Raw " + (this.is_16_bit ? 16 : 8) + " BIT";
	}
	RawDecoder.prototype.sample_rate = function() {
		return this._sample_rate;
	}
	RawDecoder.prototype.read_sample = function() {
		return this.is_16_bit ? (this.inner.readInt16() / 0x7fff) : ((this.inner.readUint8() - 128) / 128);
	}
	RawDecoder.prototype.next = function() {
		var left = this.read_sample();
		var right = this.isStereo ? this.read_sample() : left;
		return [left, right];
	}
	RawDecoder.prototype.seek_to_sample_frame = function(frame) {
		this.inner.bytePos = 0;
		for (var _ = 0; _ < frame; _++) {
			this.next();
		}
	}
	var DBitReader = function(vec) {
		this.vec = vec;
		this.bytePos = 0;
		this.bitPos = 0;
	}
	DBitReader.prototype.readUB = function(n) {
			var value = 0;
			while (n--) value <<= 1, value |= this.readBit();
			return value;
	}
	DBitReader.prototype.readSB = function(n) {
			var uval = this.readUB(n);
			var shift = 32 - n;
			return (uval << shift) >> shift;
	}
	DBitReader.prototype.readBit = function() {
		var val = (this.vec[this.bytePos] >> (7 - this.bitPos++)) & 0x1;
		if (this.bitPos > 7) {
			this.bytePos++;
			this.bitPos = 0;
		}
		return val;
	}
	var AdpcmDecoder = function(inner, sample_rate, isStereo) {
		var data = inner.data;
		this.input = new DBitReader(data ? data : new Uint8Array(0));
		this.channels = isStereo ? 2 : 1;
		this.c = [{}, {}];
		this.bits_per_sample = this.input.readUB(2) + 2;
		this.decoder = AdpcmDecoder.SAMPLE_DELTA_CALCULATOR[this.bits_per_sample - 2];
		this.sample_num = 0;
		this._sample_rate = sample_rate;
	}
	AdpcmDecoder.INDEX_TABLE = [new Int16Array([-1, 2]), new Int16Array([-1, -1, 2, 4]), new Int16Array([-1, -1, -1, -1, 2, 4, 6, 8]), new Int16Array([-1, -1, -1, -1, -1, -1, -1, -1, 1, 2, 4, 6, 8, 10, 13, 16])];
	AdpcmDecoder.STEP_TABLE = new Uint16Array([7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 19, 21, 23, 25, 28, 31, 34, 37, 41, 45, 50, 55, 60, 66, 73, 80, 88, 97, 107, 118, 130, 143, 157, 173, 190, 209, 230, 253, 279, 307, 337, 371, 408, 449, 494, 544, 598, 658, 724, 796, 876, 963, 1060, 1166, 1282, 1411, 1552, 1707, 1878, 2066, 2272, 2499, 2749, 3024, 3327, 3660, 4026, 4428, 4871, 5358, 5894, 6484, 7132, 7845, 8630, 9493, 10442, 11487, 12635, 13899, 15289, 16818, 18500, 20350, 22385, 24623, 27086, 29794, 32767]);
	AdpcmDecoder.SAMPLE_DELTA_CALCULATOR = [
		function (a, b) {
			var c = a >> 1;
			if (b & 1) c += a;
			return c;
		},
		function (a, b) {
			var c = a >> 2;
			if (b & 1) c += a >> 1;
			if (b & 2) c += a;
			return c;
		},
		function (a, b) {
			var c = a >> 3;
			if (b & 1) c += a >> 2;
			if (b & 2) c += a >> 1;
			if (b & 4) c += a;
			return c;
		},
		function (a, b) {
			var c = a >> 4;
			if (b & 1) c += a >> 3;
			if (b & 2) c += a >> 2;
			if (b & 4) c += a >> 1;
			if (b & 8) c += a;
			return c;
		},
	];
	AdpcmDecoder.prototype.debugType = function() {
		return "ADPCM " + this.bits_per_sample + "-BIT";
	}
	AdpcmDecoder.prototype.sample_rate = function() {
		return this._sample_rate;
	}
	AdpcmDecoder.prototype.next = function() {
		var j = this.input, m = this.bits_per_sample, d = this.decoder, _ = this.c, s = this.channels, h = 1 << (m - 1), n = AdpcmDecoder.INDEX_TABLE[m - 2];
		if (this.sample_num == 0) {
			for (var i = 0; i < s; i++) {
				var w = _[i];
				w.sample = j.readSB(16);
				w.stepIndex = j.readUB(6);
			}
		}
		this.sample_num = (this.sample_num + 1) % 4095;
		for (var i2 = 0; i2 < s; i2++) {
			var w = _[i2];
			var r = AdpcmDecoder.STEP_TABLE[w.stepIndex];
			var p = j.readUB(m);
			var g = p & (h - 1);
			var delta = d(r, g);
			w.sample = Math.max(-32768, Math.min(32767, w.sample + (p & h ? -delta : delta)));
			w.stepIndex = Math.max(0, Math.min(88, w.stepIndex + n[g]));
		}
		var l = _[0].sample / 0x8000;
		var r = s == 2 ? _[1].sample / 0x8000 : l;
		return [l, r];
	}
	AdpcmDecoder.prototype.seek_to_sample_frame = function(frame) {
		this.input.bytePos = 0;
		this.input.bitPos = 0;
		this.c = [{}, {}];
		this.bits_per_sample = this.input.readUB(2) + 2;
		this.decoder = AdpcmDecoder.SAMPLE_DELTA_CALCULATOR[this.bits_per_sample - 2];
		this.sample_num = 0;
		for (var _ = 0; _ < frame; _++) {
			this.next();
		}
	}
	var MP3Decoder = function(inner) {
		this.stream_ended = true;
		this.frequency = 44100;
		this._debug_type = "";
		if (!inner.data && !inner.readData()) {
			return;
		}
		this.reader = inner;
		this.header = new AT_MP3.Header();
		var r = this.getHeaders();
		if (!r) return;
		var versionS = AT_MP3.Header.versionTable[this.header.version()];
		this._debug_type = MP3Decoder.types[versionS];
		this.reader.bytePos = 0;
		this.channels = (this.header.mode() == AT_MP3.Header.SINGLE_CHANNEL) ? 1 : 2;
		this.frequency = this.header.frequency();
		this.bitstream = new AT_MP3.BitStream();
		this.max_samples = (versionS == 1) ? 1152 : 576;
		this.samples = 0;
		this.buffer = null;
		this.pos = 0;
		this.decoder = new AT_MP3.Decoder();
		this.stream_ended = false;
	}
	MP3Decoder.types = {
		1: "MPEG1",
		2: "MPEG2_LSF",
		2.5: "MPEG2.5_LSF",
	}
	MP3Decoder.prototype.sample_rate = function() {
		return this.frequency;
	}
	MP3Decoder.prototype.debugType = function() {
		return this._debug_type;
	}
	MP3Decoder.prototype.skipTags = function() {
		var startPos = this.reader.bytePos;
		var type = this.reader.readString(3);
		if (type == "ID3") {
			this.reader.bytePos += 3;
			var b3 = this.reader.readByte() | 0;
			var b2 = this.reader.readByte() | 0;
			var b1 = this.reader.readByte() | 0;
			var b0 = this.reader.readByte() | 0;
			var len = ((b3 << 21) + (b2 << 14) + (b1 << 7) + b0) | 0;
			this.reader.bytePos += len;
		} else if (type == "TAG") {
			this.reader.bytePos += 125;
		} else {
			this.reader.bytePos = startPos;
		}
	}
	MP3Decoder.prototype.getHeader = function() {
		while (this.reader.bytesAvailable() > 4) {
			this.skipTags();
			var bdfgd = this.reader.readInt32();
			if (AT_MP3.Header.isValidHeader(bdfgd)) {
				this.header.parseHeader(bdfgd);
				return true;
			} else {
				this.reader.bytePos -= 3;
			}
		}
		return false;
	}
	MP3Decoder.prototype.getHeaders = function() {
		while (true) {
			var isH = this.getHeader();
			if (isH) {
				return true;
			} else {
				if (!this.reader.readData()) {
					return false;
				}
			}
		}
	}
	MP3Decoder.prototype.next = function() {
		if (this.stream_ended) {
			return null;
		}
		var l, r;
		if (this.samples == 0) {
			this.pos = 0;
			this.samples = this.max_samples;
			var isH = this.getHeaders();
			if (!isH) {
				this.stream_ended = true;
				return null;
			}
			this.bitstream.setData(this.reader.readSub(this.header.framesize));
			var buf = this.decoder.decodeFrame(this.header, this.bitstream);
			this.buffer = buf.getBuffer();
		}
		l = this.buffer[this.pos++];
		if (this.channels == 2) r = this.buffer[this.pos++];
		else r = l;
		this.samples--;
		return [l, r];
	}
	MP3Decoder.prototype.seek_to_sample_frame = function(frame) {
		if (this.decoder) {
			this.stream_ended = false;
		} else {
			return;
		}
		this.decoder = new AT_MP3.Decoder();
		this.reader.bytePos = 0;
		this.samples = 0;
		for (var _ = 0; _ < frame; _++) {
			this.next();
		}
	}
	var NellyMoserDecoder = function(inner, sample_rate) {
		this.stream_ended = true;
		if (!inner.data && !inner.readData()) return;
		this.inner = inner;
		this.state = new Float32Array(128);
		this.cur_frame = new Float32Array(256);
		this.cur_sample = 0;
		this._sample_rate = sample_rate;
		this.stream_ended = false;
	}
	NellyMoserDecoder.prototype.debugType = function() {
		return "nellymoser";
	}
	NellyMoserDecoder.prototype.sample_rate = function() {
		return this._sample_rate;
	}
	NellyMoserDecoder.prototype.next_frame = function() {
		if (this.stream_ended) return;
		if (this.inner.isEOF()) {
			if (!this.inner.readData()) {
				this.stream_ended = true;
				return;
			}
		}
		var block = this.inner.readSub(64);
		AT_ASAO.decode(this.state, block, this.cur_frame);
		this.cur_sample = 0;
	}
	NellyMoserDecoder.prototype._next = function() {
		if (this.cur_sample >= 256) {
			this.next_frame();
		}
		var sample = this.cur_frame[this.cur_sample];
		this.cur_sample += 1;
		return sample;
	}
	NellyMoserDecoder.prototype.next = function() {
		if (this.stream_ended) return [0, 0];
		var sample = this._next() / 32767;
		return [sample, sample];
	}
	NellyMoserDecoder.prototype.seek_to_sample_frame = function(frame) {
		this.stream_ended = false;
		this.inner.bytePos = 0;
		for (var _ = 0; _ < frame; _++) {
			this.next();
		}
	}
	var StreamTagReader = function(streamInfo, swf_data) {
		this.swf_data = swf_data;
		this.pos = 0;
		this.compression = streamInfo.stream.compression;
		this.current_audio_data = null;
		this.mp3_samples_buffered = 0;
		this.mp3_samples_per_block = streamInfo.samplePerBlock;
	}
	StreamTagReader.prototype.next = function() {
		var _this = this;
		var compression = this.compression;
		var found = false;
		while (true) {
			var tag_callback = function(reader, tagCode, tagLength) {
				if (tagCode == 19) {
					if (!found) {
						found = true;
						var audio_block = reader.byteStream.readBytes(tagLength);
						if ((compression == "MP3") && (audio_block.length >= 4)) {
							var num_samples = audio_block[0] + (audio_block[1] << 8);
							_this.mp3_samples_buffered += num_samples;
							audio_block = audio_block.subarray(4);
						}
						_this.current_audio_data = audio_block;
					}
				} else if (tagCode == 1) {
					if (compression == "MP3") _this.mp3_samples_buffered -= _this.mp3_samples_per_block;
					return true;
				}
			}
			var reader = this.swf_data.readFrom(this.pos);
			decode_tags(reader, tag_callback);
			this.pos = reader.byteStream.byte_offset;
			if (found) {
				return this.current_audio_data;
			} else if ((compression != "MP3") || (this.mp3_samples_buffered <= -this.mp3_samples_per_block) || reader.isEmpty()) {
				return null;
			}
		}
	}
	var AdpcmStreamDecoder = function(stream_info, swf_data) {
		this.stream_info = stream_info;
		this.samples_per_block = stream_info.samplePerBlock;
		this.cur_frame = 0;
		this._sample_rate = stream_info.stream.sampleRate;
		this.tagReader = new StreamTagReader(stream_info, swf_data);
		var data = this.tagReader.next();
		if (data) this.decoder = this.createDecoder(data);
	}
	AdpcmStreamDecoder.prototype.debugType = function() {
		return this.decoder ? this.decoder.debugType() : "";
	}
	AdpcmStreamDecoder.prototype.sample_rate = function() {
		return this._sample_rate;
	}
	AdpcmStreamDecoder.prototype.createDecoder = function(data) {
		var b = new DByteReader();
		b.setData(data);
		var stream_format = this.stream_info.stream;
		var compression = stream_format.compression;
		switch(compression) {
			case "uncompressed":
			case "uncompressedUnknownEndian":
				return new RawDecoder(b, stream_format.sampleRate, stream_format.isStereo, stream_format.is16Bit);
			case "ADPCM":
				return new AdpcmDecoder(b, stream_format.sampleRate, stream_format.isStereo);
		}
	}
	AdpcmStreamDecoder.prototype.next = function() {
		if (this.decoder) {
			this.cur_frame += 1;
			var frame = this.decoder.next();
			if (this.cur_frame >= this.samples_per_block) {
				this.cur_frame = 0;
				var data = this.tagReader.next();
				if (data) this.decoder = this.createDecoder(data);
				else this.decoder = null;
			}
			return frame;
		} else {
			return null;
		}
	}
	var DByteReaderStream = function(stream) {
		DByteReader.call(this);
		this._stream = stream;
	}
	DByteReaderStream.prototype = Object.create(DByteReader.prototype);
	DByteReaderStream.prototype.constructor = DByteReaderStream;
	DByteReaderStream.prototype.read = function() {
		return this._stream.next();
	}
	var StandardStreamDecoder = function(stream_info, swf_data) {
		this.stream_info = stream_info;
		var tagReader = new StreamTagReader(stream_info, swf_data);
		var byteReader = new DByteReaderStream(tagReader);
		this.isSkip = stream_info.latencySeek || 0;
		this.decoder = this.createDecoder(byteReader);
	}
	StandardStreamDecoder.prototype.debugType = function() {
		return this.decoder ? this.decoder.debugType() : "";
	}
	StandardStreamDecoder.prototype.sample_rate = function() {
		return this.decoder ? this.decoder.sample_rate() : 44100;
	}
	StandardStreamDecoder.prototype.createDecoder = function(b) {
		var compression = this.stream_info.stream.compression;
		switch(compression) {
			case "MP3":
				return new MP3Decoder(b);
			case "nellymoser":
				return new NellyMoserDecoder(b, this.stream_info.stream.sampleRate);
		}
	}
	StandardStreamDecoder.prototype.next = function() {
		var frame = null;
		if (this.isSkip != null) {
			for (var _ = 0; _ < this.isSkip; _++) {
				frame = this.decoder.next();
			}
			this.isSkip = null;
		}
		frame = this.decoder.next();
		return frame;
	}
	function makeStreamDecoder(stream_info, swf_data) {
		var compression = stream_info.stream.compression;
		switch(compression) {
			case "ADPCM":
			case "uncompressed":
			case "uncompressedUnknownEndian":
				return new AdpcmStreamDecoder(stream_info, swf_data);
			default:
				return new StandardStreamDecoder(stream_info, swf_data);
		}
	}
	function makeSeekableDecoder(format, data) {
		var compression = format.compression;
		var b = new DByteReader();
		b.setData(data);
		switch (compression) {
			case "uncompressed":
			case "uncompressedUnknownEndian":
				return new RawDecoder(b, format.sampleRate, format.isStereo, format.is16Bit);
			case "ADPCM":
				return new AdpcmDecoder(b, format.sampleRate, format.isStereo);
			case "MP3":
				return new MP3Decoder(b);
			case "nellymoser":
				return new NellyMoserDecoder(b, format.sampleRate);
		}
	}
	var Linear = function(left, right) {
		this.left = left;
		this.right = right;
	}
	Linear.prototype.interpolate = function(x) {
		var l_f = this.left;
		var r_f = this.right;
		var diff_l = r_f[0] - l_f[0];
		var diff_r = r_f[1] - l_f[1];
		return [
			((diff_l * x) + l_f[0]),
			((diff_r * x) + l_f[1])
		]
	}
	Linear.prototype.next_source_frame = function(source_frame) {
		this.left = this.right;
		this.right = source_frame;
	}
	var EventSoundStream = function(decoder, settings, num_sample_frames, skip_sample_frames) {
		this.decoder = decoder;
		var sample_divisor = 44100 / decoder.sample_rate();
		this.start_sample_frame = (((settings.inSample || 0) / sample_divisor) | 0) + skip_sample_frames;
		this.end_sample_frame = (((("outSample" in settings) ? (settings.outSample / sample_divisor) : num_sample_frames)) | 0) + skip_sample_frames;
		this.numLoops = ("numLoops" in settings) ? settings.numLoops : 1;
		this.is_exhausted = false;
		this.cur_sample_frame = this.start_sample_frame;
		this.nextLoop();
	}
	EventSoundStream.prototype.getDecoder = function() {
		return this.decoder;
	}
	EventSoundStream.prototype.sample_rate = function() {
		return this.decoder.sample_rate();
	}
	EventSoundStream.prototype.isExhausted = function() {
		return this.is_exhausted;
	}
	EventSoundStream.prototype.nextLoop = function() {
		if (this.numLoops > 0) {
			this.numLoops -= 1;
			this.decoder.seek_to_sample_frame(this.start_sample_frame);
			this.cur_sample_frame = this.start_sample_frame;
		} else {
			this.is_exhausted = true;
		}
	}
	EventSoundStream.prototype.next = function() {
		if (!this.is_exhausted) {
			var frame = this.decoder.next();
			if (frame) {
				this.cur_sample_frame += 1;
				if (this.cur_sample_frame > this.end_sample_frame) {
					this.nextLoop();
				}
				return frame;
			} else {
				this.nextLoop();
				return this.next();
			}
		} else {
			return [0, 0];
		}
	}
	var DecoderStream = function(decoder) {
		this.decoder = decoder;
		this.is_exhausted = false;
	}
	DecoderStream.prototype.getDecoder = function() {
		return this.decoder;
	}
	DecoderStream.prototype.sample_rate = function() {
		return this.decoder.sample_rate();
	}
	DecoderStream.prototype.isExhausted = function() {
		return this.is_exhausted;
	}
	DecoderStream.prototype.next = function() {
		var frame = this.decoder.next();
		if (frame) {
			return frame;
		} else {
			this.is_exhausted = true;
			return [0, 0];
		}
	}
	var ResampleHzToHz = function(stream, sample_rate) {
		this._sample_rate = sample_rate;
		this.interpolation_value = 1;
		this.interpolator = new Linear([0, 0], [0, 0]);
		this.stream = stream;
	}
	ResampleHzToHz.prototype.sample_rate = function() {
		return this._sample_rate;
	}
	ResampleHzToHz.prototype.getDecoder = function() {
		return this.stream.getDecoder();
	}
	ResampleHzToHz.prototype.isExhausted = function() {
		return this.stream.isExhausted();
	}
	ResampleHzToHz.prototype.next = function() {
		var rate = this.stream.sample_rate();
		var source_to_target_ratio = rate / this._sample_rate;
		while (this.interpolation_value >= 1) {
			this.interpolator.next_source_frame(this.stream.next());
			this.interpolation_value -= 1;
		}
		var out = this.interpolator.interpolate(this.interpolation_value);
		this.interpolation_value += source_to_target_ratio;
		return out;
	}
	var EnvelopeSignal = function(envelope, outputSampleRate) {
		this.cur_sample = 0;
		var envelopes = [];
		for (var i = 0; i < envelope.length; i++) {
			var e = envelope[i];
			envelopes.push({
				leftVolume: e.leftVolume,
				rightVolume: e.rightVolume,
				sample: ((e.sample / 44100) * outputSampleRate) | 0
			});
		}
		this.envelope = envelopes;
		this.envelopeId = 0;
		this.left = this.envelope[0] ? this.envelope[0].leftVolume : 32768;
		this.right = this.envelope[0] ? this.envelope[0].rightVolume : 32768;
	}
	EnvelopeSignal.prototype.next = function() {
		this.cur_sample += 1;
		if (this.envelopeId < this.envelope.length) {
			var rs = this.envelope[this.envelopeId];
			var rs2 = this.envelope[this.envelopeId - 1];
			if (rs2) {
				var per = Math.max(Math.min((this.cur_sample - rs2.sample) / (rs.sample - rs2.sample), 1), 0);
				var startPer = 1 - per;
				var leftVal = ((rs2.leftVolume * startPer) + (rs.leftVolume * per));
				var rightVal = ((rs2.rightVolume * startPer) + (rs.rightVolume * per));
				this.left = Math.max(Math.min(leftVal, 32768), 0);
				this.right = Math.max(Math.min(rightVal, 32768), 0);
			}
			if (this.cur_sample >= rs.sample) {
				this.left = rs.leftVolume;
				this.right = rs.rightVolume;
				this.envelopeId++;
			}
		}
		return [this.left / 32768, this.right / 32768];
	}
	var MulAmpStream = function(stream, stream2) {
		this.stream = stream;
		this.stream2 = stream2;
	}
	MulAmpStream.prototype.sample_rate = function() {
		return this.stream.sample_rate();
	}
	MulAmpStream.prototype.getDecoder = function() {
		return this.stream.getDecoder();
	}
	MulAmpStream.prototype.isExhausted = function() {
		return this.stream.isExhausted();
	}
	MulAmpStream.prototype.next = function() {
		var frame = this.stream.next();
		var s = this.stream2.next();
		var l = frame[0] * s[0];
		var r = frame[1] * s[1];
		return [l, r];
	}
	var SoundInstance = function(stream) {
		this.stream = stream;
		this.active = true;
		this.left_transform = [1.0, 0.0];
		this.right_transform = [0.0, 1.0];
	}
	var AudioMixer = function(outputSampleRate) {
		this.volume = 1;
		this.soundInstances = [];
		this.outputSampleRate = outputSampleRate;
	}
	AudioMixer.prototype.mix = function(output_buffer) {
		var volume = this.volume;
		this.mix_audio(this.soundInstances, volume, output_buffer);
	}
	AudioMixer.prototype.mix_audio = function(soundInstances, volume, output_buffer) {
		var _volume = (Math.pow(10, 1.9084850188786497 * volume) - 1) / 80;
		for (var i = 0; i < output_buffer.length; i++) {
			var l = 0;
			var r = 0;
			for (var j = 0; j < soundInstances.length; j++) {
				var sound = soundInstances[j];
				if (sound.active && !sound.stream.isExhausted()) {
					var sound_frame = sound.stream.next();
					var left_0 = sound_frame[0] * sound.left_transform[0];
					var left_1 = sound_frame[1] * sound.left_transform[1];
					var right_0 = sound_frame[0] * sound.right_transform[0];
					var right_1 = sound_frame[1] * sound.right_transform[1];
					var sound_frame_left = (left_0 + left_1) * _volume;
					var sound_frame_right = (right_0 + right_1) * _volume;
					l += sound_frame_left;
					r += sound_frame_right;
				} else {
					sound.active = false;
				}
			}
			output_buffer[i][0] = l;
			output_buffer[i][1] = r;
		}
		var newSounds = [];
		for (var i = 0; i < soundInstances.length; i++) {
			var element = soundInstances[i];
			if (element.active) newSounds.push(element);
		}
		soundInstances.length = 0;
		for (var i = 0; i < newSounds.length; i++) {
			soundInstances.push(newSounds[i]);
		}
	}
	AudioMixer.prototype.stopAllSounds = function() {
		this.soundInstances = [];
	}
	AudioMixer.prototype.getSoundPosition = function(instance) {
		for (var i = 0; i < this.soundInstances.length; i++) {
			var s = this.soundInstances[i];
			if (s === instance) {
				return 0;
			}
		}
		return null;
	}
	AudioMixer.prototype.makeResampler = function(stream) {
		return new ResampleHzToHz(stream, this.outputSampleRate);
	}
	AudioMixer.prototype.makeStreamFromEventSound = function(sound, settings, data) {
		var decoder = makeSeekableDecoder(sound.format, data);
		var res = new EventSoundStream(decoder, settings, sound.numSampleFrames, sound.skipSampleFrames);
		var stream = this.makeResampler(res);
		var envelope = settings.envelope;
		if (envelope) {
			stream = new MulAmpStream(stream, new EnvelopeSignal(envelope, this.outputSampleRate));
		}
		return stream;
	}
	AudioMixer.prototype.makeStreamFromSwfSlice = function(stream_info, data_stream) {
		var clip_stream_decoder = makeStreamDecoder(stream_info, data_stream);
		var stream = new DecoderStream(clip_stream_decoder);
		stream = this.makeResampler(stream);
		return stream;
	}
	AudioMixer.prototype.startSound = function(sound_handle, settings) {
		var data = sound_handle.data;
		var stream = this.makeStreamFromEventSound(sound_handle, settings, data);
		var i = new SoundInstance(stream);
		this.soundInstances.push(i);
		return i;
	}
	AudioMixer.prototype.startStream = function(clip_data, stream_info) {
		var stream = this.makeStreamFromSwfSlice(stream_info, clip_data);
		var i = new SoundInstance(stream);
		this.soundInstances.push(i);
		return i;
	}
	AudioMixer.prototype.stopSound = function(sound) {
		for (var i = 0; i < this.soundInstances.length; i++) {
			var s = this.soundInstances[i];
			if (s === sound) {
				this.soundInstances.splice(i, 1);
				return;
			}
		}
	}
	AudioMixer.prototype.setSoundTransform = function(instance, transform) {
		for (var i = 0; i < this.soundInstances.length; i++) {
			var s = this.soundInstances[i];
			if (s === instance) {
				s.left_transform = [transform.left_to_left, transform.right_to_left];
				s.right_transform = [transform.left_to_right, transform.right_to_right];
				return;
			}
		}
	}
	AudioMixer.prototype.registerSound = function(swf_sound) {
		var data, skip_sample_frames;
		if (swf_sound.format.compression == "MP3") {
			data = swf_sound.data.subarray(2);
			skip_sample_frames = swf_sound.data[0] + (swf_sound.data[1] << 8);
		} else {
			data = swf_sound.data;
			skip_sample_frames = 0;
		}
		return {
			format: swf_sound.format,
			data: data,
			skipSampleFrames: skip_sample_frames,
			numSampleFrames: swf_sound.numSamples
		};
	}
	var AudioMixerBackend = function() {
		this.mixer = null;
	}
	AudioMixerBackend.prototype.stopAllSounds = function() {
		this.mixer.stopAllSounds();
	}
	AudioMixerBackend.prototype.getSoundPosition = function(instance) {
		return this.mixer.getSoundPosition(instance);
	}
	AudioMixerBackend.prototype.startSound = function(sound_handle, settings) {
		return this.mixer.startSound(sound_handle, settings);
	}
	AudioMixerBackend.prototype.startStream = function(clip_data, stream_info) {
		return this.mixer.startStream(clip_data, stream_info);
	}
	AudioMixerBackend.prototype.stopSound = function(sound) {
		this.mixer.stopSound(sound);
	}
	AudioMixerBackend.prototype.registerSound = function(swf_sound) {
		return this.mixer.registerSound(swf_sound);
	}
	AudioMixerBackend.prototype.setSoundTransform = function(a, b) {
		this.mixer.setSoundTransform(a, b);
	}
	var UpdateContext = function(data) {
		this.player = data.player;
		this.renderer = data.renderer;
		this.library = data.library;
		this.audio = data.audio;
		this.audioManager = data.audioManager;
		this.swf = data.swf;
		this.avm1 = data.avm1;
		this.avm2 = data.avm2;
		this.input = data.input;
		this.ui = data.ui;
		this.log = data.log;
		this.video = data.video;
		this.stage = data.stage;
		this.actionQueue = data.actionQueue;
		this.timers = data.timers;
		this.mousePosition = data.mousePosition;
		this.unbound_text_fields = data.unbound_text_fields;
		this.framePhase = data.framePhase;
	}
	Object.defineProperty(UpdateContext.prototype, "startTime", {
		get: function() {
			return this.player.startTime;
		}
	});
	UpdateContext.prototype.getDragObject = function() {
		return this.player.dragObject;
	}
	UpdateContext.prototype.setDragObject = function(dragObject) {
		this.player.dragObject = dragObject;
	}
	UpdateContext.prototype.isSoundPlaying = function(sound) {
		return this.audioManager.isSoundPlaying(sound);
	}
	UpdateContext.prototype.isSoundPlayingWithHandle = function(sound) {
		return this.audioManager.isSoundPlayingWithHandle(sound);
	}
	UpdateContext.prototype.startStream = function(movie_clip, frame, data, stream_info) {
		return this.audioManager.startStream(this.audio, movie_clip, frame, data, stream_info);
	}
	UpdateContext.prototype.startSound = function(sound, settings, owner, avm1_object) {
		return this.audioManager.startSound(this.audio, sound, settings, owner, avm1_object);
	}
	UpdateContext.prototype.setSoundTransformsDirty = function() {
		this.audioManager.setSoundTransformsDirty();
	}
	UpdateContext.prototype.stopSound = function(instance) {
		this.audioManager.stopSound(this.audio, instance);
	}
	UpdateContext.prototype.stopSoundsWithHandle = function(sound) {
		this.audioManager.stopSoundsWithHandle(this.audio, sound);
	}
	UpdateContext.prototype.stopSoundsWithDisplayObject = function(display_object) {
		this.audioManager.stopSoundsWithDisplayObject(this.audio, display_object);
	}
	UpdateContext.prototype.getGlobalSoundTransform = function() {
		return this.audioManager.globalSoundTransform;
	}
	UpdateContext.prototype.setGlobalSoundTransform = function(sound_transform) {
		this.audioManager.setGlobalSoundTransform(sound_transform);
	}
	UpdateContext.prototype.stopAllSounds = function() {
		this.audioManager.stopAllSounds(this.audio);
	}
	UpdateContext.prototype.addInstanceCounter = function() {
		return this.player.addInstanceCounter();
	}
	UpdateContext.prototype.avm_trace = function(trace) {
		this.log.avm_trace(trace.replace('\r', "\n"));
	}
	var RenderContext = function(data) {
		this.library = data.library;
		this.renderer = data.renderer;
		this.commands = data.commands;
		this.transformStack = data.transformStack;
		this.cacheDraws = data.cacheDraws;
		this.isOffscreen = data.isOffscreen;
		this.useBitmapCache = data.useBitmapCache;
		this.stage = data.stage;
	}
	var Character = function(type, data) {
		this.type = type;
		this.data = data;
	}
	Object.defineProperty(Character.prototype, "displayType", {
		get: function() {
			switch (this.type) {
				case Character.EditText: return "EditText";
				case Character.Graphic: return "Graphic";
				case Character.MovieClip: return "MovieClip";
				case Character.Bitmap: return "Bitmap";
				case Character.Avm1Button: return "Avm1Button";
				case Character.Avm2Button: return "Avm2Button";
				case Character.Font: return "Font";
				case Character.MorphShape: return "MorphShape";
				case Character.Text: return "Text";
				case Character.Sound: return "Sound";
				case Character.Video: return "Video";
				case Character.BinaryData: return "BinaryData";
			}
		}
	});
	Character.EditText = 1;
	Character.Graphic = 2;
	Character.MovieClip = 3;
	Character.Bitmap = 4;
	Character.Avm1Button = 5;
	Character.Avm2Button = 6;
	Character.Font = 7;
	Character.MorphShape = 8;
	Character.Text = 9;
	Character.Sound = 10;
	Character.Video = 11;
	Character.BinaryData = 12;
	var CompressedBitmap = function(type, data) {
		this.type = type;
		this.data = data;
	}
	CompressedBitmap.prototype.decode = function() {
		switch (this.type) {
			case CompressedBitmap.Lossless:
				return decodeDefineBitsLossless(this.data);
			case CompressedBitmap.Jpeg:
				return decodeDefineBitsJpeg(this.data.data, this.data.alpha);
		}
	}
	CompressedBitmap.Lossless = 1;
	CompressedBitmap.Jpeg = 2;
	var Glyph = function(commands) {
		this.shapeHandle = null;
		this.commands = commands;
		this.advance = 0;
	}
	Glyph.prototype.getShapeHandle = function(renderer) {
		if (!this.shapeHandle) {
			this.shapeHandle = renderer.registerShape(shapeUtils.shapeToRendererInfo(this.commands));
		}
		return this.shapeHandle;
	}
	var GlyphSourceMemory = function(glyphs, codePointToGlyph, kerningPairs) {
		this.glyphs = glyphs;
		this.codePointToGlyph = codePointToGlyph;
		this.kerningPairs = kerningPairs;
	}
	GlyphSourceMemory.prototype.getByIndex = function(i) {
		return this.glyphs[i];
	}
	GlyphSourceMemory.prototype.getByCodePoint = function(codePoint) {
		var index = this.codePointToGlyph.get(codePoint);
		if (index != null) return this.glyphs[index];
		else return null;
	}
	var FontDescriptor = function() {
		this.name = "";
		this.lowercaseName = "";
		this.isBold = false;
		this.isItalic = false;
	}
	FontDescriptor.fromSwfTag = function(val, encoding) {
		var name = ("fontNameData" in val) ? encoding.decode(val.fontNameData) : "";
		var lowercaseName = name.toLowerCase();
		var f = new FontDescriptor();
		f.name = name;
		f.lowercaseName = lowercaseName;
		f.isBold = val.isBold;
		f.isItalic = val.isItalic;
		return f;
	}
	var FlashFont = function() {
		this.glyphs = null;
		this.scale = 1024;
		this.ascent = 0;
		this.descent = 0;
		this.leading = 0;
		this.hasLayout = false;
	}
	FlashFont.fromSwfTag = function(tag, encoding) {
		var descriptor = FontDescriptor.fromSwfTag(tag, encoding);
		var glyphs = tag.glyphs;
		var layout = tag.layout;
		var codeTables = tag.codeTables;
		var codePointToGlyph = new Map();
		var glyphsResult = [];
		var kerningPairs = [];
		var ascent = 0;
		var descent = 0;
		var leading = 0;
		var hasLayout = false;
		if (glyphs) {
			for (var i = 0; i < glyphs.length; i++) {
				var g = new Glyph(shapeUtils.convertWithCacheCodes(glyphs[i]));
				glyphsResult.push(g);
			}
			if (codeTables) {
				for (var i = 0; i < codeTables.length; i++) {
					codePointToGlyph.set(codeTables[i], i)
				}
			}
			if (layout) {
				ascent = layout.ascent;
				descent = layout.descent;
				leading = layout.leading;
				var advanceTable = layout.advanceTable;
				for (var i = 0; i < advanceTable.length; i++) {
					glyphsResult[i].advance = advanceTable[i];
				}
				hasLayout = true;
			}
		}
		var f = new FlashFont();
		f.descriptor = descriptor;
		f.scale = (tag.version >= 3) ? 20480 : 1024;
		f.ascent = ascent;
		f.descent = descent;
		f.leading = leading;
		f.glyphs = new GlyphSourceMemory(glyphsResult, codePointToGlyph, kerningPairs);
		f.hasLayout = hasLayout;
		return f;
	}
	FlashFont.prototype.getGlyphForChar = function(c) {
		return this.glyphs.getByCodePoint(c);
	}
	FlashFont.prototype.getGlyph = function(index) {
		return this.glyphs.getByIndex(index);
	}
	var TextRenderSettings = function(type, gridFit, thickness, sharpness) {
		this.type = type;
		this.gridFit = gridFit;
		this.thickness = thickness;
		this.sharpness = sharpness;
	}
	TextRenderSettings.createNew = function() {
		return new TextRenderSettings(TextRenderSettings.Normal, "pixel", 0, 0);
	}
	TextRenderSettings.fromSwfTag = function(settings) {
		return new TextRenderSettings(settings.useAdvancedRendering ? TextRenderSettings.Advanced : TextRenderSettings.Normal, settings.gridFit, settings.thickness, settings.sharpness);
	}
	TextRenderSettings.prototype.isAdvanced = function() {
		return this.type == TextRenderSettings.Advanced;
	}
	TextRenderSettings.Normal = 1;
	TextRenderSettings.Advanced = 2;
	var BinaryData = function(tag) {
		this.data = tag.data;
	}
	BinaryData.fromSwfTag = function(tag) {
		return new BinaryData(tag);
	}
	var HTMLReader = function(source) {
		this.source = source;
		this.index = 0;
	}
	HTMLReader.prototype.char = function() {
		return this.source[this.index];
	}
	HTMLReader.prototype.charAt = function(index) {
		return this.source[index];
	}
	HTMLReader.prototype.next = function() {
		this.index++;
	}
	HTMLReader.prototype.isEOF = function() {
		return this.index >= this.source.length;
	}
	HTMLReader.prototype.peek = function(a, b) {
		var length = (a == null) ? 1 : a;
		var offset = (b == null) ? 1 : b;
		if (length === 1)
			return this.charAt(this.index + offset);
		var result = '';
		for (var i = 0; i < length; i++) {
			result += this.charAt(this.index + offset + i);
		}
		return result;
	}
	HTMLReader.prototype.skipWhilespace = function() {
		while (/\s/.test(this.char())) {
			if (this.isEOF()) break;
			this.next();
		}
	}
	HTMLReader.prototype.lineInfo = function() {
		var line = 0;
		var column = 0;
		for (var i = 0; i < this.index; i++) {
			if (this.source[i] === '\n') {
				line++;
				column = 0;
			}
			else {
				column++;
			}
		}
		return { line: line + 1, column: column + 1 };
	}
	HTMLReader.prototype.error = function(message) {
		var l = this.lineInfo();
		throw new SyntaxError(`HTMLParser: ${message} (Line ${l.line} Column ${l.column})`);
	}
	HTMLReader.prototype.expect = function(char) {
		if (this.char() !== char) {
			this.error(`Expected '${char}' but found '${this.char()}'`);
		}
		this.next();
	}
	HTMLReader.prototype.readAttributes = function() {
		var result = [];
		this.skipWhilespace();
		while(this.char() != ">") {
			this.skipWhilespace();
			if (this.isEOF()) break;
			var name = "";
			while(((!this.isEOF()) && (this.char() != " ") && (this.char() != "=") && (this.char() != ">"))) {
				name += this.char();
				this.next();
			}
			this.skipWhilespace();
			if (this.isEOF() || (this.char() == ">")) {
				result.push([name]);
			} else {
				if (this.char() == "=") {
					this.next();
					this.skipWhilespace();
					var value = this.readString();
					result.push([name, value]);
				}
			}
		}
		return result;
	}
	HTMLReader.prototype.readString = function() {
		this.expect('"');
		var result = '';
		if (this.char() === '"') {
			this.next();
			return '';
		}
		while (true) {
			var char = this.char();
			result += char;
			if (this.peek() === '"') {
				break;
			}
			this.next();
		}
		this.next();
		this.expect('"');
		return result;
	}
	HTMLReader.prototype.readEvent = function() {
		this.skipWhilespace();
		if (this.isEOF()) return null;
		if (this.char() == "<") {
			this.next();
			var tagName = "";
			if (this.char() == "/") {
				this.next();
				while(((!this.isEOF()) && (this.char() != " ") && (this.char() != ">"))) {
					tagName += this.char();
					this.next();
				}
				this.expect(">");
				return {
					type: "end",
					tagName: tagName
				}
			} else {
				while(((!this.isEOF()) && (this.char() != " ") && (this.char() != ">"))) {
					tagName += this.char();
					this.next();
				}
				var attributes = this.readAttributes();
				this.expect(">");
				return {
					type: "start",
					tagName: tagName,
					attributes: attributes
				}
			}
			
		} else {
			var text = "";
			while(((!this.isEOF()) && (this.char() != "<"))) {
				text += this.char();
				this.next();
			}
			return {
				type: "text",
				text: text
			}
		}
	}
	var TextSpanFont = function() {
		this.face = "";
		this.size = 12;
		this.color = [0, 0, 0, 0];
		this.kerning = false;
		this.letter_spacing = 0;
	}
	TextSpanFont.with_format = function(tf) {
		var data = new TextSpanFont();
		data.set_text_format(tf);
		return data;
	}
	TextSpanFont.prototype.set_text_format = function(tf) {
		var font = tf.font;
		var size = tf.size;
		var color = tf.color;
		var kerning = tf.kerning;
		var letter_spacing = tf.letterSpacing;
		if (font != null) {
			
		}
		if (size != null) {
			this.size = size;
		}
		if (color != null) {
			this.color = color;
		}
		if (kerning != null) {
			this.kerning = kerning;
		}
		if (letter_spacing != null) {
			this.letter_spacing = letter_spacing;
		}
	}
	TextSpanFont.prototype.clone = function() {
		var c = new TextSpanFont();
		c.face = this.face;
		c.size = this.size;
		c.color = this.color.slice(0);
		c.kerning = this.kerning;
		c.letter_spacing = this.letter_spacing;
		return c;
	}
	var TextSpanStyle = function() {
		this.bold = false;
		this.italic = false;
		this.underline = false;
	}
	var TextSpan = function() {
		this.span_length = 0;
		this.font = new TextSpanFont();
		this.style = new TextSpanStyle();
		this.align = "left";
		this.left_margin = 0;
		this.right_margin = 0;
		this.indent = 0;
		this.block_indent = 0;
		this.leading = 0;
		this.tab_stops = [];
		this.bullet = false;
		this.url = "";
		this.target = "";
		this.display = "block";
	}
	TextSpan.with_length_and_format = function(length, tf) {
		var data = new TextSpan();
		data.span_length = length;
		data.set_text_format(tf);
		return data;
	}
	TextSpan.prototype.set_text_format = function(tf) {
		var align = tf.align;
		var bold = tf.bold;
		var italic = tf.italic;
		var underline = tf.underline;
		var left_margin = tf.leftMargin;
		var right_margin = tf.rightMargin;
		var indent = tf.indent;
		var block_indent = tf.blockIndent;
		var leading = tf.leading;
		var tab_stops = tf.tabStops;
		var bullet = tf.bullet;
		var url = tf.url;
		var target = tf.target;
		var display = tf.display;
		if (align != null) {
			this.align = align;
		}
		if (bold != null) {
			this.style.bold = bold;
		}
		if (italic != null) {
			this.style.italic = italic;
		}
		if (underline != null) {
			this.style.underline = underline;
		}
		if (left_margin != null) {
			this.left_margin = left_margin;
		}
		if (right_margin != null) {
			this.right_margin = right_margin;
		}
		if (indent != null) {
			this.indent = indent;
		}
		if (block_indent != null) {
			this.block_indent = block_indent;
		}
		if (leading != null) {
			this.leading = leading;
		}
		if (tab_stops != null) {
			this.tab_stops = tab_stops;
		}
		if (bullet != null) {
			this.bullet = bullet;
		}
		if (url != null) {
			this.url = url;
		}
		if (target != null) {
			this.target = target;
		}
		if (display != null) {
			this.display = display;
		}
		this.font.set_text_format(tf);
	}
	var TextFormat = function() {
		this.font = null;
		this.size = null;
		this.color = null;
		this.align = null;
		this.bold = null;
		this.italic = null;
		this.underline = null;
		this.leftMargin = null;
		this.rightMargin = null;
		this.indent = null;
		this.blockIndent = null;
		this.kerning = null;
		this.leading = null;
		this.letterSpacing = null;
		this.tabStops = null;
		this.bullet = null;
		this.url = null;
		this.target = null;
		this.display = null;
	}
	TextFormat.fromSwfTag = function(movie, tag) {
		var tf = new TextFormat();
		var layout = tag.layout;
		if ("fontID" in tag) {
		}
		if ("fontHeight" in tag) {
			tf.size = tag.fontHeight;
		}
		if ("textColor" in tag) {
			tf.color = tag.textColor.slice(0);
		}
		if (layout) {
			tf.leftMargin = layout.leftMargin;
			tf.rightMargin = layout.rightMargin;
			tf.indent = layout.indent;
			tf.leading = layout.leading;
		}
		return tf;
	}
	TextFormat.prototype.clone = function() {
		var c = new TextFormat();
		c.font = this.font;
		c.size = this.size;
		c.color = this.color.slice(0);
		c.align = this.align;
		c.bold = this.bold;
		c.italic = this.italic;
		c.underline = this.underline;
		c.leftMargin = this.leftMargin;
		c.rightMargin = this.rightMargin;
		c.indent = this.indent;
		c.blockIndent = this.blockIndent;
		c.kerning = this.kerning;
		c.leading = this.leading;
		c.letterSpacing = this.letterSpacing;
		c.tabStops = this.tabStops;
		c.bullet = this.bullet;
		c.url = this.url;
		c.target = this.target;
		return c;
	}
	function getAttribute(attribute, name) {
		for (var i = 0; i < attribute.length; i++) {
			var a = attribute[i];
			if (a[0].toLowerCase() == name.toLowerCase()) {
				return a[1];
			}
		}
		return null;
	}
	function process_html_entity(src) {
		var result_str = '';
		var i = 0;
		while(i < src.length) {
			if (src[i] == "&") {
				i++;
				var j = "";
				while(i < src.length) {
					if (src[i] == ";") {
						i++;
						break;
					}
					j += src[i];
					i++;
				}
				console.log(j);
				switch(j) {
					case "amp":
						result_str += "&";
						break;
					case "lt":
						result_str += "<";
						break;
					case "gt":
						result_str += ">";
						break;
					case "quot":
						result_str += '"';
						break;
					case "apos":
						result_str += "\'";
						break;
					case "nbsp":
						result_str += "\xA0";
						break;
				}
			}
			result_str += src[i];
			i++;
		}
		return result_str;
	}
	var HTML_NEWLINE = "\r";
	var FormatSpans = function() {
		this.text = "";
		this.displayedText = "";
		this.spans = [];
		this.defaultFormat = null;
	}
	FormatSpans.fromHTML = function(html, defaultFormat, style_sheet, isMultiline, condense_white, swfVersion) {
		var is_multiline = isMultiline || (swfVersion <= 6);
		var format_stack = [defaultFormat.clone()];
		var text = "";
		var spans = [];
		var opened_buffer = [];
		var opened_starts = [];
		var last_closed_font = null;
		var p_open = false;
		function apply_style(style_sheet, format, selector) {
			if (style_sheet) {

			} else {
				return format;
			}

		}
		var reader = new HTMLReader(html);
		while (true) {
			var event;
			try {
				event = reader.readEvent();
			} catch(error) {
				console.log("Error while parsing HTML", error);
				return new FormatSpans();
			}
			if (event) {
				switch(event.type) {
					case "start":
						var tag_name = event.tagName.toLowerCase();
						var attributes = event.attributes;
						var format = format_stack[format_stack.length - 1];
						var k = true;
						if (tag_name == "br") { 
							if (is_multiline) {
								text += HTML_NEWLINE;
								spans.push(TextSpan.with_length_and_format(1, format));
							}
							k = false;
						} else if (tag_name == "sbr") {
							text += HTML_NEWLINE;
							spans.push(TextSpan.with_length_and_format(1, format));
							k = false;
						} else if (tag_name == "p") {
                            p_open = true;
							format = apply_style(style_sheet, format, "p");
							var _class = getAttribute(attributes, "class");
							if (_class != null) {
								format = apply_style(style_sheet, format, "p");
							}
							var align = getAttribute(attributes, "align");
							if (align != null) {
								align = align.toLowerCase();
								if (align == "left") {
									format.align = "left";
								} else if (align == "center") {
									format.align = "center";
								} else if (align == "right") {
									format.align = "right";
								} else if (align == "justify") {
									format.align = "justify";
								}
							}
						} else if (tag_name == "a") {
							var href = getAttribute(attributes, "href");
							if (href != null) {
								format.url = href;
							}
							var target = getAttribute(attributes, "target");
							if (target != null) {
								format.target = target;
							}
							format = apply_style(style_sheet, format, "a");
							var _class = getAttribute(attributes, "class");
							if (_class != null) {
								format = apply_style(style_sheet, format, "a");
							}
						} else if (tag_name == "font") {
							var face = getAttribute(attributes, "face");
							if (face != null) {
								format.font = face;
							}
							var size = getAttribute(attributes, "size");
							if (size != null) {
								format.size = +size;
							}
							var color = getAttribute(attributes, "color");
							if (color != null) {
								if (color[0] == "#") {
									var rval = +("0x" + color.slice(1, 3));
									var gval = +("0x" + color.slice(3, 5));
									var bval = +("0x" + color.slice(5, 7));
									if (Number.isFinite(rval) && Number.isFinite(gval) && Number.isFinite(bval)) {
										format.color = [rval, gval, bval, 0];
									}
								}
							}
							var letter_spacing = getAttribute(attributes, "letterSpacing");
							if (letter_spacing != null) {
								format.letterSpacing = !(+letter_spacing);
							}
							var kerning = getAttribute(attributes, "kerning");
							if (kerning != null) {
								if (kerning == "1" && swfVersion >= 8) {
									format.letterSpacing = true;
								} else {
									format.letterSpacing = false;
								}
							}
						} else if (tag_name == "b") {
							format.bold = true;
						} else if (tag_name == "i") {
							format.italic = true;
						} else if (tag_name == "u") {
							format.underline = true;
						} else if (tag_name == "li") {
							format = apply_style(style_sheet, format, "li");
							var is_last_nl = text[text.length - 1] == HTML_NEWLINE;
							if (is_multiline && !is_last_nl && text) {
								text += HTML_NEWLINE;
								spans.push(TextSpan.with_length_and_format(1, format_stack[format_stack.length - 1]));
							}
							format.bullet = true;
						} else if (tag_name == "textformat") {
							var left_margin = getAttribute(attributes, "leftmargin");
							if (left_margin != null) {
								format.leftMargin = +left_margin;
							}
							var right_margin = getAttribute(attributes, "rightmargin");
							if (right_margin != null) {
								format.rightMargin = +right_margin;
							}
							var indent = getAttribute(attributes, "indent");
							if (indent != null) {
								format.indent = +indent;
							}
							var block_indent = getAttribute(attributes, "indent");
							if (block_indent != null) {
								format.blockIndent = +block_indent;
							}
							var leading = getAttribute(attributes, "leading");
							if (leading != null) {
								format.leading = +leading;
							}
							var tab_stops = getAttribute(attributes, "tabstops");
							if (tab_stops != null) {
								var h = tab_stops.split(",");
								format.tabStops = [];
								for (var _ = 0; _ < h.length; _++) {
									format.tabStops = +h[_];
								}
							}
						} else if (tag_name == "span") {
							var _class = getAttribute(attributes, "class");
							if (_class != null) {
								format = apply_style(style_sheet, format, "span");
							}
						} else {
							format = apply_style(style_sheet, format, tag_name);
						}
						if (k) {
							opened_starts.push(opened_buffer.length);
							opened_buffer.push(tag_name);
							format_stack.push(format);
						}
						break;
					case "text":
						var e = event.text;
						if (e) {
							e = process_html_entity(e);
							var format = format_stack[format_stack.length - 1];
							text += e;	
							spans.push(TextSpan.with_length_and_format(e.length, format));
						}
						break;
					case "end":
						var k = true;
						var tag_name = event.tagName.toLowerCase();
						var start = opened_starts[opened_starts.length - 1];
						if (start != null) {
							if (tag_name != opened_buffer[start]) {
								continue;
							} else {
								var hhd = [];
								var gg = Math.min(start, opened_buffer.length);
								for (var l = 0; l < gg; l++) {
									hhd.push(opened_buffer[l]);
								}
								opened_buffer = hhd;
								opened_starts.pop();
							}
						} else {
							continue;
						}
						if (tag_name == "br" || tag_name == "sbr") {
							
						} else {
							if (tag_name == "li") {
								if (is_multiline) {
									text += HTML_NEWLINE;
									spans.push(TextSpan.with_length_and_format(1, format_stack[format_stack.length - 1]));	
								}
							} else if (tag_name == "p") {
								if (is_multiline) {
									p: {
										if (!p_open) {
											break p;
										}
										p_open = false;
										text += HTML_NEWLINE;
										var span = TextSpan.with_length_and_format(1, format_stack[format_stack.length - 1]);
										span.style = new TextSpanStyle();
										span.url = "";
										span.target = "";
										if (last_closed_font) {
											span.font = last_closed_font.clone();
										} else {
											span.font = TextSpanFont.with_format(defaultFormat);
										}
										spans.push(span);
									}
								}
							} else if (tag_name == "font") {
								var tf = format_stack[format_stack.length - 1];
								last_closed_font = TextSpanFont.with_format(tf);
							}
                   			format_stack.pop();
						}
						break;
				}
			} else {
				break;
			}
		}
		var ret = new FormatSpans();
		ret.text = text;
		ret.spans = spans;
		ret.defaultFormat = defaultFormat;
		if (condense_white && swfVersion >= 8) {
			ret.condense_white_swf8();
		}
		ret.normalize();
		return ret;
	}
	FormatSpans.fromText = function(text, format) {
		var len = text.length;
		var r = new FormatSpans();
		r.text = text;
		r.defaultFormat = format;
		r.spans = [TextSpan.with_length_and_format(len, format)];
		return r;
	}
	FormatSpans.prototype.condense_white_swf8 = function() {
		
	}
	FormatSpans.prototype.normalize = function() {
		
	}
	var SwfMovie = function(data, header, movieInfo, fileAttributes, encoding) {
		this.isMovie = true;
		this.data = data;
		this.header = header;
		this.movieInfo = movieInfo;
		this.encoding = encoding;
		this.url = "pinkfie/movie.swf";
		this.parameters = [];
		this.attributes = {
			useDirectBlit: !!fileAttributes.useDirectBlit,
			useGPU: !!fileAttributes.useGPU,
			hasMetadata: !!fileAttributes.hasMetadata,
			isActionScript3: !!fileAttributes.isActionScript3,
			useNetworkSandbox: !!fileAttributes.useNetworkSandbox
		};
		this.library = new MovieLibrary(this);
	}
	SwfMovie.from = function(result) {
		var version = result.header.version;
		var movie = new SwfMovie(result.data, result.header, result.movieInfo, result.fileAttributes, SwfEncoding.encodingForVersion(version));
		return movie;
	}
	Object.defineProperties(SwfMovie.prototype, {
		version: {
			get: function() {
				return this.header.version;
			}
		},
		numFrames: {
			get: function() {
				return this.movieInfo.numFrames;
			}
		},
		width: {
			get: function() {
				var stageSize = this.getStageSize();
				return (stageSize.xMax - stageSize.xMin) / 20;
			}
		},
		height: {
			get: function() {
				var stageSize = this.getStageSize();
				return (stageSize.yMax - stageSize.yMin) / 20;
			}
		},
		frameRate: {
			get: function() {
				return this.movieInfo.frameRate;
			}
		},
		uncompressedLength: {
			get: function() {
				return this.header.uncompressedLength;
			}
		}
	});
	SwfMovie.prototype.isActionScript3 = function() {
		return this.attributes.isActionScript3;
	}
	SwfMovie.prototype.getStageSize = function() {
		return this.movieInfo.bounds;
	}
	var SwfSlice = function(movie, start, end) {
		this.movie = movie;
		this.start = start;
		this.end = end;
	}
	SwfSlice.from = function(movie) {
		return new SwfSlice(movie, 0, movie.data.length);
	}
	SwfSlice.empty = function(movie) {
		return new SwfSlice(movie, 0, 0);
	}
	Object.defineProperties(SwfSlice.prototype, {
		length: {
			get: function() {
				return this.end - this.start;
			}
		}
	});
	SwfSlice.prototype.copyEmpty = function() {
		return SwfSlice.empty(this.movie);
	}
	SwfSlice.prototype.getData = function() {
		return this.movie.data.subarray(this.start, this.end);
	}
	SwfSlice.prototype.readFrom = function(from) {
		var b = this.getData();
		var r = new SwfInput(b, this.movie.version);
		r.byteStream.byte_offset = from;
		return r;
	}
	SwfSlice.prototype.toStartAndEnd = function(start, end) {
		var new_start = this.start + start;
		var new_end = this.start + end;
		return new SwfSlice(this.movie, new_start, new_end);
	}
	SwfSlice.prototype.resizeToReader = function(reader, size) {
		var outer_offset = (reader.byteStream.data.byteOffset + reader.byteStream.byte_offset) - this.movie.data.byteOffset;
		var new_start = outer_offset;
		var new_end = outer_offset + size;
		var len = this.movie.data.length;
		if (new_start < len && new_end < len) {
			return new SwfSlice(this.movie, new_start, new_end);
		} else {
			return this.copyEmpty();
		}
	}
	SwfSlice.prototype.toUnboundedSubslice = function(slice) {
		var movieData = this.movie.data;
		var self_pval = movieData.byteOffset;
		var self_len = movieData.length;
		var slice_pval = slice.byteOffset;
		if (self_pval <= slice_pval && slice_pval < (self_pval + self_len)) {
			return new SwfSlice(this.movie, slice_pval - self_pval, (slice_pval - self_pval) + slice.length);
		} else {
			return this.copyEmpty();
		}
	}
	SwfSlice.prototype.isEmpty = function() {
		return this.end == this.start;
	}
	function decode_tags(reader, tag_callback) {
		while (true) {
			if (reader.isEmpty()) break;
			var t = reader.parseTagCodeLength();
			var startO = reader.byteStream.byte_offset;
			var c = tag_callback(reader, t.tagcode, t.length);
			var s = startO + t.length;
			reader.byteStream.setOffset(s, 0);
			if (c) break;
		}
		return true;
	}
	var H263Decoder = function(deblocking) {
		this.state = new AT_H263.State({
			sorensonSpark: true,
			useScalabilityMode: false
		});
		this.deblocking = deblocking;
	}
	H263Decoder.prototype.preloadFrame = function(encodedFrame) {
		var reader = new AT_H263.Reader(encodedFrame.data);
		var picture = this.state.parsePicture(reader, null);
		switch (picture.picture_type.getType()) {
			case "IFrame":
				return false;
			case "PFrame":
			case "DisposablePFrame":
				return true;
			default:
				throw new Error("Invalid picture type code: " + picture.picture_type.type);
		}
	}
	H263Decoder.prototype.decodeFrame = function(encodedFrame) {
		var reader = new AT_H263.Reader(encodedFrame.data);
		this.state.decodeNextPicture(reader);
		var picture = this.state.getLastPicture();
		var ybr = picture.as_yuv();
		var wh = picture.format.intoWidthAndHeight();
		var yuv = new Uint8Array(ybr[0].length + ybr[1].length + ybr[2].length);
		yuv.set(ybr[0], 0);
		yuv.set(ybr[1], ybr[0].length);
		yuv.set(ybr[2], ybr[0].length + ybr[1].length);
		return new Bitmap(wh[0], wh[1], Bitmap.YUV420P, yuv);
	}
	var VByteReader = function(data) {
		this.data = data;
		this.offest = 0;
	}
	VByteReader.prototype.readByte = function() {
		if (this.offest >= this.data.length)
			throw new Error("Unexpected end of file");
		return this.data[this.offest++];
	}
	VByteReader.prototype.readUint16be = function() {
		var byte1 = this.readByte();
		var byte2 = this.readByte();
		return (byte1 << 8) | byte2;
	}
	VByteReader.prototype.readBuf = function(length) {
		if ((this.offest + length) > this.data.length)
			throw new Error("Unexpected end of file");
		var result = this.data.subarray(this.offest, this.offest + length);
		this.offest += length;
		return result;
	}
	var ScreenVideoDecoder = function(version) {
		this.version = version;
		this.w = 0;
		this.h = 0;
		this.blockW = 0;
		this.blockH = 0;
		this.lastFrame = null;
	}
	ScreenVideoDecoder.prototype.preloadFrame = function(encodedFrame) {
		var byte_input = new VByteReader(encodedFrame.data);
		var type = byte_input.readByte() >> 4;
		switch (type) {
			case 1:
				return 0;
			case 2:
				return 1;
			default:
				throw new Error("Invalid frame type: " + type);
		}
	}
	ScreenVideoDecoder.prototype.fillBlock = function(a, b, x, y, cur_w, cur_h) {
		for (var _y = 0; _y < cur_h; _y++) {
			for (var _x = 0; _x < cur_w; _x++) {
				var rgbIdx = (_x + (cur_w * ((cur_h - _y) - 1))) * 3;
				var idx = ((_x + x) + (this.w * (_y + y))) * 4;
				a[idx] = b[rgbIdx + 2];
				a[idx + 1] = b[rgbIdx + 1];
				a[idx + 2] = b[rgbIdx];
				a[idx + 3] = 255;
			}
		}
	}
	ScreenVideoDecoder.prototype.decodeFrame = function(encodedFrame) {
		var byte_input = new VByteReader(encodedFrame.data);
		var isKeyframe = byte_input.readByte() >> 4 == 1;
		if (!isKeyframe && !this.lastFrame)
			throw new Error("Missing reference frame");
		var hdr0 = byte_input.readUint16be();
		var blk_w = ((hdr0 >> 12) * 16) + 16;
		var w = hdr0 & 0xFFF;
		var hdr1 = byte_input.readUint16be();
		var blk_h = ((hdr1 >> 12) * 16) + 16;
		var h = hdr1 & 0xFFF;
		if (this.w != w || this.h != h || this.blockW != blk_w || this.blockH != blk_h) {
			this.w = w;
			this.h = h;
			this.blockW = blk_w;
			this.blockH = blk_h;
			this.lastFrame = new Uint8Array(w * h * 4);
		}
		var rgba = this.lastFrame;
		var is_intra = true;
		for (var yc = 0; yc < this.h; yc += this.blockH) {
			var cur_h = Math.min((this.h - yc), this.blockH);
			for (var xc = 0; xc < this.w; xc += this.blockW) {
				var cur_w = Math.min((this.w - xc), this.blockW);
				var dataSize = byte_input.readUint16be();
				if (dataSize > 0) this.fillBlock(rgba, pako.inflate(byte_input.readBuf(dataSize)), xc, (this.h - yc) - cur_h, cur_w, cur_h);
				else is_intra = false;
			}
		}
		if (is_intra != isKeyframe)
			throw new Error("Not all blocks were updated by a supposed keyframe");
		return new Bitmap(w, h, Bitmap.RGBA, rgba);
	}
	function crop(data, width, to_width, to_height) {
		var height = (data.length / width) | 0;
		if (width > to_width) {
			var new_width = to_width;
			var new_height = Math.min(height, to_height);
			var _data = new Uint8Array(new_width * new_height);
			for (var row = 0; row < new_height; row++) {
				_data.set(data.subarray(row * width, (row * width + new_width)), row * new_width);
			}
			return _data;
		} else {
			return data.subarray(0, width * Math.min(height, to_height));
		}
	}
	var Vp6Decoder = function(size, withAlpha) {
		this.width = size[0];
		this.height = size[1];
		this.withAlpha = withAlpha;
		this.decoder = new AT_NIHAV_VP6.VP56Decoder(6, withAlpha, true);
		this.support = new AT_NIHAV_VP6.NADecoderSupport();
		this.bitreader = new AT_NIHAV_VP6.VP6BR();
		this.initCalled = false;
		this.lastFrame = null;
	}
	Vp6Decoder.prototype.preloadFrame = function(encodedFrame) {
		var flag_index = this.withAlpha ? 3 : 0;
		return encodedFrame.data[flag_index] & 128;
	}
	Vp6Decoder.prototype.decodeFrame = function(encodedFrame) {
		var videoData = encodedFrame.data;
		if (!this.initCalled) {
			var bool_coder = new AT_NIHAV_VP6.BoolCoder(videoData.subarray(this.withAlpha ? 3 : 0));
			var header = this.bitreader.parseHeader(bool_coder);
			var video_info = new AT_NIHAV_VP6.NAVideoInfo(header.disp_w * 16, header.disp_h * 16, true, this.withAlpha ? AT_NIHAV_VP6.VP_YUVA420_FORMAT : AT_NIHAV_VP6.YUV420_FORMAT);
			this.decoder.init(this.support, video_info);
			this.initCalled = true;
		}
		var decoded;
		var frame = null;
		decoded = this.decoder.decode_frame(this.support, videoData, this.bitreader);
		frame = decoded[0].value;
		var yuv = frame.get_data();
		var wh = frame.get_dimensions(0);
		var width = wh[0], height = wh[1];
		var cwh = frame.get_dimensions(1);
		var chroma_width = cwh[0], chroma_height = cwh[1];
		var offsets = [
			frame.get_offset(0),
			frame.get_offset(1),
			frame.get_offset(2)
		];
		if ((width < this.width) || (height < this.height)) {
			log.warn("A VP6 video frame is smaller than the bounds of the stream it belongs in. This is not supported.");
		}
		var y = yuv.subarray(offsets[0], offsets[0] + width * height);
		var u = yuv.subarray(offsets[1], offsets[1] + chroma_width * chroma_height);
		var v = yuv.subarray(offsets[2], offsets[2] + chroma_width * chroma_height);
		var _y = crop(y, width, this.width, this.height);
		var _u = crop(u, chroma_width, ((this.width + 1) / 2) | 0, ((this.height + 1) / 2) | 0);
		var _v = crop(v, chroma_width, ((this.width + 1) / 2) | 0, ((this.height + 1) / 2) | 0);
		width = this.width;
		height = this.height;
		if (this.withAlpha) {
			var awh = frame.get_dimensions(3);
			var alpha_width = awh[0], alpha_height = awh[1];
			var alpha_offset = frame.get_offset(3);
			var alpha = yuv.subarray(alpha_offset, alpha_offset + alpha_width * alpha_height);
			var a = crop(alpha, alpha_width, this.width, this.height);
			var yuvData = new Uint8Array(_y.length + _u.length + _v.length + a.length);
			yuvData.set(_y, 0);
			yuvData.set(_u, _y.length);
			yuvData.set(_v, _y.length + _u.length);
			yuvData.set(a, _y.length + _u.length + _v.length);
			return new Bitmap(width, height, Bitmap.YUVA420P, yuvData);
		} else {
			var yuvData = new Uint8Array(_y.length + _u.length + _v.length);
			yuvData.set(_y, 0);
			yuvData.set(_u, _y.length);
			yuvData.set(_v, _y.length + _u.length);
			return new Bitmap(width, height, Bitmap.YUV420P, yuvData);
		}
	}
	var VideoStream = function(decoder) {
		this.bitmap = null;
		this.decoder = decoder;
	}
	var VideoBackend = function() {}
	VideoBackend.prototype.registerVideoStream = function(_num_frames, size, codec, filter) {
		var decoder;
		switch (codec) {
			case "none":
				decoder = null;
				break;
			case "H263":
				decoder = new H263Decoder(filter);
				break;
			case "ScreenVideo":
				decoder = new ScreenVideoDecoder(false);
				break;
			case "Vp6":
				decoder = new Vp6Decoder(size, false);
				break;
			case "Vp6WithAlpha":
				decoder = new Vp6Decoder(size, true);
				break;
			default:
				log.error("Unsupported video codec type " + codec);
		}
		return new VideoStream(decoder);
	}
	VideoBackend.prototype.preloadVideoStreamFrame = function(stream, encodedFrame) {
		return stream.decoder.preloadFrame(encodedFrame);
	}
	VideoBackend.prototype.decodeVideoStreamFrame = function(stream, encodedFrame, renderer) {
		var _stream = stream;
		var decoder = _stream.decoder;
		var result = decoder.decodeFrame(encodedFrame);
		var handle;
		if (result || !stream.bitmap) {
			if (stream.bitmap) {
				handle = stream.bitmap;
				renderer.updateTexture(handle, result);
			} else {
				handle = renderer.registerBitmap(result);
			}    
		} else {
			handle = stream.bitmap;
		}
		stream.bitmap = handle;
		return handle;
	}
	var MovieLibrary = function(swf) {
		this.swf = swf;
		this.characters = [];
		this.exportCharacters = new Avm1PropertyMap();
		this.imported_assets = new Map();
		this.jpegTables = null;
		this.fonts = null;
		this.avm2_domain = null;
	}
	MovieLibrary.prototype.characterById = function(id) {
		return this.characters[id];
	}
	MovieLibrary.prototype.characterByExportName = function(exportName) {
		var g = this.exportCharacters.get(exportName, false);
		if (g != null) {
			return [g, this.characters[g]];
		} else {
			return null;
		}
	}
	MovieLibrary.prototype.registerCharacter = function(id, character) {
		if (!this.containsCharacter(id)) {
			this.characters[id] = character;
		} else {
			log.error("Character ID collision: Tried to register ID twice: " + id);
		}
	}
	MovieLibrary.prototype.registerExport = function(id, exportName) {
		this.exportCharacters.insert(exportName, id, false);
	}
	MovieLibrary.prototype.containsCharacter = function(id) {
		return (id in this.characters);
	}
	MovieLibrary.prototype.instantiateById = function(id) {
		var c = this.characterById(id);
		if (c) {
			return this.instantiateDisplayObject(id, c);
		} else {
			log.error("Tried to instantiate non-registered character ID " + id);
		}
	}
	MovieLibrary.prototype.instantiateByExportName = function(export_name) {
		var h = this.characterByExportName(export_name);
		if (h) {
			return this.instantiateDisplayObject(h[0], h[1]);
		} else {
			return null;
		}
	}
	MovieLibrary.prototype.getDisplays = function() {
		var result = [];
		var characters = this.characters;
		for (var i = 0; i < characters.length; i++) {
			var c = characters[i];
			if (c) {
				result.push(c);
			}
		}
		return result;
	}
	MovieLibrary.prototype.getDisplayTypes = function() {
		var resultTypes = {};
		var characters = this.characters;
		for (var i = 0; i < characters.length; i++) {
			var c = characters[i];
			if (c) {
				var displayType = c.displayType;
				if (displayType) {
					if (!(displayType in resultTypes)) {
						resultTypes[displayType] = [];
					}
					resultTypes[displayType].push(c);
				}    
			}
		}
		return resultTypes;
	}
	MovieLibrary.prototype.instantiateDisplayObject = function(id, character) {
		switch (character.type) {
			case Character.Bitmap:
				var bitmap = character.data.compressed.decode();
				return BitmapGraphic.createNew(id, bitmap, this.swf);
			case Character.EditText:
			case Character.Graphic:
			case Character.MovieClip:
			case Character.Avm1Button:
			case Character.MorphShape:
			case Character.Text:
			case Character.Video:
				return character.data.instantiate();
			default:
				return null;
		}
	}
	MovieLibrary.prototype.getBitmap = function(id) {
		var ch = this.characters[id];
		if (ch) {
			return (ch.type == Character.Bitmap) ? ch.data : null;
		} else {
			return null;
		}
	}
	MovieLibrary.prototype.getFont = function(id) {
		var ch = this.characters[id];
		if (ch) {
			return (ch.type == Character.Font) ? ch.data : null;
		} else {
			return null;
		}
	}
	MovieLibrary.prototype.getGraphic = function(id) {
		var ch = this.characters[id];
		if (ch) {
			return (ch.type == Character.Graphic) ? ch.data : null;
		} else {
			return null;
		}
	}
	MovieLibrary.prototype.getMorphShape = function(id) {
		var ch = this.characters[id];
		if (ch) {
			return (ch.type == Character.MorphShape) ? ch.data : null;
		} else {
			return null;
		}
	}
	MovieLibrary.prototype.getSound = function(id) {
		var ch = this.characters[id];
		if (ch) {
			return (ch.type == Character.Sound) ? ch.data : null;
		} else {
			return null;
		}
	}
	MovieLibrary.prototype.getText = function(id) {
		var ch = this.characters[id];
		if (ch) {
			return (ch.type == Character.Text) ? ch.data : null;
		} else {
			return null;
		}
	}
	MovieLibrary.prototype.setJpegTables = function(jt) {
		if (this.jpegTables) {
			// SWF spec says there should only be one JPEGTables tag.
			// TODO: What is the behavior when there are multiples?
			log.warn("SWF contains multiple JPEGTables tags");
			return;
		}
		if (jt.length) {
			this.jpegTables = jt;
		}
	}
	var MovieLibrarySource = function(library) {
		this.library = library;
	}
	MovieLibrarySource.prototype.bitmapHandle = function(id, backend) {
		var b = this.library.getBitmap(id);
		if (!b) return null;
		if (b.handle) {
			return b.handle;
		}
		var decoded;
		try {
			decoded = b.compressed.decode();
		} catch(e) {
			console.log(`Failed to decode bitmap character ${id}: ${e}`);
			return null;
		}
		if (!decoded) {
			decoded = new Bitmap(1, 1, Bitmap.RGBA, new Uint8Array(4));
		}
		var new_handle = backend.registerBitmap(decoded);
		b.handle = new_handle;
		return new_handle;
	}
	var Library = function() {
		this.deviceFont = null;
	}
	Library.prototype.registerDeviceFont = function(definition) {
		var b = FlashFont.fromSwfTag(definition.tag, definition.encoding);
		this.deviceFont = b;
	}
	var Instantiator = {
		Movie: 0,
		Avm1: 1,
		Avm2: 2,
		isAvm: function(i) {
			return i == Instantiator.Avm1 || i == Instantiator.Avm2;
		}
	}

	var ClipEvent = function() {
		this.type = arguments[0];
		if (arguments.length > 1) {
			this.data = arguments[1];
		}
	}
	Object.defineProperty(ClipEvent.prototype, "methodName", {
		get: function() {
			switch(this.type) {
				case ClipEvent.DragOut: return "onDragOut";
				case ClipEvent.DragOver: return "onDragOver";
				case ClipEvent.EnterFrame: return "onEnterFrame";
				case ClipEvent.KeyDown: return "onKeyDown";
				case ClipEvent.KeyUp: return "onKeyUp";
				case ClipEvent.Load: return "onLoad";
				case ClipEvent.MouseDown: return "onMouseDown";
				case ClipEvent.MouseMove: return "onMouseMove";
				case ClipEvent.MouseUp: return "onMouseUp";
				case ClipEvent.Press: return "onPress";
				case ClipEvent.RollOut: return "onRollOut";
				case ClipEvent.RollOver: return "onRollOver";
				case ClipEvent.Release: return "onRelease";
				case ClipEvent.ReleaseOutside: return "onReleaseOutside";
				case ClipEvent.Unload: return "onUnload";
				default: return null;
			}
		}
	});
	ClipEvent.prototype.isButtonEvent = function() {
		return this.isButtonEventFrags();
	}
	ClipEvent.prototype.isButtonEventFrags = function() {
		switch(this.type) {
			case ClipEvent.DragOut:
			case ClipEvent.DragOver:
			case ClipEvent.KeyPress:
			case ClipEvent.Press:
			case ClipEvent.RollOut:
			case ClipEvent.RollOver:
			case ClipEvent.Release:
			case ClipEvent.ReleaseOutside:
				return true;
			default:
				return false;
		}
	}
	ClipEvent.prototype.isKeyEvent = function() {
		switch(this.type) {
			case ClipEvent.KeyDown:
			case ClipEvent.KeyUp:
			case ClipEvent.KeyPress:
				return true;
			default:
				return false;
		}
	}
	ClipEvent.prototype.propagates = function() {
		switch(this.type) {
			case ClipEvent.MouseUp:
			case ClipEvent.MouseDown:
			case ClipEvent.MouseMove:
			case ClipEvent.KeyDown:
			case ClipEvent.KeyUp:
			case ClipEvent.KeyPress:
				return true;
			default:
				return false;
		}
	}
	ClipEvent.Construct = 1;
	ClipEvent.Data = 2;
	ClipEvent.DragOut = 3;
	ClipEvent.DragOver = 4;
	ClipEvent.EnterFrame = 5;
	ClipEvent.Initialize = 6;
	ClipEvent.KeyUp = 7;
	ClipEvent.KeyDown = 8;
	ClipEvent.KeyPress = 9;
	ClipEvent.Load = 10;
	ClipEvent.MouseUp = 11;
	ClipEvent.RightMouseUp = 12;
	ClipEvent.MiddleMouseUp = 13;
	ClipEvent.MouseUpInside = 14;
	ClipEvent.RightMouseUpInside = 15;
	ClipEvent.MiddleMouseUpInside = 16;
	ClipEvent.MouseDown = 17;
	ClipEvent.RightMouseDown = 18;
	ClipEvent.MiddleMouseDown = 19;
	ClipEvent.MouseMove = 20;
	ClipEvent.MouseMoveInside = 21;
	ClipEvent.Press = 22;
	ClipEvent.RightPress = 23;
	ClipEvent.MiddlePress = 24;
	ClipEvent.RollOut = 25;
	ClipEvent.RollOver = 26;
	ClipEvent.Release = 27;
	ClipEvent.RightRelease = 28;
	ClipEvent.MiddleRelease = 29;
	ClipEvent.ReleaseOutside = 30;
	ClipEvent.RightReleaseOutside = 31;
	ClipEvent.MiddleReleaseOutside = 32;
	ClipEvent.Unload = 33;
	ClipEvent.MouseWheel = 34;
	ClipEvent.BUTTON_EVENT_METHODS = ["onDragOver", "onDragOut", "onPress", "onRelease", "onReleaseOutside", "onRollOut", "onRollOver"];
	var KeyCode = {
		UNKNOWN: 0,
		MOUSE_LEFT: 1,
		MOUSE_RIGHT: 2,
		MOUSE_MIDDLE: 4,
		BACKSPACE: 8,
		TAB: 9,
		ENTER: 13,
		COMMAND: 15,
		SHIFT: 16,
		CONTROL: 17,
		ALT: 18,
		PAUSE: 19,
		CAPS_LOCK: 20,
		NUMPAD: 21,
		ESCAPE: 27,
		SPACE: 32,
		PAGE_UP: 33,
		PAGE_DOWN: 34,
		END: 35,
		HOME: 36,
		LEFT: 37,
		UP: 38,
		RIGHT: 39,
		DOWN: 40,
		INSERT: 45,
		DELETE: 46
	}
	var AvmObject = function(type, object) {
		this.type = type;
		this.object = object;
	}
	AvmObject.fromAvm1Object = function(t) {
		return new AvmObject(AvmObject.Avm1, t);
	}
	AvmObject.fromAvm2Object = function(t) {
		return new AvmObject(AvmObject.Avm2, t);
	}
	AvmObject.prototype.asAvm1Object = function() {
		return (this.type == AvmObject.Avm1) ? this.object : null;
	}
	AvmObject.prototype.asAvm2Object = function() {
		return (this.type == AvmObject.Avm2) ? this.object : null;
	}
	AvmObject.Avm1 = 1;
	AvmObject.Avm2 = 2;
	var SoundTransform = function() {
		this.volume = 100;
		this.left_to_left = 100;
		this.left_to_right = 0;
		this.right_to_left = 0;
		this.right_to_right = 100;
	}
	SoundTransform.prototype.concat = function(other) {
		this.volume = (this.volume * other.volume) / SoundTransform.MAX_VOLUME;
		var ll0 = this.left_to_left;
		var lr0 = this.left_to_right;
		var rl0 = this.right_to_left;
		var rr0 = this.right_to_right;
		var ll1 = other.left_to_left;
		var lr1 = other.left_to_right;
		var rl1 = other.right_to_left;
		var rr1 = other.right_to_right;
		this.left_to_left = ((ll0 * ll1 + rl0 * lr1) / SoundTransform.MAX_VOLUME) | 0;
		this.left_to_right = ((lr0 * ll1 + rr0 * lr1) / SoundTransform.MAX_VOLUME) | 0;
		this.right_to_left = ((ll0 * rl1 + rl0 * rr1) / SoundTransform.MAX_VOLUME) | 0;
		this.right_to_right = ((lr0 * rl1 + rr0 * rr1) / SoundTransform.MAX_VOLUME) | 0;
	}
	SoundTransform.prototype.getPan = function() {
		if (this.left_to_left != SoundTransform.MAX_VOLUME) {
			return SoundTransform.MAX_VOLUME - Math.abs(this.left_to_left);
		} else {
			return Math.abs(this.right_to_right) - SoundTransform.MAX_VOLUME;
		}
	}
	SoundTransform.prototype.setPan = function(pan) {
		if (pan >= 0) {
			this.left_to_left = SoundTransform.MAX_VOLUME - pan;
			this.right_to_right = SoundTransform.MAX_VOLUME;
		} else {
			this.left_to_left = SoundTransform.MAX_VOLUME;
			this.right_to_right = SoundTransform.MAX_VOLUME - pan;
		}
		this.left_to_right = 0;
		this.right_to_left = 0;
	}
	SoundTransform.prototype.clone = function() {
		var c = new SoundTransform();
		c.volume = this.volume;
		c.left_to_left = this.left_to_left;
		c.left_to_right = this.left_to_right;
		c.right_to_left = this.right_to_left;
		c.right_to_right = this.right_to_right;
		return c;
	}
	SoundTransform.MAX_VOLUME = 100;
	function getBlendMode(blendMode) {
		switch (blendMode) {
			case 0:
			case 1:
				return "normal";
			case 2:
				return "layer";
			case 3:
				return "multiply";
			case 4:
				return "screen";
			case 5:
				return "lighten";
			case 6:
				return "darken";
			case 7:
				return "difference";
			case 8:
				return "add";
			case 9:
				return "subtract";
			case 10:
				return "invert";
			case 11:
				return "alpha";
			case 12:
				return "erase";
			case 13:
				return "overlay";
			case 14:
				return "hardlight";
			default:
				return "normal";
		}
	}
	var BitmapCache = function() {
		this.matrix_a = 0;
		this.matrix_b = 0;
		this.matrix_c = 0;
		this.matrix_d = 0;
		this.source_width = 0;
		this.source_height = 0;
		this.draw_offset = [0, 0];
		this.bitmap = null;
	}
	BitmapCache.prototype.makeDirty = function() {
		this.matrix_a = NaN;
	}
	BitmapCache.prototype.isDirty = function(other, source_width, source_height) {
		return (this.matrix_a != other[0]) || (this.matrix_b != other[1]) || (this.matrix_c != other[2]) || (this.matrix_d != other[3]) || (this.source_width != source_width) || (this.source_height != source_height) || (!this.bitmap);
	}
	BitmapCache.prototype.update = function(renderer, matrix, source_width, source_height, actual_width, actual_height, draw_offset, swf_version) {
		this.matrix_a = matrix[0];
		this.matrix_b = matrix[1];
		this.matrix_c = matrix[2];
		this.matrix_d = matrix[3];
		this.source_width = source_width;
		this.source_height = source_height;
		this.draw_offset = draw_offset;
		if (this.bitmap) {
			if ((this.bitmap.width == actual_width) && (this.bitmap.height == actual_height)) {
				return; // No need to resize it
			}
		}
		var acceptable_size;
		if (swf_version > 9) {
			var total = actual_width * actual_height;
			acceptable_size = (actual_width < 8191) && (actual_height < 8191) && (total < 16777215);
		} else {
			acceptable_size = (actual_width < 2880) && (actual_height < 2880);
		}
		if (renderer.is_offscreen_supported() && (actual_width > 0) && (actual_height > 0) && acceptable_size) {
			if (this.bitmap) {
				if (this.bitmap.handle) {
					this.bitmap.handle.delete();
				}
			}
			var handle = renderer.createEmptyTexture(actual_width, actual_height);
			this.bitmap = {
				width: actual_width,
				height: actual_height,
				handle: handle
			}
		} else {
			if (this.bitmap) {
				if (this.bitmap.handle) {
					this.bitmap.handle.delete();
				}
			}
			this.bitmap = null;
		}
	}
	BitmapCache.prototype.clear = function() {
		if (this.bitmap) {
			if (this.bitmap.handle) {
				this.bitmap.handle.delete();
			}
		}
		this.bitmap = null;
	}
	BitmapCache.prototype.getHandle = function() {
		return this.bitmap ? this.bitmap.handle : null;
	}
	var DisplayObject = function() {
		this.transform = new Transform();
		this.blendMode = "normal";
		this.filters = [];
		this.parent = null;
		this.placeFrame = 0;
		this.depth = 0;
		this.name = null;
		this.clipDepth = 0;
		this.nextAvm1Clip = null;
		this.soundTransform = new SoundTransform();
		this.masker = null;
		this.maskee = null;
		this.opaqueBackground = null;
		this.cache = null;
		this._viewRotation = null;
		this._viewXScale = null;
		this._viewYScale = null;
		this.AVM1_REMOVED = false;
		this.VISIBLE = true;
		this.SCALE_ROTATION_CACHED = false;
		this.TRANSFORMED_BY_SCRIPT = false;
		this.PLACED_BY_SCRIPT = false;
		this.INSTANTIATED_BY_TIMELINE = false;
		this.IS_ROOT = false;
		this.LOCK_ROOT = false;
		this.CACHE_AS_BITMAP = false;
		this.HAS_SCROLL_RECT = false;
		this.HAS_EXPLICIT_NAME = false;
		this.SKIP_NEXT_ENTER_FRAME = false;
		this.CACHE_INVALIDATED = false;
		this.AVM1_PENDING_REMOVAL = false;
		this.HAS_MATRIX3D_STUB = false;
		this.HAS_PERSPECTIVE_PROJECTION_STUB = false;
	}
	DisplayObject.prototype.displayType = "Base";
	DisplayObject.prototype._debug_colorDisplayType = [0, 0, 0, 1];
	DisplayObject.prototype.setAvm1PendingRemoval = function(value) {
		this.AVM1_PENDING_REMOVAL = value;
	}
	DisplayObject.prototype.localToGlobalMatrix = function() {
		var matrix = this.getMatrix();
		var node = this.getParent();
		while(node) {
			if (node instanceof Stage) break;
			matrix = node.getMatrix().mul(matrix);
			node = node.getParent();
		}
		return matrix;
	}
	DisplayObject.prototype.globalToLocalMatrix = function() {
		return this.localToGlobalMatrix().inverse();
	}
	DisplayObject.prototype.localToGlobal = function(local) {
		return this.localToGlobalMatrix().mulPoint(local);
	}
	DisplayObject.prototype.globalToLocal = function(local) {
		var matrix = this.globalToLocalMatrix();
		return matrix ? matrix.mulPoint(local) : null;
	}
	DisplayObject.prototype.setSoundTransform = function(context, soundTransform) {
		this.soundTransform = soundTransform;
		context.setSoundTransformsDirty();
	}
	DisplayObject.prototype.getColorTransform = function() {
		return this.transform.colorTransform;
	}
	DisplayObject.prototype.getMatrix = function() {
		return this.transform.matrix;
	}
	DisplayObject.prototype.applyColorTransform = function(colorTransform) {
		this.transform.colorTransform[0] = colorTransform[0];
		this.transform.colorTransform[1] = colorTransform[1];
		this.transform.colorTransform[2] = colorTransform[2];
		this.transform.colorTransform[3] = colorTransform[3];
		this.transform.colorTransform[4] = colorTransform[4];
		this.transform.colorTransform[5] = colorTransform[5];
		this.transform.colorTransform[6] = colorTransform[6];
		this.transform.colorTransform[7] = colorTransform[7];
	}
	DisplayObject.prototype.applyMatrix = function(matrix) {
		this.transform.matrix.copy(matrix);
	}
	DisplayObject.prototype.getBlendMode = function() {
		return this.blendMode;
	}
	DisplayObject.prototype.setBlendMode = function(mode) {
		var b = getBlendMode(mode) || "normal";
		var changed = b != this.blendMode;
		this.blendMode = b;
		if (changed) {
			var parent = this.getParent();
			if (parent) parent.invalidateCachedBitmap();
		}
	}
	DisplayObject.prototype.getFilters = function() {
		return this.filters;
	}
	DisplayObject.prototype._setFilters = function(filters) {
		if (this.filters !== filters) {
			this.filters = filters;
			this.recheck_cache_as_bitmap();
			return true;
		} else {
			return false;
		}
	}
	DisplayObject.prototype.setFilters = function(filters) {
		if (this._setFilters(filters)) {
			this.invalidateCachedBitmap();
		}
	}
	DisplayObject.prototype.recheck_cache_as_bitmap = function() {
		var should_cache = this.is_bitmap_cached_preference() || this.filters.length;
		if (should_cache && !this.cache) {
			if (this.cache) {
				console.log("cache");
				this.cache.clear();
			}
			this.cache = new BitmapCache();
		} else if (!should_cache && this.cache) {
			if (this.cache) {
				this.cache.clear();
			}
			this.cache = null;
		}
	}
	DisplayObject.prototype.is_bitmap_cached_preference = function() {
		return this.CACHE_AS_BITMAP;
	}
	DisplayObject.prototype.set_bitmap_cached_preference = function(value) {
		this.CACHE_AS_BITMAP = value;
		this.recheck_cache_as_bitmap();
	}
	DisplayObject.prototype.isBitmapCached = function() {
		return !!this.cache;
	}
	DisplayObject.prototype._invalidateCachedBitmap = function() {
		if (this.CACHE_INVALIDATED) {
			return false;
		}
		if (this.cache) {
			this.cache.makeDirty();
		}
		this.CACHE_INVALIDATED = true;
		return true;
	}
	DisplayObject.prototype.invalidateCachedBitmap = function() {
		if (this._invalidateCachedBitmap()) {
			var parent = this.getParent();
			if (parent) {
				parent.invalidateCachedBitmap();
			}
		}
	}
	DisplayObject.prototype.clearInvalidateFlag = function() {
		this.CACHE_INVALIDATED = false;
	}
	DisplayObject.prototype.swfVersion = function() {
		return this.getMovie().version;
	}
	DisplayObject.prototype.getDepth = function() {
		return this.depth;
	}
	DisplayObject.prototype.setDepth = function(depth) {
		this.depth = depth;
	}
	DisplayObject.prototype.getId = function() {
		return 0;
	}
	DisplayObject.prototype.getVisible = function() {
		return this.VISIBLE;
	}
	DisplayObject.prototype.setVisible = function(visible) {
		var changed = this.VISIBLE != visible;
		this.VISIBLE = visible;
		if (changed) {
			var parent = this.getParent();
			if (parent) parent.invalidateCachedBitmap();
		}
	}
	DisplayObject.prototype.getX = function() {
		var matrix = this.getMatrix();
		return matrix.tx / 20;
	}
	DisplayObject.prototype.getY = function() {
		var matrix = this.getMatrix();
		return matrix.ty / 20;
	}
	DisplayObject.prototype.getXScale = function() {
		if (this._viewXScale !== null) {
			return this._viewXScale;
		}
		var matrix = this.getMatrix();
		var xScale = Math.sqrt(matrix.a * matrix.a + matrix.b * matrix.b) * 100;
		if (0 > matrix.a) {
			xScale *= -1;
		}
		return xScale;
	}
	DisplayObject.prototype.getYScale = function() {
		if (this._viewYScale !== null) {
			return this._viewYScale;
		}
		var matrix = this.getMatrix();
		var yScale = Math.sqrt(matrix.c * matrix.c + matrix.d * matrix.d) * 100;
		if (0 > matrix.d) {
			yScale *= -1;
		}
		return yScale;
	}
	DisplayObject.prototype.getWidth = function() {
		var local_bounds = this.localBounds();
		return local_bounds.width / 20;
	}
	DisplayObject.prototype.getHeight = function() {
		var local_bounds = this.localBounds();
		return local_bounds.height / 20;
	}
	DisplayObject.prototype._setWidth = function(width) {
		var _matrix = this.getMatrix();
		var bounds = this.getBoundsWithTransform(_matrix);
		var _width = bounds.width;
		var xScale = width * _matrix.a / _width;
		if (Number.isNaN(xScale)) {
			xScale = 0;
		}
		_matrix = this.getMatrix();
		_matrix.a = xScale;
		this.TRANSFORMED_BY_SCRIPT = true;
	}
	DisplayObject.prototype._setHeight = function(height) {
		var _matrix = this.getMatrix();
		var bounds = this.getBoundsWithTransform(_matrix);
		var _height = bounds.height;
		var yScale = height * _matrix.d / _height;
		if (Number.isNaN(yScale)) {
			yScale = 0;
		}
		_matrix = this.getMatrix();
		_matrix.d = yScale;
		this.TRANSFORMED_BY_SCRIPT = true;
	}
	DisplayObject.prototype.setWidth = function(width) {
		this._setWidth(width * 20);
		var parent = this.getParent();
		if (parent) {
			parent.invalidateCachedBitmap();
		}
	}
	DisplayObject.prototype.setHeight = function(height) {
		this._setHeight(height * 20);
		var parent = this.getParent();
		if (parent) {
			parent.invalidateCachedBitmap();
		}
	}
	DisplayObject.prototype._setX = function(x) {
		var matrix = this.getMatrix();
		var changed = matrix.tx != x;
		this.TRANSFORMED_BY_SCRIPT = true;
		matrix.tx = x;
		return changed;
	}
	DisplayObject.prototype._setY = function(y) {
		var matrix = this.getMatrix();
		var changed = matrix.ty != y;
		matrix.ty = y;
		this.TRANSFORMED_BY_SCRIPT = true;
		return changed;
	}
	DisplayObject.prototype.setX = function(x) {
		if (this._setX(x * 20)) {
			var parent = this.getParent();
			if (parent) {
				parent.invalidateCachedBitmap();
			}
		}
	}
	DisplayObject.prototype.setY = function(y) {
		if (this._setY(y * 20)) {
			var parent = this.getParent();
			if (parent) {
				parent.invalidateCachedBitmap();
			}
		}
	}
	DisplayObject.prototype._setXScale = function(xscale) {
		if (this._viewXScale !== xscale) {
			var matrix = this.getMatrix();
			var radianX = Math.atan2(matrix.b, matrix.a);
			if (radianX === -Math.PI) {
				radianX = 0;
			}
			this._viewXScale = xscale;
			xscale /= 100;
			matrix.a = xscale * Math.cos(radianX);
			matrix.b = xscale * Math.sin(radianX);
		}
	}
	DisplayObject.prototype.setXScale = function(xscale) {
		this._setXScale(xscale);
		var parent = this.getParent();
		if (parent) {
			parent.invalidateCachedBitmap();
		}
	}
	DisplayObject.prototype._setYScale = function(yscale) {
		if (this._viewYScale !== yscale) {
			var matrix = this.getMatrix();
			var radianY = Math.atan2(-matrix.c, matrix.d);
			if (radianY === -Math.PI) {
				radianY = 0;
			}
			this._viewYScale = yscale;
			yscale /= 100;
			matrix.c = -yscale * Math.sin(radianY);
			matrix.d = yscale * Math.cos(radianY);
			this.TRANSFORMED_BY_SCRIPT = true;	
		}
	}
	DisplayObject.prototype.setYScale = function(yscale) {
		this._setYScale(yscale);
		var parent = this.getParent();
		if (parent) {
			parent.invalidateCachedBitmap();
		}
	}
	DisplayObject.prototype.getRotation = function() {
		if (this._viewRotation != null) {
			return this._viewRotation * 180 / Math.PI;
		}
		var matrix = this.getMatrix();
		var rotation = Math.atan2(matrix.b, matrix.a) * 180 / Math.PI;
		switch (rotation) {
			case -90.00000000000001:
				rotation = -90;
				break;
			case 90.00000000000001:
				rotation = 90;
				break;
		}
		return rotation;
	}
	DisplayObject.prototype._setRotation = function(rotation) {
		var matrix = this.getMatrix();
		var radianX = Math.atan2(matrix.b, matrix.a);
		var radianY = Math.atan2(-matrix.c, matrix.d);
		var ScaleX = Math.sqrt(matrix.a * matrix.a + matrix.b * matrix.b);
		var ScaleY = Math.sqrt(matrix.c * matrix.c + matrix.d * matrix.d);
		rotation *= Math.PI / 180;
		radianY += rotation - radianX;
		radianX = rotation;
		matrix.a = ScaleX * Math.cos(radianX);
		matrix.b = ScaleX * Math.sin(radianX);
		matrix.c = -ScaleY * Math.sin(radianY);
		matrix.d = ScaleY * Math.cos(radianY);
		this.TRANSFORMED_BY_SCRIPT = true;
		this._viewRotation = rotation;
	}
	DisplayObject.prototype.setRotation = function(rotation) {
		this._setRotation(rotation);
		var parent = this.getParent();
		if (parent) {
			parent.invalidateCachedBitmap();
		}
	}
	DisplayObject.prototype.getAlpha = function() {
		var colorTransform = this.getColorTransform();
		var alpha = colorTransform[3];
		return alpha * 100;
	}
	DisplayObject.prototype._setAlpha = function(alpha) {
		var _colorTransform = this.getColorTransform();
		var colorTransform = cloneArray(_colorTransform);
		colorTransform[3] = alpha / 100;
		colorTransform[7] = 0;
		this.TRANSFORMED_BY_SCRIPT = true;
		this.applyColorTransform(colorTransform);
	}
	DisplayObject.prototype.setAlpha = function(alpha) {
		this._setAlpha(alpha);
		var parent = this.getParent();
		if (parent) {
			parent.invalidateCachedBitmap();
		}
	}
	DisplayObject.prototype.localMousePosition = function(context) {
		var stage = context.stage;
		var pixel_ratio = stage.view_matrix().a;
		var virtual_to_device = Matrix.scale(pixel_ratio, pixel_ratio);
		var mouse_position = context.mousePosition;
		var global_twips = mouse_position.clone();
		var global_device_twips = virtual_to_device.mulPoint(global_twips);
		var global_device_pixels = Matrix.TWIPS_TO_PIXELS.mulPoint(global_device_twips);
		var local_twips_to_global_twips = this.localToGlobalMatrix();
		var twips_to_device_pixels = virtual_to_device.mul(Matrix.TWIPS_TO_PIXELS);
		var local_twips_to_global_device_pixels = twips_to_device_pixels.mul(local_twips_to_global_twips);
		var global_device_pixels_to_local_twips = local_twips_to_global_device_pixels.inverse() || Matrix.IDENTITY.clone();
		return global_device_pixels_to_local_twips.mulPoint(global_device_pixels);
	}
	DisplayObject.prototype.getPlaceFrame = function() {
		return this.placeFrame;
	}
	DisplayObject.prototype.setPlaceFrame = function(frame) {
		this.placeFrame = frame;
	}
	DisplayObject.prototype.getParent = function() {
		return this.parent;
	}
	DisplayObject.prototype.setParent = function(context, parent) {
		this.parent = parent;
	}
	DisplayObject.prototype.getOpaqueBackground = function() {
		return this.opaqueBackground;
	}
	DisplayObject.prototype.setOpaqueBackground = function(color) {
		this.opaqueBackground = color;
		this.invalidateCachedBitmap();
	}
	DisplayObject.prototype.isRoot = function() {
		return this.IS_ROOT;
	}
	DisplayObject.prototype.setIsRoot = function(bool) {
		this.IS_ROOT = bool;
	}
	DisplayObject.prototype.getName = function() {
		return this.name;
	}
	DisplayObject.prototype.setName = function(name) {
		this.name = name;
	}
	DisplayObject.prototype.setDefaultInstanceName = function(context) {
		var name = this.getName();
		if (name == null) {
			var r = context.addInstanceCounter();
			this.setName("instance" + r);
		}
	}
	DisplayObject.prototype.setDefaultRootName = function(context) {
		this.setName("");
	}
	DisplayObject.prototype.setSkipNextEnterFrame = function(b) {
		this.SKIP_NEXT_ENTER_FRAME = b;
	}
	DisplayObject.prototype.shouldSkipNextEnterFrame = function() {
		return this.SKIP_NEXT_ENTER_FRAME;
	}
	DisplayObject.prototype.applyPlaceObject = function(context, placeObject) {
		if (!this.TRANSFORMED_BY_SCRIPT) {
			if ("matrix" in placeObject) {
				this.applyMatrix(Matrix.fromArray(placeObject.matrix));
				var parent = this.getParent();
				if (parent) {
					parent.invalidateCachedBitmap();
				}
			}
			if ("colorTransform" in placeObject) {
				this.applyColorTransform(placeObject.colorTransform);
				var parent = this.getParent();
				if (parent) {
					parent.invalidateCachedBitmap();
				}
			}
			if ("ratio" in placeObject) {
				if (this instanceof MorphShape) {
					this.setRatio(placeObject.ratio);
				} else if(this instanceof VideoDisplay) {
					this.seek(context, placeObject.ratio);
				}
			}
			if ("bitmapCache" in placeObject) {
				this.set_bitmap_cached_preference(!!placeObject.bitmapCache);
			}
			if ("blendMode" in placeObject) {
				this.setBlendMode(placeObject.blendMode);
			}
			if (this.swfVersion() >= 11) {
				if ("visible" in placeObject) {
					this.setVisible(!!placeObject.visible);
				}
				if ("backgroundColor" in placeObject) {
					var backgroundColor = placeObject.backgroundColor.slice(0);
					var color = null;
					if (backgroundColor[3] > 0) {
						backgroundColor[3] = 1;
						color = backgroundColor;
					}
					this.setOpaqueBackground(color);
				}
			}
			if ("filters" in placeObject) {
				var filters = placeObject.filters;
				var result = [];
				for (var i = 0; i < filters.length; i++) {
					var _ = Filter.from(filters[i]);
					if (_) result.push(_);
				}
				this.setFilters(result);
			}
		}
	}
	DisplayObject.prototype.path = function() {
		var parent = this.getAvm1Parent();
		if (parent) {
			var path = parent.path();
			path += ".";
			var name = this.getName();
			if (name) {
				path += name;
			}
			return path;
		} else {
			return "_level" + this.getDepth();
		}
	}
	DisplayObject.prototype.slash_path = function() {
		function build_slash_path(object) {
			var parent = object.getAvm1Parent();
			if (parent) {
				var path = build_slash_path(parent);
				path += "/";
				var name = object.getName();
				if (name) {
					path += name;
				}
				return path;
			} else {
				var level = object.getDepth();
				if (level == 0) {
					return "";
				} else {
					return "_level" + level;
				}
			}
		}
		var parent = this.getAvm1Parent();
		if (parent) {
			return build_slash_path(this);
		} else {
			return "/";
		}
	}
	DisplayObject.prototype.replaceWith = function(context, characterId) {}
	DisplayObject.prototype.postInstantiation = function(context, initObject, instantiatedBy, runFrame) {
		if (runFrame) {
			this.runFrameAvm1(context);
		}
	}
	DisplayObject.prototype.getObject = function() {
		return Avm1Value.INSTANCE.Undefined;
	}
	DisplayObject.prototype.getBounds = function() {
		return this.getBoundsWithTransform(Matrix.IDENTITY);
	}
	DisplayObject.prototype.localBounds = function() {
		return this.getBoundsWithTransform(this.getMatrix());
	}
	DisplayObject.prototype.worldBounds = function() {
		return this.getBoundsWithTransform(this.localToGlobalMatrix());
	}
	DisplayObject.prototype.getBoundsWithTransform = function(matrix) {
		var bounds = matrix.mulRectangle(this.selfBounds());
		if (this.isContainer()) {
			var children = this.iterRenderList();
			for (var i = 0; i < children.length; i++) {
				var child = children[i];
				var mat = matrix.mul(child.getMatrix());
				bounds = bounds.union(child.getBoundsWithTransform(mat));
			}
		}
		return bounds;
	}
	DisplayObject.prototype.renderBoundsWithTransform = function(matrix, include_own_filters, view_matrix) {
		var bounds = matrix.mulRectangle(this.selfBounds());
		if (this.isContainer()) {
			var children = this.iterRenderList();
			for (var i = 0; i < children.length; i++) {
				var child = children[i];
				var mat = matrix.mul(child.getMatrix());
				bounds = bounds.union(child.renderBoundsWithTransform(mat, true, view_matrix));
			}
		}
		if (include_own_filters) {
			var filters = this.getFilters();
			for (var i = 0; i < filters.length; i++) {
				var filter = filters[i].clone();
				filter.scale(view_matrix.a, view_matrix.d);
				bounds = filter.calculateDestRect(bounds);
			}
		}
		return bounds;
	}
	DisplayObject.prototype.selfBounds = function() {
		return Rectangle.INVALID.clone();
	}
	DisplayObject.prototype.hitTestShape = function(_context, point, options) {
		return false;
	}
	DisplayObject.prototype.hitTestObject = function(other) {
		var a = this.worldBounds();
		var b = other.worldBounds();
		var result = a.intersects(b);
		return result;
	}
	DisplayObject.prototype.hitTestBounds = function(point) {
		return this.worldBounds().contains(point);
	}
	DisplayObject.prototype.setMasker = function(node, remove_old_link) {
		if (remove_old_link) {
			var old_masker = this.masker;
			if (old_masker) {
				old_masker.setMaskee(null, false);
			}
			var parent = this.getParent();
			if (parent) {
				parent.invalidateCachedBitmap();
			}
		}
		this.masker = node;
	}
	DisplayObject.prototype.setMaskee = function(node, remove_old_link) {
		if (remove_old_link) {
			var old_masker = this.maskee;
			if (old_masker) {
				old_masker.setMasker(null, false);
			}
			this.invalidateCachedBitmap();
		}
		this.maskee = node;
	}
	DisplayObject.prototype.render = function(context) {
		this.renderBase(context);
	}
	DisplayObject.prototype.renderBase = function(context) {
		if (this.maskee) return;
		context.transformStack.stackPush(this.transform);
		var blendMode = this.getBlendMode();
		var originalCommands = (blendMode != "normal") ? context.commands.copy() : null; 
		if (originalCommands) {
			context.commands.clear();
		}
		var cache_info = null;
		if (context.useBitmapCache && this.isBitmapCached()) {
			var _cache_info = null;
			var base_transform = context.transformStack.getTransform().clone();
			var bounds = this.renderBoundsWithTransform(base_transform.matrix, false, context.stage.view_matrix());
			var filters = this.getFilters();
			var swf_version = this.swfVersion();
			filters = filters.filter(function(r) {
				return !r.impotent();
			});
			if (this.cache) {
				var stage_matrix = context.stage.view_matrix();
				var width = Math.ceil(bounds.width / 20);
				var height = Math.ceil(bounds.height / 20);
				if (width <= 0xffff && height <= 0xffff) {
					var filter_rect = new Rectangle(0, width * 20, 0, height * 20);
					var resultFilters = [];
					for (var i = 0; i < filters.length; i++) {
						resultFilters.push(filters[i].clone());
					}
					for (var i = 0; i < resultFilters.length; i++) {
						var filter = resultFilters[i];
						filter.scale(stage_matrix.a, stage_matrix.d);
						filter_rect = filter.calculateDestRect(filter_rect);
					}
					var filter_rect_result = new Rectangle(
						Math.floor(filter_rect.xMin / 20),
						Math.ceil(filter_rect.xMax / 20),
						Math.floor(filter_rect.yMin / 20),
						Math.ceil(filter_rect.yMax / 20)
					);
					var draw_offset = [filter_rect_result.xMin, filter_rect_result.yMin];
					if (this.cache.isDirty(base_transform.matrix, width, height)) {
						this.cache.update(
							context.renderer,
							base_transform.matrix,
							width,
							height,
							filter_rect_result.width,
							filter_rect_result.height,
							draw_offset,
							swf_version
						);
						var k = this.cache.getHandle();
						if (k) {
							_cache_info = {
								handle: k,
								dirty: true,
								base_transform: base_transform,
								bounds,
								draw_offset,
								filters: resultFilters,
							};
						}
					} else {
						var k = this.cache.getHandle();
						if (k) {
							_cache_info = {
								handle: k,
								dirty: false,
								base_transform: base_transform,
								bounds,
								draw_offset,
								filters: resultFilters,
							};
						}
					}
				} else {
					this.cache.clear();
					_cache_info = null;
				}
			}
			cache_info = _cache_info;
		}
		if (cache_info) {
			var offset_x = (cache_info.bounds.xMin - cache_info.base_transform.matrix.tx) + (cache_info.draw_offset[0] * 20);
			var offset_y = (cache_info.bounds.yMin - cache_info.base_transform.matrix.ty) + (cache_info.draw_offset[1] * 20);
			if (cache_info.dirty) {
				var transform_stack = new TransformStack();
				var nx = -offset_x;
				var ny = -offset_y;
				transform_stack.stackPush(new Transform(new Matrix(cache_info.base_transform.matrix.a, cache_info.base_transform.matrix.b, cache_info.base_transform.matrix.c, cache_info.base_transform.matrix.d, nx, ny)));
				var offscreen_context = new RenderContext({
					library: context.library,
					renderer: context.renderer,
					commands: new CommandList(),
					transformStack: transform_stack,
					cacheDraws: context.cacheDraws,
					isOffscreen: true,
					useBitmapCache: true,
					stage: context.stage
				});
				this.renderSelf(offscreen_context);
				var background = this.getOpaqueBackground();
				offscreen_context.cacheDraws.push({
					handle: cache_info.handle,
					commands: offscreen_context.commands,
					clear: background ? background.slice(0) : null,
					filters: cache_info.filters,
				});
			}
			var t = context.transformStack.getTransform().clone();
			var mx = t.matrix.tx + offset_x;
			var my = t.matrix.ty + offset_y;
			context.commands.renderBitmap(cache_info.handle, new Transform(new Matrix(1, 0, 0, 1, mx, my), cache_info.base_transform.colorTransform), true, PixelSnapping.INSTANCE.Always);
		} else {
			var background = this.getOpaqueBackground();
			if (background) {
				var base_transform = context.transformStack.getTransform().clone();
				var bounds = this.renderBoundsWithTransform(base_transform.matrix, true, context.stage.view_matrix());
				context.commands.drawRect(background, new Matrix(bounds.width / 20, 0, 0, bounds.height / 20, bounds.xMin, bounds.yMin));
			}
			this.apply_standard_mask_and_scroll(context, this.renderSelf.bind(this));
		}
		if (originalCommands) {
			var subCommands = context.commands.copy();
			context.commands.replace(originalCommands);
			context.commands.blend(subCommands, blendMode);
		}
		context.transformStack.stackPop();
	}
	DisplayObject.prototype.apply_standard_mask_and_scroll = function(context, draw) {
		var mask = this.masker;
		var mask_transform = new Transform();
		if (mask) {
			mask_transform.matrix = (this.globalToLocalMatrix() || Matrix.IDENTITY.clone()).mul(mask.localToGlobalMatrix());
			context.commands.pushMask();
			context.transformStack.stackPush(mask_transform);
			mask.renderSelf(context);
			context.transformStack.stackPop();
			context.commands.activateMask();
		}
		draw(context);
		if (mask) {
			context.commands.deactivateMask();
			context.transformStack.stackPush(mask_transform);
			mask.renderSelf(context);
			context.transformStack.stackPop();
			context.commands.popMask();
		}
	}
	DisplayObject.prototype.renderSelf = function(context) {}
	DisplayObject.prototype.preRender = function(context) {
		this.clearInvalidateFlag();
	}
	DisplayObject.prototype.allowAsMask = function() {
		return true;
	}
	DisplayObject.prototype.debugRender = function(context, player) {
		player.debugTransformStack.stackPush(this.transform);
		var oa = null;
		var hgfh = player.debugTransformStack.getTransform();
		var bm = this.renderBoundsWithTransform(hgfh.matrix, true, context.stage.view_matrix());
		var b = this.getBounds();
		var coll = this._debug_colorDisplayType;
		var collC = [coll[0] / 255, coll[1] / 255, coll[2] / 255, coll[3], 0, 0, 0, 0];
		var collM = new Matrix((b.width / 2000) * 1, 0, 0, (b.height / 2000) * 1, b.xMin, b.yMin);
		context.transformStack.stackPush(hgfh);
		context.transformStack.stackPush(new Transform(collM, collC));
		oa = context.transformStack.getTransform();
		context.commands.renderShape(player.debugRectLineShapeRender, oa);
		context.transformStack.stackPop();
		context.transformStack.stackPop();
		context.transformStack.stackPush(new Transform(Matrix.IDENTITY, hgfh.colorTransform));
		context.transformStack.stackPush(new Transform(new Matrix(bm.width / 2000, 0, 0, bm.height / 2000, bm.xMin, bm.yMin), [0, 0, 0, 1, 0, 0, 0, 0]));
		oa = context.transformStack.getTransform();
		context.commands.renderShape(player.debugRectLineShapeRender, oa);
		context.transformStack.stackPop();
		context.transformStack.stackPush(new Transform(Matrix.IDENTITY, [coll[0] / 255, coll[1] / 255, coll[2] / 255, coll[3], 0, 0, 0, 0]));
		player.drawTextW(context, bm.xMin, (bm.yMin - (75 * player.getScaleBoundsText())), 0.25 * player.getScaleBoundsText(), this.getDisplayName());
		context.transformStack.stackPop();
		context.transformStack.stackPop();
		player.debugTransformStack.stackPop();
	}
	DisplayObject.prototype.enterFrame = function() {}
	DisplayObject.prototype.runFrameAvm1 = function() {}
	DisplayObject.prototype.isInteractive = function() {
		return false;
	}
	DisplayObject.prototype.isContainer = function() {
		return false;
	}
	DisplayObject.prototype.getAvm1RootNoLock = function() {
		var root = this;
		var parent;
		while(parent = root.getAvm1Parent()) {
			root = parent;
		}
		return root;
	}
	DisplayObject.prototype.getAvm1Parent = function() {
		var a = this.getParent();
		if (a) {
			return !(a instanceof Stage) ? a : null;
		}
		return null;
	}
	DisplayObject.prototype.getAvm1Root = function() {
		var root = this;
		while(true) {
			if (root.LOCK_ROOT) {
				break;
			}
			var parent = root.getAvm1Parent();
			if (parent) {
				root = parent;
			} else {
				break;
			}
		}
		return root;
	}
	DisplayObject.prototype.getAvm1Stage = function() {
		var root = this;
		while(true) {
			var parent = root.getParent();
			if (parent) {
				if (parent instanceof Stage) {
					return parent;
				}
				root = parent;
			} else {
				return root;
			}
		}
	}
	DisplayObject.prototype.getAvm1TextFieldBindings = function() {
		return null;
	}
	DisplayObject.prototype.avm1Unload = function(context) {
		if (this.isContainer()) {
			var children = this.iterRenderList();
			for (var i = 0; i < children.length; i++) {
				var child = children[i];
				child.avm1Unload(context);
			}
		}
		var node = this.maskee;
		if (node) {
			node.setMasker(null, true);
		} else {
			node = this.masker;
			if (node) {
				node.setMaskee(null, true);
			}
		}
		Avm1TextFieldBinding.unregisterBindings(this, context);
		if (this.cache) this.cache.clear();
		this.AVM1_REMOVED = true;
	}
	DisplayObject.prototype.constructFrame = function() {

	}
	DisplayObject.prototype.onConstructionComplete = function(context) {
		
	}
	DisplayObject.prototype.frameConstructed = function(context) {

	}
	DisplayObject.prototype.runFrameScripts = function(context) {
		if (this.isContainer()) {

		}
	}
	DisplayObject.prototype.exitFrame = function(context) {

	}
	DisplayObject.prototype.setState = function() {
	}
	DisplayObject.prototype.getDisplayName = function() {
		return this.displayType + ": " + this.getId();
	}
	DisplayObject.prototype.mousePickAvm1 = function() {
		return null;
	}
	DisplayObject.prototype.getAvm1BooleanProperty = function(name, context, d) {
		var object = this.getObject();
		if (object.a == Avm1Value.Object) {
			var activation = Avm1Activation.fromNothing(context, Avm1ActivationIdentifier.root("[AVM1 Boolean Property]"), this.getAvm1Root());
			var value = object.b.get(name, activation);
			switch(value.a) {
				case Avm1Value.Undefined:
					return d(context);
				default:
					return value.asBool(activation.swfVersion);
			}
		} else {
			return false;
		}
	}
	DisplayObject.prototype.downgrade = function() {
		if (this instanceof MovieClip) {
			return new DisplayObjectWeak(DisplayObjectWeak.MovieClip, this);
		} else if (this instanceof Bitmap) {
			return new DisplayObjectWeak(DisplayObjectWeak.Bitmap, this);
		} else {
			console.log("Downgrade not yet implemented for", this);
		}
	}
	var Avm1TextFieldBinding = function(text_field, variable_name) {
		this.text_field = text_field;
		this.variable_name = variable_name;
	}
	Avm1TextFieldBinding.bindVariables = function(activation) {
		var i = 0;
		var len = activation.context.unbound_text_fields.length;
		while (i < len) {
			if (activation.context.unbound_text_fields[i].tryBindTextFieldVariable(activation, false)) {
				activation.context.unbound_text_fields.splice(i, 1);
				len -= 1;
			} else {
				i += 1;
			}
		}
	}
	Avm1TextFieldBinding.clearBinding = function(dobj) {
		var bindings = dobj.getAvm1TextFieldBindings();
		if (bindings) {
			for (var i = 0; i < bindings.length;) {
				var a = bindings[i];
				if (a === dobj) {
					bindings.splice(i, 1);
				} else {
					i++;
				}
			}
		}
	}
	Avm1TextFieldBinding.unregisterBindings = function(dobj, context) {
		var bindings = dobj.getAvm1TextFieldBindings();
		if (bindings) {
			for (var i = 0; i < bindings.length; i++) {
				var binding = bindings[i];
				binding.text_field.clearBoundDisplayObject(context);
				context.unbound_text_fields.push(binding.text_field);
			}	
		}
	}
	Avm1TextFieldBinding.prototype.registerBinding = function(dobj) {
		var bindings = dobj.getAvm1TextFieldBindings();
		if (bindings) bindings.push(this);
	}
	var DisplayObjectWeak = function(type, data) {
		this.type = type;
		this.data = data;
	}
	DisplayObjectWeak.prototype.upgrade = function() {
		switch (this.type) {
			case DisplayObjectWeak.MovieClip:
			case DisplayObjectWeak.LoaderDisplay:
			case DisplayObjectWeak.Bitmap:
				return this.data;
		}
	}
	DisplayObjectWeak.MovieClip = 1;
	DisplayObjectWeak.LoaderDisplay = 2;
	DisplayObjectWeak.Bitmap = 3;
	var InteractiveObject = function() {
		DisplayObject.call(this);
		this._mouseEnabled = true;
	}
	InteractiveObject.prototype = Object.create(DisplayObject.prototype);
	InteractiveObject.prototype.constructor = InteractiveObject;
	InteractiveObject.prototype.displayType = "InteractiveObject";
	InteractiveObject.prototype.isInteractive = function() {
		return true;
	}
	InteractiveObject.prototype.propagateToChildren = function(context, event) {
		if (event.propagates()) {
			if (this instanceof DisplayObjectContainer) {
				var children = this.iterRenderList();
				for (var i = 0; i < children.length; i++) {
					var child = children[i];
					if (child instanceof InteractiveObject) {
						if (child.handleClipEvent(context, event)) {
							return true;
						}
					}
				}
			}	
		}
		return false;
	}
	InteractiveObject.prototype.handleClipEvent = function(context, event) {
		if (!this._mouseEnabled) {
			return false;
		}
		if (!this.filterClipEvent(context, event)) {
			return false;
		}
		if (this.propagateToChildren(context, event)) {
			return true;
		}
		return this.eventDispatch(context, event);
	}
	InteractiveObject.prototype.shouldFireEventHandlers = function(context, event) {
		if (this.getMovie().version < 6) {
			return false;
		}
		if (!event.isKeyEvent()) {
			return true;
		}	
		return false;
	}
	InteractiveObject.prototype.eventDispatch = function(context, event) {
		return false;
	}
	InteractiveObject.prototype.filterClipEvent = function(context, event) {
		return false;
	}
	var ChildContainer = function() {
		this.renderList = [];
		this.depthList = new BTreeMap();
		this.has_pending_removals = false;
	}
	ChildContainer.shouldDelayRemoval = function(activation, child) {
		if (child instanceof MovieClip) {
			if (child.hasUnloadHandler()) {
				return true;
			} else {
				var obj = child.getObject().coerceToObject(activation);
				if (obj.has_property(activation, "onUnload")) {
					return true;
				}
			}
		}
		if (child.isContainer()) {
			var children = child.iterRenderList();
			for (var i = 0; i < children.length; i++) {
				var c = children[i];
				if (ChildContainer.shouldDelayRemoval(activation, c)) {
					return true;
				}
			}
		}
		return false;
	}
	ChildContainer.queueRemoval = function(child, context) {
		if (child.isContainer()) {
			var children = child.iterRenderList();
			for (var i = 0; i < children.length; i++) {
				var c = children[i];
				ChildContainer.queueRemoval(c, context);
			}
		}
		var cur_depth = child.getDepth();
		child.setDepth(-cur_depth - 1);
		child.setAvm1PendingRemoval(true);
		if (child instanceof MovieClip) {
			child.eventDispatch(context, new ClipEvent(ClipEvent.Unload));
		}
	}
	ChildContainer.prototype.isEmpty = function() {
		return !this.renderList.length;
	}
	ChildContainer.prototype.numChildren = function() {
		return this.renderList.length;
	}
	ChildContainer.prototype.replaceId = function(id, child) {
		this.renderList[id] = child;
	}
	ChildContainer.prototype.insertId = function(id, child) {
		if (this.renderList.length) {
			if (id >= this.renderList.length) {
				this.renderList.push(child);
			} else {
				this.renderList.splice(id, 0, child);
			}
		} else {
			this.renderList.push(child);
		}
	}
	ChildContainer.prototype.pushId = function(child) {
		this.renderList.push(child);
	}
	ChildContainer.prototype.removeId = function(id) {
		if (this.renderList.length) {
			if (id >= this.renderList.length) {
				this.renderList.pop();
			} else {
				this.renderList.splice(id, 1);
			}
		}
	}
	ChildContainer.prototype.removeChildFromDepthList = function(child) {
		var other_child = this.depthList.get(child.getDepth());
		if (other_child) {
			this.depthList.remove(child.getDepth());
			return true;
		} else {
			return false;
		}
	}
	ChildContainer.prototype.removeChildFromRenderList = function(child, context) {
		var rs = this.renderList.indexOf(child);
		if (rs >= 0) {
			this.removeId(rs);
			return true;
		} else {
			return false;
		}
	}
	ChildContainer.prototype.getDepth = function(depth) {
		return this.depthList.get(depth);
	}
	ChildContainer.prototype.getHighestDepth = function() {
		return this.depthList.highest() || 0;
	}
	ChildContainer.prototype.swapAtDepth = function(context, parent, child, depth) {
		var prev_depth = child.getDepth();
		child.setDepth(depth);
		child.setParent(context, parent);
		var prev_child = this.depthList.insert(depth, child);
		if (prev_child) {

		} else {
			this.depthList.remove(prev_depth);
			var old_position = this.renderList.indexOf(child);
			if (old_position >= 0) {
				this.removeId(old_position);
			}
			var below_child = this.depthList.range(null, depth);
			if (below_child) {
				var new_position = this.renderList.indexOf(below_child);
				this.insertId(new_position, child);
			} else {
				this.insertId(0, child);
			}
		}
	}
	ChildContainer.prototype.getName = function(name, case_sensitive) {
		if (this.has_pending_removals) {
			var depthList = this.depthList.values();
			for (var i = 0; i < depthList.length; i++) {
				var child = depthList[i];
				if (child) {
					var _name = child.getName();
					if (_name != null) {
						if (case_sensitive) {
							if (_name == name) {
								return child;
							}
						} else {
							if (eq_ignore_case(_name, name)) {
								return child;
							}
						}
					}	
				}
			}
		} else {
			var renderList = this.renderList;
			for (var i = 0; i < renderList.length; i++) {
				var child = renderList[i];
				var _name = child.getName();
				if (_name != null) {
					if (case_sensitive) {
						if (_name == name) {
							return child;
						}
					} else {
						if (eq_ignore_case(_name, name)) {
							return child;
						}
					}
				}
			}
		}
		return null;
	}
	ChildContainer.prototype.insertChildIntoDepthList = function(depth, child) {
		return this.depthList.insert(depth, child);
	}
	ChildContainer.prototype.replaceAtDepth = function(child, depth) {
		var prevChild = this.insertChildIntoDepthList(depth, child);
		if (prevChild) {
			var rs = this.renderList.indexOf(prevChild);
			if (rs >= 0) {
				if (!prevChild.PLACED_BY_SCRIPT) {
					this.replaceId(rs, child);
					return prevChild;
				} else {
					this.insertId(rs + 1, child);
					return null;
				}
			} else {
				console.log("ChildContainer::replace_at_depth: Previous child is not in render list");
				this.pushId(child);
				return null;
			}
		} else {
			var aboveChild = this.depthList.range(depth, null);
			if (aboveChild) {
				var rs = this.renderList.indexOf(aboveChild);
				if (rs >= 0) {
					this.insertId(rs, child);
					return null;
				} else {
					this.pushId(child);
					return null;
				}
			} else {
				this.pushId(child);
				return null;
			}	
		}
	}
	ChildContainer.prototype.setPendingRemovals = function(pending) {
		this.has_pending_removals = pending;
	}
	ChildContainer.prototype.updatePendingRemovals = function() {
		var depthList = this.depthList.values();
		var h = false;
		for (var i = 0; i < depthList.length; i++) {
			var c = depthList[i];
			if (c.AVM1_PENDING_REMOVAL) {
				h = true;
			}
		}
		this.has_pending_removals = h;
	}
	var DisplayObjectContainer = function() {
		InteractiveObject.call(this);
		this.container = new ChildContainer();
	}
	DisplayObjectContainer.prototype = Object.create(InteractiveObject.prototype);
    DisplayObjectContainer.prototype.constructor = DisplayObjectContainer;
	DisplayObjectContainer.prototype.displayType = "Container";
	DisplayObjectContainer.prototype.isEmpty = function() {
		return this.container.isEmpty();
	}
	DisplayObjectContainer.prototype.numChildren = function() {
		return this.container.numChildren();
	}
	DisplayObjectContainer.prototype.isContainer = function() {
		return true;
	}
	DisplayObjectContainer.prototype.replaceAtDepth = function(context, child, depth) {
		var rawContainer = this.container;
		var removed_child = rawContainer.replaceAtDepth(child, depth);
		child.setParent(context, this);
		child.setPlaceFrame(0);
		child.setDepth(depth);
		if (removed_child) {
			removed_child.avm1Unload(context);
			removed_child.setParent(context, null);
		}
		this.invalidateCachedBitmap();
	}
	DisplayObjectContainer.prototype.getHighestDepth = function() {
		return this.container.getHighestDepth();
	}
	DisplayObjectContainer.prototype.childByDepth = function(depth) {
		return this.container.getDepth(depth);
	}
	DisplayObjectContainer.prototype.childByName = function(name, case_sensitive) {
		return this.container.getName(name, case_sensitive);
	}
	DisplayObjectContainer.prototype.swapAtDepth = function(context, child, depth) {
		this.container.swapAtDepth(context, this, child, depth);
		this.invalidateCachedBitmap();
	}
	DisplayObjectContainer.prototype.removeChild = function(context, child) {
		var should_delay_removal;
		var activation = Avm1Activation.fromNothing(context, Avm1ActivationIdentifier.root("[Unload Handler Check]"), this.getAvm1Root());
		should_delay_removal = ChildContainer.shouldDelayRemoval(activation, child);
		if (should_delay_removal) {
			var raw_container = this.container;
			raw_container.removeChildFromDepthList(child);
			ChildContainer.queueRemoval(child, context);
			raw_container.setPendingRemovals(true);
			raw_container.insertChildIntoDepthList(child.getDepth(), child);
			this.invalidateCachedBitmap();
			return;
		}
		this.removeChildDirectly(context, child);
	}
	DisplayObjectContainer.prototype.removeChildFromDepthList = function(context, child) {
		this.container.removeChildFromDepthList(child);
		this.invalidateCachedBitmap();
	}
	DisplayObjectContainer.prototype.removeChildDirectly = function(context, child) {
		var rawContainer = this.container;
		rawContainer.removeChildFromDepthList(child);
		var removed_from_render_list = rawContainer.removeChildFromRenderList(child, context)
		if (removed_from_render_list) {
			child.avm1Unload(context);
			this.invalidateCachedBitmap();
		}
	}
	DisplayObjectContainer.prototype.iterRenderList = function() {
		return this.container.renderList.slice(0);
	}
	DisplayObjectContainer.prototype.renderChildren = function(context) {
		var clipDepth = 0;
		var clipDepthStack = [];
		var children = this.iterRenderList();
		for (var i = 0; i < children.length; i++) {
			var child = children[i];
			var depth = child.getDepth();
			child.preRender(context);
			while ((clipDepth > 0) && (depth > clipDepth)) {
				var _f = clipDepthStack.pop();
				clipDepth = _f[0];
				context.commands.deactivateMask();
				_f[1].render(context);
				context.commands.popMask();
			}
			if (child.clipDepth > 0 && child.allowAsMask()) {
				clipDepthStack.push([clipDepth, child]);
				clipDepth = child.clipDepth;
				context.commands.pushMask();
				child.render(context);
				context.commands.activateMask();
			} else if (child.getVisible() || context.commands.drawingMask()) {
				child.render(context);
			}
		}
		for (var j = clipDepthStack.length - 1; j >= 0; j--) {
			context.commands.deactivateMask();
			clipDepthStack[j][1].render(context);
			context.commands.popMask();
		}
	}
	DisplayObjectContainer.prototype.debugRender = function(context, player) {
		player.debugTransformStack.stackPush(this.transform);
		var children = this.iterRenderList();
		for (var i = 0; i < children.length; i++) {
			var child = children[i];
			if (child.getVisible()) {
				child.debugRender(context, player);
			}
		}
		if (!this.isRoot()) {
			var h = player.debugTransformStack.getTransform();
			var bm = this.renderBoundsWithTransform(h.matrix, true, context.stage.view_matrix());
			var coll = this._debug_colorDisplayType;
			context.transformStack.stackPush(new Transform(Matrix.IDENTITY, h.colorTransform));
			context.transformStack.stackPush(new Transform(Matrix.IDENTITY, [coll[0] / 255, coll[1] / 255, coll[2] / 255, coll[3], 0, 0, 0, 0]));
			player.drawTextW(context, bm.xMin, bm.yMin - (320 * player.getScaleBoundsText()), (0.25 * player.getScaleBoundsText()), this.getDisplayName());
			context.transformStack.stackPop();
			context.transformStack.stackPush(new Transform(new Matrix(bm.width / 2000, 0, 0, bm.height / 2000, bm.xMin, bm.yMin), [0, 0, 0, 1, 0, 0, 0, 0]));
			context.commands.renderShape(player.debugRectLineShapeRender, context.transformStack.getTransform());
			context.transformStack.stackPop();
			context.transformStack.stackPop();
		}
		player.debugTransformStack.stackPop();
	}
	var Graphic = function() {
		DisplayObject.call(this);
		this.shapeData = null;
	}
	Graphic.prototype = Object.create(DisplayObject.prototype);
	Graphic.prototype.constructor = Graphic;
	Graphic.prototype.displayType = "Shape";
	Graphic.prototype._debug_colorDisplayType = [0, 0, 255, 1];
	Graphic.fromSwfTag = function(movie, tag) {
		return new GraphicStatic(movie, tag);
	}
	Graphic.prototype.getId = function() {
		return this.shapeData.characterId;
	}
	Graphic.prototype.init = function(shapeData) {
		if (!shapeData) return;
		this.shapeData = shapeData;
	}
	Graphic.prototype.replaceWith = function(context, characterId) {
		var movie = this.getMovie();
		this.init(movie.library.getGraphic(characterId));
		this.invalidateCachedBitmap();
	}
	Graphic.prototype.postInstantiation = function(context, initObject, instantiatedBy, runFrame) {
		context.avm1.addExecuteList(this);
		if (runFrame) {
			this.runFrameAvm1(context);
		}
	}
	Graphic.prototype.runFrameAvm1 = function(context) {}
	Graphic.prototype.selfBounds = function() {
		return this.shapeData.bounds;
	}
	Graphic.prototype.getMovie = function() {
		return this.shapeData.movie;
	}
	Graphic.prototype.hitTestShape = function(_context, point, options) {
		if (this.getVisible() && this.worldBounds().contains(point)) {
			var _m = this.globalToLocalMatrix();
			if (!_m) return false;
			var data = this.shapeData.data;
			return shapeUtils.shapeHitTest(data, _m.mulPoint(point), _m);
		}
	}
	Graphic.prototype.renderSelf = function(context) {
		var shapeRender = this.shapeData.getShape(context);
		context.commands.renderShape(shapeRender, context.transformStack.getTransform());
	}
	var GraphicStatic = function(movie, data) {
		this.movie = movie;
		this.data = data;
		this.characterId = data.id;
		this.bounds = Rectangle.fromObject(data.bounds);
		this.shapeRender = null;
	}
	GraphicStatic.prototype.getShape = function(context) {
		if (!this.shapeRender) {
			var resultShape = shapeUtils.shapeToRendererInfo(shapeUtils.convert(this.data, "shape"));
			this.shapeRender = context.renderer.registerShape(resultShape, new MovieLibrarySource(this.movie.library));
		}
		return this.shapeRender;
	}
	GraphicStatic.prototype.instantiate = function() {
		var shape = new Graphic();
		shape.init(this);
		return shape;
	}
	var MorphShape = function() {
		DisplayObject.call(this);
		this.morphShapeData = null;
		this.ratio = 0;
	}
	MorphShape.prototype = Object.create(DisplayObject.prototype);
	MorphShape.prototype.constructor = MorphShape;
	MorphShape.prototype.displayType = "MorphShape";
	MorphShape.prototype._debug_colorDisplayType = [0, 255, 255, 1];
	MorphShape.fromSwfTag = function(movie, tag) {
		return new MorphShapeStatic(movie, tag);
	}
	MorphShape.prototype.getId = function() {
		return this.morphShapeData.characterId;
	}
	MorphShape.prototype.init = function(morphShapeData) {
		if (!morphShapeData) return;
		this.morphShapeData = morphShapeData;
		this.invalidateCachedBitmap();
	}
	MorphShape.prototype.getMovie = function() {
		return this.morphShapeData.movie;
	}
	MorphShape.prototype.replaceWith = function(context, characterId) {
		var movie = this.getMovie();
		this.init(movie.library.getMorphShape(characterId));
	}
	MorphShape.prototype.runFrameAvm1 = function(context) {
		// Noop
	}
	MorphShape.prototype.setRatio = function(ratio) {
		this.ratio = ratio;
		this.invalidateCachedBitmap();
	}
	MorphShape.prototype.selfBounds = function() {
		var frame = this.morphShapeData.getFrame(this.ratio);
		return frame.bounds;
	}
	MorphShape.prototype.renderSelf = function(context) {
		var ratio = this.ratio;
		var renderShape = this.morphShapeData.getShape(context, ratio);
		context.commands.renderShape(renderShape, context.transformStack.getTransform());
	}
	var MorphShapeStatic = function(movie, data) {
		this.movie = movie;
		this.data = data;
		this.characterId = data.id;
		this.morphCaches = [];
	}
	MorphShapeStatic.prototype.getShape = function(context, ratio) {
		var frame = this.getFrame(ratio);
		if (!frame.shapeRender) {
			var resultCache = shapeUtils.shapeToRendererInfo(shapeUtils.convert(frame.shape, "morphshape"));
			frame.shapeRender = context.renderer.registerShape(resultCache, new MovieLibrarySource(this.movie));
		}
		return frame.shapeRender;
	}
	MorphShapeStatic.prototype.instantiate = function() {
		var shape = new MorphShape();
		shape.init(this);
		return shape;
	}
	MorphShapeStatic.prototype.getFrame = function(ratio) {
		if (!this.morphCaches[ratio]) {
			this.morphCaches[ratio] = this.buildMorphFrame(ratio / 65535);
		}
		return this.morphCaches[ratio];
	}
	MorphShapeStatic.prototype.lerpTwips = function(start, end, per) {
		var startPer = 1 - per;
		return ((start * startPer) + (end * per)) | 0;
	}
	MorphShapeStatic.prototype.lerpColor = function(startColor, endColor, per) {
		var startPer = 1 - per;
		var result = [
			Math.floor(startColor[0] * startPer + endColor[0] * per),
			Math.floor(startColor[1] * startPer + endColor[1] * per),
			Math.floor(startColor[2] * startPer + endColor[2] * per),
			startColor[3] * startPer + endColor[3] * per
		];
		return result;
	}
	MorphShapeStatic.prototype.lerpMatrix = function(startMatrix, endMatrix, per) {
		var startPer = 1 - per;
		var result = [
			startMatrix[0] * startPer + endMatrix[0] * per,
			startMatrix[1] * startPer + endMatrix[1] * per,
			startMatrix[2] * startPer + endMatrix[2] * per,
			startMatrix[3] * startPer + endMatrix[3] * per,
			this.lerpTwips(startMatrix[4], endMatrix[4], per),
			this.lerpTwips(startMatrix[5], endMatrix[5], per)
		];
		return result;
	}
	MorphShapeStatic.prototype.lerpGradient = function(gradient, per) {
		var startPer = 1 - per;
		var gRecords = [];
		var records = gradient.records;
		for (var gIdx = 0; gIdx < records.length; gIdx++) {
			var gRecord = records[gIdx];
			gRecords.push({
				color: this.lerpColor(gRecord.startColor, gRecord.endColor, per),
				ratio: (gRecord.startRatio * startPer) + (gRecord.endRatio * per)
			});
		}
		return {
			matrix: this.lerpMatrix(gradient.startMatrix, gradient.endMatrix, per),
			records: gRecords,
			spreadMode: gradient.spreadMode,
			interpolationMode: gradient.interpolationMode
		};
	}
	MorphShapeStatic.prototype.lerpFill = function(fillStyle, per) {
		var startPer = 1 - per;
		var fillStyleType = fillStyle.type;
		if (fillStyleType === 0x00) {
			return {
				color: this.lerpColor(fillStyle.startColor, fillStyle.endColor, per),
				type: fillStyleType
			};
		} else {
			if (fillStyleType == 0x40 || fillStyleType == 0x41 || fillStyleType == 0x42 || fillStyleType == 0x43) {
				return {
					bitmapId: fillStyle.bitmapId,
					bitmapMatrix: this.lerpMatrix(fillStyle.bitmapStartMatrix, fillStyle.bitmapEndMatrix, per),
					isSmoothed: fillStyle.isSmoothed,
					isRepeating: fillStyle.isRepeating,
					type: fillStyleType
				};
			} else {
				var focalPoint = 0;
				if (fillStyleType == 19) {
					focalPoint = (fillStyle.startFocalPoint * startPer) + (fillStyle.endFocalPoint * per);
				}
				var gradient = this.lerpGradient(fillStyle.gradient, per);
				return {
					gradient: gradient,
					focalPoint,
					type: fillStyleType
				};
			}
		}
	}
	MorphShapeStatic.prototype.lerpLine = function(lineStyle, per) {
		var width = this.lerpTwips(lineStyle.startWidth, lineStyle.endWidth, per);
		if (lineStyle.fillType) {
			return {
				width: width,
				fillType: this.lerpFill(lineStyle.fillType, per)
			};
		} else {
			return {
				width: width,
				color: this.lerpColor(lineStyle.startColor, lineStyle.endColor, per)
			};
		}
	}
	MorphShapeStatic.prototype.buildEdges = function(per) {
		var startPer = 1 - per;
		var startPosition = { x: 0, y: 0 };
		var endPosition = { x: 0, y: 0 };
		var StartRecords = cloneObject(this.data.startEdges);
		var EndRecords = cloneObject(this.data.endEdges);
		var StartRecordLength = StartRecords.length;
		var EndRecordLength = EndRecords.length;
		var length = Math.max(StartRecordLength, EndRecordLength);
		for (var i = 0; i < length; i++) {
			var addRecode = {};
			var StartRecord = StartRecords[i];
			var EndRecord = EndRecords[i];
			if (!StartRecord || !EndRecord) continue;
			if (!StartRecord.isChange && !EndRecord.isChange) {
				if (StartRecord.isCurved) {
					startPosition.x += StartRecord.controlDeltaX + StartRecord.anchorDeltaX;
					startPosition.y += StartRecord.controlDeltaY + StartRecord.anchorDeltaY;
				} else {
					startPosition.x += StartRecord.deltaX;
					startPosition.y += StartRecord.deltaY;
				}
				if (EndRecord.isCurved) {
					endPosition.x += EndRecord.controlDeltaX + EndRecord.anchorDeltaX;
					endPosition.y += EndRecord.controlDeltaY + EndRecord.anchorDeltaY;
				} else {
					endPosition.x += EndRecord.deltaX;
					endPosition.y += EndRecord.deltaY;
				}
				continue;
			}
			if (StartRecord.isChange && !EndRecord.isChange) {
				addRecode = {
					fillStyle0: StartRecord.fillStyle0,
					fillStyle1: StartRecord.fillStyle1,
					lineStyle: StartRecord.lineStyle,
					stateFillStyle0: StartRecord.stateFillStyle0,
					stateFillStyle1: StartRecord.stateFillStyle1,
					stateLineStyle: StartRecord.stateLineStyle,
					stateMoveTo: StartRecord.stateMoveTo,
					stateNewStyles: StartRecord.stateNewStyles,
					isChange: true
				};
				if (StartRecord.stateMoveTo) {
					addRecode.moveX = endPosition.x;
					addRecode.moveY = endPosition.y;
					startPosition.x = StartRecord.moveX;
					startPosition.y = StartRecord.moveY;
				}
				EndRecords.splice(i, 0, addRecode);
			} else if (!StartRecord.isChange && EndRecord.isChange) {
				addRecode = {
					fillStyle0: EndRecord.fillStyle0,
					fillStyle1: EndRecord.fillStyle1,
					lineStyle: EndRecord.lineStyle,
					stateFillStyle0: EndRecord.stateFillStyle0,
					stateFillStyle1: EndRecord.stateFillStyle1,
					stateLineStyle: EndRecord.stateLineStyle,
					stateMoveTo: EndRecord.stateMoveTo,
					stateNewStyles: EndRecord.stateNewStyles,
					isChange: true
				};
				if (EndRecord.stateMoveTo) {
					addRecode.moveX = startPosition.x;
					addRecode.moveY = startPosition.y;
					endPosition.x = EndRecord.moveX;
					endPosition.y = EndRecord.moveY;
				}
				StartRecords.splice(i, 0, addRecode);
			} else {
				if (StartRecord.stateMoveTo) {
					startPosition.x = StartRecord.moveX;
					startPosition.y = StartRecord.moveY;
				}
				if (EndRecord.stateMoveTo) {
					endPosition.x = EndRecord.moveX;
					endPosition.y = EndRecord.moveY;
				}
			}
		}
		var FillType = 0;
		var FillStyle = 0;
		length = StartRecords.length;
		for (var i = 0; i < length; i++) {
			var record = StartRecords[i];
			if (!record.isChange) continue;
			if (record.stateFillStyle0) {
				FillStyle = record.fillStyle0;
			}
			if (FillStyle) {
				record.stateFillStyle0 = 1;
				record.stateFillStyle1 = 1;
				if (FillType) {
					record.fillStyle0 = 0;
					record.fillStyle1 = FillStyle;
				} else {
					record.fillStyle0 = FillStyle;
					record.fillStyle1 = 0;
				}
			} else {
				record.stateFillStyle1 = 1;
				record.fillStyle1 = 0;
			}
			FillType = (FillType) ? 0 : 1;
		}
		var newShapeRecords = [];
		var len = StartRecords.length;
		for (var i = 0; i < len; i++) {
			var StartRecord = StartRecords[i];
			if (!StartRecord) continue;
			var EndRecord = EndRecords[i];
			if (!EndRecord) continue;
			var newRecord = {};
			if (StartRecord.isChange) {
				var MoveX = 0;
				var MoveY = 0;
				if (StartRecord.stateMoveTo) {
					MoveX = StartRecord.moveX * startPer + EndRecord.moveX * per;
					MoveY = StartRecord.moveY * startPer + EndRecord.moveY * per;
				}
				newRecord = {
					fillStyle0: StartRecord.fillStyle0,
					fillStyle1: StartRecord.fillStyle1,
					lineStyle: StartRecord.lineStyle,
					moveX: MoveX,
					moveY: MoveY,
					stateFillStyle0: StartRecord.stateFillStyle0,
					stateFillStyle1: StartRecord.stateFillStyle1,
					stateLineStyle: StartRecord.stateLineStyle,
					stateMoveTo: StartRecord.stateMoveTo,
					stateNewStyles: StartRecord.stateNewStyles,
					isChange: true
				};
			} else {
				newRecord = this.lerpEdges(StartRecord, EndRecord, per);
			}
			newShapeRecords[i] = newRecord;
		}
		return newShapeRecords;
	}
	MorphShapeStatic.prototype.lerpEdges = function(start, end, per) {
		var startIsCurved = start.isCurved;
		var endIsCurved = end.isCurved;
		if (!startIsCurved && !endIsCurved) {
			return {
				deltaX: this.lerpTwips(start.deltaX, end.deltaX, per),
				deltaY: this.lerpTwips(start.deltaY, end.deltaY, per),
				isCurved: false,
				isChange: false
			};
		} else if (startIsCurved && endIsCurved) {
			return {
				controlDeltaX: this.lerpTwips(start.controlDeltaX, end.controlDeltaX, per),
				controlDeltaY: this.lerpTwips(start.controlDeltaY, end.controlDeltaY, per),
				anchorDeltaX: this.lerpTwips(start.anchorDeltaX, end.anchorDeltaX, per),
				anchorDeltaY: this.lerpTwips(start.anchorDeltaY, end.anchorDeltaY, per),
				isCurved: true,
				isChange: false
			};
		} else if (!startIsCurved && endIsCurved) {
			var startControlX = start.deltaX / 2;
			var startControlY = start.deltaY / 2;
			var startAnchorX = startControlX;
			var startAnchorY = startControlY;
			return {
				controlDeltaX: this.lerpTwips(startControlX, end.controlDeltaX, per),
				controlDeltaY: this.lerpTwips(startControlY, end.controlDeltaY, per),
				anchorDeltaX: this.lerpTwips(startAnchorX, end.anchorDeltaX, per),
				anchorDeltaY: this.lerpTwips(startAnchorY, end.anchorDeltaY, per),
				isCurved: true,
				isChange: false
			};
		} else if (startIsCurved && !endIsCurved) {
			var endControlX = end.deltaX / 2;
			var endControlY = end.deltaY / 2;
			var endAnchorX = endControlX;
			var endAnchorY = endControlY;
			return {
				controlDeltaX: this.lerpTwips(start.controlDeltaX, endControlX, per),
				controlDeltaY: this.lerpTwips(start.controlDeltaY, endControlY, per),
				anchorDeltaX: this.lerpTwips(start.anchorDeltaX, endAnchorX, per),
				anchorDeltaY: this.lerpTwips(start.anchorDeltaY, endAnchorY, per),
				isCurved: true,
				isChange: false
			};
		}
	}
	MorphShapeStatic.prototype.buildMorphFrame = function(per) {
		var shape = {
			lineStyles: [],
			fillStyles: [],
			shapeRecords: []
		};
		var lineStyles = cloneObject(this.data.morphLineStyles);
		var fillStyles = cloneObject(this.data.morphFillStyles);
		for (var i = 0; i < lineStyles.length; i++) {
			shape.lineStyles[i] = this.lerpLine(lineStyles[i], per);
		}
		for (var i = 0; i < fillStyles.length; i++) {
			shape.fillStyles[i] = this.lerpFill(fillStyles[i], per);
		}
		shape.shapeRecords = this.buildEdges(per);
		var bounds = shapeUtils.calculateShapeBounds(shape.shapeRecords);
		return {
			bounds: Rectangle.fromObject(bounds),
			shape: shape,
			shapeRender: null
		};
	}
	var StaticText = function() {
		DisplayObject.call(this);
		this.staticData = null;
		this.renderSettings = null;
	}
	StaticText.prototype = Object.create(DisplayObject.prototype);
	StaticText.prototype.constructor = StaticText;
	StaticText.prototype.displayType = "StaticText";
	StaticText.prototype._debug_colorDisplayType = [255, 0, 255, 1];
	StaticText.fromSwfTag = function(movie, tag) {
		return new TextStatic(movie, tag);
	}
	StaticText.prototype.getId = function() {
		return this.staticData.characterId;
	}
	StaticText.prototype.init = function(textData) {
		if (!textData) return;
		this.staticData = textData;
		this.renderSettings = textData.settings;
	}
	StaticText.prototype.replaceWith = function(context, characterId) {
		var movie = this.getMovie();
		this.init(movie.library.getText(characterId));
		this.invalidateCachedBitmap();
	}
	StaticText.prototype.postInstantiation = function(context) {}
	StaticText.prototype.runFrameAvm1 = function(context) {}
	StaticText.prototype.getMovie = function() {
		return this.staticData.movie;
	}
	StaticText.prototype.selfBounds = function() {
		return this.staticData.bounds;
	}
	StaticText.prototype.renderSelf = function(context) {
		var movie = this.getMovie();
		var renderer = context.renderer;
		var color = [0, 0, 0, 0];
		var textHeight = 0;
		var fontData = null;
		context.transformStack.stackPush(new Transform(this.staticData.matrix, [1, 1, 1, 1, 0, 0, 0, 0]));
		var glyphMatrix = Matrix.IDENTITY.clone();
		var textBlocks = this.staticData.textBlocks;
		for (var i = 0; i < textBlocks.length; i++) {
			var record = textBlocks[i];
			if ("fontId" in record) fontData = movie.library.getFont(record.fontId);
			if ("x" in record) glyphMatrix.tx = record.x;
			if ("y" in record) glyphMatrix.ty = record.y;
			if ("textColor" in record) color = record.textColor;
			if ("textHeight" in record) textHeight = record.textHeight;
			var entries = record.entries;
			if (fontData) {
				var _scale = textHeight / fontData.scale;
				glyphMatrix.a = _scale;
				glyphMatrix.d = _scale;
				for (var idx = 0; idx < entries.length; idx++) {
					var entry = entries[idx];
					var glyph = fontData.getGlyph(entry.index);
					if (glyph) {
						var shapeRender = glyph.getShapeHandle(renderer);
						if (shapeRender) {
							context.transformStack.stackPush(new Transform(glyphMatrix, [color[0] / 255, color[1] / 255, color[2] / 255, color[3], 0, 0, 0, 0]));
							context.commands.renderShape(shapeRender, context.transformStack.getTransform());
							context.transformStack.stackPop();
							glyphMatrix.tx += entry.advance;
						}
					}
				}
			}
		}
		context.transformStack.stackPop();
	}
	StaticText.prototype.hitTestShape = function(context, point, _) {
		if (this.getVisible() && this.worldBounds().contains(point)) {
			if (this.renderSettings.isAdvanced()) return true;
			var movie = this.getMovie();
			var localMatrix = this.globalToLocalMatrix();
			if (!localMatrix) return false;
			var textMatrix = this.staticData.matrix.inverse();
			if (!textMatrix) return false;
			var _point = textMatrix.mul(localMatrix).mulPoint(point);
			var fontData = null;
			var textHeight = 0;
			var glyphMatrix = Matrix.IDENTITY.clone();
			var textBlocks = this.staticData.textBlocks;
			for (var i = 0; i < textBlocks.length; i++) {
				var record = textBlocks[i];
				if ("fontId" in record) fontData = movie.library.getFont(record.fontId);
				if ("x" in record) glyphMatrix.tx = record.x;
				if ("y" in record) glyphMatrix.ty = record.y;
				if ("textHeight" in record) textHeight = record.textHeight;
				var entries = record.entries;
				if (fontData) {
					var _scale = textHeight / fontData.scale;
					glyphMatrix.a = _scale;
					glyphMatrix.d = _scale;
					for (var idx = 0; idx < entries.length; idx++) {
						var entry = entries[idx];
						var glyph = fontData.getGlyph(entry.index);
						if (glyph) {
							var commands = glyph.commands;
							var matrix = glyphMatrix.inverse();
							if (!matrix) return false;
							var __point = matrix.mulPoint(_point);
							if (shapeUtils.drawCommandFillHitTest(commands, __point)) { // matrixUtils.generateMatrix(__point, localMatrix)
								return true;
							}
							glyphMatrix.tx += entry.advance;
						}
					}	
				}
			}
		}
		return false;
	}
	var TextStatic = function(movie, data) {
		this.movie = movie;
		this.data = data;
		this.characterId = data.id;
		this.settings = TextRenderSettings.createNew();
		this.bounds = new Rectangle(0, 0, 0, 0);
		this.matrix = Matrix.IDENTITY.clone();
		this.textBlocks = [];
		this.init();
	}
	TextStatic.prototype.init = function() {
		this.bounds = Rectangle.fromObject(this.data.bounds);
		this.matrix = Matrix.fromArray(this.data.matrix);
		this.textBlocks = this.data.records;
	}
	TextStatic.prototype.setRenderSettings = function(settings) {
		this.settings = TextRenderSettings.fromSwfTag(settings);
	}
	TextStatic.prototype.instantiate = function() {
		var d = new StaticText();
		d.init(this);
		return d;
	}
	var TextField = function() {
		InteractiveObject.call(this);
		this.text_bounds = null;
		this.__backgroundColor = [255, 255, 255, 1];
		this.__border_color = [0, 0, 0, 1];
		this.__text = "";
		this.___object = null;
		this.___font = null;
		this._variable = null;
		this.avm1_text_field_bindings = [];
		this.textColor = [0, 0, 0, 1];
		this.fontHeight = 0;
		this.bound_display_object = null;
		this.textSpans = null;
		this.staticData = null;
		this.FIRING_VARIABLE_BINDING = false;
		this.HAS_BACKGROUND = false;
		this.CONDENSE_WHITE = false;
		this.ALWAYS_SHOW_SELECTION = false;
		this.READ_ONLY = false;
		this.PASSWORD = false;
		this.MULTILINE = false;
		this.WORD_WRAP = false;
		this.USE_OUTLINES = false;
		this.HTML = false;
		this.WAS_STATIC = false;
		this.BORDER = false;
		this.NO_SELECT = false;
	}
	TextField.prototype = Object.create(InteractiveObject.prototype);
	TextField.prototype.constructor = TextField;
	TextField.prototype.displayType = "TextField";
	TextField.prototype._debug_colorDisplayType = [255, 255, 0, 1];
	TextField.fromSwfTag = function(movie, tag) {
		var r = new EditTextStatic(movie);
		r.data = tag;
		r.characterId = tag.id;
		return r;
	}
	TextField.prototype.getMovie = function() {
		return this.staticData.movie;
	}
	TextField.prototype.getId = function() {
		return this.staticData.characterId;
	}
	TextField.prototype.isHTML = function() {
		return this.HTML;
	}
	TextField.prototype.isEffectivelyHTML = function() {
		return this.HTML;
	}
	TextField.prototype.htmlText = function() {
		if (this.isEffectivelyHTML()) {
			return "";
		} else {
			return this.__text;
		}
	}
	TextField.prototype.setIsHTML = function(b) {
		this.HTML = b;
	}
	TextField.prototype.parseHTML = function(text) {
		var defaultFormat = this.textSpans.defaultFormat.clone();
		this.textSpans = FormatSpans.fromHTML(text, defaultFormat, null, false, false, this.staticData.movie);
		return null;
	}
	TextField.prototype.init = function(sd) {
		this.staticData = sd;
		var textInfo = sd.data;
		this.text_bounds = Rectangle.fromObject(textInfo.bounds);
		if (textInfo.border) this.HAS_BACKGROUND = true;
		var movie = this.getMovie();
		var defaultFormat = TextFormat.fromSwfTag(movie, textInfo);
		var encoding = movie.encoding;
		var text = ("initialText" in textInfo) ? encoding.decode(textInfo.initialText) : "";
		var text_spans = textInfo.HTML ? FormatSpans.fromHTML(text, defaultFormat, null, textInfo.isMultiline, false, movie.version) : FormatSpans.fromText(text, defaultFormat);
		var resultText = text_spans.text;
		this.textSpans = text_spans;
		this.__text = resultText;
		this.HAS_BACKGROUND = !!textInfo.border;

		if ("fontID" in textInfo) {
			var r = movie.library.getFont(textInfo.fontID);
			//console.log(r);
			this.___font = r;
		}

		if (textInfo.HTML) {
			this.HTML = false;
		} else {
			this.HTML = false;
		}
		if ("fontHeight" in textInfo) this.fontHeight = textInfo.fontHeight;
		if ("textColor" in textInfo) this.textColor = textInfo.textColor.slice(0);
		this._variable = this.getMovie().encoding.decode(textInfo.variableName);
	}
	TextField.prototype.selfBounds = function() {
		return this.text_bounds;
	}
	TextField.prototype.getObject = function() {
		return this.___object ? Avm1Value.fromObject(this.___object) : Avm1Value.INSTANCE.Undefined;
	}
	TextField.prototype.postInstantiation = function(context, initObject, instantiatedBy, runFrame) {
		this.setDefaultInstanceName(context);
		context.avm1.addExecuteList(this);
		if (!this.getMovie().isActionScript3()) {
			this.constructAsAvm1Object(context, runFrame);
		}
	}
	TextField.prototype.tryBindTextFieldVariable = function(activation, set_initial_value) {
		var variable_path = this._variable;
		if (!variable_path) return true;
		var parent = this.getAvm1Parent();
		while(parent instanceof Avm1Button) {
			var p = parent.getAvm1Parent();
			if (!p) return false;
			parent = p;
		}
		var bound = false;
		var _this = this;
		activation.runWithChildFrameForDisplayObject("[Text Field Binding]", parent, this.getMovie().version, function(activation) {
			var r = activation.resolveVariablePath(parent, variable_path);
			if (r) {
				var object = r[0];
				var property = r[1];
				if (set_initial_value) {
					if (object.has_property(activation, property)) {
						var value = object.get(property, activation);
						_this.set_html_text(value.coerceToString(activation), activation.context);
					} else {
						var text = _this.__text;
						if (text) {
							object.set(property, Avm1Value.fromString(text), activation);
						}
					}
				}
				var dobj = object.asDisplayObject();
				if (dobj) {
					_this.bound_display_object = dobj;
					var binding = new Avm1TextFieldBinding(_this, property);
					binding.registerBinding(dobj);
					bound = true;
				}
			}
		});
		return bound;
	}
	TextField.prototype.set_html_text = function(text, context) {
		if (text == this.htmlText()) return;
		if (this.isEffectivelyHTML()) {
			this.relayout(context);
		} else {
			this.setText(text, context);
		}
	}
	TextField.prototype.relayout = function(context) {
		this.invalidateCachedBitmap();
	}
	TextField.prototype.constructAsAvm1Object = function(context, runFrame) {
		if (!this.___object) {
			var scriptObject = Avm1Object.createNewWithNative(context.avm1.prototypes.text_field, new Avm1NativeObject(Avm1NativeObject.EditText, this));
			this.___object = scriptObject;
		}
		var _this = this;
		Avm1.runWithStackFrameForDisplayObject(this, context, function(activation) {
			if (!_this.tryBindTextFieldVariable(activation, true)) {
				activation.context.unbound_text_fields.push(_this);
			}
			Avm1TextFieldBinding.bindVariables(activation);
		});
		if (runFrame) {
			this.runFrameAvm1(context);
		}
	}
	TextField.prototype.getAvm1TextFieldBindings = function() {
		if (this.___object) {
			return this.avm1_text_field_bindings;
		}
		return null;
	}
	TextField.prototype.clearBoundDisplayObject = function(context) {
		this.bound_display_object = null;
	}
	TextField.prototype.avm1Unload = function(context) {
		var node = this.maskee;
		if (node) {
			node.setMasker(null, true);
		} else {
			node = this.masker;
			if (node) {
				node.setMaskee(null, true);
			}
		}
		if (this.bound_display_object) {
			Avm1TextFieldBinding.clearBinding(this.bound_display_object, context);
			this.bound_display_object = null;
		}
		Avm1TextFieldBinding.unregisterBindings(this, context);
		if (this._variable) {
			var unbound_text_fields = context.unbound_text_fields;
			for (var i = 0; i < unbound_text_fields.length; ) {
				var tf = unbound_text_fields[i];
				if (tf !== this) {
					i++;
				} else {
					unbound_text_fields.splice(i, 1);
				}
			}
		}
		if (this.cache) this.cache.clear();
		this.AVM1_REMOVED = true;
	}
	TextField.prototype.runFrameAvm1 = function(context) {}
	TextField.prototype.renderSelf = function(context) {
		var font = context.library.deviceFont;
		if (this.___font) {
			if (this.___font.hasLayout) {
				font = this.___font;
			}
		}
		var sc = this.fontHeight / font.scale;
		var xMin = this.text_bounds.xMin;
		var yMin = this.text_bounds.yMin;
		if (this.HAS_BACKGROUND) {
			var r = new Matrix(this.text_bounds.width / 20, 0, 0, this.text_bounds.height / 20, xMin, yMin);
			context.transformStack.stackPush(new Transform(r, [1, 1, 1, 1, 0, 0, 0, 0]));
			context.commands.drawRect(this.__backgroundColor, context.transformStack.getTransform().matrix);
			context.transformStack.stackPop();	
		}
		var lists = this.__text.split("\r");
		var x = xMin;
		var y = yMin;
		for (var i = 0; i < lists.length; i++) {
			y += (font.ascent * sc);
			var element = lists[i];
			this.renderText(context, font, element, x, y);
		}
	}
	TextField.prototype.getText = function() {
		return this.__text;
	}
	TextField.prototype.setText = function(text, context) {
		this.__text = text;
		this.relayout(context);
	}
	TextField.prototype.propagateTextBinding = function(activation) {}
	TextField.prototype.renderText = function(context, font, text, x, y) {
		var renderer = context.renderer;
		var rrr = 0;
		var sc = this.fontHeight / font.scale;
		context.transformStack.stackPush(new Transform(Matrix.IDENTITY, [this.textColor[0] / 255, this.textColor[1] / 255, this.textColor[2] / 255, this.textColor[3], 0, 0, 0, 0]));
		for (var i = 0; i < text.length; i++) {
			var glyph = font.getGlyphForChar(text.charCodeAt(i));
			if (glyph) {
				var shapeHandle = glyph.getShapeHandle(renderer);
				context.transformStack.stackPush(new Transform(new Matrix(sc, 0, 0, sc, x + rrr, y), [1, 1, 1, 1, 0, 0, 0, 0]));
				context.commands.renderShape(shapeHandle, context.transformStack.getTransform());
				context.transformStack.stackPop();
				rrr += glyph.advance * sc;
			}
		}
		context.transformStack.stackPop();
	}
	var EditTextStatic = function(movie) {
		this.movie = movie;
		this.data = null;
		this.characterId = 0;
		this.textFormat = null;
		this.settings = null;
	}
	EditTextStatic.prototype.instantiate = function() {
		var t = new TextField();
		t.init(this);
		return t;
	}
	EditTextStatic.prototype.setRenderSettings = function(settings) {
		this.settings = TextRenderSettings.fromSwfTag(settings);
	}
	var VideoDisplay = function() {
		DisplayObject.call(this);
		this.__size = [0, 0];
		this.isInstantiated = false;
		this._result = 0;
		this.isSmoothed = false;
		this.keyframes = [];
		this.decoded_frame = null;
		this._debug_decoder_time = 0;
	}
	VideoDisplay.prototype = Object.create(DisplayObject.prototype);
	VideoDisplay.prototype.constructor = VideoDisplay;
	VideoDisplay.prototype.displayType = "Video";
	VideoDisplay.prototype._debug_colorDisplayType = [255, 100, 100, 1];
	VideoDisplay.fromSwfTag = function(movie, tag) {
		return new DefineVideoData(movie, tag);
	}
	VideoDisplay.prototype.getId = function() {
		return this.staticData.characterId;
	}
	VideoDisplay.prototype.getMovie = function() {
		return this.staticData.movie;
	}
	VideoDisplay.prototype.postInstantiation = function(context, initObject, instantiatedBy, runFrame) {
		context.avm1.addExecuteList(this);
		var streamdef = this.staticData.data;
		this.isSmoothed = !!streamdef.isSmoothed;
		var stream = context.video.registerVideoStream(streamdef.numFrames, [streamdef.width, streamdef.height], streamdef.codec, streamdef.codec);
		var keyframes = [];
		if (!stream.decoder) return;
		for (var i = 0; i < this.staticData.frames.length; i++) {
			var frame = this.staticData.frames[i];
			if (!frame) continue;
			var dep = context.video.preloadVideoStreamFrame(stream, {
				codec: streamdef.codec,
				data: frame,
				frameId: i
			});
			keyframes[i] = !!dep;
		}
		this.keyframes = keyframes;
		var starting_seek = (this.isInstantiated ? 0 : this._result);
		this.isInstantiated = true;
		this._result = stream;
		this.seek(context, starting_seek);
	}
	VideoDisplay.prototype.selfBounds = function() {
		return new Rectangle(0, this.__size[0] * 20, 0, this.__size[1] * 20);
	}
	VideoDisplay.prototype.setRatio = function(ratio) {
		this.seek(ratio);
	}
	VideoDisplay.prototype.seek = function(context, frame_id) {
		this.invalidateCachedBitmap();
		if (!this.isInstantiated) {
			this._result = frame_id;
			return;
		}
		var last_frame = this.decoded_frame ? this.decoded_frame[0] : -1;
		if (last_frame == frame_id) return;
		var is_ordered_seek = (frame_id == 0) || frame_id == (last_frame + 1);
		var sweep_from = frame_id;
		if (!is_ordered_seek) {
			var keyframes = this.keyframes;
			var prev_keyframe_id = 0;
			for (var i = frame_id; i >= 0; i--) {
				if (i in keyframes) {
					var isKeyframe = keyframes[i];
					if (!isKeyframe) {
						prev_keyframe_id = i;
						break;
					}
				}
			}
			if (last_frame !== null) {
				if (frame_id > last_frame) {
					sweep_from = Math.max(prev_keyframe_id, last_frame + 1);
				} else {
					sweep_from = prev_keyframe_id;
				}
			} else {
				sweep_from = prev_keyframe_id;
			}
		}
		var fr = sweep_from;
		while (fr <= frame_id) {
			this.seek_internal(context, fr);
			fr++;
		}
	}
	VideoDisplay.prototype.seek_internal = function(context, frameId) {
		if (!this.isInstantiated) return;
		var stream = this._result;
		var res;
		var frame = this.staticData.frames[frameId];
		if (frame) {
			var encframe = {
				codec: this.staticData.data.codec,
				data: frame,
				frameId,
			};
			try {
				var _ = Date.now();
				res = context.video.decodeVideoStreamFrame(stream, encframe, context.renderer);
				this._debug_decoder_time = Date.now() - _;
			} catch(e) {
				log.error("Got error when seeking to video frame " + frameId + ":", e);
				return;
			}
		} else {
			if (!this.decoded_frame) return;
			res = this.decoded_frame[1];
		}
		this.decoded_frame = [frameId, res];
	}
	VideoDisplay.prototype.getDebugVideoText = function() {
		if (this.isInstantiated) {
			return this.staticData.data.codec + ":" + this.getId() + " " + this._debug_decoder_time + "ms";
		} else {
			return "";
		}
	}
	VideoDisplay.prototype.renderSelf = function(context) {
		if (this.decoded_frame && this.decoded_frame[1]) {
			context.commands.renderBitmap(this.decoded_frame[1], context.transformStack.getTransform(), this.isSmoothed, PixelSnapping.INSTANCE.Never);	
		}
	}
	var DefineVideoData = function(movie, data) {
		this.movie = movie;
		this.characterId = data.id;
		this.width = data.width;
		this.height = data.height;
		this.data = data;
		this.frames = [];
	}
	DefineVideoData.prototype.instantiate = function() {
		var v = new VideoDisplay();
		v.__size[0] = this.width;
		v.__size[1] = this.height;
		v.staticData = this;
		return v;
	}
	DefineVideoData.prototype.preloadSwfFrame = function(tag) {
		this.frames[tag.frameNum] = tag.videoData;
	}
	var BitmapGraphic = function(id, bitmap, swf) {
		DisplayObject.call(this);
		this.movie = swf;
		this.__id = id;
		this.staticBitmap = bitmap;
		this.pixelSnapping = new PixelSnapping(PixelSnapping.Auto);
	}
	BitmapGraphic.prototype = Object.create(DisplayObject.prototype);
	BitmapGraphic.prototype.constructor = BitmapGraphic;
	BitmapGraphic.prototype.displayType = "Bitmap";
	BitmapGraphic.prototype._debug_colorDisplayType = [255, 155, 0, 1];
	BitmapGraphic.createNew = function(id, bitmap, swf) {
		return new BitmapGraphic(id, bitmap, swf);
	}
	BitmapGraphic.prototype.getId = function() {
		return this.__id;
	}
	BitmapGraphic.prototype.getMovie = function() {
		return this.movie;
	}
	BitmapGraphic.prototype.postInstantiation = function(context, initObject, instantiatedBy, runFrame) {
		context.avm1.addExecuteList(this);
	}
	BitmapGraphic.prototype.selfBounds = function() {
		return new Rectangle(0, this.staticBitmap.width * 20, 0, this.staticBitmap.height * 20);
	}
	BitmapGraphic.prototype.renderSelf = function(context) {
		if (!this.handle) {
			this.handle = context.renderer.registerBitmap(this.staticBitmap);
		}
		context.commands.renderBitmap(this.handle, context.transformStack.getTransform(), false, this.pixelSnapping);
	}
	var typeButton = {
		"up": "buttonStateUp",
		"over": "buttonStateOver",
		"down": "buttonStateDown",
	}
	var typeButtonCxform = {
		"up": 0,
		"over": 1,
		"down": 2,
	}
	var Avm1Button = function() {
		DisplayObjectContainer.call(this);
		this.staticData = null;
		this.__initialized = false;
		this._records = null;
		this._recordSounds = null;
		this._actions = [];
		this._recordColorTransforms = null;
		this._state = "";
		this.text_field_bindings = [];
		this.__clickflag = false;
		this.___appendclick = false;
		this.___object = null;
		this.___hitArea = [];
	}
	Avm1Button.prototype = Object.create(DisplayObjectContainer.prototype);
	Avm1Button.prototype.constructor = Avm1Button;
	Avm1Button.prototype.displayType = "Buttom";
	Avm1Button.prototype._debug_colorDisplayType = [0, 255, 0, 1];
	Avm1Button.fromSwfTag = function(movie, tag) {
		return new ButtonData(movie, tag);
	}
	Avm1Button.prototype.getMovie = function() {
		return this.staticData.movie;
	}
	Avm1Button.prototype.getId = function() {
		return this.staticData.characterId;
	}
	Avm1Button.prototype.init = function(i) {
		this.staticData = i;
		this._records = i.data.records;
		this._soundInfo = i.soundInfo;
		this._actions = i.actions;
		this._recordColorTransforms = i.colorTransforms;
	}
	Avm1Button.prototype.getObject = function() {
		return this.___object ? Avm1Value.fromObject(this.___object) : Avm1Value.INSTANCE.Undefined;
	}
	Avm1Button.prototype.postInstantiation = function(context, initObject, instantiatedBy, runFrame) {
		this.setDefaultInstanceName(context);
		context.avm1.addExecuteList(this);
		if (!this.getMovie().isActionScript3()) {
			if (!this.___object) {
				var scriptObject = Avm1Object.createNewWithNative(context.avm1.prototypes.button, new Avm1NativeObject(Avm1NativeObject.Button, this));
				this.___object = scriptObject;
			}	
		}
	}
	Avm1Button.prototype.setState = function(context, state) {
		var movie = this.getMovie();
		this._state = state;
		var removedDepths = [];
		var cs = this.iterRenderList();
		for (var f = 0; f < cs.length; f++) {
			var jdf = cs[f];
			var de = jdf.getDepth();
			removedDepths[de] = jdf;
		}
		var children = [];
		for (var i = 0; i < this._records.length; i++) {
			var record = this._records[i];
			if (record[typeButton[state]]) {
				removedDepths[record.depth] = null;
				var child = null;
				var child1 = this.childByDepth(record.depth);
				if (child1) {
					if (child1.getId() == record.characterId) {
						child = child1;
					}
				}
				if (!child) {
					child = movie.library.instantiateById(record.characterId);
					child.setParent(context, this);
					child.setDepth(record.depth);
					children.push([record.depth, child]);
				}
				child.applyMatrix(Matrix.fromArray(record.matrix));
				if ("colorTransform" in record) {
					child.applyColorTransform(record.colorTransform);
				} else {
					child.applyColorTransform([1, 1, 1, 1, 0, 0, 0, 0]);
				}
				if ("blendMode" in record) {
					child.setBlendMode(record.blendMode);
				} else {
					child.setBlendMode(0);
				}
				if ("filters" in record) {
					var filters = record.filters;
					var result = [];
					for (var j = 0; j < filters.length; j++) {
						var _ = Filter.from(filters[j]);
						if (_) result.push(_);
					}
					child.setFilters(result);
				} else {
					child.setFilters([]);
				}
			}
		}
		for (var k = 0; k < removedDepths.length; k++) {
			var d = removedDepths[k];
			if (d) {
				var child = this.childByDepth(k);
				if (child) {
					this.removeChild(context, child);
				}
			}
		}
		for (var o = 0; o < children.length; o++) {
			var c = children[o];
			var depth = c[0];
			var lastC = this.childByDepth(depth);
			if (lastC) {
				this.removeChild(context, lastC);
			}
			var child = c[1];
			child.postInstantiation(context, null, Instantiator.Movie, false);
			child.runFrameAvm1(context);
			this.replaceAtDepth(context, child, depth);
		}
		if (this._recordColorTransforms) {
			var g = this._recordColorTransforms[typeButtonCxform[state]];
			if (g) {
				this.applyColorTransform(g);
			}
		}
		this.invalidateCachedBitmap();
	}
	Avm1Button.prototype.playSound = function(context, sound, soundInfo) {
		switch (soundInfo.event) {
			case "event":
				context.startSound(sound, soundInfo, this, null);
				break;
			case "start":
				if (!context.isSoundPlayingWithHandle(sound)) {
					context.startSound(sound, soundInfo, this, null);
				}
				break;
			case "stop":
				context.stopSoundsWithHandle(sound);
				break;
		}
	}
	Avm1Button.prototype.runFrameAvm1 = function(context) {
		var movie = this.getMovie();
		if (!this.__initialized) {
			var new_children = [];
			this.__initialized = true;
			this.setState(context, "up");
			for (var i = 0; i < this._records.length; i++) {
				var record = this._records[i];
				if (record.buttonStateHitTest) {
					var child = movie.library.instantiateById(record.characterId);
					if (child) {
						child.applyMatrix(Matrix.fromArray(record.matrix));
						child.setParent(context, this);
						child.setDepth(record.depth);
						new_children.push([child, record.depth]);
					} else {
						log.error("Button ID: " + this.getId() + " could not instantiate child ID: " + record.characterId);
					}
				}
			}
			for (var o = 0; o < new_children.length; o++) {
				var c = new_children[o];
				var child = c[0];
				var depth = c[1];
				child.postInstantiation(context, null, Instantiator.Avm1, false);
				this.___hitArea[depth] = child;
			}
		}
	}
	Avm1Button.prototype.avm1Unload = function(context) {
		if (this.isContainer()) {
			var children = this.iterRenderList();
			for (var i = 0; i < children.length; i++) {
				var child = children[i];
				child.avm1Unload(context);
			}
		}
		var node = this.maskee;
		if (node) {
			node.setMasker(null, true);
		} else {
			node = this.masker;
			if (node) {
				node.setMaskee(null, true);
			}
		}
		if (this.cache) this.cache.clear();
		this.AVM1_REMOVED = true;
	}
	Avm1Button.prototype.getAvm1TextFieldBindings = function() {
		return this.text_field_bindings;
	}
	Avm1Button.prototype.renderSelf = function(context) {
		this.renderChildren(context);
	}
	Avm1Button.prototype.filterClipEvent = function(context, event) {
		if (!this.VISIBLE && this._state == "up") {
			return false;
		}
		if (event.type == ClipEvent.KeyPress) {
			var parent = this.getParent();
			if (parent) {
				if (parent instanceof Avm1Button) {
					return false;
				}
			}
		}
		return true;
	}
	Avm1Button.prototype.getBooleanProperty = function(name, d, context) {
		var object = this.___object;
		if (object) {
			var activation = Avm1Activation.fromNothing(context, Avm1ActivationIdentifier.root("[AVM1 Boolean Property]"), this.getAvm1Root());
			var value = object.get(name, activation);
			switch(value.a) {
				case Avm1Value.Undefined:
					return d;
				default:
					return value.asBool(activation.swfVersion);
			}
		} else {
			return false;
		}
	}
	Avm1Button.prototype.enabled = function(context) {
		if (this.getMovie().isActionScript3()) return true;
		return this.getBooleanProperty("enabled", true, context);
	}
	Avm1Button.prototype.eventDispatch = function(context, event) {
		var is_enabled = this.enabled(context);
		var movie = this.getMovie();
		var new_state, condition, sound;
		switch (event.type) {
			case ClipEvent.Press:
				new_state = "down";
				condition = "condOverUpToOverDown";
				sound = this._soundInfo.down;
				break;
			case ClipEvent.Release:
				new_state = "over";
				condition = "condOverDownToOverUp";
				sound = this._soundInfo.hit;
				break;
			case ClipEvent.ReleaseOutside:
				new_state = "up";
				condition = "condOutDownToIdle";
				sound = this._soundInfo.up;
				break;
			case ClipEvent.RollOut:
				new_state = "up";
				condition = "condOverUpToIdle";
				sound = this._soundInfo.up;
				break;
			case ClipEvent.RollOver:
				new_state = "over";
				condition = "condIdleToOverUp";
				sound = this._soundInfo.over;
				break;
			default:
				return false;
		}
		var _update_state = null, _new_state = null;
		if (is_enabled) {
			if (condition) {
				this.runActions(context, condition);
			}
			if (sound) {
				var _sound = movie.library.getSound(sound.id);
				this.playSound(context, _sound, sound.info);
			}
			if (this.shouldFireEventHandlers(context, event)) {
				var methodName = event.methodName;
				if (methodName) {
					context.actionQueue.queueAction(this, {
						type: "method",
						name: methodName,
						object: this.___object,
						args: [],
					}, event.type == ClipEvent.Unload);
				}
			}
			_update_state = this._state != new_state;
			_new_state = new_state;	
		} else {
			_update_state = new_state != "over";
			_new_state = "up";	
		}
		if (_update_state) {
			this.setState(context, _new_state);
		}
		return false;
	}
	Avm1Button.prototype.runActions = function(context, condition) {
		var movie = this.getMovie();
		var handled = false;
		for (var i = 0; i < this._actions.length; i++) {
			var g = this._actions[i];
			if (g[condition]) {
				context.actionQueue.queueAction(this.getParent(), {
					type: "normal",
					bytecode: SwfSlice.from(movie).toUnboundedSubslice(g.actionScript)
				}, false);
				handled = true;
			}
		}
		return handled;
	}
	Avm1Button.prototype.mousePickAvm1 = function(context, point, _) {
		if (this.getVisible() && this._mouseEnabled) {
			for (var i = 0; i < this.___hitArea.length; i++) {
				var child = this.___hitArea[i];
				if (child) {
					if (child.hitTestShape(context, point, _)) {
						return this;
					}
				}
			}	
		}
	}
	var ButtonData = function(movie, data) {
		this.movie = movie;
		this.data = data;
		this.characterId = data.id;
		this.actions = data.actions || [];
		this.soundInfo = {};
		this.colorTransforms = [];
	}
	ButtonData.prototype.instantiate = function() {
		var b = new Avm1Button();
		b.init(this);
		return b;
	}
	ButtonData.prototype.setSounds = function(tag) {
		if (tag.buttonStateUpSoundInfo) {
			this.soundInfo.up = {
				id: tag.buttonStateUpSoundId,
				info: tag.buttonStateUpSoundInfo
			};
		}
		if (tag.buttonStateOverSoundInfo) {
			this.soundInfo.over = {
				id: tag.buttonStateOverSoundId,
				info: tag.buttonStateOverSoundInfo
			};
		}
		if (tag.buttonStateDownSoundInfo) {
			this.soundInfo.down = {
				id: tag.buttonStateDownSoundId,
				info: tag.buttonStateDownSoundInfo
			};
		}
		if (tag.buttonStateHitTestSoundInfo) {
			this.soundInfo.hit = {
				id: tag.buttonStateHitTestSoundId,
				info: tag.buttonStateHitTestSoundInfo
			};
		}
	}
	ButtonData.prototype.setColorTransforms = function(tag) {
		var colorTransforms = tag.colorTransforms;
		if (colorTransforms) {
			this.colorTransforms = colorTransforms;
		}
	}
	function objectCopy(src) {
		var obj = {};
		for (var name in src) {
			obj[name] = src[name];
		}
		return obj;
	}
	function removeIdArray(array, i) {
		if (array.length) {
			if (i >= array.length) {
				array.pop();
			} else {
				array.splice(i, 1);
			}
		}
	}
	var GotoPlaceObject = function(frame, place, isRewind, index) {
		this.frame = frame;
		this.place = place;
		this.isRewind = isRewind;
		this.index = index;
		this.placeData = objectCopy(place);
		if (isRewind) {
			if (("characterId" in place) && !place.isMove) {
				if (!("matrix" in place)) {
					this.placeData.matrix = [1, 0, 0, 1, 0, 0];
				}
				if (!("colorTransform" in place)) {
					this.placeData.colorTransform = [1, 1, 1, 1, 0, 0, 0, 0];
				}
				if (!("blendMode" in place)) {
					this.placeData.blendMode = 1;
				}
				if (!("filters" in place)) {
					this.placeData.filters = [];
				}
				/*if ("visible" in place) {
					this.placeData.visible = place.visible;
				}*/
				if (!("ratio" in place)) {
					this.placeData.ratio = 0;
				}
				if (!("backgroundColor" in place)) {
					//this.placeData.backgroundColor = [0, 0, 0, 0];
				}   
			}
		}
	}
	GotoPlaceObject.prototype.getDepth = function() {
		return this.placeData.depth;
	}
	GotoPlaceObject.prototype.merge = function(next) {
		var cur_place = this.placeData;
		var next_place = next.placeData;
		if (("characterId" in next_place)) {
			cur_place.characterId = next_place.characterId;
			cur_place.isMove = next_place.isMove;
			this.frame = next.frame;
		}
		if ("matrix" in next_place) {
			cur_place.matrix = next_place.matrix;
		}
		if ("colorTransform" in next_place) {
			cur_place.colorTransform = next_place.colorTransform;
		}
		if ("visible" in next_place) {
			cur_place.visible = next_place.visible;
		}
		if ("blendMode" in next_place) {
			cur_place.blendMode = next_place.blendMode;
		}
		if ("filters" in next_place) {
			cur_place.filters = next_place.filters;
		}
		if ("ratio" in next_place) {
			cur_place.ratio = next_place.ratio;
		}
		if ("backgroundColor" in next_place) {
			cur_place.backgroundColor = next_place.backgroundColor;
		}
	}
	var ClipEventHandler = function(events, keyCode, actionData) {
		this.events = events;
		this.keyCode = keyCode;
		this.actionData = actionData;
	}
	ClipEventHandler.fromActionAndMovie = function(other, movie) {
		var actionData = SwfSlice.from(movie).toUnboundedSubslice(other.actions);
		return new ClipEventHandler(other.eventFlags, null, actionData);
	}
	ClipEventHandler.prototype.isButtonEventFrags = function() {
		var events = this.events;
		return events.dragOut || events.dragOver ||  events.keyPress ||  events.press ||  events.rollOut ||  events.rollOver ||  events.release ||  events.releaseOutside;
	}
	ClipEventHandler.prototype.contains = function(event) {
		switch(event.type) {
			case ClipEvent.Load: return !!this.events.load;
			case ClipEvent.EnterFrame: return !!this.events.enterFrame;
			case ClipEvent.Unload: return !!this.events.unload;
			case ClipEvent.Press: return !!this.events.press;
			case ClipEvent.Release: return !!this.events.release;
			case ClipEvent.KeyDown: return !!this.events.keyDown;
			case ClipEvent.KeyUp: return !!this.events.keyUp;
			default:
				return false;
		}
	}
	var QueuedTagAction = function(type, version) {
		this.type = type;
		this.version = version;
	}
	QueuedTagAction.Place = 1;
	QueuedTagAction.Remove = 2;
	var QueuedTag = function(tagType, tagStart) {
		this.tagType = tagType;
		this.tagStart = tagStart;
	}
	var QueuedTagList = function(type, data) {
		this.type = type;
		this.data = data;
	}
	QueuedTagList.None = 0;
	QueuedTagList.Add = 1;
	QueuedTagList.Remove = 2;
	QueuedTagList.RemoveThenAdd = 3;
	var MovieClip = function() {
		DisplayObjectContainer.call(this);
		this.staticData = null;
		this.currentFrame = 0;
		this.audioStream = null;
		this.tagStreamPos = 0;
		this.___object = null;
		this.clipEventHandlers = [];
		this.avm1_text_field_bindings = [];
		this.isPlaying = true;
		this.isLoop = true;
		this.INITIALIZED = false;
		this.PROGRAMMATICALLY_PLAYED = false;
		this.EXECUTING_AVM2_FRAME_SCRIPT = false;
		this.LOOP_QUEUED = false;
	}
	MovieClip.prototype = Object.create(DisplayObjectContainer.prototype);
	MovieClip.prototype.constructor = MovieClip;
	MovieClip.prototype.displayType = "MovieClip";
	MovieClip.prototype._debug_colorDisplayType = [255, 0, 0, 1];
	MovieClip.playerRootMovie = function(activation, movie) {
		var num_frames = movie.numFrames;
		var root = MovieClipStatic.withData(0, SwfSlice.from(movie), num_frames, null);
		var s = root.instantiate();
		s.setIsRoot(true);
		return s;
	}
	MovieClip.createNew = function(movie) {
		var mc = new MovieClip();
		mc.staticData = MovieClipStatic.empty(movie);
		mc.isPlaying = false;
		return mc;
	}
	MovieClip.prototype.getMovie = function() {
		return this.staticData.swf.movie;
	}
	MovieClip.prototype.getId = function() {
		return this.staticData.characterId;
	}
	MovieClip.prototype.getTotalFrames = function() {
		return this.staticData.totalframes;
	}
	MovieClip.prototype.getFramesloaded = function() {
		return this.staticData.preloadProgress.curPreloadFrame - 1;
	}
	MovieClip.prototype.postInstantiation = function(context, initObject, instantiatedBy, runFrame) {
		this.setDefaultInstanceName(context);
		context.avm1.addExecuteList(this);
		if (!this.getMovie().isActionScript3()) {
			this.constructAvm1ValueObject(context, initObject, instantiatedBy, runFrame);
		}
	}
	MovieClip.prototype.constructAvm1ValueObject = function(context, initObject, instantiatedBy, runFrame) {
		if (!this.___object) {
			var avm1_constructor = this.getRegisteredAvm1Constructor(context);
			if (avm1_constructor && (instantiatedBy == Instantiator.Avm1)) {
				var activation = Avm1Activation.fromNothing(context, Avm1ActivationIdentifier.root("[Construct]"), this);
				var prototype = avm1_constructor.get("prototype", activation).coerceToObject(activation);
				if (prototype) {
					var object = Avm1Object.createNewWithNative(prototype, new Avm1NativeObject(Avm1NativeObject.MovieClip, this));
					this.___object = object;
					if (runFrame) {
						this.runFrameAvm1(context);
					}
					avm1_constructor.constructOnExisting(activation, object, []);
				}
				return;
			}
			var object = Avm1Object.createNewWithNative(context.avm1.prototypes.movieclip, new Avm1NativeObject(Avm1NativeObject.MovieClip, this));
			this.___object = object;
			if (runFrame) {
				this.runFrameAvm1(context);
			}
			if (initObject) {
				var activation = Avm1Activation.fromNothing(context, Avm1ActivationIdentifier.root("[Init]"), this);
				var keys = initObject.getKeys(activation, false);
				for (var i = 0; i < keys.length; i++) {
					var key = keys[i];
					var value = initObject.get(key, activation);
					object.set(key, value, activation);
				}
			}
			var events = [];
			for (var i = 0; i < this.clipEventHandlers.length; i++) {
				var event_handler = this.clipEventHandlers[i];
				if (event_handler.events.initialize) {
					context.actionQueue.queueAction(this, {
						type: "initialize",
						bytecode: event_handler.actionData
					}, false);
				}
				if (event_handler.events.construct) {
					events.push(event_handler.actionData);
				}
			}
			context.actionQueue.queueAction(this, {
				type: "construct",
				constructor: avm1_constructor,
				events,
			}, false);
		} else if (runFrame) {
			this.runFrameAvm1(context);
		}
		Avm1.runWithStackFrameForDisplayObject(this, context, Avm1TextFieldBinding.bindVariables);
	}
	MovieClip.prototype.getRegisteredAvm1Constructor = function(context) {
		var symbol_name = this.staticData.exportedName;
		if (symbol_name != null) {
			return context.avm1.getRegisteredConstructor(this.getMovie().version, symbol_name);
		}
		return null;
	}
	MovieClip.prototype.hasUnloadHandler = function() {
		var agdg = this.clipEventHandlers;
		for (var i = 0; i < agdg.length; i++) {
			var e = agdg[i];
			if (e.events.unload) {
				return true;
			}
		}
		return false;
	}
	MovieClip.prototype.preload = function(context, _) {
		return this.staticData.preload(context, _);
	}
	MovieClip.prototype.actionsOnFrame = function(_context, frame) {
		var actions = [];
		if ((frame > 0) && (frame <= this.getTotalBytes())) {
			var cur_frame = 1;
			var reader = this.staticData.swf.readFrom(0);
			while(cur_frame <= frame) {
				var tagCallback = function(reader, tagCode, tagLen) {
					switch (tagCode) {
						case 12:
							if (cur_frame == frame) {
								var slice = this.staticData.swf.resizeToReader(reader, tagLen);
								if (!slice.isEmpty()) {
									actions.push(slice);	
								}
							}
							break;
						case 1:
							cur_frame++;
							return "exit";
					}
					return "continue";
				};
				decode_tags(reader, tagCallback.bind(this));
			}
		}
		return actions;
	}
	MovieClip.prototype.play = function(context) {
		if (this.getFramesloaded() > 1) {
			this.isPlaying = true;
		}
	}
	MovieClip.prototype.stop = function(context) {
		this.isPlaying = false;
		this.stopAudioStream(context);
	}
	MovieClip.prototype.eventDispatch = function(context, event) {
		var frame_name;
		switch(event.type) {
			case ClipEvent.RollOut:
			case ClipEvent.ReleaseOutside:
				frame_name = "_up";
				break;
			case ClipEvent.RollOver:
			case ClipEvent.Release:
			case ClipEvent.DragOut:
				frame_name = "_over";
				break;
			case ClipEvent.Press:
			case ClipEvent.DragOver:
				frame_name = "_down";
				break;
		}
		if (frame_name) {
			var frame_number = this.frameLabelToNumber(frame_name, context);
			if (frame_number != null) {
				if (this.isButtonMode(context)) {
					this.gotoFrame(context, frame_number, true);
				}
			}
		}
		var object = this.___object;
		var handled = false;
		if (object) {
			var swf_version = this.getMovie().version;
			if (swf_version >= 5) {
				var clipEventHandlers = this.clipEventHandlers;
				for (var i = 0; i < clipEventHandlers.length; i++) {
					var c = clipEventHandlers[i];
					if (c.contains(event)) {
						context.actionQueue.queueAction(this, {
							type: "normal",
							bytecode: c.actionData,
						}, event.type == ClipEvent.Unload);
					}
				}
				if (this.shouldFireEventHandlers(context, event)) {
					var name = event.methodName;
					if (name) {
						context.actionQueue.queueAction(this, {
							type: "method",
							name,
							object,
							args: []
						}, event.type == ClipEvent.Unload);
					}	
				}
			}
		}
		return handled;
	}
	MovieClip.prototype.getAvm1TextFieldBindings = function() {
		if (this.___object) {
			return this.avm1_text_field_bindings;
		}
		return null;
	}
	MovieClip.prototype.determineNextFrame = function() {
		var totalframes = this.getFramesloaded();
		if (this.currentFrame < totalframes) {
			return "next";
		} else if (totalframes > 1) {
			return "first";
		} else {
			return "same";
		}
	}
	MovieClip.prototype.runIntervalFrame = function(context, runDisplayAction, runSounds, is_action_script_3) {
		var nextFrame = this.determineNextFrame();
		switch (nextFrame) {
			case "next":
				this.currentFrame++;
				if ((!this.isLoop) && (this.currentFrame == this.getFramesloaded())) {
					this.stop(context);
				}
				break;
			case "first":
				this.runGoto(context, 1, true);
				return;
			case "same":
				this.stop(context);
				break;
		}
		var initActions = this.staticData.initActions;
		var c = this.currentFrame;
		var a = initActions.get(c);
		if (a) {
			for (var index = 0; index < a.length; index++) {
				var b = a[index];
				context.avm1.runStackFrameForInitAction(this, b, context);
			}
			initActions.delete(c);
		}
		var data = this.staticData.swf;
		var reader = data.readFrom(this.tagStreamPos);
		var tagCallback = function(reader, tagCode, tagLength) {
			switch (tagCode) {
				case 4:
					if (runDisplayAction) this.placeObject(context, reader, 1, tagLength);
					break;
				case 26:
					if (runDisplayAction) this.placeObject(context, reader, 2, tagLength);
					break;
				case 70:
					if (runDisplayAction) this.placeObject(context, reader, 3, tagLength);
					break;
				case 94:
					if (runDisplayAction) this.placeObject(context, reader, 4, tagLength);
					break;
				case 5:
					if (runDisplayAction) this.removeObject(context, reader, 1);
					break;
				case 28:
					if (runDisplayAction) this.removeObject(context, reader, 2);
					break;
				case 15:
				case 89:
					if (runSounds) this.startSound1(context, reader);
					break;
				case 19:
					if (runSounds) this.soundStreamBlock(context);
					break;
				case 12:
					this.doAction(context, reader, tagLength);
					break;
				case 9:
					this.setBackgroundColor(context, reader);
					break;
				case 1:
					return true;
			}
			return false;
		};
		decode_tags(reader, tagCallback.bind(this));
		this.tagStreamPos = reader.byteStream.byte_offset;
		if (this.audioStream) {
			if (!context.isSoundPlaying(this.audioStream)) {
				this.audioStream = null;
			}
		}
	}
	MovieClip.prototype.setBackgroundColor = function(context, reader) {
		context.stage.setBackgroundColor(reader.rgb());
	}
	MovieClip.prototype.runGoto = function(context, frame, isImplicit) {
		var frameBeforeRewind = this.currentFrame;
		this.setSkipNextEnterFrame(false);
		var gotoCommands = [];
		this.stopAudioStream(context);
		var isRewind = (frame <= this.currentFrame);
		if (isRewind) {
			this.tagStreamPos = 0;
			this.currentFrame = 0;
		}
		var fromFrame = this.currentFrame;
		if (isImplicit) {
			this.setLoopQueued();
		}
		var index = 0;
		var clamped_frame = Math.min(frame, Math.max(this.getFramesloaded(), 0));
		var removed_frame_scripts = [];
		var data = this.staticData.swf;
		var reader = data.readFrom(this.tagStreamPos);
		var frame_pos = reader.byteStream.byte_offset;
		while (this.currentFrame < clamped_frame && !reader.isEmpty()) {
			this.currentFrame++;
			frame_pos = reader.byteStream.byte_offset;
			var tagCallback = function(reader, tagcode, tagLen) {
				switch (tagcode) {
					case 4:
						index++;
						this.gotoPlaceObject(reader, 1, tagLen, gotoCommands, isRewind, index);
						break;
					case 26:
						index++;
						this.gotoPlaceObject(reader, 2, tagLen, gotoCommands, isRewind, index);
						break;
					case 70:
						index++;
						this.gotoPlaceObject(reader, 3, tagLen, gotoCommands, isRewind, index);
						break;
					case 94:
						index++;
						this.gotoPlaceObject(reader, 4, tagLen, gotoCommands, isRewind, index);
						break;
					case 5:
						this.gotoRemoveObject(reader, 1, context, gotoCommands, isRewind, fromFrame, removed_frame_scripts);
						break;
					case 28:
						this.gotoRemoveObject(reader, 2, context, gotoCommands, isRewind, fromFrame, removed_frame_scripts);
						break;
					case 1:
						return true;
				}
				return false;
			};
			decode_tags(reader, tagCallback.bind(this));
		}
		var hitTargetFrame = this.currentFrame == frame;
		if (isRewind) {
			var children = this.iterRenderList().filter(function (clip) {
				return clip.getPlaceFrame() > frame;
			});
			for (var i = 0; i < children.length; i++) {
				var child = children[i];
				if (!child.PLACED_BY_SCRIPT) {
					this.removeChild(context, child);
				} else {
					this.removeChildFromDepthList(context, child);
				}
			}
		}
		var _this = this;
		var run_goto_command = function(params) {
			var child_entry = _this.childByDepth(params.getDepth());
			var place = params.placeData;
			if (child_entry) {
				if ("characterId" in place) {
					child_entry.replaceWith(context, place.characterId);
					child_entry.applyPlaceObject(context, place);
					child_entry.setPlaceFrame(params.frame);
				} else {
					if (place.isMove) {
						child_entry.applyPlaceObject(context, place);
					}
				}
			} else {
				if ("characterId" in place) {
					var clip = _this.instantiateChild(context, place.characterId, params.getDepth(), place);
					if (clip) {
						clip.setPlaceFrame(params.frame);
					}
				} else {
					log.error("Unexpected PlaceObject during goto", params);
					if (place.isMove) {
					}
				}
			}
		}
		gotoCommands.filter(function (params) {
			return params.frame < frame;
		}).forEach(function(goto) {
			run_goto_command(goto);
		});
		if (hitTargetFrame) {
			this.currentFrame--;
			this.tagStreamPos = frame_pos;
			this.runIntervalFrame(context, false, frame != frameBeforeRewind, this.getMovie().isActionScript3());
		} else {
			this.currentFrame = clamped_frame;
		}
		gotoCommands.filter(function (params) {
			return params.frame >= frame;
		}).forEach(function(goto) {
			run_goto_command(goto);
		});
	}
	MovieClip.prototype.gotoPlaceObject = function(reader, version, tagLen, gotoCommands, isRewind, index) {
		var place = reader.parsePlaceObject(version, tagLen);
		var depth = place.depth;
		var gotoPlace = new GotoPlaceObject(this.currentFrame, place, isRewind, index);
		var j = false;
		for (var i = 0; i < gotoCommands.length; i++) {
			var gc = gotoCommands[i];
			if (gc.getDepth() == depth) {
				gc.merge(gotoPlace);
				j = true;
				break;
			}
		}
		if (!j) {
			gotoCommands.push(gotoPlace);
		}
	}
	MovieClip.prototype.gotoRemoveObject = function(reader, version, context, gotoCommands, isRewind, fromFrame, removed_frame_scripts) {
		var place = reader.parseRemoveObject(version);
		var depth = place.depth;
		for (var i = 0; i < gotoCommands.length; i++) {
			var gc = gotoCommands[i];
			if (gc.getDepth() == depth) {
				removeIdArray(gotoCommands, i);
				break;
			}
		}
		if (!isRewind) {
			var to_frame = this.currentFrame;
			this.currentFrame = fromFrame;
			var child = this.childByDepth(depth);
			if (child) {
				if (!child.PLACED_BY_SCRIPT) {
					this.removeChild(context, child);
				} else {
					this.removeChildFromDepthList(context, child);
				}
				removed_frame_scripts.push(child);
			}
			this.currentFrame = to_frame;
		}
	}
	MovieClip.prototype.nextFrame = function(context) {
		if (this.currentFrame < this.getFramesloaded()) {
			this.gotoFrame(context, this.currentFrame + 1, true);
		}
	}
	MovieClip.prototype.prevFrame = function(context) {
		if (this.currentFrame > 1) {
			this.gotoFrame(context, this.currentFrame - 1, true);
		}
	}
	MovieClip.prototype.gotoFrame = function(context, frame, stop) {
		if (stop) {
			this.stop(context);
		} else {
			this.play(context);
		}
		var _frame = Math.max(frame, 1);
		if (_frame != this.currentFrame) {
			this.runGoto(context, _frame, false);
		}
	}
	MovieClip.prototype.setLoopQueued = function() {
		this.LOOP_QUEUED = true;
	}
	MovieClip.prototype.unsetLoopQueued = function() {
		this.LOOP_QUEUED = false;
	}
	MovieClip.prototype.frameLabelToNumber = function(label, context) {
		if (this.getMovie().isActionScript3()) {
			return this.staticData.frameLabelsMap.get(label);
		} else {
			return this.staticData.frameLabelsMap.get(label.toLowerCase());
		}
	}
	MovieClip.prototype.renderSelf = function(context) {
		this.renderChildren(context);
	}
	MovieClip.prototype.runFrameAvm1 = function(context) {
		var isLoadFrame = !this.INITIALIZED;
		if (isLoadFrame) {
			this.eventDispatch(context, new ClipEvent(ClipEvent.Load));
			this.INITIALIZED = true;
		} else {
			this.eventDispatch(context, new ClipEvent(ClipEvent.EnterFrame));
		}
		if (this.isPlaying) {
			this.runIntervalFrame(context, true, true, false);
		}
	}
	MovieClip.prototype.instantiateChild = function(context, id, depth, place) {
		var movie = this.getMovie();
		var child = movie.library.instantiateById(id);
		if (child) {
			var prevChild = this.replaceAtDepth(context, child, depth);
			child.INSTANTIATED_BY_TIMELINE = true;
			child.setDepth(depth);
			child.setParent(context, this);
			child.setPlaceFrame(this.currentFrame);
			child.applyPlaceObject(context, place);
			if ("name" in place) {
				var encoding = SwfEncoding.encodingForVersion(this.swfVersion());
				var name = encoding.decode(place.name);
				child.setName(name);
				child.HAS_EXPLICIT_NAME = true;
			}
			if ("clipDepth" in place) {
				child.clipDepth = place.clipDepth;
			}
			if ("clipActions" in place) {
				var actionRecords = place.clipActions.actionRecords;
				var clipActions = [];
				for (var i = 0; i < actionRecords.length; i++) {
					clipActions.push(ClipEventHandler.fromActionAndMovie(actionRecords[i], movie));
				}
				child.setClipEventHandlers(clipActions);
			}
			child.postInstantiation(context, null, Instantiator.Movie, false);
			child.enterFrame(context);
			child.runFrameAvm1(context);
		} else {
			log.error("Unable to instantiate display node id, reason being");
		}
		return child;
	}
	MovieClip.prototype.enterFrame = function(context) {
		var skipFrame = this.shouldSkipNextEnterFrame();
		var children = this.iterRenderList();
		for (var i = 0; i < children.length; i++) {
			var child = children[i];
			if (skipFrame) {
				child.setSkipNextEnterFrame(true);
			}
			child.enterFrame(context);
		}
		if (skipFrame) {
			this.setSkipNextEnterFrame(false);
			return;
		}
		if (this.getMovie().isActionScript3()) {
			//var is_playing = this.isPlaying;
			//if (is_playing) {
			//	this.runIntervalFrame(context, true, true, true);
			//}
		}
	}
	MovieClip.prototype.enabled = function(context) {
		if (!this.getMovie().isActionScript3()) {
			return this.getAvm1BooleanProperty("enabled", context, function() { return true; });
		} else {
			return true;
		}
	}
	MovieClip.prototype.filterClipEvent = function(context, event) {
		if (event.isButtonEvent()) {
			if (!this.VISIBLE && (event.type != ClipEvent.ReleaseOutside)) {
				return false;
			}
			if (!this.enabled(context) && (event.type != ClipEvent.KeyPress)) {
				return false;
			}
		}
		return true;
	}
	MovieClip.prototype.allowAsMask = function() {
		return !this.isEmpty();
	}
	MovieClip.prototype.setClipEventHandlers = function(clipActions) {
		this.clipEventHandlers = clipActions;
	}
	MovieClip.prototype.stopAudioStream = function(context) {
		if (this.audioStream) {
			context.stopSound(this.audioStream);
			this.audioStream = null;
		}
	}
	MovieClip.prototype.getObject = function() {
		return this.___object ? Avm1Value.fromObject(this.___object) : Avm1Value.INSTANCE.Undefined;
	}
	MovieClip.prototype.avm1Unload = function(context) {
		var children = this.iterRenderList();
		for (var i = 0; i < children.length; i++) {
			var child = children[i];
			child.avm1Unload(context);
		}
		var node = this.maskee;
		if (node) {
			node.setMasker(null, true);
		} else {
			node = this.masker;
			if (node) {
				node.setMaskee(null, true);
			}
		}
		Avm1TextFieldBinding.unregisterBindings(this, context);
		this.stopAudioStream(context);
		if (!this.AVM1_PENDING_REMOVAL) {
			this.eventDispatch(context, new ClipEvent(ClipEvent.Unload));
		}
		if (this.cache) this.cache.clear();
		this.AVM1_REMOVED = true;
	}
	MovieClip.prototype.getTotalBytes = function() {
		var movie = this.getMovie();
		if (this.isRoot()) {
			return movie.uncompressedLength;
		} else {
			return this.tagStreamLen();
		}
	}
	MovieClip.prototype.getLoadedBytes = function() {
		var progress_read = this.staticData.preloadProgress;
		if (progress_read.nextPreloadChunk === null) {
			return Math.max(this.getTotalBytes(), 0);
		} 
		var swf_header_size = Math.max(this.getTotalBytes(), 0) - this.tagStreamLen();
		return swf_header_size + progress_read.nextPreloadChunk;
	}
	MovieClip.prototype.tagStreamLen = function() {
		return this.staticData.swf.end - this.staticData.swf.start;
	}
	MovieClip.prototype.isButtonMode = function(context) {
		var object = this.___object;
		for (var i = 0; i < this.clipEventHandlers.length; i++) {
			var c = this.clipEventHandlers[i];
			if (c.isButtonEventFrags()) {
				return true;
			}
		}
		if (object) {
			var activation = Avm1Activation.fromNothing(context, Avm1ActivationIdentifier.root("[Mouse Pick]"), this.getAvm1Root());
			for (var i = 0; i < ClipEvent.BUTTON_EVENT_METHODS.length; i++) {
				var e = ClipEvent.BUTTON_EVENT_METHODS[i];
				if (object.has_property(activation, e)) {
					return true;
				}
			}
		}
		return false;
	}
	MovieClip.prototype.hitTestShape = function(context, point, options) {
		if (this.getVisible()) {
			var children = this.iterRenderList();
			for (var i = 0; i < children.length; i++) {
				var child = children[i];
				if (child) {
					if (child.hitTestShape(context, point, null)) {
						return true;
					}
				}
			}	
		}
		return false;
	}
	MovieClip.prototype.mousePickAvm1 = function(context, point, _) {
		if (this.getVisible()) {
			var is_button_mode = this.isButtonMode(context);
			if (is_button_mode) {
				if (this.hitTestShape(context, point, null)) {
					return this;
				}
			}
			var children = this.iterRenderList();
			var result = null;
			for (var i = children.length - 1; i >= 0; i--) {
				var child = children[i];
				if (!result) result = child.mousePickAvm1(context, point, _);
			}
			return result;
		}
		return null;
	}
	MovieClip.prototype.doAction = function(context, reader, tagLen) {
		if (this.getMovie().isActionScript3()) {
			log.warn("DoAction tag in AVM2 movie");
			return;	
		}
		var slice = this.staticData.swf.resizeToReader(reader, tagLen);
		if (!slice.isEmpty()) {
			context.actionQueue.queueAction(this, {
				type: "normal",
				bytecode: slice
			}, false);
		}
	}
	MovieClip.prototype.placeObject = function(context, reader, version, tagLen) {
		var place = reader.parsePlaceObject(version, tagLen);
		if ("characterId" in place) {
			if (place.isMove) {
				var child = this.childByDepth(place.depth);
				if (child) {
					child.replaceWith(context, place.characterId);
					child.applyPlaceObject(context, place);
					child.setPlaceFrame(this.currentFrame);
				}
			} else {
				this.instantiateChild(context, place.characterId, place.depth, place);
			}
		} else {
			if (place.isMove) {
				var child = this.childByDepth(place.depth);
				if (child) child.applyPlaceObject(context, place);
			}
		}
	}
	MovieClip.prototype.removeObject = function(context, reader, version) {
		var re = reader.parseRemoveObject(version);
		var child = this.childByDepth(re.depth);
		if (child) {
			if (!child.PLACED_BY_SCRIPT) {
				this.removeChild(context, child);
			} else {
				this.removeChildFromDepthList(context, child);
			}
		}
	}
	MovieClip.prototype.soundStreamBlock = function(context) {
		if (this.isPlaying) {
			var stream_info = this.staticData.audioStreamInfo;
			if (stream_info && !this.audioStream) {
				var slice = this.staticData.swf.toStartAndEnd(this.tagStreamPos, this.tagStreamLen());
				var audioStream = context.startStream(this, this.currentFrame, slice, stream_info);
				this.audioStream = audioStream;
			}
		}
	}
	MovieClip.prototype.startSound1 = function(context, reader) {
		var tag = reader.parseStartSound(1);
		var movie = this.getMovie();
		var sound = movie.library.getSound(tag.id);
		if (sound) {
			var soundInfo = tag.info;
			switch (soundInfo.event) {
				case "event":
					context.startSound(sound, soundInfo, this, null);
					break;
				case "start":
					if (!context.isSoundPlayingWithHandle(sound)) {
						context.startSound(sound, soundInfo, this, null);
					}
					break;
				case "stop":
					context.stopSoundsWithHandle(sound);
					break;
			}
		}
	}
	var PreloadProgress = function() {
		this.nextPreloadChunk = 0;
		this.curPreloadFrame = 1;
		this.curPreloadSymbol = null;
	}
	var MovieClipStatic = function() {
		this.totalframes = 0;
		this.characterId = 0;
		this.audioStreamInfo = null;
		this.exportedName = null;
		this.frameLabels = [];
		this.frameLabelsMap = new Map();
		this.initActions = new Map();
		this.preloadProgress = new PreloadProgress();
		this.symbolclassNames = new Map();
		this.abcTags = new Map();
	}
	MovieClipStatic.withData = function(id, swf, totalFrames, loader_info) {
		var mcs = new MovieClipStatic();
		mcs.characterId = id;
		mcs.swf = swf;
		mcs.totalframes = totalFrames;
		return mcs;
	}
	MovieClipStatic.empty = function(movie) {
		var s = MovieClipStatic.withData(0, SwfSlice.empty(movie), 1, null);
		s.preloadProgress.curPreloadFrame = s.totalframes + 1;
		return s;
	}
	MovieClipStatic.prototype.instantiate = function() {
		var clip = new MovieClip();
		clip.staticData = this;
		return clip;
	}
	MovieClipStatic.prototype.getMovie = function() {
		return this.swf.movie;
	}
	MovieClipStatic.prototype.preload = function(context, chunkLimit) {
		var preloadProgress = this.preloadProgress;
		var nextPreloadChunk = preloadProgress.nextPreloadChunk;
		var curPreloadSymbol = preloadProgress.curPreloadSymbol;
		if (nextPreloadChunk === null) return true;
		var g = this.swf.readFrom(nextPreloadChunk);
		if (curPreloadSymbol !== null) {
			var preloadSymbol = this.swf.movie.library.characterById(curPreloadSymbol).data;
			var sub_preload_done = preloadSymbol.preload(context, chunkLimit);
			if (sub_preload_done) {
				preloadProgress.curPreloadSymbol = null;
			}
		}
		var endTagFound = false;
		var subPreloadDone = preloadProgress.curPreloadSymbol === null;
		var tagCallback = function(reader, tagCode, tagLength) {
			switch (tagCode) {
				case 0:
					endTagFound = true;
					return true;
				case 1:
					preloadProgress.curPreloadFrame += 1;
					break;
				case 72:
				case 82:
					this.preloadBytecodeTag(tagCode, reader, context, preloadProgress.curPreloadFrame - 1, tagLength);
					break;
				case 76:
					this.preloadSymbolClass(reader, context, preloadProgress.curPreloadFrame - 1);
					break;
				case 43:
					this.frameLabel(reader, preloadProgress.curPreloadFrame, context, tagLength);
					break;
				case 18:
					this.soundStreamHead(reader, 1);
					break;
				case 45:
					this.soundStreamHead(reader, 2);
					break;
				//////// Define ////////
				case 10:
					this.defineFont(reader, 1, tagLength);
					break;
				case 48:
					this.defineFont(reader, 2, tagLength);
					break;
				case 75:
					this.defineFont(reader, 3, tagLength);
					break;
				case 20:
					this.defineLossless(reader, 1, tagLength);
					break;
				case 36:
					this.defineLossless(reader, 2, tagLength);
					break;
				case 6:
					this.defineBits(reader, 1, tagLength);
					break;
				case 21:
					this.defineBits(reader, 2, tagLength);
					break;
				case 35:
					this.defineBits(reader, 3, tagLength);
					break;
				case 90:
					this.defineBits(reader, 4, tagLength);
					break;
				case 14:
					this.defineSound(context, reader, tagLength);
					break;
				case 60:
					this.defineVideoStream(reader);
					break;
				case 2:
					this.defineShape(reader, 1);
					break;
				case 22:
					this.defineShape(reader, 2);
					break;
				case 32:
					this.defineShape(reader, 3);
					break;
				case 83:
					this.defineShape(reader, 4);
					break;
				case 46:
					this.defineMorphShape(reader, 1);
					break;
				case 84:
					this.defineMorphShape(reader, 2);
					break;
				case 11:
					this.defineText(reader, 1);
					break;
				case 33:
					this.defineText(reader, 2);
					break;
				case 59:
					this.doInitAction(reader, tagLength, preloadProgress.curPreloadFrame);
					break;
				case 37:
					this.defineEditText(reader);
					break;
				case 7:
					this.defineButton(reader, 1, tagLength);
					break;
				case 34:
					this.defineButton(reader, 2, tagLength);
					break;
				case 87:
					this.defineBinaryData(reader, tagLength);
					break;
				case 17:
					this.defineButtonSound(reader);
					break;
				case 23:
					this.defineButtonCxform(reader, tagLength);
					break;
				case 8:
					this.jpegTables(reader, tagLength);
					break;
				case 61:
					this.preloadVideoFrame(reader, tagLength);
					break;
				case 56:
					this.exportAssets(reader);
					break;
				case 74:
					this.csmTextSettings(reader);
					break;
				case 39:
					return this.defineSprite(context, reader, tagLength, chunkLimit);
			}
			if (chunkLimit.didOpsBreachLimit(context, tagLength)) {
				return true;
			}
			return false;
		}
		var result;
		if (subPreloadDone) {
			result = decode_tags(g, tagCallback.bind(this));
		} else {
			result = true;
		}
		if (subPreloadDone) {
			preloadProgress.nextPreloadChunk = g.byteStream.byte_offset;
		}
		var is_finished = endTagFound || g.isEmpty();
		if (is_finished) {
			preloadProgress.nextPreloadChunk = null;
		}
		return is_finished;
	}
	MovieClipStatic.prototype.preloadBytecodeTag = function(tagCode, reader, context, cur_frame, tagLength) {
		var tag = reader.parseTagWithCode(tagCode, tagLength);
		tag.tagcode = tagCode;
		this.abcTags.set(cur_frame, tag);
		var r = new Avm2Reader(tag.abc);
		console.time("Avm2:read");
		var res = r.read();
		console.timeEnd("Avm2:read");
		console.log(res);
	}
	MovieClipStatic.prototype.preloadSymbolClass = function(reader, context, cur_frame) {
		var byteStream = reader.byteStream;
		var num_symbols = byteStream.readUint16();
		var symbolclass_names = [];
		this.symbolclassNames.set(cur_frame, symbolclass_names);
		for (var i = 0; i < num_symbols; i++) {
			var id = byteStream.readUint16();
			var str = reader.getEncoding().decode(byteStream.readBytesNullTerminated());
			symbolclass_names.push([id, str]);
		}
	}
	MovieClipStatic.prototype.frameLabel = function(reader, cur_frame, context, tagLength) {
		var movie = this.getMovie();
		var frame_label = reader.parseFrameLabel(tagLength);
		var label = reader.getEncoding().decode(frame_label.label);
		if (!movie.isActionScript3()) {
			label = label.toLowerCase();
		}
		this.frameLabels.push([cur_frame, label]);
		var g = this.frameLabelsMap.get(label);
		if (g) {
			console.log("Movie clip " + this.characterId + " Duplicated frame label");
		} else {
			this.frameLabelsMap.set(label, cur_frame);
		}
	}
	MovieClipStatic.prototype.defineFont = function(reader, version, tagLength) {
		var movie = this.getMovie();
		var font;
		switch (version) {
			case 1:
				font = reader.parseDefineFont1(tagLength);
				break;
			case 2:
				font = reader.parseDefineFont2(2, tagLength);
				break;
			case 3:
				font = reader.parseDefineFont2(3, tagLength);
				break;
			case 4:
				font = reader.parseDefineFont4(tagLength);
				break;
		}
		var font_object = FlashFont.fromSwfTag(font, movie.encoding);
		movie.library.registerCharacter(font.id, new Character(Character.Font, font_object));
	}
	MovieClipStatic.prototype.defineBits = function(reader, version, tagLength) {
		var movie = this.getMovie();
		var tag1 = reader.parseDefineBits(version, tagLength);
		var rr = movie.library.jpegTables;
		var jpegTables = (version == 1) ? rr : null;
		var data = tag1.data;
		var bitmadA = tag1.alphaData;
		var _JPEGData = glueTablesToJpeg(data, jpegTables);
		movie.library.registerCharacter(tag1.id, new Character(Character.Bitmap, {
			compressed: new CompressedBitmap(CompressedBitmap.Jpeg, {
				data: _JPEGData,
				alpha: bitmadA
			}),
			handle: null,
			avm2BitmapDataClass: null,
		}));
	}
	MovieClipStatic.prototype.defineLossless = function(reader, version, tagLength) {
		var movie = this.getMovie();
		var bitmapInfo = reader.parseDefineBitsLossLess(version, tagLength);
		movie.library.registerCharacter(bitmapInfo.id, new Character(Character.Bitmap, {
			compressed: new CompressedBitmap(CompressedBitmap.Lossless, bitmapInfo),
			handle: null,
			avm2BitmapDataClass: null,
		}));
	}
	MovieClipStatic.prototype.defineSound = function(context, reader, tagLength) {
		var movie = this.getMovie();
		var tag = reader.parseDefineSound(tagLength);
		var sp = context.audio.registerSound(tag);
		movie.library.registerCharacter(tag.id, new Character(Character.Sound, sp));
	}
	MovieClipStatic.prototype.defineShape = function(reader, version) {
		var movie = this.getMovie();
		var tag = reader.parseDefineShape(version);
		var shape = Graphic.fromSwfTag(movie, tag);
		movie.library.registerCharacter(tag.id, new Character(Character.Graphic, shape));
	}
	MovieClipStatic.prototype.defineMorphShape = function(reader, version) {
		var movie = this.getMovie();
		var tag = reader.parseDefineMorphShape(version);
		var morph_shape = MorphShape.fromSwfTag(movie, tag);
		movie.library.registerCharacter(tag.id, new Character(Character.MorphShape, morph_shape));
	}
	MovieClipStatic.prototype.defineSprite = function(context, reader, tagLength, chunkLimit) {
		var movie = this.getMovie();
		var id = reader.byteStream.readUint16();
		var numFrames = reader.byteStream.readUint16();
		var movieClip = MovieClipStatic.withData(id, this.swf.resizeToReader(reader, tagLength - 4), numFrames, null);
		movie.library.registerCharacter(id, new Character(Character.MovieClip, movieClip));
		this.preloadProgress.curPreloadSymbol = id;
		var should_exit = chunkLimit.didOpsBreachLimit(context, 4);
		if (should_exit)
			return true;
		if (movieClip.preload(context, chunkLimit)) {
			this.preloadProgress.curPreloadSymbol = null;
			return false;
		} else {
			return true;
		}
	}
	MovieClipStatic.prototype.defineText = function(reader, version) {
		var movie = this.getMovie();
		var tag = reader.parseDefineText(version);
		var text = StaticText.fromSwfTag(movie, tag);
		movie.library.registerCharacter(tag.id, new Character(Character.Text, text));
	}
	MovieClipStatic.prototype.defineEditText = function(reader) {
		var movie = this.getMovie();
		var edit_text = reader.parseDefineEditText();
		var et_obj = TextField.fromSwfTag(movie, edit_text);
		movie.library.registerCharacter(edit_text.id, new Character(Character.EditText, et_obj));
	}
	MovieClipStatic.prototype.defineButton = function(reader, version, tagLength) {
		var movie = this.getMovie();

		var tag = reader.parseDefineButton(version, tagLength);

		var r = Avm1Button.fromSwfTag(movie, tag);
		movie.library.registerCharacter(tag.id, new Character(Character.Avm1Button, r));
	}
	MovieClipStatic.prototype.defineBinaryData = function(reader, tagLength) {
		var movie = this.getMovie();
		var tag = reader.parseDefineBinaryData(tagLength);
		var binarydata_obj = BinaryData.fromSwfTag(tag);
		movie.library.registerCharacter(tag.id, new Character(Character.BinaryData, binarydata_obj));
	}
	MovieClipStatic.prototype.defineVideoStream = function(reader) {
		var movie = this.getMovie();
		var streamdef = reader.parseDefineVideoStream();
		var video = VideoDisplay.fromSwfTag(movie, streamdef);
		movie.library.registerCharacter(streamdef.id, new Character(Character.Video, video));
	}
	MovieClipStatic.prototype.defineButtonSound = function(reader) {
		var movie = this.getMovie();
		var tag = reader.parseDefineButtonSound();
		var resultButton = movie.library.characterById(tag.buttonId);
		if (resultButton) {
			if ((resultButton.type == Character.Avm1Button) || (resultButton.type == Character.Avm2Button)) {
				resultButton.data.setSounds(tag);
			} else {
				log.warn("DefineButtonCxform: Tried to apply on non-button ID " + tag.buttonId);
			}
		} else {
			log.warn("DefineButtonSound: Character ID " + tag.buttonId + " doesn't exist");
		}
	}
	MovieClipStatic.prototype.defineButtonCxform = function(reader, tagLength) {
		var movie = this.getMovie();
		var tag = reader.parseDefineButtonCxform(tagLength);
		var resultButton = movie.library.characterById(tag.id);
		if (resultButton) {
			if (resultButton.type == Character.Avm1Button) {
				resultButton.data.setColorTransforms(tag);
			} else {
				log.warn("DefineButtonCxform: Tried to apply on non-button ID " + tag.id);
			}
		} else {
			log.warn("DefineButtonSound: Character ID " + tag.id + " doesn't exist");
		}
	}
	MovieClipStatic.prototype.doInitAction = function(reader, tagLength, cur_frame) {
		var movie = this.getMovie();
		var spriteId = reader.byteStream.readUint16();
		var action = this.swf.resizeToReader(reader, tagLength - 2);
		var movieclip = movie.library.characterById(spriteId);
		if (movieclip.type == Character.MovieClip) {
			if (this.initActions.has(cur_frame)) {
				this.initActions.get(cur_frame).push(action);
			} else {
				this.initActions.set(cur_frame, [action]);
			}
		}
	}
	MovieClipStatic.prototype.soundStreamHead = function(reader, version) {
		this.audioStreamInfo = reader.parseSoundStreamHead(version);
	}
	MovieClipStatic.prototype.preloadVideoFrame = function(reader, tagLength) {
		var movie = this.getMovie();
		var vframe = reader.parseVideoFrame(tagLength);
		var library = movie.library;
		var v = library.characterById(vframe.streamId);
		if (v.type == Character.Video) {
			v.data.preloadSwfFrame(vframe);
		}
	}
	MovieClipStatic.prototype.getRegisteredCharacterById = function(id) {
		var movie = this.getMovie();
		return movie.library.characterById(id);
	}
	MovieClipStatic.prototype.registerExport = function(id, name, movie) {
		movie.library.registerExport(id, name);
		var character = movie.library.characterById(id);
		if (character) {
			if (character.type == Character.MovieClip) {
				character.data.exportedName = name;
			}
		} else {
			log.warn("Can't register export " + name + ": Character ID " + id + " doesn't exist");
		}
	}
	MovieClipStatic.prototype.exportAssets = function(reader) {
		var movie = this.getMovie();
		var tag = reader.parseExportAssets();
		var encoding = reader.getEncoding();
		var packages = tag.packages;
		for (var i = 0; i < packages.length; i++) {
			var _package = packages[i];
			var id = _package[0];
			var name = encoding.decode(_package[1]);
			var character = this.getRegisteredCharacterById(id);
			if (character) {
				this.registerExport(id, name, movie);
			} else {
				log.warn("Export asset: " + name + " (ID: " + id + ") not found in library");
			}
		}
	}
	MovieClipStatic.prototype.csmTextSettings = function(reader) {
		var movie = this.getMovie();
		var tag = reader.parseCSMTextSettings();
		var ch = movie.library.characterById(tag.id);
		if (ch) {
			if (ch.type == Character.Text) {
				ch.data.setRenderSettings(tag);
			} else if (ch.type == Character.EditText) {
				ch.data.setRenderSettings(tag);
			} else {
				log.warn("Tried to apply CSMTextSettings to non-text character ID");
			}
		} else {
			log.warn("Tried to apply CSMTextSettings to unregistered character ID");
		}
	}
	MovieClipStatic.prototype.jpegTables = function(reader, tagLength) {
		var movie = this.getMovie();
		var jpeg_data = reader.byteStream.readBytes(tagLength);
		movie.library.setJpegTables(jpeg_data);
	}
	var StageScaleMode = function(type) {
		this.type = type;
	}
	StageScaleMode.fromStr = function(s) {
		switch(s.toLowerCase()) {
			case "exactfit": return new StageScaleMode(StageScaleMode.ExactFit);
			case "noborder": return new StageScaleMode(StageScaleMode.NoBorder);
			case "noscale": return new StageScaleMode(StageScaleMode.NoScale);
			case "showall": return new StageScaleMode(StageScaleMode.ShowAll);
			default: return null;
		}
	}
	StageScaleMode.prototype.toString = function() {
		switch(this.type) {
			case StageScaleMode.ExactFit: return "exactFit";
			case StageScaleMode.NoBorder: return "noBorder";
			case StageScaleMode.NoScale: return "noScale";
			case StageScaleMode.ShowAll: return "showAll";
		}
	}
	StageScaleMode.ExactFit = 1;
	StageScaleMode.NoBorder = 2;
	StageScaleMode.NoScale = 3;
	StageScaleMode.ShowAll = 4;
	var StageAlign = function() {
		this.TOP = false;
		this.BOTTOM = false;
		this.LEFT = false;
		this.RIGHT = false;
	}
	StageAlign.fromStr = function(s) {
		var ret = new StageAlign();
		var t = s.toUpperCase();
		for (var i = 0; i < t.length; i++) {
			switch(t[i]) {
				case "B":
					ret.BOTTOM = true;
					break;
				case "L":
					ret.LEFT = true;
					break;
				case "R":
					ret.RIGHT = true;
					break;
				case "T":
					ret.TOP = true;
					break;
			}	
		}
		return ret;
	}
	StageAlign.prototype.set = function(other) {
		this.TOP = other.TOP;
		this.BOTTOM = other.BOTTOM;
		this.LEFT = other.LEFT;
		this.RIGHT = other.RIGHT;
	}
	var Stage = function(fullscreen, movie) {
		DisplayObjectContainer.call(this);
		this.movie = movie;
		this.quality = StageQuality.fromStr("high");
		this.display_state = fullscreen ? "full_screen" : "normal";
		this.background_color = null;
		this.movie_size = [0, 0];
		this.viewport_matrix = Matrix.IDENTITY.clone();
		this.stage_size = [0, 0];
		this.scale_mode = new StageScaleMode(StageScaleMode.ShowAll);
		this.align = new StageAlign();
		this.setIsRoot(true);
	}
	Stage.prototype = Object.create(DisplayObjectContainer.prototype);
	Stage.prototype.constructor = Stage;
	Stage.prototype.displayType = "Stage";
	Stage.prototype._debug_colorDisplayType = [0, 0, 0, 1];
	Stage.prototype.view_matrix = function() {
		return this.viewport_matrix;
	}
	Stage.prototype.setMovieSize = function(width, height) {
		this.movie_size = [width, height];
		this.stage_size[0] = this.movie_size[0];
		this.stage_size[1] = this.movie_size[1];
	}
	Stage.prototype.getId = function() {
		return 0xffff;
	}
	Stage.prototype.selfBounds = function() {
		return Rectangle.INVALID.clone();
	}
	Stage.prototype.getQuality = function() {
		return this.quality;
	}
	Stage.prototype.setQuality = function(context, quality) {
		this.quality.set(quality);
		context.renderer.setQuality(quality.toString());
	}
	Stage.prototype.getAlign = function() {
		return this.align;
	}
	Stage.prototype.setAlign = function(context, align) {
		this.align.set(align);
	}
	Stage.prototype.setMovie = function(movie) {
		this.movie = movie;
	}
	Stage.prototype.getBackgroundColor = function() {
		return this.background_color;
	}
	Stage.prototype.getRootClip = function() {
		return this.childByDepth(0);
	}
	Stage.prototype.setBackgroundColor = function(color) {
		this.background_color = [color[0], color[1], color[2], 1];
	}
	Stage.prototype.getScaleMode = function() {
		return this.scale_mode;
	}
	Stage.prototype.setScaleMode = function(context, scale_mode, respect_forced) {
		this.scale_mode = scale_mode;
		this.buildMatrices(context);
	}
	Stage.prototype.buildMatrices = function(context) {
		this.stage_size[0] = this.movie_size[0];
		this.stage_size[1] = this.movie_size[1];
	}
	Stage.prototype.render = function(context) {
		context.transformStack.stackPush(new Transform(this.viewport_matrix, [1, 1, 1, 1, 0, 0, 0, 0]));
		this.renderBase(context);
		context.transformStack.stackPop();
	}
	Stage.prototype.renderSelf = function(context) {
		this.renderChildren(context);
	}
	Stage.prototype.debugRender = function(context, player) {
		player.debugTransformStack.stackPush(new Transform(this.viewport_matrix, [1, 1, 1, 1, 0, 0, 0, 0]));
		DisplayObjectContainer.prototype.debugRender.call(this, context, player);
		player.debugTransformStack.stackPop();
	}
	Stage.prototype.filterClipEvent = function(context, event) {
		return true;
	}
	Stage.prototype.eventDispatch = function(context, event) {
		return false;
	}
	var Avm1Value = function() {
		this.a = arguments[0];
		if (arguments.length == 2) {
			this.b = arguments[1];
		}
	}
	Avm1Value.fromObject = function(obj) {
		return new Avm1Value(Avm1Value.Object, obj);
	}
	Avm1Value.fromNumber = function(num) {
		return new Avm1Value(Avm1Value.Number, num);
	}
	Avm1Value.fromString = function(str) {
		return new Avm1Value(Avm1Value.String, str);
	}
	Avm1Value.fromBoolean = function(bool) {
		return new Avm1Value(Avm1Value.Bool, bool);
	}
	Avm1Value.fromMovieClip = function(mc) {
		return new Avm1Value(Avm1Value.MovieClip, mc);
	}
	Avm1Value.parse_float_impl = function(s, strict) {
		if (!strict) {
			return Number.parseFloat(s);
		}
		var n = +s;
		return Number.isNaN(n) ? n : +s;
	}
	Avm1Value.string_to_f64 = function(s, swf_version) {
		var strict = swf_version >= 5;
		var result = Avm1Value.parse_float_impl(s, strict);
		if (!strict && Number.isNaN(result)) {
			return 0;
		} else {
			return result;
		}
	}
	Avm1Value.prototype.isPrimitive = function() {
		switch (this.a) {
			case Avm1Value.Object:
			case Avm1Value.MovieClip:
				return false;
			default:
				return true;
		}
	}
	Avm1Value.prototype.eq = function(other) {
		var thisType = this.a;
		var otherType = other.a;
		switch (true) {
			case (thisType == Avm1Value.Undefined) && (otherType == Avm1Value.Undefined):
				return true;
			case (thisType == Avm1Value.Null) && (otherType == Avm1Value.Null):
				return true;
			case (thisType == Avm1Value.Bool) && (otherType == Avm1Value.Bool):
				return this.b == other.b;
			case (thisType == Avm1Value.Number) && (otherType == Avm1Value.Number):
				return (this.b === other.b) || (Number.isNaN(this.b) && Number.isNaN(other.b));
			case (thisType == Avm1Value.String) && (otherType == Avm1Value.String):
				return (this.b === other.b);
			case (thisType == Avm1Value.Object) && (otherType == Avm1Value.Object):
				return (this.b === other.b);
			case (thisType == Avm1Value.MovieClip) && (otherType == Avm1Value.MovieClip):
				return (this.b.path() == other.b.path());
			default:
				return false;
		}
	}
	Avm1Value.prototype.primitiveAsNumber = function(activation) {
		var type = this.a;
		var value = this.b;
		switch (type) {
			case Avm1Value.Undefined:
			case Avm1Value.Null:
				return (activation.swfVersion < 7) ? 0 : NaN;
			case Avm1Value.Object:
			case Avm1Value.MovieClip:
				return (activation.swfVersion < 5) ? 0 : NaN;
			case Avm1Value.Bool:
				return +value;
			case Avm1Value.Number:
				return value;
			case Avm1Value.String:
				return Avm1Value.string_to_f64(value, activation.swfVersion);
		}
	}
	Avm1Value.prototype.toPrimitive = function(activation) {
		switch (this.a) {
			case Avm1Value.Object:
				var val;
				if (activation.swfVersion > 5) {
					val = this.b.callMethod("toString", [], activation, Avm1ExecutionReason.INSTANCE.Special);
				} else {
					val = this.b.callMethod("valueOf", [], activation, Avm1ExecutionReason.INSTANCE.Special);
				}
				return val;
			case Avm1Value.MovieClip:
				var object = this.coerceToObject(activation);
				var res = object.callMethod("valueOf", [], activation, Avm1ExecutionReason.INSTANCE.Special);
				return (res.a == Avm1Value.Undefined) ? Avm1Value.fromString(this.coerceToString(activation)) : res;
			default:
				return this;
		}
	}
	Avm1Value.prototype.toPrimitiveNum = function(activation) {
		switch (this.a) {
			case Avm1Value.Object:
				return this.b.asDisplayObject() ? this : this.b.callMethod("valueOf", [], activation, Avm1ExecutionReason.INSTANCE.Special);
			default:
				return this;
		}
	}
	Avm1Value.prototype.coerceToNumber = function(activation) {
		var type = this.a;
		switch (type) {
			case Avm1Value.Object:
				return this.toPrimitiveNum(activation).primitiveAsNumber(activation);
			case Avm1Value.MovieClip:
				return Avm1Value.fromObject(this.coerceToObject(activation)).toPrimitiveNum(activation).primitiveAsNumber(activation);
			default:
				return this.primitiveAsNumber(activation);
		}
	}
	Avm1Value.prototype.coerceToI32 = function(activation) {
		return this.coerceToNumber(activation) | 0;
	}
	Avm1Value.prototype.coerceToU32 = function(activation) {
		return this.coerceToNumber(activation) >>> 0;
	}
	Avm1Value.prototype.coerceToString = function(activation) {
		var type = this.a;
		var value = this.b;
		switch (type) {
			case Avm1Value.Object:
				var dobj = value.asDisplayObjectNoSuper();
				if (dobj) {
					return dobj.path();
				} else {
					var o = value.callMethod("toString", [], activation, Avm1ExecutionReason.INSTANCE.Special);
					return (o.a == Avm1Value.String) ? o.b : (value.asExecutable() ? "[type Function]" : "[type Object]");	
				}
			case Avm1Value.MovieClip:
				return value.coerceToString(activation);
			case Avm1Value.Undefined:
				return (activation.swfVersion < 7) ? "" : "undefined";
			case Avm1Value.Null:
				return "null";
			case Avm1Value.Bool:
				return (activation.swfVersion < 5) ? (value ? "1" : "0") : (value + "");
			case Avm1Value.Number:
				return value + "";
			case Avm1Value.String:
				return value;
		}
	}
	Avm1Value.prototype.asBool = function(swfVersion) {
		var type = this.a;
		var value = this.b;
		switch (type) {
			case Avm1Value.Bool:
				return value;
			case Avm1Value.Number:
				return (!Number.isNaN(value)) && (value != 0);
			case Avm1Value.String:
				if (swfVersion >= 7) {
					return !value.length;
				} else {
					var num = parseFloat(value);
					return !Number.isNaN(num) && (num != 0);
				}
			case Avm1Value.Object:
			case Avm1Value.MovieClip:
				return true;
			default:
				return false;
		}
	}
	Avm1Value.prototype.coerceToObject = function(activation) {
		var value, proto;
		switch(this.a) {
			case Avm1Value.Object:
				return this.b;
			case Avm1Value.MovieClip:
				var hf = this.b.coerceToObject(activation);
				if (hf) {
					return hf;
				} else {
					value = Avm1Value.INSTANCE.Undefined;
					proto = null;
				}
			case Avm1Value.Null:
			case Avm1Value.Undefined:
				value = this;
				proto = null;
				break;
			case Avm1Value.Bool:
				value = this;
				proto = activation.context.avm1.prototypes.boolean;
				break;
			case Avm1Value.Number:
				value = this;
				proto = activation.context.avm1.prototypes.number;
				break;
			case Avm1Value.String:
				value = this;
				proto = activation.context.avm1.prototypes.string;
				break;
		}
		var obj = Avm1Object.createNew(proto);
		switch(this.a) {
			case Avm1Value.Bool:
				avm1_globals.boolean.constructor(activation, obj, [value]);
				break;
			case Avm1Value.Number:
				avm1_globals.number.number(activation, obj, [value]);
				break;
			case Avm1Value.String:
				avm1_globals.string.string(activation, obj, [value]);
				break;
		}
		return obj;
	}
	Avm1Value.prototype.abstract_lt = function(other, activation) {
		var prim_self = this.toPrimitiveNum(activation);
		if (prim_self.a == Avm1Value.Object) {
			if (!prim_self.b.asDisplayObject()) {
				return Avm1Value.fromBoolean(false);
			}
		}
		var prim_other = other.toPrimitiveNum(activation);
		if (prim_other.a == Avm1Value.Object) {
			if (!prim_other.b.asDisplayObject()) {
				return Avm1Value.fromBoolean(false);
			}
		}
		if ((prim_self.a == Avm1Value.String) && (prim_other.a == Avm1Value.String)) {
			var a = prim_self.b + "";
			var b = prim_other.b + "";
			return Avm1Value.fromBoolean(a < b);
		} else {
			var a = prim_self.primitiveAsNumber(activation);
			var b = prim_other.primitiveAsNumber(activation);
			return (Number.isNaN(a) || Number.isNaN(b)) ? Avm1Value.INSTANCE.Undefined : Avm1Value.fromBoolean(a < b);
		}
	}
	Avm1Value.prototype.abstract_eq = function(other, activation) {
		var a;
		var b;
		if (activation.swfVersion > 5) {
			a = other;
			b = this;
		} else {
			a = other.toPrimitiveNum(activation);
			b = this.toPrimitiveNum(activation);
		}
		if (((a.a == Avm1Value.Undefined) || (a.a == Avm1Value.Null)) && ((b.a == Avm1Value.Undefined) || (b.a == Avm1Value.Null))) {
			return true;
		} else if (((a.a == Avm1Value.Bool) && (b.a == Avm1Value.Bool)) || ((a.a == Avm1Value.String) && (b.a == Avm1Value.String)) || ((a.a == Avm1Value.Object) && (b.a == Avm1Value.Object))) {
			return a.b == b.b;
		} else if ((a.a == Avm1Value.Number) && (b.a == Avm1Value.Number)) {
			return (a.b == b.b) || (Number.isNaN(a.b) && Number.isNaN(b.b));
		} else if (a.a == Avm1Value.Bool) {
			return b.abstract_eq(Avm1Value.fromNumber(+a.b), activation);
		} else if (b.a == Avm1Value.Bool) {
			return a.abstract_eq(Avm1Value.fromNumber(+b.b), activation);
		} else if ((a.a == Avm1Value.Number) && (b.a == Avm1Value.String)) {
			return a.b == b.primitiveAsNumber(activation);
		} else if ((a.a == Avm1Value.String) && (b.a == Avm1Value.Number)) {
			return b.b == a.primitiveAsNumber(activation);
		} else if ((a.a == Avm1Value.MovieClip) && (b.a == Avm1Value.MovieClip)) {
			return a.b.coerceToString(activation) == b.b.coerceToString(activation);
		} else if (a.a == Avm1Value.Object) {
			var obj_val = a.toPrimitiveNum(activation);
			return obj_val.isPrimitive() && b.abstract_eq(obj_val, activation);
		} else if (b.a == Avm1Value.Object) {
			var obj_val = b.toPrimitiveNum(activation);
			return obj_val.isPrimitive() && a.abstract_eq(obj_val, activation);
		} else {
			return false;
		}
	}
	Avm1Value.prototype.typeOf = function(activation) {
		switch (this.a) {
			case Avm1Value.Undefined: return "undefined";
			case Avm1Value.Null: return "null";
			case Avm1Value.Bool: return "boolean";
			case Avm1Value.Number: return "number";
			case Avm1Value.String: return "string";
			case Avm1Value.Object: return this.b.asExecutable() ? "function" : "object";
			case Avm1Value.MovieClip: return "movieclip";
		}
	}
	Avm1Value.Undefined = 1;
	Avm1Value.Null = 2;
	Avm1Value.Bool = 3;
	Avm1Value.Number = 4;
	Avm1Value.String = 5;
	Avm1Value.Object = 6;
	Avm1Value.MovieClip = 7;
	Avm1Value.INSTANCE = {Undefined: new Avm1Value(Avm1Value.Undefined), Null: new Avm1Value(Avm1Value.Null)};
	var Avm1Error = function(value) {
		this.value = value;
	}
	var Avm1ExecutionName = function(type, str) {
		this.type = type;
		this.name = str;
	}
	Avm1ExecutionName.Static = 1;
	Avm1ExecutionName.Dynamic = 2;
	var Avm1ExecutionReason = function(type) {
		this.type = type;
	}
	Avm1ExecutionReason.FunctionCall = 1;
	Avm1ExecutionReason.Special = 2;
	Avm1ExecutionReason.INSTANCE = {FunctionCall: new Avm1ExecutionReason(Avm1ExecutionReason.FunctionCall), Special: new Avm1ExecutionReason(Avm1ExecutionReason.Special)};
	var Avm1Attribute = function() {
		this.DONT_ENUM = false;
		this.DONT_DELETE = false;
		this.READ_ONLY = false;
		this._version = null;
	}
	Avm1Attribute.prototype.dontEnum = function() {
		this.DONT_ENUM = true;
		return this;
	}
	Avm1Attribute.prototype.dontDelete = function() {
		this.DONT_DELETE = true;
		return this;
	}
	Avm1Attribute.prototype.readOnly = function() {
		this.READ_ONLY = true;
		return this;
	}
	Avm1Attribute.prototype.withVersion = function(v) {
		this._version = v;
		return this;
	}
	var Avm1Property = function(data) {
		this.data = data.data;
		this.getter = data.getter;
		this.setter = data.setter;
		this.attributes = data.attributes;
	}
	Avm1Property.newStored = function(data, attributes) {
		return new Avm1Property({
			data,
			getter: null,
			setter: null,
			attributes,
		});
	}
	Avm1Property.newVirtual = function(getter, setter, attributes) {
		return new Avm1Property({
			data: Avm1Value.INSTANCE.Undefined,
			getter: getter,
			setter: setter,
			attributes,
		});
	}
	Avm1Property.prototype.isVirtual = function() {
		return !!this.getter;
	}
	Avm1Property.prototype.canDelete = function() {
		return !this.attributes.DONT_DELETE;
	}
	Avm1Property.prototype.isOverwritable = function() {
		return !this.attributes.READ_ONLY;
	}
	Avm1Property.prototype.isEnumerable = function() {
		return !this.attributes.DONT_ENUM;
	}
	Avm1Property.prototype.allowSwfVersion = function(version) {
		var v = this.attributes._version;
		if (v == null) {
			return true;
		}
		return version >= v;
	}
	Avm1Property.prototype.setData = function(data) {
		if (this.isOverwritable()) {
			this.data = data;
		}
	}
	Avm1Property.prototype.setVirtual = function(getter, setter) {
		this.getter = getter;
		this.setter = setter;
	}
	var Avm1PropertyMapEntry = function(key, data) {
		this.key = key;
		this.data = data;
	}
	var Avm1PropertyMap = function() {
		this.properties = Object.create(null);
	}
	Avm1PropertyMap.prototype.insert = function(key, value, case_sensitive) {
		this.properties[case_sensitive ? key : key.toLowerCase()] = new Avm1PropertyMapEntry(key, value);
	}
	Avm1PropertyMap.prototype.insertA = function(key, value) {
		this.properties[key] = new Avm1PropertyMapEntry(key, value);
	}
	Avm1PropertyMap.prototype.get = function(key, case_sensitive) {
		var p = this.properties[case_sensitive ? key : key.toLowerCase()];
		if (!p && !case_sensitive) {
			p = this.properties[key];
		}
		return p ? p.data : null;
	}
	Avm1PropertyMap.prototype.getA = function(key) {
		var p = this.properties[key];
		return p ? p.data : null;
	}
	Avm1PropertyMap.prototype.remove = function(key, case_sensitive) {
		var g = delete this.properties[case_sensitive ? key : key.toLowerCase()];
		if (!g && !case_sensitive) {
			g = delete this.properties[key];
		}
		return g;
	}
	Avm1PropertyMap.prototype.contains_key = function(key, case_sensitive) {
		var r = (case_sensitive ? key : key.toLowerCase()) in this.properties;
		if (!r && !case_sensitive) {
			r = key in this.properties;
		}
		return r;
	}
	Avm1PropertyMap.prototype.getEntries = function() {
		var result = [];
		for (var key in this.properties) {
			if (Object.prototype.hasOwnProperty.call(this.properties, key)) {
				var element = this.properties[key];
				result.push([element.key, element.data]);
			}
		}
		result.reverse();
		return result;
	}
	function avm1_eq_with_case(n1, n2, is_case_sensitive) {
		return is_case_sensitive ? (n1 == n2) : eq_ignore_case(n1, n2);
	}
	var Avm1NativeObject = function(type, data) {
		this.type = type;
		this.data = data;
	}
	Avm1NativeObject.prototype.asDisplayObject = function() {
		switch(this.type) {
			case Avm1NativeObject.MovieClip:
			case Avm1NativeObject.Button:
			case Avm1NativeObject.EditText:
			case Avm1NativeObject.Video:
				return this.data;
		}
		return null;
	}
	Avm1NativeObject.None = 0;
	Avm1NativeObject.Bool = 1;
	Avm1NativeObject.Number = 2;
	Avm1NativeObject.String = 3;
	Avm1NativeObject.Array = 4;
	Avm1NativeObject.Function = 5;
	Avm1NativeObject.Super = 6;
	Avm1NativeObject.MovieClip = 8;
	Avm1NativeObject.Button = 9;
	Avm1NativeObject.EditText = 10;
	Avm1NativeObject.Video = 11;
	Avm1NativeObject.Sound = 12;
	Avm1NativeObject.ColorTransform = 13;
	Avm1NativeObject.Transform = 14;
	Avm1NativeObject.INSTANCE = {
		None: new Avm1NativeObject(Avm1NativeObject.None)
	};
	var Avm1Watcher = function(callback, user_data) {
		this.callback = callback;
		this.user_data = user_data;
	}
	Avm1Watcher.prototype.call = function(activation, name, old_value, new_value, _this) {
		var args = [Avm1Value.fromString(name), old_value, new_value, this.user_data];
		var exec = this.callback.asExecutable();
		return exec.exec(new Avm1ExecutionName(Avm1ExecutionName.Dynamic, name), activation, Avm1Value.fromObject(_this), 0, args, Avm1ExecutionReason.INSTANCE.Special, this.callback);
	}
	var Avm1Object = function(data) {
		this.native = data.native;
		this.properties = data.properties;
		this.interfaces = data.interfaces;
		this.watchers = data.watchers;
	}
	Avm1Object.createNew = function(proto) {
		var object = new Avm1Object({
			native: Avm1NativeObject.INSTANCE.None,
			properties: new Avm1PropertyMap(),
			interfaces: [],
			watchers: new Avm1PropertyMap()
		});
		if (proto) {
			object.defineValue("__proto__", Avm1Value.fromObject(proto), new Avm1Attribute().dontEnum().dontDelete());
		}
		return object;
	}
	Avm1Object.createNewWithNative = function(proto, native) {
		var o = Avm1Object.createNew(proto);
		o.setNative(native);
		return o;
	}
	Avm1Object.prototype.getData = function(name, activation) {
		var h = this.properties.get(name, activation.is_case_sensitive());
		return h ? h.data : Avm1Value.INSTANCE.Undefined;
	}
	Avm1Object.prototype.setData = function(name, value, activation) {
		var h = this.properties.get(name, activation.is_case_sensitive());
		if (h) {
			h.setData(value);
		} else {
			this.properties.insert(name, Avm1Property.newStored(value, new Avm1Attribute()), activation.is_case_sensitive());
		}
	}
	Avm1Object.prototype.getLocalStored = function(name, activation, is_slash_path) {
		if (this.asSuperObject()) {
			return null;
		}
		var h = this.properties.get(name, activation.is_case_sensitive());
		if (h) {
			if (h.allowSwfVersion(activation.swfVersion)) {
				return h.data;
			}
		}
		var display_object = this.asDisplayObject();
		if (display_object) {
			return avm1_stage_object.get_property(display_object, name, activation, is_slash_path);
		}
		return null;
	}
	Avm1Object.prototype.setLocal = function(name, value, activation, _this) {
		var native = this.getNativeNoSuper();
		if (native.type == Avm1NativeObject.Super) {
			return;
		} else if (native.type == Avm1NativeObject.Array) {
			if (name == "length") {
				var new_length = value.coerceToI32(activation);
				var old_length = this.getData("length", activation);
				if (old_length.a == Avm1Value.Number) {
					old_length = old_length.b;
					for (var i = Math.max(new_length, 0); i < (old_length | 0); i++) {
						this.deleteElement(activation, i);
					}
				}
			} else {
				var index = parse_array_index(name);
				if (index != null) {
					var length = this.getLength(activation);
					if (index >= length) {
						this.setLength(activation, index + 1);
					}
				}
			}
		} else {
			var dobj = this.asDisplayObject();
			if (dobj) {
				avm1_stage_object.notify_property_change(dobj, name, value, activation);
				if (!this.has_own_property(activation, name)) {
					var property = activation.context.avm1.displayProperties.getByName(name);
					if (property) {
						property.set(activation, dobj, value);
						return;
					}
				}
			}
		}
		var setter;
		var h = this.properties.get(name, activation.is_case_sensitive());
		if (h) {
			h.setData(value);
			setter = h.setter;
		} else {
			this.properties.insert(name, Avm1Property.newStored(value, new Avm1Attribute()), activation.is_case_sensitive());
		}
		if (setter) {
			var exec = setter.asExecutable();
			if (exec) {
				exec.exec(new Avm1ExecutionName(Avm1ExecutionName.Static, "[Setter]"), activation, Avm1Value.fromObject(_this), 1, [value], Avm1ExecutionReason.INSTANCE.Special, setter);
			}
		}
	}
	Avm1Object.prototype.call = function(name, activation, _this, args) {
		var native = this.getNativeNoSuper();
		if (native.type == Avm1NativeObject.Super) {
			return native.data.call(name, activation, args);
		} else if (native.type == Avm1NativeObject.Function) {
			var func = native.data;
			return func.call(name, activation, this, _this, args);
		} else {
			return Avm1Value.INSTANCE.Undefined;
		}
	}
	Avm1Object.prototype.constructOnExisting = function(activation, _this, args) {
		var native = this.getNativeNoSuper();
		if (native.type == Avm1NativeObject.Function) {
			var func = native.data;
			return func.constructOnExisting(activation, this, _this, args);
		} else {
			return Avm1Value.INSTANCE.Undefined;
		}
	}
	Avm1Object.prototype.construct = function(activation, args) {
		var native = this.getNativeNoSuper();
		if (native.type == Avm1NativeObject.Function) {
			var func = native.data;
			return func.construct(activation, this, args);
		} else {
			return Avm1Value.INSTANCE.Undefined;
		}
	}
	Avm1Object.prototype.getter = function(name, activation) {
		var zuper = this.asSuperObject();
		if (zuper) {
			return zuper.thisObject.getter(name, activation);
		}
		var g = this.properties.get(name, activation.is_case_sensitive());
		if (g) {
			if (g.allowSwfVersion(activation.swfVersion)) {
				return g.getter;
			}
		}
	}
	Avm1Object.prototype.setter = function(name, activation) {
		var zuper = this.asSuperObject();
		if (zuper) {
			return zuper.thisObject.setter(name, activation);
		}
		var g = this.properties.get(name, activation.is_case_sensitive());
		if (g) {
			if (g.allowSwfVersion(activation.swfVersion)) {
				return g.setter;
			}
		}
	}
	Avm1Object.prototype.delete = function(activation, name) {
		if (this.asSuperObject()) return false;
		var property = this.properties.get(name, activation.is_case_sensitive());
		if (property) {
			if (property.canDelete()) {
				this.properties.remove(name, activation.is_case_sensitive());
				return true;
			}
		}
		return false;
	}
	Avm1Object.prototype.addProperty = function(name, getter, setter, attributes) {
		if (this.asSuperObject()) return;
		var property = this.properties.getA(name, false);
		if (property) {
			property.setVirtual(getter, setter);
		} else {
			this.properties.insertA(name, Avm1Property.newVirtual(getter, setter, attributes), false);
		}
	}
	Avm1Object.prototype.addPropertyWithCase = function(activation, name, getter, setter, attributes) {
		if (this.asSuperObject()) return;
		var property = this.properties.get(name, activation.is_case_sensitive());
		if (property) {
			property.setVirtual(getter, setter);
		} else {
			this.properties.insert(name, Avm1Property.newVirtual(getter, setter, attributes), activation.is_case_sensitive());
		}
	}
	Avm1Object.prototype.defineValue = function(name, value, attributes) {
		if (this.asSuperObject()) return;
		this.properties.insert(name, Avm1Property.newStored(value, attributes), true);
	}
	Avm1Object.prototype.getProto = function(activation) {
		var zuper = this.asSuperObject();
		if (zuper) {
			return zuper.getProto(activation);
		}
		return this.getData("__proto__", activation);
	}
	Avm1Object.prototype.has_property = function(activation, name) {
		var native = this.getNativeNoSuper();
		if (native.type == Avm1NativeObject.Super) {
			return native.data.thisObject.has_property(activation, name);
		}
		var dobj = native.asDisplayObject();
		var has_dobj = !dobj;
		if (dobj) {
			has_dobj = !dobj.AVM1_REMOVED;
		}
		if (has_dobj) {
			if (this.has_own_property(activation, name)) {
				return true;
			} else {
				var proto = this.getProto(activation);
				proto = (proto.a == Avm1Value.Object) ? proto.b : null;
				if (proto) {
					if (proto.has_property(activation, name)) {
						return true;
					}
				}
			}
		}
		if (dobj) {
			return avm1_stage_object.has_display_object_property(dobj, activation, name);
		}
		return false;
	}
	Avm1Object.prototype.has_own_property = function(activation, name) {
		var zuper = this.asSuperObject();
		if (zuper) {
			return zuper.thisObject.has_own_property(activation, name);
		}
		return this.properties.contains_key(name, activation.is_case_sensitive())
	}
	Avm1Object.prototype.has_own_virtual = function(activation, name) {
		var zuper = this.asSuperObject();
		if (zuper) {
			return zuper.thisObject.has_own_virtual(activation, name);
		}
		var property = this.properties.get(name, activation.is_case_sensitive());
		return property ? (property.isVirtual() && property.allowSwfVersion(activation.swfVersion)) : false;
	}
	Avm1Object.prototype.is_property_enumerable = function(activation, name) {
		var zuper = this.asSuperObject();
		if (zuper) {
			return zuper.thisObject.is_property_enumerable(activation, name);
		}
		var property = this.properties.get(name, activation.is_case_sensitive());
		if (property) {
			return property.isEnumerable();
		}
		return false;
	}
	Avm1Object.prototype.getKeys = function(activation, include_hidden) {
		if (this.asSuperObject()) return [];
		var proto_keys = this.getProto(activation);
		if (proto_keys.a == Avm1Value.Object) {
			proto_keys = proto_keys.b.getKeys(activation, include_hidden);
		} else {
			proto_keys = [];
		}
		var out_keys = [];
		for (var i = 0; i < proto_keys.length; i++) {
			var k = proto_keys[i];
			if (!this.has_own_property(activation, k)) {
				out_keys.push(k);
			}
		}
		var e = this.properties.getEntries();
		for (var i = 0; i < e.length; i++) {
			var b = e[i];
			var p = b[1];
			if (include_hidden || p.isEnumerable()) {
				out_keys.push(b[0]);
			}
		}
		var dobj = this.native.asDisplayObject();
		if (dobj) {
			avm1_stage_object.enumerate_keys(dobj, out_keys);
		}
		return out_keys;
	}
	Avm1Object.prototype.getInterfaces = function() {
		if (this.asSuperObject()) return [];
		return this.interfaces;
	}
	Avm1Object.prototype.setInterfaces = function(iface_list) {
		if (this.asSuperObject()) return;
		this.interfaces = iface_list;
	}
	Avm1Object.prototype.getNativeNoSuper = function() {
		return this.native;
	}
	Avm1Object.prototype.getNative = function() {
		if (this.native.type == Avm1NativeObject.Super) {
			return this.native.data.thisObject.getNative();
		}
		return this.native;
	}
	Avm1Object.prototype.setNative = function(native) {
		var old_native = this.native;
		if (old_native.type == Avm1NativeObject.Super) {
			old_native.data.thisObject.setNative(native);
		} else if (old_native.type == Avm1NativeObject.None) {
			this.native = native;
		} else {
			
		}
	}
	Avm1Object.prototype.asSuperObject = function() {
		var native = this.getNativeNoSuper();
		if (native.type == Avm1NativeObject.Super) {
			return native.data;
		}
		return null;
	}
	Avm1Object.prototype.asExecutable = function() {
		var native = this.getNativeNoSuper();
		return (native.type == Avm1NativeObject.Function) ? native.data.asExecutable() : null;
	}
	Avm1Object.prototype.asDisplayObjectNoSuper = function() {
		return this.native.asDisplayObject();
	}
	Avm1Object.prototype.asDisplayObject = function() {
		return this.getNative().asDisplayObject();
	}
	Avm1Object.prototype.getLength = function(activation) {
		if (this.asSuperObject()) return 0;
		return this.getData("length", activation).coerceToI32(activation);
	}
	Avm1Object.prototype.setLength = function(activation, new_length) {
		if (this.native.type == Avm1NativeObject.Array) {
			var old_length = this.getData("length", activation);
			if (old_length.a == Avm1Value.Number) {
				for (var i = Math.max(new_length, 0); i < (old_length.b | 0); i++) {
					this.deleteElement(activation, i);
				}
			}
		}
		this.setData("length", Avm1Value.fromNumber(new_length), activation);
	}
	Avm1Object.prototype.hasElement = function(activation, index) {
		if (this.asSuperObject()) return false;
		var index_str = index + "";
		return this.has_own_property(activation, index_str);
	}
	Avm1Object.prototype.getElement = function(activation, index) {
		if (this.asSuperObject()) return Avm1Value.INSTANCE.Undefined;
		return this.getData(index + "", activation);
	}
	Avm1Object.prototype.setElement = function(activation, index, value) {
		if (this.native.type == Avm1NativeObject.Super) {
			return;
		} else if (this.native.type == Avm1NativeObject.Array) {
			var length = this.getLength(activation);
			if (index >= length) {
				this.setLength(activation, index + 1);
			}
		}
		this.setData(index + "", value, activation);
	}
	Avm1Object.prototype.deleteElement = function(activation, index) {
		if (this.asSuperObject()) return false;
		return this.delete(activation, index + "");
	}
	// Object
	Avm1Object.prototype.get_non_slash_path = function(name, activation) {
		var _this, proto;
		var super_object = this.asSuperObject();
		if (super_object) {
			_this = super_object.thisObject;
			proto = super_object.getProto(activation);
		} else {
			_this = this;
			proto = Avm1Value.fromObject(this);
		}
		var s = avm1_search_prototype(proto, name, activation, _this, false);
		if (s) {
			return s[0];
		} else {
			return Avm1Value.INSTANCE.Undefined;
		}
	}
	Avm1Object.prototype.get = function(name, activation) {
		var _this, proto;
		var super_object = this.asSuperObject();
		if (super_object) {
			_this = super_object.thisObject;
			proto = super_object.getProto(activation);
		} else {
			_this = this;
			proto = Avm1Value.fromObject(this);
		}
		var s = avm1_search_prototype(proto, name, activation, _this, true);
		if (s) {
			return s[0];
		} else {
			return Avm1Value.INSTANCE.Undefined;
		}
	}
	Avm1Object.prototype.set = function(name, value, activation) {
		if (!name) return;
		var _this, proto;
		var super_object = this.asSuperObject();
		if (super_object) {
			_this = super_object.thisObject;
			proto = super_object.getProto(activation);
		} else {
			_this = this;
			proto = Avm1Value.fromObject(this);
		}
		if (!this.has_own_property(activation, name)) {
			while(true) {
				if (proto.a == Avm1Value.Object) {
					var this_proto = proto.b;
					if (this_proto.has_own_virtual(activation, name)) {
						var setter = this_proto.setter(name, activation);
						if (setter) {
							var exec = setter.asExecutable();
							if (exec) {
								exec.exec(new Avm1ExecutionName(Avm1ExecutionName.Static, "[Setter]"), activation, Avm1Value.fromObject(_this), 1, [value], Avm1ExecutionReason.INSTANCE.Special, setter);
							}
						}
						return;
					}
					proto = this_proto.getProto(activation);
				} else {
					break;
				}
			}
		}
		var result = this.setLocal(name, value, activation, _this);
	}
	Avm1Object.prototype.callMethod = function(name, args, activation, reason) {
		var method, depth;
		var native = this.getNativeNoSuper();
		if (native.type == Avm1NativeObject.Super) {
			return native.data.callMethod(name, args, activation, reason);
		} else {
			var dobj = native.asDisplayObject();
			if (dobj) {
				if (dobj.AVM1_REMOVED) {
					return Avm1Value.INSTANCE.Undefined;
				}
			}
		}
		var t = avm1_search_prototype(Avm1Value.fromObject(this), name, activation, this, false);
		if (t) {
			method = t[0].b;
			if (t[0].a != Avm1Value.Object) {
				return Avm1Value.INSTANCE.Undefined;
			}
			depth = t[1];
		} else {
			return Avm1Value.INSTANCE.Undefined;
		}
		var _depth = Math.max(depth, 1);
		var n = method.asExecutable();
		if (n) {
			return n.exec(new Avm1ExecutionName(Avm1ExecutionName.Dynamic, name), activation, Avm1Value.fromObject(this), _depth, args, reason, method);
		} else {
			return method.call(new Avm1ExecutionName(Avm1ExecutionName.Dynamic, name), activation, Avm1Value.fromObject(this), args);
		}
	}
	Avm1Object.prototype.isInstanceOf = function(activation, constructor, prototype) {
		var proto_stack = [];
		var p = this.getProto(activation);
		if (p.a == Avm1Value.Object) {
			proto_stack.push(p.b);
		}
		var this_proto;
		while(this_proto = proto_stack.pop()) {
			if (this_proto === prototype) {
				return true;
			}
			var p = this_proto.getProto(activation);
			if (p.a == Avm1Value.Object) {
				proto_stack.push(p.b);
			}
			if (activation.swfVersion >= 7) {
				var interfaces = this_proto.getInterfaces();
				for (var i = 0; i < interfaces.length; i++) {
					var interface = interfaces[i];
					if (interface === constructor) {
						return true;
					}
					var o = interface.get("prototype", activation);
					if (o.a == Avm1Value.Object) {
						proto_stack.push(o.b);
					}
				}
			}
		}
		return false;
	}
	Avm1Object.prototype.is_prototype_of = function(activation, other) {
		var proto = other.getProto(activation);
		while (true) {
			if (proto.a == Avm1Value.Object) {
				var proto_ob = proto.b;
				if (this === proto_ob) {
					return true;
				}
				proto = proto_ob.getProto(activation);
			} else {
				break;
			}
		}
		return false;
	}
	function avm1_search_prototype(proto, name, activation, _this, is_slash_path) {
		var depth = 0;
		var _proto = proto;
		var orig_proto = _proto; 
		while(true) {
			var p = (_proto.a == Avm1Value.Object) ? _proto.b : null;
			if (p) {
				if (depth == 255) {
					throw new Error("Error::PrototypeRecursionLimit");
				}
				var getter = p.getter(name, activation);
				if (getter) {
					var exec = getter.asExecutable();
					if (exec) {
						var result = exec.exec(new Avm1ExecutionName(Avm1ExecutionName.Static, "[Getter]"), activation, Avm1Value.fromObject(_this), 1, [], Avm1ExecutionReason.INSTANCE.Special, getter);
						return [result, depth];
					}
				}
				var b = p.getLocalStored(name, activation, is_slash_path);
				if (b) {
					return [b, depth];
				}
				_proto = p.getProto(activation);
				depth += 1;
			} else {
				break;
			}
		}
		return null;
	}
	var Avm1SuperObject = function(thisObject, depth) {
		this.thisObject = thisObject;
		this.depth = depth;
	}
	Avm1SuperObject.prototype.baseProto = function(activation) {
		var depth = this.depth;
		var proto = this.thisObject;
		for (var i = 0; i < depth; i++) {
			proto = proto.getProto(activation).coerceToObject(activation);
		}
		return proto;
	}
	Avm1SuperObject.prototype.getProto = function(activation) {
		return this.baseProto(activation).getProto(activation);
	}
	Avm1SuperObject.prototype.call = function(name, activation, args) {
		var constructor = this.baseProto(activation).get("__constructor__", activation).coerceToObject(activation);
		var constr = constructor.getNative();
		if (constr.type == Avm1NativeObject.Function) {
			return constr.data.asConstructor().exec(name, activation, Avm1Value.fromObject(this.thisObject), this.depth + 1, args, Avm1ExecutionReason.INSTANCE.FunctionCall, constructor);
		} else {
			return Avm1Value.INSTANCE.Undefined;
		}
	}
	Avm1SuperObject.prototype.callMethod = function(name, args, activation, reason) {
		var _this = this.thisObject;
		var method, depth;
		var s = avm1_search_prototype(this.getProto(activation), name, activation, _this, false);
		if (s) {
			var o = s[0];
			if (o.a = Avm1Value.Object) {
				method = o.b;
				depth = s[1];
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
		} else {
			return Avm1Value.INSTANCE.Undefined;
		}
		var exec = method.asExecutable();
		if (exec) {
			return exec.exec(new Avm1ExecutionName(Avm1ExecutionName.Dynamic, name), activation, Avm1Value.fromObject(_this), this.depth + depth + 1, args, reason, method);
		} else {
			return method.call(name, activation, Avm1Value.fromObject(_this), args);
		}
	}
	var Avm1Function = function(swf_version, actions, swf_function, scope, constant_pool, base_clip) {
		var encoding = SwfEncoding.encodingForVersion(swf_version);
		var name = encoding.decode(swf_function.name);
		var is2 = "registerCount" in swf_function;
		var params = [];
		for (var i = 0; i < swf_function.params.length; i++) {
			var a = swf_function.params[i];
			if (is2) {
				params.push({
					register: a.registerIndex,
					name: encoding.decode(a.name),
				});
			} else {
				params.push({
					register: null,
					name: encoding.decode(a),
				});
			}
		}
		this.swf_version = swf_version;
		this.data = actions;
		this.name = name;
		this.register_count = swf_function.registerCount || 0;
		this.params = params;
		this.scope = scope;
		this.constant_pool = constant_pool;
		this.base_clip = base_clip;
		this.preloadArguments = !!swf_function.preloadArguments;
		this.preloadGlobal = !!swf_function.preloadGlobal;
		this.preloadParent = !!swf_function.preloadParent;
		this.preloadRoot = !!swf_function.preloadRoot;
		this.preloadSuper = !!swf_function.preloadSuper;
		this.preloadThis = !!swf_function.preloadThis;
		this.suppressArguments = !!swf_function.suppressArguments;
		this.suppressSuper = !!swf_function.suppressSuper;
		this.suppressThis = !!swf_function.suppressThis;
	}
	Avm1Function.prototype.loadThis = function(frame, _this, preload_r) {
		var preload = this.preloadThis;
		var suppress = this.suppressThis;
		if (preload) {
			var __this = suppress ? Avm1Value.INSTANCE.Undefined : _this;
			frame.setLocalRegister(preload_r, __this);
			preload_r += 1;
		}
		return preload_r;
	}
	Avm1Function.prototype.loadArguments = function(frame, args, caller, preload_r) {
		var preload = this.preloadArguments;
		var suppress = this.suppressArguments;
		if (suppress && !preload) return preload_r;
		var _arguments = Avm1ArrayBuilder.createNew(frame).with(args);
		_arguments.defineValue("callee", (frame.callee ? Avm1Value.fromObject(frame.callee) : Avm1Value.INSTANCE.Undefined), new Avm1Attribute().dontEnum());
		_arguments.defineValue("caller", (caller ? Avm1Value.fromObject(caller) : Avm1Value.INSTANCE.Null), new Avm1Attribute().dontEnum());
		var __arguments = Avm1Value.fromObject(_arguments);
		if (preload) {
			frame.setLocalRegister(preload_r, __arguments);
			preload_r += 1;
		} else {
			frame.forceDefineLocal("arguments", __arguments);
		}
		return preload_r;
	}
	Avm1Function.prototype.loadSuper = function(frame, _this, depth, preload_r) {
		var preload = this.preloadSuper;
		var suppress = this.suppressSuper;
		var zuper;
		if (!suppress && _this) {
			var j = new Avm1NativeObject(Avm1NativeObject.Super, new Avm1SuperObject(_this, depth));
			zuper = Avm1Value.fromObject(Avm1Object.createNewWithNative(null, j));
		}
		if (preload) {
			frame.setLocalRegister(preload_r, zuper || Avm1Value.INSTANCE.Undefined);
			preload_r++;
		} else if (zuper) {
			frame.forceDefineLocal("super", zuper);
		}
		return preload_r;
	}
	Avm1Function.prototype.loadRoot = function(frame, preload_r) {
		if (this.preloadRoot) {
			var root = frame.base_clip.getAvm1Root().getObject();
			frame.setLocalRegister(preload_r, root);
			preload_r++;
		}
		return preload_r;
	}
	Avm1Function.prototype.loadParent = function(frame, preload_r) {
		if (this.preloadParent) {
			var parent = frame.base_clip.getAvm1Parent();
			if (parent) {
				frame.setLocalRegister(preload_r, parent.getObject());
				preload_r++;
			}
		}
		return preload_r;
	}
	Avm1Function.prototype.loadGlobal = function(frame, preload_r) {
		if (this.preloadGlobal) {
			var global = frame.context.avm1.globalObject();
			frame.setLocalRegister(preload_r, Avm1Value.fromObject(global));
			preload_r++;
		}
		return preload_r;
	}
	var Avm1Executable = function(type, data) {
		this.type = type;
		this.data = data;
	}
	Avm1Executable.prototype.exec = function(name, activation, _this, depth, args, reason, _callee) {
		var af = this.data;
		switch(this.type) {
			case Avm1Executable.Native:
				var __this = _this.coerceToObject(activation);
				return af(activation, __this, args);
		}
		var this_obj = (_this.a == Avm1Value.Object) ? _this.b : null;
		var target = activation.target_clip_or_root();
		var is_closure = activation.swfVersion >= 6;
		var base_clip;
		if ((is_closure || (reason.type == Avm1ExecutionReason.Special)) && !af.base_clip.AVM1_REMOVED) {
			base_clip = af.base_clip;
		} else {
			if (this_obj) {
				var _p = this_obj.asDisplayObject();
				if (_p) {
					base_clip = _p;
				} else {
					base_clip = target;
				}
			} else {
				base_clip = target;
			}
		}
		var swf_version, parent_scope;
		if (is_closure) {
			swf_version = af.swf_version;
			parent_scope = af.scope;
		} else {
			swf_version = Math.max(base_clip.swfVersion(), 5);
			var base_clip_obj = base_clip.getObject();
			if (base_clip_obj.a == Avm1Value.Object) {
				base_clip_obj = base_clip_obj.b;
			} else {
				throw new Error("unreachable");
			}
			var scope = new Avm1Scope(activation.context.avm1.globalScope, new Avm1ScopeClass(Avm1ScopeClass.Target), base_clip_obj);
			parent_scope = scope;
		}
		var child_scope = Avm1Scope.newLocalScope(parent_scope);
		var arguments_caller = activation.callee;
		var _name = "[Anonymous]";
		var is_this_inherited = af.preloadThis || af.suppressThis;
		var local_this = is_this_inherited ? activation.thisObject : _this;
		var max_recursion_depth = activation.context.avm1.maxRecursionDepth;
		var frame = Avm1Activation.fromAction(activation.context, activation.id.function(_name, reason, max_recursion_depth), swf_version, child_scope, af.constant_pool, base_clip, local_this, _callee);
		frame.allocateLocalRegisters(af.register_count);
		var preload_r = 1;
		preload_r = af.loadThis(frame, _this, preload_r);
		preload_r = af.loadArguments(frame, args, arguments_caller, preload_r);
		preload_r = af.loadSuper(frame, this_obj, depth, preload_r);
		preload_r = af.loadRoot(frame, preload_r);
		preload_r = af.loadParent(frame, preload_r);
		preload_r = af.loadGlobal(frame, preload_r);
		var params = af.params;
		for (var i = 0; i < params.length; i++) {
			var param = params[i];
			var value = args[i] || Avm1Value.INSTANCE.Undefined;
			if (param.register == null) {
				frame.forceDefineLocal(param.name, value);
			} else {
				frame.setLocalRegister(param.register, value);
			}
		}
		var g = frame.runActions(af.data);
		return g.getValue();
	}
	Avm1Executable.Native = 1;
	Avm1Executable.Action = 2;
	Avm1Executable.EMPTY = new Avm1Executable(Avm1Executable.Native, function(a, b, c) {
		return Avm1Value.INSTANCE.Undefined;
	});
	var Avm1FunctionObject = function(_function, _constructor) {
		this._function = _function;
		this._constructor = _constructor;
	}
	Avm1FunctionObject.bare_function = function(_function, _constructor, fn_proto) {
		var obj = Avm1Object.createNew(fn_proto);
		var native = new Avm1NativeObject(Avm1NativeObject.Function, new Avm1FunctionObject(_function, _constructor));
		obj.setNative(native);
		return obj;
	}
	Avm1FunctionObject.allocate_function = function(_function, _constructor, fn_proto, prototype) {
		var __function = Avm1FunctionObject.bare_function(_function, _constructor, fn_proto);
		prototype.defineValue("constructor", Avm1Value.fromObject(__function), new Avm1Attribute().dontEnum());
		__function.defineValue("prototype", Avm1Value.fromObject(prototype), new Avm1Attribute());
		return __function;
	}
	Avm1FunctionObject.createEmpty = function(fn_proto, prototype) {
		return Avm1FunctionObject.allocate_function(Avm1Executable.EMPTY, null, fn_proto, prototype);
	}
	Avm1FunctionObject.createFunction = function(_function, fn_proto, prototype) {
		return Avm1FunctionObject.allocate_function(new Avm1Executable(Avm1Executable.Action, _function), null, fn_proto, prototype);
	}
	Avm1FunctionObject.createNative = function(_function, fn_proto, prototype) {
		var __function = new Avm1Executable(Avm1Executable.Native, _function);
		return Avm1FunctionObject.allocate_function(__function, null, fn_proto, prototype);
	}
	Avm1FunctionObject.createConstructor = function(_constructor, _function, fn_proto, prototype) {
		return Avm1FunctionObject.allocate_function(new Avm1Executable(Avm1Executable.Native, _function), _constructor, fn_proto, prototype);
	}
	Avm1FunctionObject.prototype.asExecutable = function() {
		return this._function;
	}
	Avm1FunctionObject.prototype.asConstructor = function() {
		if (this._constructor) {
			return new Avm1Executable(Avm1Executable.Native, this._constructor);
		} else {
			return this._function;
		}
	}
	Avm1FunctionObject.prototype.isNativeConstructor = function() {
		return !!this._constructor;
	}
	Avm1FunctionObject.prototype.call = function(name, activation, callee, _this, args) {
		return this._function.exec(name, activation, _this, 0, args, Avm1ExecutionReason.INSTANCE.FunctionCall, callee);
	}
	Avm1FunctionObject.prototype.constructOnExisting = function(activation, callee, _this, args) {
		_this.defineValue("__constructor__", Avm1Value.fromObject(callee), new Avm1Attribute().dontEnum());
		if (activation.swfVersion < 7) {
			_this.defineValue("constructor", Avm1Value.fromObject(callee), new Avm1Attribute().dontEnum());
		}
		this.asConstructor().exec(new Avm1ExecutionName(Avm1ExecutionName.Static, "[ctor]"), activation, Avm1Value.fromObject(_this), 1, args, Avm1ExecutionReason.INSTANCE.FunctionCall, callee);
	}
	Avm1FunctionObject.prototype.construct = function(activation, callee, args) {
		var prototype = callee.get("prototype", activation).coerceToObject(this);
		var _this = Avm1Object.createNew(prototype);
		_this.defineValue("__constructor__", Avm1Value.fromObject(callee), new Avm1Attribute().dontEnum());
		if (activation.swfVersion < 7) {
			_this.defineValue("constructor", Avm1Value.fromObject(callee), new Avm1Attribute().dontEnum());
		}
		var result = this.asConstructor().exec(new Avm1ExecutionName(Avm1ExecutionName.Static, "[ctor]"), activation, Avm1Value.fromObject(_this), 1, args, Avm1ExecutionReason.INSTANCE.FunctionCall, callee);
		if (this.isNativeConstructor()) {
			return result;
		} else {
			return Avm1Value.fromObject(_this);
		}
	}
	var Avm1ArrayBuilder = function(proto) {
		this.length_prop = "length";
		this.proto_prop = "__proto__";
		this.proto = proto;
	}
	Avm1ArrayBuilder.createNew = function(activation) {
		var proto = activation.context.avm1.prototypes.array;
		return Avm1ArrayBuilder.new_with_proto(proto);
	}
	Avm1ArrayBuilder.new_with_proto = function(proto) {
		return new Avm1ArrayBuilder(proto);
	}
	Avm1ArrayBuilder.createEmpty = function(activation) {
		return Avm1ArrayBuilder.createNew(activation).with([]);
	}
	Avm1ArrayBuilder.prototype.init_with = function(_this, elements) {
		var length = 0;
		for (var i = 0; i < elements.length; i++) {
			var length_str = length + "";
			_this.defineValue(length_str, elements[i], new Avm1Attribute());
			length++;
		}
		_this.defineValue(this.length_prop, Avm1Value.fromNumber(length), new Avm1Attribute().dontEnum().dontDelete());
		_this.setNative(new Avm1NativeObject(Avm1NativeObject.Array, this));
	}
	Avm1ArrayBuilder.prototype.with = function(elements) {
		var obj = Avm1Object.createNew(null);
		obj.defineValue(this.proto_prop, Avm1Value.fromObject(this.proto), new Avm1Attribute().dontEnum().dontDelete());
		this.init_with(obj, elements);
		return obj;
	}
	var Avm1Sound = function(owner) {
		this.sound = null;
		this.sound_instance = null;
		this.owner = owner;
		this.position = 0;
		this.duration = null;
		this.is_streaming = false;
	}
	Avm1Sound.prototype.setSound = function(sound) {
		this.sound = sound;
	}
	Avm1Sound.prototype.setPosition = function(position) {
		this.position = position;
	}
	Avm1Sound.prototype.setIsStreaming = function(is_streaming) {
		this.is_streaming = is_streaming;
	}
	Avm1Sound.prototype.setSoundInstance = function(a) {
		this.sound_instance = a;
	}
	var Avm1ColorTransformObject = function(data) {
		this.red_multiplier = data.red_multiplier;
		this.green_multiplier = data.green_multiplier;
		this.blue_multiplier = data.blue_multiplier;
		this.alpha_multiplier = data.alpha_multiplier;
		this.red_offset = data.red_offset;
		this.green_offset = data.green_offset;
		this.blue_offset = data.blue_offset;
		this.alpha_offset = data.alpha_offset;
	}
	Avm1ColorTransformObject.construct = function(activation, color_transform) {
		var args = [
			Avm1Value.fromNumber(color_transform[0]),
			Avm1Value.fromNumber(color_transform[1]),
			Avm1Value.fromNumber(color_transform[2]),
			Avm1Value.fromNumber(color_transform[3]),
			Avm1Value.fromNumber(color_transform[4]),
			Avm1Value.fromNumber(color_transform[5]),
			Avm1Value.fromNumber(color_transform[6]),
			Avm1Value.fromNumber(color_transform[7])
		];
		var constructor = activation.context.avm1.prototypes.color_transform_constructor;
		return constructor.construct(activation, args);
	}
	Avm1ColorTransformObject.cast = function(value) {
		if (value.a == Avm1Value.Object) {
			var native = value.b.getNative();
			if (native.type == Avm1NativeObject.ColorTransform) {
				return native.data;
			}
		}
		return null;
	}
	Avm1ColorTransformObject.fromColorTransform = function(color_transform) {
		return [color_transform.red_multiplier, color_transform.green_multiplier, color_transform.blue_multiplier, color_transform.alpha_multiplier, color_transform.red_offset, color_transform.green_offset, color_transform.blue_offset, color_transform.alpha_offset];
	}
	Avm1ColorTransformObject.prototype.clone = function() {
		return new Avm1ColorTransformObject({
			red_multiplier: this.red_multiplier,
			green_multiplier: this.green_multiplier,
			blue_multiplier: this.blue_multiplier,
			alpha_multiplier: this.alpha_multiplier,
			red_offset: this.red_offset,
			green_offset: this.green_offset,
			blue_offset: this.blue_offset,
			alpha_offset: this.alpha_offset,
		});
	}
	Avm1ColorTransformObject.IDENTITY = new Avm1ColorTransformObject({
		red_multiplier: 1,
		green_multiplier: 1,
		blue_multiplier: 1,
		alpha_multiplier: 1,
		red_offset: 0,
		green_offset: 0,
		blue_offset: 0,
		alpha_offset: 0
	});
	var Avm1TransformObject = function(clip) {
		this.clip = clip;
	}
	Avm1TransformObject.createNew = function(activation, args) {
		var arg = args[0];
		if (arg) {
			var clip;
			switch (arg.a) {
				case Avm1Value.MovieClip:
					clip = arg.b;
					break;
				case Avm1Value.Object:
					clip = Avm1MovieClipReference.tryFromStagePbject(activation, arg.b);
					break;
				default:
					return null;
			}
			return new Avm1TransformObject(clip);
		} else {
			return null;
		}
	}
	Avm1TransformObject.prototype.getClip = function(activation) {
		var clip = this.clip;
		if (clip) {
			var res = clip.resolveReference(activation);
			return res ? res[2] : null;
		} else {
			return null;
		}
	}
	var Avm1FSCommand = {
		parse: function(url) {
			var prefix = "fscommand:";
			if (url.length < prefix.length) {
				return null;
			}
			var head = url.slice(0, prefix.length);
			var tail = url.slice(prefix.length);
			if (head == prefix) {
				return tail;
			} else {
				return null;
			}
		},
		handle: function(command, args, activation) {
			
		}
	}
	function avm1_define_properties_on(decls, _this, fn_proto) {
		for (var name in decls) {
			if (Object.prototype.hasOwnProperty.call(decls, name)) {
				var decl = decls[name];
				var value = Avm1Value.INSTANCE.Undefined;
				var a = new Avm1Attribute();
				var attributes = decl.attributes;
				if (attributes) {
					for (var i = 0; i < attributes.length; i++) {
						switch(attributes[i]) {
							case "DONT_ENUM":
								a.dontEnum();
								break;
							case "DONT_DELETE":
								a.dontDelete();
								break;
							case "READ_ONLY":
								a.readOnly();
								break;
						}
					}	
				}
				if (decl.version != null) {
					a.withVersion(decl.version);
				}
				switch(decl.type) {
					case "method":
						value = Avm1Value.fromObject(Avm1FunctionObject.bare_function(new Avm1Executable(Avm1Executable.Native, decl.fn), null, fn_proto));
						break;
					case "property":
						var getter = Avm1FunctionObject.createNative(decl.getter, fn_proto, fn_proto);
						var setter = decl.setter ? Avm1FunctionObject.createNative(decl.setter, fn_proto, fn_proto) : null;
						_this.addProperty(name, getter, setter, a);
						value = Avm1Value.INSTANCE.Undefined;
						break;
					case "number":
						value = Avm1Value.fromNumber(decl.number);
						break;
					case "string":
						value = Avm1Value.fromString(decl.string);
						break;
					case "boolean":
						value = Avm1Value.fromBoolean(decl.boolean);
						break;
				}
				if (decl.type != "property") _this.defineValue(name, value, a);
			}
		}
	}
	var avm1_globals = {};
	var AVM1_DEPTH_BIAS = 16384;
	var AVM1_MAX_DEPTH = 2130706428;
	var AVM1_MAX_REMOVE_DEPTH = 2130706416;
	var avm1_get_depth = function(activation, _this, _args) {
		var display_object = _this.asDisplayObject();
		if (display_object) {
			if (activation.swfVersion >= 6) {
				var depth = (display_object.getDepth() - AVM1_DEPTH_BIAS) | 0;
				return Avm1Value.fromNumber(depth);
			}
		}
		return Avm1Value.INSTANCE.Undefined;
	}
	var avm1_remove_display_object = function(_this, activation) {
		var depth = _this.getDepth();
		if ((depth >= AVM1_DEPTH_BIAS) && (depth < AVM1_MAX_REMOVE_DEPTH) && !_this.AVM1_REMOVED) {
			var parent = _this.getAvm1Parent();
			if (parent) {
				if (parent instanceof MovieClip) {
					parent.removeChild(activation.context, _this);
				}
			}
		}
	}
	avm1_globals.todo = function(n) {
		return function(a, b, c) {
			console.log("TODO:" + n, b, c);
			return Avm1Value.INSTANCE.Undefined;
		}
	}
	avm1_globals.object = (function(){
		var PROTO_DECLS = {
			"addProperty": {
				type: "method",
				fn: add_property,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"hasOwnProperty": {
				type: "method",
				fn: has_own_property,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"isPropertyEnumerable": {
				type: "method",
				fn: avm1_globals.todo("isPropertyEnumerable"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"isPrototypeOf": {
				type: "method",
				fn: is_prototype_of,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"toString": {
				type: "method",
				fn: to_string,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"valueOf": {
				type: "method",
				fn: value_of,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"watch": {
				type: "method",
				fn: avm1_globals.todo("watch"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"unwatch": {
				type: "method",
				fn: avm1_globals.todo("unwatch"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
		};
		var OBJECT_DECLS = {
			"registerClass": {
				type: "method",
				fn: register_class,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
		};
		function _constructor(activation, _this, args) {
			var __this = args[0] || Avm1Value.INSTANCE.Undefined;
			switch(__this.a) {
				case Avm1Value.Undefined:
				case Avm1Value.Null:
					__this = _this;
					break;
				default:
					__this = __this.coerceToObject(activation);
			}
			return Avm1Value.fromObject(__this);
		}
		function object_function(activation, _this, args) {
			var __this = args[0] || Avm1Value.INSTANCE.Undefined;
			var obj;
			switch(__this.a) {
				case Avm1Value.Undefined:
				case Avm1Value.Null:
					obj = Avm1Object.createNew(null);
					break;
				default:
					obj = __this.coerceToObject(activation);
			}
			return Avm1Value.fromObject(obj);
		}
		function add_property(activation, _this, args) {
			if (args[0]) {
				var name = args[0].coerceToString(activation);
				var getter = args[1] || Avm1Value.INSTANCE.Undefined;
				var setter = args[2] || Avm1Value.INSTANCE.Undefined;
				if ((getter.a == Avm1Value.Object) && name) {
					var get = getter.b;
					if (setter.a == Avm1Value.Object) {
						var set = setter.b;
						_this.addPropertyWithCase(activation, name, get, set, new Avm1Attribute().readOnly());
					} else if (setter.a == Avm1Value.Null) {
						_this.addPropertyWithCase(activation, name, get, null, new Avm1Attribute().readOnly());
					} else {
						return Avm1Value.fromBoolean(false);
					}
					return Avm1Value.fromBoolean(true);
				} else {
					return Avm1Value.fromBoolean(false);
				}
			}
			return Avm1Value.fromBoolean(false);
		}
		function has_own_property(activation, _this, args) {
			var value = args[0];
			if (value) {
				var name = value.coerceToString(activation);
				return Avm1Value.fromBoolean(_this.has_own_property(activation, name));
			} else {
				return Avm1Value.fromBoolean(false);
			}
		}
		function is_prototype_of(activation, _this, args) {
			var value = args[0];
			if (value) {
				var ob = value.coerceToObject(activation);
				return Avm1Value.fromBoolean(_this.is_prototype_of(activation, ob));
			} else {
				return Avm1Value.fromBoolean(false);
			}
		}
		function register_class(activation, _this, args) {
			var class_name = args[0], constructor = args[1];
			if (class_name && constructor) {
			} else {
				return Avm1Value.fromBoolean(false);
			}
			if (constructor.a == Avm1Value.Undefined || constructor.a == Avm1Value.Null) {
				constructor = null;
			} else if (constructor.a == Avm1Value.Object) {
				constructor = constructor.b.asExecutable() ? constructor.b : null;
			} else {
				return Avm1Value.fromBoolean(false);
			}
			class_name = class_name.coerceToString(activation);
			activation.context.avm1.registerConstructor(activation.base_clip.getMovie().version, class_name, constructor);
			return Avm1Value.fromBoolean(true);
		}
		function to_string(activation, _this, args) {
			var r = _this.asExecutable() ? "[type Function]" : "[object Object]";
			return Avm1Value.fromString(r);
		}
		function value_of(activation, _this, args) {
			return Avm1Value.fromObject(_this);
		}
		return {
			create_object_object: function(proto, fn_proto) {
				var _object_function = Avm1FunctionObject.createConstructor(_constructor, object_function, fn_proto, proto);
				avm1_define_properties_on(OBJECT_DECLS, _object_function, fn_proto);
				return _object_function;
			},
			fill_proto: function(object_proto, fn_proto) {
				avm1_define_properties_on(PROTO_DECLS, object_proto, fn_proto);
			}
		};
	}());
	avm1_globals.function = (function(){
		var PROTO_DECLS = {
			"call": {
				type: "method",
				fn: _call,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"apply": {
				type: "method",
				fn: _apply,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
		};
		function _call(activation, func, myargs) {
			var _this = myargs[0] || Avm1Value.INSTANCE.Undefined;
			if (_this.a == Avm1Value.Undefined || _this.a == Avm1Value.Null) {
				_this = activation.context.avm1.globalObject();
			} else {
				_this = _this.coerceToObject(activation);
			}
			var empty = [];
			var args;
			switch(myargs.length) {
				case 0:
				case 1:
					args = empty;
					break;
				default:
					args = myargs.slice(1);
			}
			var exec = func.asExecutable();
			if (exec) {
				return exec.exec(new Avm1ExecutionName(Avm1ExecutionName.Static, "[Anonymous]"), activation, Avm1Value.fromObject(_this), 1, args, Avm1ExecutionReason.INSTANCE.FunctionCall, func);
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
		}
		function _apply(activation, func, myargs) {
			var _this;
			var a = myargs[0] || Avm1Value.INSTANCE.Undefined;
			if (a.a == Avm1Value.Undefined || a.a == Avm1Value.Null) {
				_this = activation.context.avm1.globalObject();
			} else {
				_this = a.coerceToObject(activation);
			}
			var args_object = myargs[1] || Avm1Value.INSTANCE.Undefined;
			var length = 0;
			if (args_object.a == Avm1Value.Object) {
				length = args_object.b.getLength(activation);
			}
			var child_args = [];
			while(child_args.length < length) {
				var args = args_object.coerceToObject(activation);
				var next_arg = args.get(child_args.length + "", activation);
				child_args.push(next_arg);
			}
			var exec = func.asExecutable();
			return exec ? exec.exec(new Avm1ExecutionName(Avm1ExecutionName.Static, "[Anonymous]"), activation, Avm1Value.fromObject(_this), 1, child_args, Avm1ExecutionReason.INSTANCE.FunctionCall, func) : Avm1Value.INSTANCE.Undefined;
		}
		function _constructor(activation, _this, args) {
			return args[0] || Avm1Value.fromObject(_this);
		}
		function _function(activation, _this, args) {
			return args[0] || Avm1Value.fromObject(Avm1Object.createNew(null));
		}
		return {
			constructor: _constructor,
			function: _function,
			create_proto: function(proto) {
				var function_proto = Avm1Object.createNew(proto);
				avm1_define_properties_on(PROTO_DECLS, function_proto, proto);
				return function_proto;
			}
		};
	}());
	avm1_globals.number = (function(){
		var PROTO_DECLS = {
			"toString": {
				type: "method",
				fn: to_string,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"valueOf": {
				type: "method",
				fn: value_of,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
		};
		var OBJECT_DECLS = {
			"MAX_VALUE": {
				type: "number",
				number: Number.MAX_VALUE,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"MIN_VALUE": {
				type: "number",
				number: 5e-324,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"NaN": {
				type: "number",
				number: NaN,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"NEGATIVE_INFINITY": {
				type: "number",
				number: -Infinity,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"POSITIVE_INFINITY": {
				type: "number",
				number: Infinity,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
		};
		function number(activation, _this, args) {
			var value = ("0" in args) ? args[0].coerceToNumber(activation) : 0;
			_this.setNative(new Avm1NativeObject(Avm1NativeObject.Number, value));
			return Avm1Value.fromObject(_this);
		}
		function number_function(activation, _this, args) {
			var value = ("0" in args) ? args[0].coerceToNumber(activation) : 0;
			return Avm1Value.fromNumber(value);
		}
		function to_string(activation, _this, args) {
			var number;
			var native =  _this.getNative();
			if (native.type == Avm1NativeObject.Number) {
				number = native.data;
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
			return Avm1Value.fromString(number.toString());
		}
		function value_of(activation, _this, args) {
			var native =  _this.getNative();
			if (native.type == Avm1NativeObject.Number) {
				return Avm1Value.fromNumber(native.data);
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		return {
			number: number,
			create_number_object: function(number_proto, fn_proto) {
				var _number = Avm1FunctionObject.createConstructor(number, number_function, fn_proto, number_proto);
				avm1_define_properties_on(OBJECT_DECLS, _number, fn_proto);
				return _number;
			},
			create_proto: function(proto, fn_proto) {
				var number_proto = Avm1Object.createNew(proto);
				avm1_define_properties_on(PROTO_DECLS, number_proto, fn_proto);
				return number_proto;
			}
		};
	}());
	avm1_globals.string = (function(){
		var PROTO_DECLS = {
			"toString": {
				type: "method",
				fn: to_string_value_of,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"valueOf": {
				type: "method",
				fn: to_string_value_of,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"charAt": {
				type: "method",
				fn: char_at,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"charCodeAt": {
				type: "method",
				fn: char_code_at,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"concat": {
				type: "method",
				fn: concat,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"indexOf": {
				type: "method",
				fn: index_of,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"lastIndexOf": {
				type: "method",
				fn: last_index_of,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"slice": {
				type: "method",
				fn: slice,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"split": {
				type: "method",
				fn: split,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"substr": {
				type: "method",
				fn: substr,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"substring": {
				type: "method",
				fn: substring,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"toLowerCase": {
				type: "method",
				fn: to_lower_case,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"toUpperCase": {
				type: "method",
				fn: to_upper_case,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			}
		};
		var OBJECT_DECLS = {
			"fromCharCode": {
				type: "method",
				fn: from_char_code,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			}
		};
		function to_string_value_of(activation, _this, args) {
			var string;
			var native = _this.getNative();
			if (native.type == Avm1NativeObject.String) {
				string = native.data;
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
			return Avm1Value.fromString(string);
		}
		function string(activation, _this, args) {
			var value = ("0" in args) ? args[0].coerceToString(activation) : "";
			_this.setNative(new Avm1NativeObject(Avm1NativeObject.String, value));
			_this.defineValue("length", Avm1Value.fromNumber(value.length), new Avm1Attribute().dontEnum().dontDelete());
			return Avm1Value.fromObject(_this);
		}
		function string_function(activation, _this, args) {
			var value = ("0" in args) ? args[0].coerceToString(activation) : "";
			return Avm1Value.fromString(value);
		}
		function concat(activation, _this, args) {
			var ret = Avm1Value.fromObject(_this).coerceToString(activation);
			for (var i = 0; i < args.length; i++) {
				var s = args[i].coerceToString(activation);
				ret += s;
			}
			return Avm1Value.fromString(ret);
		}
		function char_at(activation, _this, args) {
			var this_val = Avm1Value.fromObject(_this);
			var str = this_val.coerceToString(activation);
			var i = (args[0] || Avm1Value.INSTANCE.Undefined).coerceToI32(activation);
			var ret = str[i] || "";
			return Avm1Value.fromString(ret);
		}
		function char_code_at(activation, _this, args) {
			var this_val = Avm1Value.fromObject(_this);
			var str = this_val.coerceToString(activation);
			var i = (args[0] || Avm1Value.INSTANCE.Undefined).coerceToI32(activation);
			var is_swf5 = activation.swfVersion == 5;
			if (i >= 0) {
				var ret = str.charCodeAt(i);
				return Avm1Value.fromNumber(Number.isFinite(ret) ? ret : (is_swf5 ? 0 : NaN));
			} else {
				return Avm1Value.fromNumber(NaN);
			}
		}
		function index_of(activation, _this, args) {
			var str = Avm1Value.fromObject(_this).coerceToString(activation);
			var pattern = args[0];
			if (pattern) {
				pattern = pattern.coerceToString(activation);
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
			var start_index = args[1];
			if (start_index) {
				if (start_index.a == Avm1Value.Undefined) {
					start_index = 0;
				} else {
					start_index = Math.max(start_index.coerceToI32(activation), 0);
				}
			} else {
				start_index = 0;
			}
			var res = str.slice(start_index).indexOf(pattern);
			return Avm1Value.fromNumber((res >= 0) ? (res + start_index) : -1);
		}
		function last_index_of(activation, _this, args) {
			var str = Avm1Value.fromObject(_this).coerceToString(activation);
			var pattern = args[0];
			if (pattern) {
				pattern = pattern.coerceToString(activation);
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
			var start_index = args[1];
			if (start_index) {
				if (start_index.a == Avm1Value.Undefined) {
					start_index = 0;
				} else {
					start_index = start_index.coerceToI32(activation);
					if (start_index >= 0) {
						
					} else {
						return Avm1Value.fromNumber(-1);
					}
				}
			} else {
				start_index = 0;
			}
			var res = str.slice(0, start_index).lastIndexOf(pattern);
			return Avm1Value.fromNumber((res >= 0) ? res : -1);
		}
		function string_wrapping_index(i, len) {
			if (i < 0) {
				var offset = -i;
				return Math.max(len - offset, 0);
			} else {
				return Math.min(i, len);
			}
		}
		function slice(activation, _this, args) {
			if (!args.length) return Avm1Value.INSTANCE.Undefined;
			var str = Avm1Value.fromObject(_this).coerceToString(activation);
			var start_index = string_wrapping_index((args[0] || Avm1Value.INSTANCE.Undefined).coerceToI32(activation), str.length);
			var end_index = args[1];
			if (end_index) {
				if (end_index.a == Avm1Value.Undefined) {
					end_index = str.length;
				} else {
					end_index = string_wrapping_index(end_index.coerceToI32(activation), str.length);
				}
			} else {
				end_index = str.length;
			}
			if (start_index < end_index) {
				return Avm1Value.fromString(str.slice(start_index, end_index));
			} else {
				return Avm1Value.fromString("");
			}
		}
		function substr(activation, _this, args) {
			if (!args.length) return Avm1Value.INSTANCE.Undefined;
			var str = Avm1Value.fromObject(_this).coerceToString(activation);
			var start_index = string_wrapping_index((args[0] || Avm1Value.INSTANCE.Undefined).coerceToI32(activation), str.length);
			var len = args[1];
			if (len) {
				if (len.a == Avm1Value.Undefined) {
					len = str.length;
				} else {
					len = len.coerceToI32(activation);
				}
			} else {
				len = str.length;
			}
			var end_index = string_wrapping_index(start_index + len, str.length);
			if (start_index < end_index) {
				return Avm1Value.fromString(str.slice(start_index, end_index));
			} else {
				return Avm1Value.fromString("");
			}
		}
		function substring(activation, _this, args) {
			if (!args.length) return Avm1Value.INSTANCE.Undefined;
			var str = Avm1Value.fromObject(_this).coerceToString(activation);
			var start_index = string_wrapping_index((args[0] || Avm1Value.INSTANCE.Undefined).coerceToI32(activation), str.length);
			var end_index = args[1];
			if (end_index) {
				if (end_index.a == Avm1Value.Undefined) {
					end_index = str.length;
				} else {
					end_index = string_wrapping_index(end_index.coerceToI32(activation), str.length);
				}
			} else {
				end_index = str.length;
			}
			if (end_index < start_index) {
				var a = end_index;
				var b = start_index;
				end_index = b;
				start_index = a;
			}
			return Avm1Value.fromString(str.slice(start_index, end_index));
		}
		function split(activation, _this, args) {
			return Avm1Value.INSTANCE.Undefined;
		}
		function to_lower_case(activation, _this, args) {
			var str = Avm1Value.fromObject(_this).coerceToString(activation);
			return Avm1Value.fromString(str.toLowerCase());
		}
		function to_upper_case(activation, _this, args) {
			var str = Avm1Value.fromObject(_this).coerceToString(activation);
			return Avm1Value.fromString(str.toUpperCase());
		}
		function from_char_code(activation, _this, args) {
			var out = "";
			for (var i = 0; i < args.length; i++) {
				var s = args[i].coerceToI32(activation) << 16 >>> 16;
				if (s == 0) break;
				out += String.fromCharCode(s);
			}
			return Avm1Value.fromString(out);
		}
		return {
			string: string,
			create_string_object: function(string_proto, fn_proto) {
				var _string = Avm1FunctionObject.createConstructor(string, string_function, fn_proto, string_proto);
				avm1_define_properties_on(OBJECT_DECLS, _string, fn_proto);
				return _string;
			},
			create_proto: function(string_proto, fn_proto) {
				var _string_proto = Avm1Object.createNew(string_proto);
				avm1_define_properties_on(PROTO_DECLS, _string_proto, fn_proto);
				return _string_proto;
			}
		};
	}());
	avm1_globals.boolean = (function(){
		var PROTO_DECLS = {
			"toString": {
				type: "method",
				fn: to_string,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"valueOf": {
				type: "method",
				fn: value_of,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
		};
		function to_string(activation, _this, args) {
			var string;
			var native = _this.getNative();
			if (native.type == Avm1NativeObject.Bool) {
				string = native.data ? "true" : "false";
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
			return Avm1Value.fromString(string);
		}
		function value_of(activation, _this, args) {
			var native = _this.getNative();
			if (native.type == Avm1NativeObject.Bool) {
				return Avm1Value.fromBoolean(native.data);
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
		}
		function _constructor(activation, _this, args) {
			var value = ("0" in args) ? args[0].asBool(activation.swfVersion) : false;
			_this.setNative(new Avm1NativeObject(Avm1NativeObject.Bool, value));
			return Avm1Value.fromObject(_this);
		}
		function boolean_function(activation, _this, args) {
			return ("0" in args) ? Avm1Value.fromBoolean(args[0].asBool(activation.swfVersion)) : Avm1Value.INSTANCE.Undefined;
		}
		return {
			constructor: _constructor,
			create_boolean_object: function(boolean_proto, fn_proto) {
				return Avm1FunctionObject.createConstructor(_constructor, boolean_function, fn_proto, boolean_proto);
			},
			create_proto: function(proto, fn_proto) {
				var boolean_proto = Avm1Object.createNew(proto);
				avm1_define_properties_on(PROTO_DECLS, boolean_proto, fn_proto);
				return boolean_proto;
			}
		};
	}());
	avm1_globals.array = (function(){
		var PROTO_DECLS = {
			"push": {
				type: "method",
				fn: push,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"pop": {
				type: "method",
				fn: pop,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"join": {
				type: "method",
				fn: join,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"slice": {
				type: "method",
				fn: slice,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"toString": {
				type: "method",
				fn: to_string,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"reverse": {
				type: "method",
				fn: avm1_globals.todo("reverse"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"unshift": {
				type: "method",
				fn: unshift,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"shift": {
				type: "method",
				fn: shift,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"splice": {
				type: "method",
				fn: splice,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"concat": {
				type: "method",
				fn: concat,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"sort": {
				type: "method",
				fn: avm1_globals.todo("sort"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"sortOn": {
				type: "method",
				fn: avm1_globals.todo("sortOn"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
		};
		function _constructor(activation, _this, args) {
			var builder = Avm1ArrayBuilder.createNew(activation);
			if ((args.length <= 1) && (args[0] && (args[0].a == Avm1Value.Number))) {
				builder.init_with(_this, []);
				_this.setLength(activation, clampToI32(args[0].b));
			} else {
				builder.init_with(_this, args);
			}
			return Avm1Value.fromObject(_this);
		}
		function array(activation, _this, args) {
			if ((args.length <= 1) && (args[0] && (args[0].a == Avm1Value.Number))) {
				var a = Avm1ArrayBuilder.createEmpty(activation);
				a.setLength(activation, clampToI32(args[0].b));
				return Avm1Value.fromObject(a);
			} else {
				return Avm1Value.fromObject(Avm1ArrayBuilder.createNew(activation).with(args));
			}
		}
		function push(activation, _this, args) {
			var old_length = _this.getLength(activation);
			for (var i = 0; i < args.length; i++) {
				var arg = args[i];
				_this.setElement(activation, old_length + i, arg);
			}
			var new_length = old_length + args.length;
			_this.setLength(activation, new_length);
			return Avm1Value.fromNumber(new_length);
		}
		function unshift(activation, _this, args) {
			var old_length = _this.getLength(activation);
			var new_length = old_length + args.length;
			for (var i = 0; i < old_length; i++) {
				var from = old_length - i - 1;
				var to = new_length - i - 1;
				if (_this.hasElement(activation, from)) {
					var element = _this.getElement(activation, from);
					_this.setElement(activation, to, element);
				} else {
					_this.deleteElement(activation, to);
				}
			}
			for (var i = 0; i < args.length; i++) {
				_this.setElement(activation, i, args[i]);
			}
			if (_this.getNative().type == Avm1NativeObject.Array) {
				_this.setLength(activation, new_length);
			}
			return Avm1Value.fromNumber(new_length);
		}
		function shift(activation, _this, args) {
			var length = _this.getLength(activation);
			if (length == 0)
				return Avm1Value.INSTANCE.Undefined;
			var first = _this.getElement(activation, 0);
			for (var i = 1; i < length; i++) {
				if (_this.hasElement(activation, i)) {
					var element = _this.getElement(activation, i);
					_this.setElement(activation, i - 1, element);
				} else {
					_this.deleteElement(activation, i - 1);
				}
			}
			_this.deleteElement(activation, length - 1);
			if (_this.getNative().type == Avm1NativeObject.Array) {
				_this.setLength(activation, length - 1);
			}
			return first;
		}
		function concat(activation, _this, args) {
			var elements = [];
			var _args = [Avm1Value.fromObject(_this)];
			for (var i = 0; i < args.length; i++) {
				_args.push(args[i]);
			}
			for (var i = 0; i < _args.length; i++) {
				var value = _args[i];
				var array_object = null;
				if (value.a == Avm1Value.Object) {
					var object = value.b;
					if (object.getNative().type == Avm1NativeObject.Array) {
						array_object = object;
					}
				}
				if (array_object) {
					var length = array_object.getLength(activation);
					for (var j = 0; j < length; j++) {
						var element = array_object.getElement(activation, j);
                		elements.push(element);
					}
				} else {
					elements.push(value);
				}
			}
			return Avm1Value.fromObject(Avm1ArrayBuilder.createNew(activation).with(elements));
		}
		function pop(activation, _this, args) {
			var length = _this.getLength(activation);
			if (length == 0) 
				return Avm1Value.INSTANCE.Undefined;
			var last = _this.getElement(activation, length - 1);
			_this.deleteElement(activation, length - 1);
			if (_this.getNative().type == Avm1NativeObject.Array) {
				_this.setLength(activation, length - 1);
			}
			return last;
		}
		function join(activation, _this, args) {
			var length = _this.getLength(activation);
			var separator;
			if (args[0]) {
				separator = args[0].coerceToString(activation);
			} else {
				separator = ",";
			}
			if (length <= 0) {
				return Avm1Value.fromString("");
			}
			var parts = [];
			for (var i = 0; i < length; i++) {
				var element = _this.getElement(activation, i);
				parts.push(element.coerceToString(activation));
			}
			var joined = parts.join(separator);
			return Avm1Value.fromString(joined);
		}
		function make_index_absolute(index, length) {
			if (index < 0) {
				return Math.max((index + length), 0);
			} else {
				return Math.min(index, length);
			}
		}
		function slice(activation, _this, args) {
			var length = _this.getLength(activation);
			var start = make_index_absolute((args[0] || Avm1Value.INSTANCE.Undefined).coerceToI32(activation), length);
			var end = args[1] || Avm1Value.INSTANCE.Undefined;
			if (end.a == Avm1Value.Undefined) {
				end = length;
			} else {
				end = make_index_absolute(end.coerceToI32(activation), length);
			}
			var elements = [];
			for (var i = start; i < end; i++) {
				elements.push(_this.getElement(activation, i));
			}
			return Avm1Value.fromObject(Avm1ArrayBuilder.createNew(activation).with(elements));
		}
		function splice(activation, _this, args) {
			var start = args[0];
			if (!start) return Avm1Value.INSTANCE.Undefined;
			var length = _this.getLength(activation);
			start = make_index_absolute(start.coerceToI32(activation), length);
			var delete_count;
			var arg = args[1];
			if (arg) {
				var _delete_count = arg.coerceToI32(activation);
				if (_delete_count < 0) return Avm1Value.INSTANCE.Undefined;
				delete_count = Math.min(_delete_count, length - start);
			} else {
				delete_count = length - start;
			}
			var result = [];
			for (var i = 0; i < delete_count; i++) {
				result.push(_this.getElement(activation, start + i));
			}
			result = Avm1ArrayBuilder.createNew(activation).with(result);
			function splice_internal(activation, _this, delete_count, items, i) {
				if (_this.hasElement(activation, i)) {
					var element = _this.getElement(activation, i);
					_this.setElement(activation, i - delete_count + items.length, element);
				} else {
					_this.deleteElement(activation, i - delete_count + items.length);
				}
				return Avm1Value.INSTANCE.Undefined;
			}
			var items = (args.length > 2) ? args.slice(2) : [];
			if (items.length > delete_count) {
				for (var i = length - 1; i >= (start + delete_count); i--) {
					splice_internal(activation, _this, delete_count, items, i);
				}
			} else {
				for (var i = (start + delete_count); i < length; i++) {
					splice_internal(activation, _this, delete_count, items, i);
				}
			}
			for (var i = 0; i < items.length; i++) {
				var item = items[i];
				_this.setElement(activation, start + i, item);
			}
			_this.setLength(activation, length - delete_count + items.length);
			return Avm1Value.fromObject(result);
		}
		function to_string(activation, _this, args) {
			return join(activation, _this, []);
		}
		return {
			create_array_object: function(array_proto, fn_proto) {
				var _array = Avm1FunctionObject.createConstructor(_constructor, array, fn_proto, array_proto);
				return _array;
			},
			create_proto: function(proto, fn_proto) {
				var _array = Avm1ArrayBuilder.new_with_proto(proto).with([]);
				avm1_define_properties_on(PROTO_DECLS, _array, fn_proto);
				return _array;
			}
		};
	}());
	avm1_globals.math = (function(){
		function wrap_std(std) {
			return function(activation, _this, args) {
				var input = args[0];
				if (input) {
					return Avm1Value.fromNumber(std(input.coerceToNumber(activation)));
				} else {
					return Avm1Value.fromNumber(NaN);
				}
			}
		}
		var OBJECT_DECLS = {
			"E": {
				type: "number",
				number: Math.E,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"LN10": {
				type: "number",
				number: Math.LN10,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"LN2": {
				type: "number",
				number: Math.LN2,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"LOG10E": {
				type: "number",
				number: Math.LOG10E,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"LOG2E": {
				type: "number",
				number: Math.LOG2E,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"PI": {
				type: "number",
				number: Math.PI,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"SQRT1_2": {
				type: "number",
				number: Math.SQRT1_2,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"SQRT2": {
				type: "number",
				number: Math.SQRT2,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"abs": {
				type: "method",
				fn: wrap_std(Math.abs),
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"acos": {
				type: "method",
				fn: wrap_std(Math.acos),
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"asin": {
				type: "method",
				fn: wrap_std(Math.asin),
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"atan": {
				type: "method",
				fn: wrap_std(Math.atan),
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"ceil": {
				type: "method",
				fn: wrap_std(Math.ceil),
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"cos": {
				type: "method",
				fn: wrap_std(Math.cos),
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"exp": {
				type: "method",
				fn: wrap_std(Math.exp),
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"floor": {
				type: "method",
				fn: wrap_std(Math.floor),
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"sin": {
				type: "method",
				fn: wrap_std(Math.sin),
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"sqrt": {
				type: "method",
				fn: wrap_std(Math.sqrt),
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"tan": {
				type: "method",
				fn: wrap_std(Math.tan),
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"log": {
				type: "method",
				fn: wrap_std(Math.log),
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"atan2": {
				type: "method",
				fn: atan2,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"pow": {
				type: "method",
				fn: pow,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"max": {
				type: "method",
				fn: max,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"min": {
				type: "method",
				fn: min,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"random": {
				type: "method",
				fn: random,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"round": {
				type: "method",
				fn: round,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
		}
		function atan2(activation, _this, args) {
			var y = args[0];
			if (y) {
				var x = args[1];
				if (x) {
					return Avm1Value.fromNumber(Math.atan2(y.coerceToNumber(activation), x.coerceToNumber(activation)));
				} else {
					return Avm1Value.fromNumber(Math.atan2(y.coerceToNumber(activation), 0));
				}
			}
			return Avm1Value.fromNumber(NaN);
		}
		function pow(activation, _this, args) {
			var y = args[0];
			if (y) {
				var x = args[1];
				if (x) {
					x = x.coerceToNumber(activation);
					if (Number.isNaN(x)) {
						return Avm1Value.fromNumber(NaN);
					}
					return Avm1Value.fromNumber(Math.pow(y.coerceToNumber(activation), x));
				}
			}
			return Avm1Value.fromNumber(NaN);
		}
		function max(activation, _this, args) {
			var a = args[0];
			if (a) {
				a = a.coerceToNumber(activation);
				var b = args[1];
				if (b) {
					b = b.coerceToNumber(activation);
					return Avm1Value.fromNumber(Math.max(a, b));
				}
				return Avm1Value.fromNumber(NaN);
			}
			return Avm1Value.fromNumber(-Infinity);
		}
		function min(activation, _this, args) {
			var a = args[0];
			if (a) {
				a = a.coerceToNumber(activation);
				var b = args[1];
				if (b) {
					b = b.coerceToNumber(activation);
					return Avm1Value.fromNumber(Math.min(a, b));
				}
				return Avm1Value.fromNumber(NaN);
			}
			return Avm1Value.fromNumber(Infinity);
		}
		function random(activation, _this, args) {
			var MAX_VAL = 0x7FFFFFFF;
			return Avm1Value.fromNumber(((Math.random() * MAX_VAL) >>> 0) / MAX_VAL);
		}
		function round(activation, _this, args) {
			var x = args[0];
			if (x) {
				x = x.coerceToNumber(activation);
				return Avm1Value.fromNumber(Math.floor(x + 0.5));
			}
			return Avm1Value.fromNumber(NaN);
		}
		return {
			create: function(proto, fn_proto) {
				var _math = Avm1Object.createNew(proto);
				avm1_define_properties_on(OBJECT_DECLS, _math, fn_proto);
				return _math;
			}
		}
	}());
	avm1_globals.movieclip = (function(){
		function mc_method(fn) {
			return function(activation, _this, args) {
				var native = _this.getNative();
				var display_object = native.asDisplayObject();
				if (display_object) {
					if (display_object instanceof MovieClip) {
						return fn(display_object, activation, args);
					}
				}
				return Avm1Value.INSTANCE.Undefined;
			}
		}
		function mc_getter(fn) {
			return function(activation, _this, args) {
				var native = _this.getNative();
				var display_object = native.asDisplayObject();
				if (display_object) {
					if (display_object instanceof MovieClip) {
						return fn(display_object, activation);
					}
				}
				return Avm1Value.INSTANCE.Undefined;
			}
		}
		function mc_setter(fn) {
			return function(activation, _this, args) {
				var native = _this.getNative();
				var display_object = native.asDisplayObject();
				if (display_object) {
					if (display_object instanceof MovieClip) {
						var value = args[0] || Avm1Value.INSTANCE.Undefined;
						return fn(display_object, activation, value);
					}
				}
				return Avm1Value.INSTANCE.Undefined;
			}
		}
		var PROTO_DECLS = {
			"play": {
				type: "method",
				fn: mc_method(play),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"stop": {
				type: "method",
				fn: mc_method(stop),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"attachMovie": {
				type: "method",
				fn: mc_method(attach_movie),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"duplicateMovieClip": {
				type: "method",
				fn: mc_method(duplicate_movie_clip),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"gotoAndPlay": {
				type: "method",
				fn: mc_method(goto_and_play),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"gotoAndStop": {
				type: "method",
				fn: mc_method(goto_and_stop),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"getBytesLoaded": {
				type: "method",
				fn: mc_method(get_bytes_loaded),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"getBounds": {
				type: "method",
				fn: mc_method(get_bounds),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"getBytesTotal": {
				type: "method",
				fn: mc_method(get_bytes_total),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"getRect": {
				type: "method",
				fn: mc_method(get_rect),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"prevFrame": {
				type: "method",
				fn: mc_method(prev_frame),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"nextFrame": {
				type: "method",
				fn: mc_method(next_frame),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"swapDepths": {
				type: "method",
				fn: mc_method(swap_depths),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"hitTest": {
				type: "method",
				fn: mc_method(hit_test),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"localToGlobal": {
				type: "method",
				fn: mc_method(local_to_global),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"globalToLocal": {
				type: "method",
				fn: mc_method(global_to_local),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"getDepth": {
				type: "method",
				fn: avm1_get_depth,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"getInstanceAtDepth": {
				type: "method",
				fn: mc_method(get_instance_at_depth),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"getNextHighestDepth": {
				type: "method",
				fn: mc_method(get_next_highest_depth),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"removeMovieClip": {
				type: "method",
				fn: remove_movie_clip,
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"transform": {
				type: "property",
				getter: mc_getter(transform),
				setter: mc_setter(set_transform),
				attributes: ["DONT_ENUM"]
			},
			"createEmptyMovieClip": {
				type: "method",
				fn: mc_method(create_empty_movie_clip),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"createTextField": {
				type: "method",
				fn: avm1_globals.todo("MovieClip:createTextField"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"setMask": {
				type: "method",
				fn: mc_method(set_mask),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"beginFill": {
				type: "method",
				fn: avm1_globals.todo("MovieClip:beginFill"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"beginBitmapFill": {
				type: "method",
				fn: avm1_globals.todo("MovieClip:beginBitmapFill"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"beginGradientFill": {
				type: "method",
				fn: avm1_globals.todo("MovieClip:beginGradientFill"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"clear": {
				type: "method",
				fn: avm1_globals.todo("MovieClip:clear"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"curveTo": {
				type: "method",
				fn: avm1_globals.todo("MovieClip:curveTo"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"endFill": {
				type: "method",
				fn: avm1_globals.todo("MovieClip:endFill"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"lineGradientStyle": {
				type: "method",
				fn: avm1_globals.todo("MovieClip:lineGradientStyle"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"lineStyle": {
				type: "method",
				fn: avm1_globals.todo("MovieClip:lineStyle"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"lineTo": {
				type: "method",
				fn: avm1_globals.todo("MovieClip:lineTo"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"loadMovie": {
				type: "method",
				fn: avm1_globals.todo("MovieClip:loadMovie"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"loadVariables": {
				type: "method",
				fn: avm1_globals.todo("MovieClip:loadVariables"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"moveTo": {
				type: "method",
				fn: avm1_globals.todo("MovieClip:moveTo"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"startDrag": {
				type: "method",
				fn: mc_method(start_drag),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"stopDrag": {
				type: "method",
				fn: mc_method(stop_drag),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"unloadMovie": {
				type: "method",
				fn: avm1_globals.todo("MovieClip:unloadMovie"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"attachAudio": {
				type: "method",
				fn: avm1_globals.todo("MovieClip:attachAudio"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"attachBitmap": {
				type: "method",
				fn: avm1_globals.todo("MovieClip:attachBitmap"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"getSWFVersion": {
				type: "method",
				fn: avm1_globals.todo("MovieClip:getSWFVersion"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"getURL": {
				type: "method",
				fn: avm1_globals.todo("MovieClip:getURL"),
				attributes: ["DONT_ENUM", "DONT_DELETE"]
			},
			"enabled": {
				type: "boolean",
				boolean: true,
				attributes: ["DONT_ENUM"]
			},
		};
		function goto_frame(movie_clip, activation, args, stop, scene_offset) {
			var call_frame = null;
			var f = args[0] || Avm1Value.INSTANCE.Undefined;
			if (f.a == Avm1Value.Number) {
				if (f.b != 0) call_frame = [movie_clip, (f.b >>> 0) | 0];
			} else {
				var frame_path = f.coerceToString(activation);
				var o = activation.resolveVariablePath(movie_clip, frame_path);
				if (o) {
					var clip = o[0];
					var frame = o[1];
					clip = clip.asDisplayObject();
					if (clip) {
						var lf = clip.frameLabelToNumber(frame, activation.context);
						if (lf != null) {
							call_frame = [clip, lf];
						}	
					}
				}
			}
			if (call_frame) {
				var frame = call_frame[1];
				frame = (frame - 1) | 0;
				frame = Math.min(frame + 1, 2147483647);
				call_frame[0].gotoFrame(activation.context, frame, stop);
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function play(movie_clip, activation, args) {
			movie_clip.play(activation.context);
			return Avm1Value.INSTANCE.Undefined;
		}
		function hit_test(movie_clip, activation, args) {
			if (args.length > 1) {
				var x = args[0].coerceToNumber(activation);
				var y = args[1].coerceToNumber(activation);
				var shape = args[2];
				if (shape) {
					shape = shape.asBool(activation.swfVersion);
				}
				if (Number.isFinite(x) && Number.isFinite(y)) {
					var local = new Point((x * 20) | 0, (y * 20) | 0);
					var point = movie_clip.getAvm1RootNoLock().localToGlobal(local);
					var ret;
					if (shape) {
						ret = movie_clip.hitTestShape(activation.context, point, null);
					} else {
						ret = movie_clip.hitTestBounds(point);
					}
					return Avm1Value.fromBoolean(ret);
				}
			} else if (args.length == 1) {
				var other = activation.resolveTargetDisplayObject(movie_clip, args[0], false);
				if (other) {
					return Avm1Value.fromBoolean(movie_clip.hitTestObject(other));
				}
			}
			return Avm1Value.fromBoolean(false);
		}
		function stop(movie_clip, activation, args) {
			movie_clip.stop(activation.context);
			return Avm1Value.INSTANCE.Undefined;
		}
		function goto_and_play(movie_clip, activation, args) {
			return goto_frame(movie_clip, activation, args, false, 0);
		}
		function goto_and_stop(movie_clip, activation, args) {
			return goto_frame(movie_clip, activation, args, true, 0);
		}
		function prev_frame(movie_clip, activation, args) {
			movie_clip.prevFrame(activation.context);
			return Avm1Value.INSTANCE.Undefined;
		}
		function next_frame(movie_clip, activation, args) {
			movie_clip.nextFrame(activation.context);
			return Avm1Value.INSTANCE.Undefined;
		}
		function attach_movie(movie_clip, activation, args) {
			var export_name = args[0], new_instance_name = args[1], depth = args[2];
			if (export_name && new_instance_name && depth) {
				export_name = export_name.coerceToString(activation);
				new_instance_name = new_instance_name.coerceToString(activation);
				depth = (depth.coerceToI32(activation) + AVM1_DEPTH_BIAS) | 0;
			} else {
				console.log("MovieClip.attachMovie: Too few parameters");
				return Avm1Value.INSTANCE.Undefined;
			}
			var init_object = args[3];
			if (depth < 0 || depth > AVM1_MAX_DEPTH) {
				return Avm1Value.INSTANCE.Undefined;
			}
			var new_clip = movie_clip.getMovie().library.instantiateByExportName(export_name);
			if (new_clip) {
				new_clip.setName(new_instance_name);
				movie_clip.replaceAtDepth(activation.context, new_clip, depth);
				var _init_object;
				if (init_object) {
					if (init_object.a == Avm1Value.Object) {
						_init_object = init_object.b;
					}
				}
				new_clip.postInstantiation(activation.context, _init_object, Instantiator.Avm1, true);
				return Avm1Value.fromObject(new_clip.getObject().coerceToObject(activation));
			} else {
				console.log("Unable to attach", export_name);
				return Avm1Value.INSTANCE.Undefined;
			}
		}
		function create_empty_movie_clip(movie_clip, activation, args) {
			var new_instance_name, depth;
			if (args.length == 2) {
				new_instance_name = args[0].coerceToString(activation);
				depth = (args[1].coerceToI32(activation) + AVM1_DEPTH_BIAS) | 0;
			} else {
				console.log("MovieClip.createEmptyMovieClip: Too few parameters");
				return Avm1Value.INSTANCE.Undefined;
			}
			var swf_movie = movie_clip.getMovie();
			var new_clip = MovieClip.createNew(swf_movie);
			new_clip.setName(new_instance_name);
			movie_clip.replaceAtDepth(activation.context, new_clip, depth);
			new_clip.postInstantiation(activation.context, null, Instantiator.Avm1, true);
			return new_clip.getObject();
		}
		function remove_movie_clip(activation, _this, _args) {
			var d = _this.asDisplayObject();
			if (d) {
				avm1_remove_display_object(d, activation);
			}
			return Avm1Value.INSTANCE.Undefined;
		} 
		function get_bytes_loaded(movie_clip, activation, args) {
			return Avm1Value.fromNumber(movie_clip.getLoadedBytes());
		}
		function get_bytes_total(movie_clip, activation, args) {
			return Avm1Value.fromNumber(movie_clip.getTotalBytes());
		}
		function local_to_global(movie_clip, activation, args) {
			var point = args[0] || Avm1Value.INSTANCE.Undefined;
			if (point.a == Avm1Value.Object) {
				point = point.b;
				var x = point.getLocalStored("x", activation, false) || Avm1Value.INSTANCE.Undefined;
				var y = point.getLocalStored("y", activation, false) || Avm1Value.INSTANCE.Undefined;
				if (x.a == Avm1Value.Number || y.a == Avm1Value.Number) {
					x = x.b;
					y = y.b;
					var local = new Point((x * 20) | 0, (y * 20) | 0);
					var global = movie_clip.localToGlobal(local);
					point.set("x", Avm1Value.fromNumber(global.x / 20), activation);
					point.set("y", Avm1Value.fromNumber(global.y / 20), activation);
				}
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function global_to_local(movie_clip, activation, args) {
			var point = args[0] || Avm1Value.INSTANCE.Undefined;
			if (point.a == Avm1Value.Object) {
				point = point.b;
				var x = point.getLocalStored("x", activation, false) || Avm1Value.INSTANCE.Undefined;
				var y = point.getLocalStored("y", activation, false) || Avm1Value.INSTANCE.Undefined;
				if (x.a == Avm1Value.Number || y.a == Avm1Value.Number) {
					x = x.b;
					y = y.b;
					var local = new Point((x * 20) | 0, (y * 20) | 0);
					var global = movie_clip.globalToLocal(local);
					if (global) {
						point.set("x", Avm1Value.fromNumber(global.x / 20), activation);
						point.set("y", Avm1Value.fromNumber(global.y / 20), activation);
					}
				}
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function get_rect(movie_clip, activation, args) {
			return get_bounds(movie_clip, activation, args);
		}
		function get_bounds(movie_clip, activation, args) {
			var target = args[0];
			if (target) {
				target = activation.resolveTargetDisplayObject(movie_clip, target, false);
			} else {
				target = movie_clip;
			}
			if (target) {
				if (!activation.context.avm1.get_use_new_invalid_bounds_value()) {
					if (activation.swfVersion >= 8 || activation.context.swf.version >= 8) {
						activation.context.avm1.activate_use_new_invalid_bounds_value();
					}
				}
				var bounds = movie_clip.getBounds();
				var out_bounds;
				if (movie_clip === target) {
					out_bounds = bounds;
				} else {
					out_bounds = new Rectangle(0x8000000, 0x8000000, 0x8000000, 0x8000000);
				}
				var out = Avm1Object.createNew(activation.context.avm1.prototypes.object);
				out.set("xMin", Avm1Value.fromNumber(out_bounds.xMin / 20), activation);
				out.set("xMax", Avm1Value.fromNumber(out_bounds.xMax / 20), activation);
				out.set("yMin", Avm1Value.fromNumber(out_bounds.yMin / 20), activation);
				out.set("yMax", Avm1Value.fromNumber(out_bounds.yMax / 20), activation);
				return Avm1Value.fromObject(out);
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function duplicate_movie_clip(movie_clip, activation, args) {
			var name = args[0];
			if (name) {
				name = name.coerceToString(activation);
			} else {
				console.log("MovieClip.duplicateMovieClip: Too few parameters");
				return Avm1Value.INSTANCE.Undefined;
			}
			var depth = args[1];
			if (depth) {
				depth = depth.coerceToI32(activation);
			} else {
				depth = 0;
			}
			var init_object = args[2];
			if (init_object) {
				init_object = init_object.coerceToObject(activation);
			}
			var _depth = (depth + AVM1_DEPTH_BIAS) | 0;
			var new_clip = clone_sprite(movie_clip, activation.context, name, _depth, init_object);
			if (activation.swfVersion < 6) {
				return Avm1Value.INSTANCE.Undefined;
			}
			return new_clip ? new_clip.getObject() : Avm1Value.INSTANCE.Undefined;
		}
		function get_instance_at_depth(movie_clip, activation, args) {
			if (activation.swfVersion >= 7) {
				var depth = args[0];
				if (depth) {
					depth = (depth.coerceToI32(activation) + AVM1_DEPTH_BIAS) | 0;
				} else {
					console.log("MovieClip.get_instance_at_depth: Too few parameters");
					return Avm1Value.INSTANCE.Undefined;
				}
				var child = movie_clip.childByDepth(depth);
				if (child) {
					var obj = child.getObject();
					if (obj.a == Avm1Value.Undefined) {
						return movie_clip.getObject();
					} else {
						return obj;
					}
				} else {
					return Avm1Value.INSTANCE.Undefined;
				}
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
		}
		function get_next_highest_depth(movie_clip, activation, _args) {
			if (activation.swfVersion >= 7) {
				var depth = Math.max((movie_clip.getHighestDepth() - AVM1_DEPTH_BIAS - 1) | 0, 0);
				return Avm1Value.fromNumber(depth);
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
		}
		function clone_sprite(movie_clip, context, target, depth, init_object) {
			var parent = movie_clip.getAvm1Parent();
			if (parent) {
				if (parent instanceof MovieClip) {

				} else {
					return null;
				}
			} else {
				return null;
			}
			if (depth < 0 || depth > AVM1_MAX_DEPTH) {
				return null;
			}
			var movie = parent.getMovie();
			var new_clip;
			if (movie_clip.getId() != 0) {
				var library = movie.library;
				new_clip = library.instantiateById(movie_clip.getId());
			} else {
				new_clip = MovieClip.createNew(movie);
			}
			new_clip.setName(target);
			parent.replaceAtDepth(context, new_clip, depth);
			new_clip.applyMatrix(movie_clip.getMatrix());
			new_clip.applyColorTransform(movie_clip.getColorTransform());
			new_clip.clipEventHandlers = movie_clip.clipEventHandlers;
			new_clip.postInstantiation(context, init_object, Instantiator.Avm1, true);
			return new_clip;
		}
		function swap_depths(movie_clip, activation, args) {
			var arg = args[0] || Avm1Value.INSTANCE.Undefined;
			if (movie_clip.AVM1_REMOVED) return Avm1Value.INSTANCE.Undefined;
			var parent = movie_clip.getAvm1Parent();
			if (parent) {
				if (parent instanceof MovieClip) {

				} else {
					return Avm1Value.INSTANCE.Undefined;
				}
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
			var depth = null;
			if (arg.a == Avm1Value.Number) {
				depth = ((arg.b | 0) + AVM1_DEPTH_BIAS) | 0;
			} else {
				var target = activation.resolveTargetDisplayObject(movie_clip, arg, false);
				if (target) {
					var target_parent = target.getAvm1Parent();
					if (target_parent) {
						if ((target_parent === parent) && !target.AVM1_REMOVED) {
							depth = target.getDepth();
						} else {
							console.log("MovieClip.swapDepths: Objects do not have the same parent");
						}
					} else {
						console.log("MovieClip.swapDepths: Invalid target");
					}
				} else {
					console.log("MovieClip.swapDepths: Invalid target");
				}
			}
			if (depth != null) {
				if (depth < 0 || depth > AVM1_MAX_DEPTH) {
					return Avm1Value.INSTANCE.Undefined;
				}
				if (depth != movie_clip.getDepth()) {
					parent.swapAtDepth(activation.context, movie_clip, depth);
					movie_clip.TRANSFORMED_BY_SCRIPT = true;
				}
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function transform(_this, activation) {
			var constructor = activation.context.avm1.prototypes.transform_constructor;
			var cloned = constructor.construct(activation, [_this.getObject()]);
			return cloned;
		}
		function set_transform(_this, activation, value) {
			if (value.a == Avm1Value.Object) {
				var object = value.b;
				var native = object.getNative();
				if (native.type == Avm1NativeObject.Transform) {
					var transform = native.data;
					var clip = transform.getClip(activation);
					if (clip) {
						var matrix = clip.getMatrix();
						_this.applyMatrix(matrix);
						var color_transform = clip.getColorTransform();
						_this.applyColorTransform(color_transform);
						var parent = _this.getParent();
						if (parent) {
							parent.invalidateCachedBitmap();
						}
						_this.TRANSFORMED_BY_SCRIPT = true;
					}
				}
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function start_drag_impl(display_object, activation, lock_center, constraint_args) {
			var constraint;
			if (constraint_args) {
				var x_min = ((constraint_args[0] || 0) * 20) | 0;
				var y_min = ((constraint_args[1] || 0) * 20) | 0;
				var x_max = ((constraint_args[2] || 0) * 20) | 0;
				var y_max = ((constraint_args[3] || 0) * 20) | 0;
				constraint = new Rectangle(x_min, x_max, y_min, y_max);
			} else {
				constraint = Rectangle.INVALID.clone();
			}
			var drag_object = {
				display_object,
				last_mouse_position: activation.context.mousePosition.clone(),
				lock_center,
				constraint
			}
			activation.context.setDragObject(drag_object);
		}
		function set_mask(movie_clip, activation, args) {
			var mask = args[0];
			if (mask) {
				if (mask.a == Avm1Value.Undefined || mask.a == Avm1Value.Null) {
					mask = null;
				} else {
					var start_clip = activation.target_clip_or_root();
					var _mask = activation.resolveTargetDisplayObject(start_clip, mask, false);
					if (!_mask) return Avm1Value.fromBoolean(false);
					mask = _mask;
				}
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
			movie_clip.clipDepth = 0;
    		movie_clip.setMasker(mask, true);
			if (mask) {
				mask.setMaskee(movie_clip, true);
			}
			return Avm1Value.fromBoolean(true);
		}
		function start_drag(movie_clip, activation, args) {
			var lock_center = args[0] ? args[0].asBool(activation.swfVersion) : false;
			var constraint_args = null;
			if (args.length > 1) {
				var x_min = (args[1] || Avm1Value.INSTANCE.Undefined).coerceToNumber(activation);
				var y_min = (args[2] || Avm1Value.INSTANCE.Undefined).coerceToNumber(activation);
				var x_max = (args[3] || Avm1Value.INSTANCE.Undefined).coerceToNumber(activation);
				var y_max = (args[4] || Avm1Value.INSTANCE.Undefined).coerceToNumber(activation);
				constraint_args = [x_min, y_min, x_max, y_max];
			}
			start_drag_impl(movie_clip, activation, lock_center, constraint_args);
			return Avm1Value.INSTANCE.Undefined;
		}
		function stop_drag(_movie_clip, activation, _args) {
			Player.updateDrag(activation.context);
			activation.context.setDragObject(null);
			return Avm1Value.INSTANCE.Undefined;
		}
		return {
			start_drag_impl: start_drag_impl,
			goto_frame: goto_frame,
			clone_sprite: clone_sprite,
			create_proto: function(proto, fn_proto) {
				var _proto = Avm1Object.createNew(proto);
				avm1_define_properties_on(PROTO_DECLS, _proto, fn_proto);
				return _proto;
			}
		};
	}());
	avm1_globals.button = (function(){
		var PROTO_DECLS = {
			"enabled": {
				type: "boolean",
				boolean: true
			},
			"getDepth": {
				type: "method",
				fn: avm1_get_depth,
				attributes: ["DONT_DELETE", "READ_ONLY"]
			},
		};
		return {
			create_proto: function(proto, fn_proto) {
				var object = Avm1Object.createNew(proto);
				avm1_define_properties_on(PROTO_DECLS, object, fn_proto);
				return object;
			}
		};
	}());
	avm1_globals.text_field = (function(){
		function tf_method(fn) {
			return function(activation, _this, args) {
				var native = _this.getNative();
				var display_object = native.asDisplayObject();
				if (display_object) {
					if (display_object instanceof TextField) {
						return fn(display_object, activation, args);
					}
				}
				return Avm1Value.INSTANCE.Undefined;
			}
		}
		function tf_getter(fn) {
			return function(activation, _this, args) {
				var native = _this.getNative();
				var display_object = native.asDisplayObject();
				if (display_object) {
					if (display_object instanceof TextField) {
						return fn(display_object, activation);
					}
				}
				return Avm1Value.INSTANCE.Undefined;
			}
		}
		function tf_setter(fn) {
			return function(activation, _this, args) {
				var native = _this.getNative();
				var display_object = native.asDisplayObject();
				if (display_object) {
					if (display_object instanceof TextField) {
						var value = args[0] || Avm1Value.INSTANCE.Undefined;
						fn(display_object, activation, value);
					}
				}
				return Avm1Value.INSTANCE.Undefined;
			}
		}
		var PROTO_DECLS = {
			"getDepth": {
				type: "method",
				fn: avm1_get_depth,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"replaceSel": {
				type: "method",
				fn: tf_method(replace_sel)
			},
			"replaceText": {
				type: "method",
				fn: tf_method(replace_text)
			},
			"text": {
				type: "property",
				getter: tf_getter(text),
				setter: tf_setter(set_text)
			},
			"html": {
				type: "property",
				getter: tf_getter(html),
				setter: tf_setter(set_html)
			},
			"htmlText": {
				type: "property",
				getter: tf_getter(html_text),
				setter: tf_setter(set_html_text)
			},
			"variable": {
				type: "property",
				getter: tf_getter(variable),
				setter: tf_setter(set_variable)
			}
		};
		function text(_this, activation) {
			return Avm1Value.fromString(_this.getText());
		}
		function set_text(_this, activation, value) {
			_this.setText(value.coerceToString(activation), activation.context);
			_this.propagateTextBinding(activation);
		}
		function html_text(_this, activation) {
			return Avm1Value.fromString(_this.html_text());
		}
		function set_html_text(_this, activation, value) {
			_this.set_html_text(value.coerceToString(activation), activation.context);
		}
		function html(_this, activation) {
			return Avm1Value.fromBoolean(_this.isHTML());
		}
		function set_html(_this, activation, value) {
			var _value = value.asBool(activation.swfVersion);
			_this.setIsHTML(_value);
		}
		function variable(_this, activation) {
			console.log("variable");
			return Avm1Value.fromString("");
		}
		function set_variable(_this, activation, value) {
			console.log("variable", value);
		}
		function replace_text(_this, activation, args) {
			console.log("replace_text");
			return Avm1Value.INSTANCE.Undefined;
		}
		function replace_sel(_this, activation, args) {
			console.log("replace_sel");
			return Avm1Value.INSTANCE.Undefined;
		}
		return {
			create_proto: function(proto, fn_proto) {
				var object = Avm1Object.createNew(proto);
				avm1_define_properties_on(PROTO_DECLS, object, fn_proto);
				return object;
			}
		};
	}());
	avm1_globals.sound = (function(){
		var PROTO_DECLS = {
			"attachSound": {
				type: "method",
				fn: attach_sound,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"start": {
				type: "method",
				fn: start,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"stop": {
				type: "method",
				fn: stop,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"getVolume": {
				type: "method",
				fn: get_volume,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"setVolume": {
				type: "method",
				fn: set_volume,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"position": {
				type: "method",
				fn: avm1_globals.todo("Sound:position"),
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"setPan": {
				type: "method",
				fn: set_pan,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"loadSound": {
				type: "method",
				fn: avm1_globals.todo("Sound:loadSound"),
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"getPan": {
				type: "method",
				fn: get_pan,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"getDuration": {
				type: "method",
				fn: avm1_globals.todo("Sound:getDuration"),
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"setDuration": {
				type: "method",
				fn: avm1_globals.todo("Sound:setDuration"),
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"getTransform": {
				type: "method",
				fn: get_transform,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"setTransform": {
				type: "method",
				fn: set_transform,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
		};
		function constructor(activation, _this, args) {
			var owner = null;
			if (args[0]) {
				var start_clip = activation.target_clip_or_root();
				owner = activation.resolveTargetDisplayObject(start_clip, args[0], false);
			}
			var sound = new Avm1Sound(owner);
			_this.setNative(new Avm1NativeObject(Avm1NativeObject.Sound, sound));
			return Avm1Value.fromObject(_this);
		}
		function attach_sound(activation, _this, args) {
			var name = args[0] || Avm1Value.INSTANCE.Undefined;
			var native = _this.getNative();
			if (native.type == Avm1NativeObject.Sound) {
				var sound = native.data;
				var _name = name.coerceToString(activation);
				var movie = (sound.owner || activation.base_clip.getAvm1Root()).getMovie();
				var csound = movie.library.characterByExportName(_name);
				if (csound && (csound[1].type == Character.Sound)) {
					sound.setSound(csound[1].data);
					sound.setIsStreaming(false);
					sound.setPosition(0);
				} else {
					console.log("Sound.attachSound: Sound " + _name + " not found");
				}
			} else {
				console.log("Sound.attachSound: this is not a Sound");
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function start(activation, _this, args) {
			var start_offset = (args[0] || Avm1Value.fromNumber(0)).coerceToNumber(activation);
			var loops = (args[1] || Avm1Value.fromNumber(1)).coerceToNumber(activation);
			loops = Math.max(loops, 1);
			var native = _this.getNative();
			if (native.type == Avm1NativeObject.Sound) {
				var sound = native.data;
				var sound_handle = sound.sound;
				if (sound_handle) {
					var sound_instance = activation.context.startSound(sound_handle, {
						event: "start",
						inSample: (start_offset * 44100) | 0,
						numLoops: loops
					}, sound.owner, _this);
					if (sound_instance) {
						sound.setSoundInstance(sound_instance);
					}
				} else {
					console.log("Sound.start: No sound is attached");
				}
			} else {
				console.log("Sound.start: Invalid sound");
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function stop(activation, _this, args) {
			var native = _this.getNative();
			if (native.type == Avm1NativeObject.Sound) {
				var sound = native.data;
				var name = args[0];
				if (name) {
					var _name = name.coerceToString(activation);
					var movie = (sound.owner || activation.base_clip.getAvm1Root()).getMovie();
					var csound = movie.library.characterByExportName(_name);
					if (csound && (csound[1].type == Character.Sound)) {
						activation.context.stopSoundsWithHandle(csound[1].data);
					} else {
						console.log("Sound.attachSound: Sound " + _name + " not found");
					}
				} else if (sound.owner) {
					activation.context.stopSoundsWithDisplayObject(sound.owner);
					sound.setSoundInstance(null);
				} else {
					activation.context.stopAllSounds();
				}
			} else {
				console.log("Sound.attachSound: this is not a Sound");
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function get_volume(activation, _this, args) {
			var native = _this.getNative();
			if (native.type == Avm1NativeObject.Sound) {
				var sound = native.data;
				var transform;
				var owner = sound.owner;
				if (owner) {
					transform = owner.soundTransform;
				} else {
					transform = activation.context.getGlobalSoundTransform();
				}
				return Avm1Value.fromNumber(transform.volume);
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
		}
		function set_volume(activation, _this, args) {
			var volume = (args[0] || Avm1Value.fromNumber(0)).coerceToNumber(activation);
			var native = _this.getNative();
			if (native.type == Avm1NativeObject.Sound) {
				var sound = native.data;
				var owner = sound.owner;
				if (owner) {
					var transform = new SoundTransform();
					transform.volume = volume | 0;
					transform.left_to_left = owner.soundTransform.left_to_left;
					transform.left_to_right = owner.soundTransform.left_to_right;
					transform.right_to_left = owner.soundTransform.right_to_left;
					transform.right_to_right = owner.soundTransform.right_to_right;
					owner.setSoundTransform(activation.context, transform);
				} else {
					var transform = new SoundTransform();
					transform.volume = volume | 0;
					var g = activation.context.getGlobalSoundTransform();
					transform.left_to_left = g.left_to_left;
					transform.left_to_right = g.left_to_right;
					transform.right_to_left = g.right_to_left;
					transform.right_to_right = g.right_to_right;
					activation.context.setGlobalSoundTransform(transform);
				}
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function get_transform(activation, _this, args) {
			console.log("get_transform");
			return Avm1Value.INSTANCE.Undefined;
		}
		function set_transform(activation, _this, args) {
			console.log("set_transform");
			return Avm1Value.INSTANCE.Undefined;
		}
		function get_pan(activation, _this, args) {
			console.log("get_pan");
			return Avm1Value.INSTANCE.Undefined;
		}
		function set_pan(activation, _this, args) {
			console.log("set_pan");
			return Avm1Value.INSTANCE.Undefined;
		}
		return {
			create_constructor: function(proto, fn_proto) {
				return Avm1FunctionObject.createConstructor(constructor, null, fn_proto, proto);
			},
			create_proto: function(proto, fn_proto) {
				var object = Avm1Object.createNew(proto);
				avm1_define_properties_on(PROTO_DECLS, object, fn_proto);
				return object;
			}
		};
	}());
	avm1_globals.color_transform = (function(){
		function color_transform_value_accessor(field) {
			function getter(_activation, _this, _args) {
				var color_transform = Avm1ColorTransformObject.cast(Avm1Value.fromObject(_this));
				if (color_transform) {
					return Avm1Value.fromNumber(color_transform[field]);
				} else {
					return Avm1Value.INSTANCE.Undefined;
				}
			}
			function setter(activation, _this, args) {
				var color_transform = Avm1ColorTransformObject.cast(Avm1Value.fromObject(_this));
				if (color_transform) {
					var value = args[0];
					if (value) {
						color_transform[field] = value.coerceToNumber(activation);
					}
				}
				return Avm1Value.INSTANCE.Undefined;
			}
			return {
				type: "property",
				getter: getter,
				setter: setter
			}
		}
		var PROTO_DECLS = {
			"redMultiplier": color_transform_value_accessor("red_multiplier"),
			"greenMultiplier": color_transform_value_accessor("green_multiplier"),
			"blueMultiplier": color_transform_value_accessor("blue_multiplier"),
			"alphaMultiplier": color_transform_value_accessor("alpha_multiplier"),
			"redOffset": color_transform_value_accessor("red_offset"),
			"greenOffset": color_transform_value_accessor("green_offset"),
			"blueOffset": color_transform_value_accessor("blue_offset"),
			"alphaOffset": color_transform_value_accessor("alpha_offset"),
			"toString": {
				type: "method",
				fn: to_string
			},
			"rgb": {
				type: "property",
				getter: get_rgb,
				setter: set_rgb
			},
			"concat": {
				type: "method",
				fn: concat
			},
		};
		function constructor(activation, _this, args) {
			var color_transform;
			if (args.length >= 8) {
				var values = [0, 0, 0, 0, 0, 0, 0, 0];
				for (var i = 0; i < args.length; i++) {
					var arg = args[i];
					values[i] = arg.coerceToNumber(activation);
				}
				color_transform = new Avm1ColorTransformObject({
					red_multiplier: values[0],
					green_multiplier: values[1],
					blue_multiplier: values[2],
					alpha_multiplier: values[3],
					red_offset: values[4],
					green_offset: values[5],
					blue_offset: values[6],
					alpha_offset: values[7]
				});
			} else {
				color_transform = Avm1ColorTransformObject.IDENTITY.clone();
			}
			_this.setNative(new Avm1NativeObject(Avm1NativeObject.ColorTransform, color_transform));
			return Avm1Value.fromObject(_this);
		}
		function to_string(activation, _this, _args) {
			var formatted = `(redMultiplier=${_this.get("redMultiplier", activation).coerceToString(activation)}, greenMultiplier=${_this.get("greenMultiplier", activation).coerceToString(activation)}, blueMultiplier=${_this.get("blueMultiplier", activation).coerceToString(activation)}, alphaMultiplier=${_this.get("alphaMultiplier", activation).coerceToString(activation)}, redOffset=${_this.get("redOffset", activation).coerceToString(activation)}, greenOffset=${_this.get("greenOffset", activation).coerceToString(activation)}, blueOffset=${_this.get("blueOffset", activation).coerceToString(activation)}, alphaOffset=${_this.get("alphaOffset", activation).coerceToString(activation)})`;
			return Avm1Value.fromString(formatted);
		}
		function get_rgb(activation, _this, _args) {
			var color_transform = Avm1ColorTransformObject.cast(Avm1Value.fromObject(_this));
			if (color_transform) {
				var rgb = ((color_transform.red_offset) << 16) | ((color_transform.green_offset) << 8) | (color_transform.blue_offset);
				return Avm1Value.fromNumber(rgb);
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function set_rgb(activation, _this, args) {
			var color_transform = Avm1ColorTransformObject.cast(Avm1Value.fromObject(_this));
			if (color_transform) {
				var rgb = args[0];
				if (rgb) {
					rgb = rgb.coerceToU32(activation);
					color_transform.red_multiplier = 0;
					color_transform.green_multiplier = 0;
					color_transform.blue_multiplier = 0;
					color_transform.red_offset = rgb >>> 16;
					color_transform.green_offset = rgb >>> 8;
					color_transform.blue_offset = rgb & 0xff;
				}
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function concat(activation, _this, args) {
			var other = args[0];
			if (other) {
				var __this = Avm1ColorTransformObject.cast(Avm1Value.fromObject(_this));
				var _other = Avm1ColorTransformObject.cast(other);
				if (__this && _other) {
					var native = _this.getNative();
					var c = native.data;
					c.red_multiplier = _other.red_multiplier * __this.red_multiplier;
					c.green_multiplier = _other.green_multiplier * __this.green_multiplier;
					c.blue_multiplier = _other.blue_multiplier * __this.blue_multiplier;
					c.alpha_multiplier = _other.alpha_multiplier * __this.alpha_multiplier;
					c.red_offset = ((_other.red_offset * __this.red_multiplier) + __this.red_offset);
					c.green_offset = ((_other.green_offset * __this.green_multiplier) + __this.green_offset);
					c.blue_offset = ((_other.blue_offset * __this.blue_multiplier) + __this.blue_offset);
					c.alpha_offset = ((_other.alpha_offset * __this.alpha_multiplier) + __this.alpha_offset);
				}
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		return {
			constructor,
			create_proto: function(proto, fn_proto) {
				var object = Avm1Object.createNew(proto);
				avm1_define_properties_on(PROTO_DECLS, object, fn_proto);
				return object;
			}
		};
	}());
	avm1_globals.matrix = (function(){
		var PROTO_DECLS = {
			"toString": {
				type: "method",
				fn: to_string
			},
			"clone": {
				type: "method",
				fn: clone
			},
			"scale": {
				type: "method",
				fn: scale
			},
			"rotate": {
				type: "method",
				fn: rotate
			},
			"translate": {
				type: "method",
				fn: translate
			},
			"concat": {
				type: "method",
				fn: concat
			},
			"invert": {
				type: "method",
				fn: invert
			},
		};
		function apply_matrix_to_object(matrix, object, activation) {
			object.set("a", Avm1Value.fromNumber(matrix.a), activation);
			object.set("b", Avm1Value.fromNumber(matrix.b), activation);
			object.set("c", Avm1Value.fromNumber(matrix.c), activation);
			object.set("d", Avm1Value.fromNumber(matrix.d), activation);
			object.set("tx", Avm1Value.fromNumber(matrix.tx / 20), activation);
			object.set("ty", Avm1Value.fromNumber(matrix.ty / 20), activation);
		}
		function object_to_matrix(object, activation) {
			var a = object.get("a", activation).coerceToNumber(activation);
			var b = object.get("b", activation).coerceToNumber(activation);
			var c = object.get("c", activation).coerceToNumber(activation);
			var d = object.get("d", activation).coerceToNumber(activation);
			var tx = object.get("tx", activation).coerceToNumber(activation) * 20;
			var ty = object.get("ty", activation).coerceToNumber(activation) * 20;
			return new Matrix(a, b, c, d, tx, ty);
		}
		function value_to_matrix(value, activation) {
			var a = value.coerceToObject(activation).get("a", activation).coerceToNumber(activation);
			var b = value.coerceToObject(activation).get("b", activation).coerceToNumber(activation);
			var c = value.coerceToObject(activation).get("c", activation).coerceToNumber(activation);
			var d = value.coerceToObject(activation).get("d", activation).coerceToNumber(activation);
			var tx = value.coerceToObject(activation).get("tx", activation).coerceToNumber(activation) * 20;
			var ty = value.coerceToObject(activation).get("ty", activation).coerceToNumber(activation) * 20;
			return new Matrix(a, b, c, d, tx, ty);
		}
		function matrix_to_value(matrix, activation) {
			var args = [
				Avm1Value.fromNumber(matrix.a),
				Avm1Value.fromNumber(matrix.b),
				Avm1Value.fromNumber(matrix.c),
				Avm1Value.fromNumber(matrix.d),
				Avm1Value.fromNumber(matrix.tx / 20),
				Avm1Value.fromNumber(matrix.ty / 20)
			];
			var _constructor = activation.context.avm1.prototypes.matrix_constructor;
			var cloned = _constructor.construct(activation, args);
			return cloned;
		}
		function constructor(activation, _this, args) {
			if (args.length) {
				var a = args[0];
				var b = args[1];
				var c = args[2];
				var d = args[3];
				var tx = args[4];
				var ty = args[5];
				if (a) _this.set("a", a, activation);
				if (b) _this.set("b", b, activation);
				if (c) _this.set("c", c, activation);
				if (d) _this.set("d", d, activation);
				if (tx) _this.set("tx", tx, activation);
				if (ty) _this.set("ty", ty, activation);
			} else {
				apply_matrix_to_object(Matrix.IDENTITY, _this, activation);
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function to_string(activation, _this, args) {
			var a = _this.get("a", activation);
			var b = _this.get("b", activation);
			var c = _this.get("c", activation);
			var d = _this.get("d", activation);
			var tx = _this.get("tx", activation);
			var ty = _this.get("ty", activation);
			return Avm1Value.fromString(`(a=${a.coerceToString(activation)}, b=${b.coerceToString(activation)}, c=${c.coerceToString(activation)}, d=${d.coerceToString(activation)}, tx=${tx.coerceToString(activation)}, ty=${ty.coerceToString(activation)})`);
		}
		function clone(activation, _this, _args) {
			var args = [
				_this.get("a", activation),
				_this.get("b", activation),
				_this.get("c", activation),
				_this.get("d", activation),
				_this.get("tx", activation),
				_this.get("ty", activation)
			];
			var _constructor = activation.context.avm1.prototypes.matrix_constructor;
			var cloned = _constructor.construct(activation, args);
			return cloned;
		}
		function scale(activation, _this, args) {
			var scale_x = (args[0] || Avm1Value.INSTANCE.Undefined).coerceToNumber(activation);
			var scale_y = (args[1] || Avm1Value.INSTANCE.Undefined).coerceToNumber(activation);
			var matrix = Matrix.scale(scale_x, scale_y);
			matrix = matrix.mul(object_to_matrix(_this, activation));
			apply_matrix_to_object(matrix, _this, activation);
			return Avm1Value.INSTANCE.Undefined;
		}
		function rotate(activation, _this, args) {
			var angle = (args[0] || Avm1Value.INSTANCE.Undefined).coerceToNumber(activation);
			var matrix = Matrix.rotate(angle);
			matrix = matrix.mul(object_to_matrix(_this, activation));
			apply_matrix_to_object(matrix, _this, activation);
			return Avm1Value.INSTANCE.Undefined;
		}
		function translate(activation, _this, args) {
			var translate_x = (args[0] || Avm1Value.INSTANCE.Undefined).coerceToNumber(activation);
			var translate_y = (args[1] || Avm1Value.INSTANCE.Undefined).coerceToNumber(activation);
			var matrix = Matrix.translate((translate_x * 20) | 0, (translate_y * 20) | 0);
			matrix = matrix.mul(object_to_matrix(_this, activation));
			apply_matrix_to_object(matrix, _this, activation);
			return Avm1Value.INSTANCE.Undefined;
		}
		function concat(activation, _this, args) {
			var matrix = object_to_matrix(_this, activation);
			var other = value_to_matrix(args[0] || Avm1Value.INSTANCE.Undefined, activation);
			matrix = other.mul(matrix);
			apply_matrix_to_object(matrix, _this, activation);
			return Avm1Value.INSTANCE.Undefined;
		}
		function invert(activation, _this, args) {
			var matrix = object_to_matrix(_this, activation).inverse() || Matrix.IDENTITY;
			apply_matrix_to_object(matrix, _this, activation);
			return Avm1Value.INSTANCE.Undefined;
		}
		return {
			matrix_to_value,
			object_to_matrix,
			create_matrix_object: function(matrix_proto, fn_proto) {
				return Avm1FunctionObject.createNative(constructor, fn_proto, matrix_proto);
			},
			create_proto: function(proto, fn_proto) {
				var object = Avm1Object.createNew(proto);
				avm1_define_properties_on(PROTO_DECLS, object, fn_proto);
				return object;
			}
		};
	}());
	avm1_globals.transform = (function(){
		function transform_method(index) {
			return function(activation, _this, args) {
				return method(activation, _this, args, index);
			}
		}
		var PROTO_DECLS = {
			"matrix": {
				type: "property",
				getter: transform_method(101),
				setter: transform_method(102)
			},
			"concatenatedMatrix": {
				type: "property",
				getter: transform_method(103),
				setter: transform_method(104)
			},
			"colorTransform": {
				type: "property",
				getter: transform_method(105),
				setter: transform_method(106)
			},
			"concatenatedColorTransform": {
				type: "property",
				getter: transform_method(107),
				setter: transform_method(108)
			},
		};
		function method(activation, _this, args, index) {
			var CONSTRUCTOR = 0;
			var GET_MATRIX = 101;
			var SET_MATRIX = 102;
			var GET_CONCATENATED_MATRIX = 103;
			var GET_COLOR_TRANSFORM = 105;
			var SET_COLOR_TRANSFORM = 106;
			var GET_CONCATENATED_COLOR_TRANSFORM = 107;
			var GET_PIXEL_BOUNDS = 109;
			if (index == CONSTRUCTOR) {
				var transform = Avm1TransformObject.createNew(activation, args);
				if (!transform) {
					return Avm1Value.INSTANCE.Undefined;
				}
				_this.setNative(new Avm1NativeObject(Avm1NativeObject.Transform, transform));
				return Avm1Value.fromObject(_this);
			}
			var native = _this.getNative();
			var __this = native.data;
			if (native.type == Avm1NativeObject.Transform) {

			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
			var clip = __this.getClip(activation);
			if (!clip) {
				return Avm1Value.INSTANCE.Undefined;
			}
			switch (index) {
				case GET_MATRIX:
					return avm1_globals.matrix.matrix_to_value(clip.getMatrix(), activation);
				case SET_MATRIX:
					var matrix_props = [
						"a",
						"b",
						"c",
						"d",
						"tx",
						"ty"
					];
					var value = args[0];
					if (value) {
						var object = value.coerceToObject(activation);
						var is_matrix = false;
						for (var i = 0; i < matrix_props.length; i++) {
							var o = matrix_props[i];
							if (object.has_own_property(activation, o)) {
								is_matrix = true;
							}
						}
						if (is_matrix) {
							var matrix = avm1_globals.matrix.object_to_matrix(object, activation);
							clip.applyMatrix(matrix);
							clip.TRANSFORMED_BY_SCRIPT = true;
							var parent = clip.getParent();
							if (parent) {
								parent.invalidateCachedBitmap();
							}
						}
					}
					return Avm1Value.INSTANCE.Undefined;
				case GET_COLOR_TRANSFORM:
					return Avm1ColorTransformObject.construct(activation, clip.getColorTransform());
				case SET_COLOR_TRANSFORM:
					var value = args[0];
					if (value) {
						var color_transform = Avm1ColorTransformObject.cast(value);
						if (color_transform) {
							clip.applyColorTransform(Avm1ColorTransformObject.fromColorTransform(color_transform));
							clip.invalidateCachedBitmap();
							clip.TRANSFORMED_BY_SCRIPT = true;
						}
					}
					return Avm1Value.INSTANCE.Undefined;
				default:
					return Avm1Value.INSTANCE.Undefined;
			}
		}
		return {
			create_constructor: function(proto, fn_proto) {
				var transform_proto = Avm1Object.createNew(proto);
				avm1_define_properties_on(PROTO_DECLS, transform_proto, fn_proto);
				return Avm1FunctionObject.createConstructor(transform_method(0), null, fn_proto, transform_proto);
			}
		};
	}());
	avm1_globals.color = (function(){
		var PROTO_DECLS = {
			"getRGB": {
				type: "method",
				fn: get_rgb,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"getTransform": {
				type: "method",
				fn: get_transform,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"setRGB": {
				type: "method",
				fn: set_rgb,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"setTransform": {
				type: "method",
				fn: set_transform,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
		};
		function constructor(activation, _this, args) {
			var target = args[0] || Avm1Value.INSTANCE.Undefined;
			_this.defineValue("target", target, new Avm1Attribute().dontEnum().dontDelete().readOnly());
			return Avm1Value.INSTANCE.Undefined;
		}
		function target(activation, _this) {
			var target = _this.get("target", activation);
			if (target.a != Avm1Value.Undefined) {
				var start_clip = activation.target_clip_or_root();
				return activation.resolveTargetDisplayObject(start_clip, target, false);
			} else {
				return null;
			}
		}
		function get_rgb(activation, _this, args) {
			return Avm1Value.INSTANCE.Undefined;
		}
		function get_transform(activation, _this, args) {
			var _target = target(activation, _this);
			if (_target) {
				var color_transform = _target.getColorTransform();
				var out = Avm1Object.createNew(activation.context.avm1.prototypes.object);
				out.set("ra", Avm1Value.fromNumber(color_transform[0] * 100), activation);
				out.set("ga", Avm1Value.fromNumber(color_transform[1] * 100), activation);
				out.set("ba", Avm1Value.fromNumber(color_transform[2] * 100), activation);
				out.set("aa", Avm1Value.fromNumber(color_transform[3] * 100), activation);
				out.set("rb", Avm1Value.fromNumber(color_transform[4]), activation);
				out.set("gb", Avm1Value.fromNumber(color_transform[5]), activation);
				out.set("bb", Avm1Value.fromNumber(color_transform[6]), activation);
				out.set("ab", Avm1Value.fromNumber(color_transform[7]), activation);
				return Avm1Value.fromObject(out);
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
		}
		function set_rgb(activation, _this, args) {
			return Avm1Value.INSTANCE.Undefined;
		}
		function set_transform(activation, _this, args) {
			function set_color_mult(activation, transform, property, out, outIdx) {
				if (transform.has_own_property(activation, property)) {
					var n = transform.get(property, activation).coerceToNumber(activation);
					out[outIdx] = n / 100;
				}
			}
			function set_color_add(activation, transform, property, out, outIdx) {
				if (transform.has_own_property(activation, property)) {
					var n = transform.get(property, activation).coerceToI32(activation);
					out[outIdx] = n;
				}
			}
			var _target = target(activation, _this);
			if (_target) {
				_target.TRANSFORMED_BY_SCRIPT = true;
				var parent = _target.getParent();
				if (parent) {
					parent.invalidateCachedBitmap();
				}
				var color_transform = _target.getColorTransform();
				var transform = (args[0] || Avm1Value.INSTANCE.Undefined).coerceToObject(activation);
				set_color_mult(activation, transform, "ra", color_transform, 0);
				set_color_mult(activation, transform, "ga", color_transform, 1);
				set_color_mult(activation, transform, "ba", color_transform, 2);
				set_color_mult(activation, transform, "aa", color_transform, 3);
				set_color_add(activation, transform, "rb", color_transform, 4);
				set_color_add(activation, transform, "gb", color_transform, 5);
				set_color_add(activation, transform, "bb", color_transform, 6);
				set_color_add(activation, transform, "ab", color_transform, 7);
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		return {
			constructor,
			create_proto: function(proto, fn_proto) {
				var object = Avm1Object.createNew(proto);
				avm1_define_properties_on(PROTO_DECLS, object, fn_proto);
				return object;
			}
		};
	}());
	avm1_globals.point = (function(){
		var PROTO_DECLS = {
			"toString": {
				type: "method",
				fn: to_string
			},
			"clone": {
				type: "method",
				fn: clone
			},
			"equals": {
				type: "method",
				fn: equals
			},
			"add": {
				type: "method",
				fn: add
			},
			"subtract": {
				type: "method",
				fn: subtract
			},
			"normalize": {
				type: "method",
				fn: normalize
			},
			"offset": {
				type: "method",
				fn: offset
			},
			"length": {
				type: "property",
				getter: length,
				attributes: ["READ_ONLY"]
			},
		};
		var OBJECT_DECLS = {
			"distance": {
				type: "method",
				fn: distance
			},
			"polar": {
				type: "method",
				fn: polar
			},
			"interpolate": {
				type: "method",
				fn: interpolate
			},
		};
		function point_to_object(point, activation) {
			var args = [Avm1Value.fromNumber(point[0]), Avm1Value.fromNumber(point[1])];
			return construct_new_point(args, activation);
		}
		function construct_new_point(args, activation) {
    		var constructor = activation.context.avm1.prototypes.point_constructor;
			var object = constructor.construct(activation, args);
			return object;
		}
		function value_to_point(value, activation) {
			var x = value.coerceToObject(activation).get("x", activation).coerceToNumber(activation);
			var y = value.coerceToObject(activation).get("y", activation).coerceToNumber(activation);
			return [x, y];
		}
		function object_to_point(object, activation) {
			var x = object.get("x", activation).coerceToNumber(activation);
			var y = object.get("y", activation).coerceToNumber(activation);
			return [x, y];
		}
		function constructor(activation, _this, args) {
			if (args.length) {
				_this.set("x", args[0] || Avm1Value.INSTANCE.Undefined, activation);
				_this.set("y", args[1] || Avm1Value.INSTANCE.Undefined, activation);
			} else {
				_this.set("x", Avm1Value.fromNumber(0), activation);
				_this.set("y", Avm1Value.fromNumber(0), activation);
			}
			return Avm1Value.fromObject(_this);
		}
		function clone(activation, _this, _args) {
			var args = [_this.get("x", activation), _this.get("y", activation)];
    		var constructor = activation.context.avm1.prototypes.point_constructor;
			var cloned = constructor.construct(activation, args);
			return cloned;
		}
		function to_string(activation, _this, args) {
			var x = _this.get("x", activation);
			var y = _this.get("y", activation);
			return Avm1Value.fromString(`(x=${x.coerceToString(activation)}, y=${y.coerceToString(activation)})`);
		}
		function length(activation, _this, args) {
			var point = value_to_point(Avm1Value.fromObject(_this), activation);
			var length = Math.sqrt(point[0] * point[0] + point[1] * point[1]);
			return Avm1Value.fromNumber(length)
		}
		function normalize(activation, _this, args) {
			var current_length = _this.get("length", activation).coerceToNumber(activation);
			if (Number.isFinite(current_length)) {
				var point = object_to_point(_this, activation);
				var new_length = (args[0] || Avm1Value.INSTANCE.Undefined).coerceToNumber(activation);
				var x, y;
				if (current_length == 0) {
					x = point[0] * new_length;
					y = point[1] * new_length;
				} else {
					x = point[0] / current_length * new_length;
					y = point[1] / current_length * new_length;
				}
				_this.set("x", Avm1Value.fromNumber(x), activation);
				_this.set("y", Avm1Value.fromNumber(y), activation);
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function add(activation, _this, args) {
			var this_x = _this.get("x", activation).coerceToNumber(activation);
			var this_y = _this.get("y", activation).coerceToNumber(activation);
			var other = value_to_point(args[0] || Avm1Value.INSTANCE.Undefined, activation);
			var object = point_to_object([this_x + other[0], this_y + other[1]], activation);
			return object;
		}
		function subtract(activation, _this, args) {
			var this_x = _this.get("x", activation).coerceToNumber(activation);
			var this_y = _this.get("y", activation).coerceToNumber(activation);
			var other = value_to_point(args[0] || Avm1Value.INSTANCE.Undefined, activation);
			var object = point_to_object([this_x - other[0], this_y - other[1]], activation);
			return object;
		}
		function distance(activation, _this, args) {
			if (args.length < 2) return Avm1Value.fromNumber(NaN);
			var a = (args[0] || Avm1Value.INSTANCE.Undefined).coerceToObject(activation);
			var b = args[1] || Avm1Value.INSTANCE.Undefined;
			var delta = a.callMethod("subtract", [b], activation, Avm1ExecutionReason.INSTANCE.FunctionCall);
			return delta.coerceToObject(activation).get("length", activation);
		}
		function polar(activation, _this, args) {
			var length = (args[0] || Avm1Value.INSTANCE.Undefined).coerceToNumber(activation);
			var angle = (args[1] || Avm1Value.INSTANCE.Undefined).coerceToNumber(activation);
			var point = point_to_object([length * Math.cos(angle), length * Math.sin(angle)], activation);
			return point;
		}
		function interpolate(activation, _this, args) {
			if (args.length < 3) return point_to_object([NaN, NaN], activation);
			var a = value_to_point(args[0], activation);
			var b = value_to_point(args[1], activation);
			var f = args[2].coerceToNumber(activation);
			var result = [b[0] - (b[0] - a[0]) * f, b[1] - (b[1] - a[1]) * f];
			return point_to_object(result, activation);
		}
		function offset(activation, _this, args) {
			var point = value_to_point(Avm1Value.fromObject(_this), activation);
			var dx = (args[0] || Avm1Value.INSTANCE.Undefined).coerceToNumber(activation);
			var dy = (args[1] || Avm1Value.INSTANCE.Undefined).coerceToNumber(activation);
			_this.set("x", Avm1Value.fromNumber(point[0] + dx), activation);
			_this.set("y", Avm1Value.fromNumber(point[1] + dy), activation);
			return Avm1Value.INSTANCE.Undefined;
		}
		function equals(activation, _this, args) {
			var other = args[0];
			if (other) {
				var this_x = _this.get("x", activation);
				var this_y = _this.get("y", activation);
				other = other.coerceToObject(activation);
				var other_x = other.get("x", activation);
				var other_y = other.get("y", activation);
				return Avm1Value.fromBoolean(this_x.eq(other_x) && this_y.eq(other_y));
			}
			return Avm1Value.fromBoolean(false);
		}
		return {
			create_point_object: function(point_proto, fn_proto) {
				var point = Avm1FunctionObject.createNative(constructor, fn_proto, point_proto);
				avm1_define_properties_on(OBJECT_DECLS, point, fn_proto);
				return point;
			},
			create_proto: function(proto, fn_proto) {
				var object = Avm1Object.createNew(proto);
				avm1_define_properties_on(PROTO_DECLS, object, fn_proto);
				return object;
			}
		};
	}());
	avm1_globals.rectangle = (function(){
		var PROTO_DECLS = {
			"toString": {
				type: "method",
				fn: to_string
			},
			"equals": {
				type: "method",
				fn: equals
			},
		};
		function constructor(activation, _this, args) {
			if (args.length) {
				_this.set("x", args[0] || Avm1Value.INSTANCE.Undefined, activation);
				_this.set("y", args[1] || Avm1Value.INSTANCE.Undefined, activation);
				_this.set("width", args[2] || Avm1Value.INSTANCE.Undefined, activation);
				_this.set("height", args[3] || Avm1Value.INSTANCE.Undefined, activation);
			} else {
				_this.set("x", Avm1Value.fromNumber(0), activation);
				_this.set("y", Avm1Value.fromNumber(0), activation);
				_this.set("width", Avm1Value.fromNumber(0), activation);
				_this.set("height", Avm1Value.fromNumber(0), activation);
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function to_string(activation, _this, args) {
			var x = _this.get("x", activation);
			var y = _this.get("y", activation);
			var width = _this.get("width", activation);
			var height = _this.get("height", activation);
			return Avm1Value.fromString(`(x=${x.coerceToString(activation)}, y=${y.coerceToString(activation)}, w=${width.coerceToString(activation)}, h=${height.coerceToString(activation)})`);
		}
		function equals(activation, _this, args) {
			return Avm1Value.fromBoolean(false);
		}
		return {
			create_rectangle_object: function(rectangle_proto, fn_proto) {
				return Avm1FunctionObject.createNative(constructor, fn_proto, rectangle_proto);
			},
			create_proto: function(proto, fn_proto) {
				var object = Avm1Object.createNew(proto);
				avm1_define_properties_on(PROTO_DECLS, object, fn_proto);
				return object;
			}
		};
	}());
	avm1_globals.error = (function(){
		var PROTO_DECLS = {
			"toString": {
				type: "method",
				fn: to_string
			},
			"name": {
				type: "string",
				string: "Error"
			},
			"message": {
				type: "string",
				string: "Error"
			},
		};
		function constructor(activation, _this, args) {
			var message = args[0] || Avm1Value.INSTANCE.Undefined;
			if (message.a != Avm1Value.Undefined) {
				_this.set("message", message, activation);
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function to_string(activation, _this, args) {
			var message = _this.get("message", activation);
			return Avm1Value.fromString(message.coerceToString(activation));
		}
		return {
			constructor,
			create_proto: function(proto, fn_proto) {
				var object = Avm1Object.createNew(proto);
				avm1_define_properties_on(PROTO_DECLS, object, fn_proto);
				return object;
			}
		};
	}());
	avm1_globals.key = (function(){
		var OBJECT_DECLS = {
			"ALT": {
				type: "number",
				number: KeyCode.ALT,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"BACKSPACE": {
				type: "number",
				number: KeyCode.BACKSPACE,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"CAPSLOCK": {
				type: "number",
				number: KeyCode.CAPS_LOCK,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"CONTROL": {
				type: "number",
				number: KeyCode.CONTROL,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"DELETEKEY": {
				type: "number",
				number: KeyCode.DELETE,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"DOWN": {
				type: "number",
				number: KeyCode.DOWN,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"END": {
				type: "number",
				number: KeyCode.END,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"ENTER": {
				type: "number",
				number: KeyCode.ENTER,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"ESCAPE": {
				type: "number",
				number: KeyCode.ESCAPE,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"HOME": {
				type: "number",
				number: KeyCode.HOME,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"INSERT": {
				type: "number",
				number: KeyCode.INSERT,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"LEFT": {
				type: "number",
				number: KeyCode.LEFT,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"PGDN": {
				type: "number",
				number: KeyCode.PAGE_DOWN,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"PGUP": {
				type: "number",
				number: KeyCode.PAGE_UP,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"RIGHT": {
				type: "number",
				number: KeyCode.RIGHT,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"SHIFT": {
				type: "number",
				number: KeyCode.SHIFT,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"SPACE": {
				type: "number",
				number: KeyCode.SPACE,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"TAB": {
				type: "number",
				number: KeyCode.TAB,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"UP": {
				type: "number",
				number: KeyCode.UP,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"isDown": {
				type: "method",
				fn: is_down,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"getCode": {
				type: "method",
				fn: get_code,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			}
		};
		function is_down(activation, _this, args) {
			var key = (args[0] || Avm1Value.INSTANCE.Undefined).coerceToI32(activation);
			return Avm1Value.fromBoolean(activation.context.input.isKeyDown(key));
		}
		function get_code(activation, _this, _args) {
			var code = activation.context.input.getLastKeyCode();
			return Avm1Value.fromNumber(code);
		}
		return {
			create_key_object: function(proto, fn_proto) {
				var object = Avm1Object.createNew(proto);
				avm1_define_properties_on(OBJECT_DECLS, object, fn_proto);
				return object;
			}
		};
	}());
	avm1_globals.mouse = (function(){
		var OBJECT_DECLS = {
			"show": {
				type: "method",
				fn: show_mouse,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			},
			"hide": {
				type: "method",
				fn: hide_mouse,
				attributes: ["DONT_ENUM", "DONT_DELETE", "READ_ONLY"]
			}
		};
		function show_mouse(activation, _this, _args) {
			var was_visible = activation.context.ui.mouseVisible();
			activation.context.ui.setMouseVisible(true);
			return Avm1Value.fromNumber(was_visible ? 0 : 1);
		}
		function hide_mouse(activation, _this, _args) {
			var was_visible = activation.context.ui.mouseVisible();
			activation.context.ui.setMouseVisible(false);
			return Avm1Value.fromNumber(was_visible ? 0 : 1);
		}
		return {
			create_mouse_object: function(proto, fn_proto) {
				var object = Avm1Object.createNew(proto);
				avm1_define_properties_on(OBJECT_DECLS, object, fn_proto);
				return object;
			}
		};
	}());
	avm1_globals.stage = (function(){
		var OBJECT_DECLS = {
			"width": {
				type: "property",
				getter: width
			},
			"height": {
				type: "property",
				getter: height
			},
			"scaleMode": {
				type: "property",
				getter: scale_mode,
				setter: set_scale_mode
			},
			"align": {
				type: "property",
				getter: align,
				setter: set_align
			},
		};
		function width(activation, _this, _args) {
			return Avm1Value.fromNumber(activation.context.stage.stage_size[0]);
		}
		function height(activation, _this, _args) {
			return Avm1Value.fromNumber(activation.context.stage.stage_size[1]);
		}
		function scale_mode(activation, _this, args) {
			return Avm1Value.fromString(activation.context.stage.getScaleMode().toString());
		}
		function set_scale_mode(activation, _this, args) {
			var r = args[0] || Avm1Value.INSTANCE.Undefined;
			var s = StageScaleMode.fromStr(r.coerceToString(activation)) || new StageScaleMode(StageScaleMode.ShowAll);
			activation.context.stage.setScaleMode(activation.context, s, true);
			return Avm1Value.INSTANCE.Undefined;
		}
		function align(activation, _this, args) {
			var align = activation.context.stage.getAlign();
			var s = "";
			if (align.LEFT) {
				s += "L";
			}
			if (align.TOP) {
				s += "T";
			}
			if (align.RIGHT) {
				s += "R";
			}
			if (align.BOTTOM) {
				s += "B";
			}
			return Avm1Value.fromString(s);
		}
		function set_align(activation, _this, args) {
			var r = args[0] || Avm1Value.INSTANCE.Undefined;
			var s = StageAlign.fromStr(r.coerceToString(activation));
			if (s) {
				activation.context.stage.setAlign(activation.context, s);
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		return {
			create_stage_object: function(proto, array_proto, fn_proto, broadcaster_functions) {
				var object = Avm1Object.createNew(proto);
				avm1_define_properties_on(OBJECT_DECLS, object, fn_proto);
				return object;
			}
		};
	}());
	var AVM1_GLOBAL_DECLS;
	(function() {
		AVM1_GLOBAL_DECLS = {
			"trace": {
				type: "method",
				fn: trace,
				attributes: ["DONT_ENUM"]
			},
			"isFinite": {
				type: "method",
				fn: is_finite,
				attributes: ["DONT_ENUM"]
			},
			"isNaN": {
				type: "method",
				fn: is_nan,
				attributes: ["DONT_ENUM"]
			},
			"parseFloat": {
				type: "method",
				fn: parse_float,
				attributes: ["DONT_ENUM"]
			},
			"parseInt": {
				type: "method",
				fn: parse_int,
				attributes: ["DONT_ENUM"]
			},
			"clearInterval": {
				type: "method",
				fn: clear_interval,
				attributes: ["DONT_ENUM"]
			},
			"setInterval": {
				type: "method",
				fn: set_interval,
				attributes: ["DONT_ENUM"]
			},
			"clearTimeout": {
				type: "method",
				fn: clear_timeout,
				attributes: ["DONT_ENUM"]
			},
			"setTimeout": {
				type: "method",
				fn: set_timeout,
				attributes: ["DONT_ENUM"]
			},
			"escape": {
				type: "method",
				fn: _escape,
				attributes: ["DONT_ENUM"]
			},
			"unescape": {
				type: "method",
				fn: _unescape,
				attributes: ["DONT_ENUM"]
			},
			"NaN": {
				type: "property",
				getter: get_nan,
				attributes: ["DONT_ENUM"]
			},
			"Infinity": {
				type: "property",
				getter: get_infinity,
				attributes: ["DONT_ENUM"]
			}
		}
		function _escape(activation, _this, args) {
			var s;
			if (args[0]) {
				s = args[0].coerceToString(activation);
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
			return Avm1Value.fromString(s);
		}
		function _unescape(activation, _this, args) {
			var s;
			if (args[0]) {
				s = args[0].coerceToString(activation);
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
			return Avm1Value.fromString(s);
		}
		function trace(activation, _this, args) {
			var out = args[0] || Avm1Value.INSTANCE.Undefined;
			activation.context.avm_trace(out.coerceToString(activation));
			return Avm1Value.INSTANCE.Undefined;
		}
		function is_finite(activation, _this, args) {
			if (args[0]) {
				return Avm1Value.fromBoolean(Number.isFinite(args[0].coerceToNumber(activation)));
			}
			return Avm1Value.fromBoolean(false);
		}
		function is_nan(activation, _this, args) {
			if (args[0]) {
				return Avm1Value.fromBoolean(Number.isNaN(args[0].coerceToNumber(activation)));
			}
			return Avm1Value.fromBoolean(false);
		}
		function parse_float(activation, _this, args) {
			if (args[0]) {
				return Avm1Value.fromNumber(Number.parseFloat(args[0].coerceToString(activation)));
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function parse_int(activation, _this, args) {
			if (args[0]) {
				return Avm1Value.fromNumber(Number.parseInt(args[0].coerceToString(activation)));
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function clear_interval(activation, _this, args) {
			var id = args[0] || Avm1Value.INSTANCE.Undefined;
			id = id.coerceToI32(activation);
			if (!activation.context.timers.remove(id)) {
				console.log("clearTimeout: Timer " + id + " does not exist");
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function set_interval(activation, _this, args) {
			return create_timer(activation, _this, args, false);
		}
		function clear_timeout(activation, _this, args) {
			var id = args[0] || Avm1Value.INSTANCE.Undefined;
			id = id.coerceToI32(activation);
			if (!activation.context.timers.remove(id)) {
				console.log("clearTimeout: Timer " + id + " does not exist");
			}
			return Avm1Value.INSTANCE.Undefined;
		}
		function set_timeout(activation, _this, args) {
			return create_timer(activation, _this, args, true);
		}
		function create_timer(activation, _this, args, is_timeout) {
			var callback = null;
			var interval = null;
			var o = args[0];
			if (o && (o.a == Avm1Value.Object)) {
				var e = o.b.asExecutable();
				if (e) {
					callback = {
						type: "avm1_function",
						func: o.b,
						params: args.slice(2)
					}
					interval = args[1];
				} else {
					callback = {
						type: "avm1_method",
						this: o.b,
						methodName: (args[1] || Avm1Value.INSTANCE.Undefined).coerceToString(activation),
						params: args.slice(3)
					}
					interval = args[2];
				}
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
			interval = interval || Avm1Value.INSTANCE.Undefined;
			if (interval.a == Avm1Value.Undefined) {
				return Avm1Value.INSTANCE.Undefined;
			} else {
				interval = interval.coerceToI32(activation);
			}
			var id = activation.context.timers.addTimer(callback, interval, is_timeout);
			return Avm1Value.fromNumber(id);
		}
		function get_nan(activation, _this, args) {
			if (activation.swfVersion > 4) {
				return Avm1Value.fromNumber(NaN);
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
		}
		function get_infinity(activation, _this, args) {
			if (activation.swfVersion > 4) {
				return Avm1Value.fromNumber(Infinity);
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
		}
	}());

	function avm1_create_globals() {
		var object_proto = Avm1Object.createNew(null);
		var function_proto = avm1_globals.function.create_proto(object_proto);
		avm1_globals.object.fill_proto(object_proto, function_proto);

		var button_proto = avm1_globals.button.create_proto(object_proto, function_proto);
		var movie_clip_proto = avm1_globals.movieclip.create_proto(object_proto, function_proto);

		var sound_proto = avm1_globals.sound.create_proto(object_proto, function_proto);

		var text_field_proto = avm1_globals.text_field.create_proto(object_proto, function_proto);

		var array_proto = avm1_globals.array.create_proto(object_proto, function_proto);

		var color_proto = avm1_globals.color.create_proto(object_proto, function_proto);

		var error_proto = avm1_globals.error.create_proto(object_proto, function_proto);

		var object = avm1_globals.object.create_object_object(object_proto, function_proto);
		var _function = Avm1FunctionObject.createConstructor(avm1_globals.function.constructor, avm1_globals.function.function, function_proto, function_proto);

		var string_proto = avm1_globals.string.create_proto(object_proto, function_proto);
		var number_proto = avm1_globals.number.create_proto(object_proto, function_proto);
		var boolean_proto = avm1_globals.boolean.create_proto(object_proto, function_proto);

		var array = avm1_globals.array.create_array_object(array_proto, function_proto);

		var string = avm1_globals.string.create_string_object(string_proto, function_proto);
		var number = avm1_globals.number.create_number_object(number_proto, function_proto);
		var boolean = avm1_globals.boolean.create_boolean_object(boolean_proto, function_proto);

		var color = Avm1FunctionObject.createNative(avm1_globals.color.constructor, function_proto, color_proto);

		var sound = avm1_globals.sound.create_constructor(sound_proto, function_proto);

		var movie_clip = Avm1FunctionObject.createEmpty(function_proto, movie_clip_proto);
		var button = Avm1FunctionObject.createEmpty(function_proto, button_proto);
		var text_field = Avm1FunctionObject.createEmpty(function_proto, text_field_proto);

		var error = Avm1FunctionObject.createNative(avm1_globals.error.constructor, function_proto, error_proto);

		var color_transform_proto = avm1_globals.color_transform.create_proto(object_proto, function_proto);
		var color_transform = Avm1FunctionObject.createConstructor(avm1_globals.color_transform.constructor, null, function_proto, color_transform_proto);

		var matrix_proto = avm1_globals.matrix.create_proto(object_proto, function_proto);
		var point_proto = avm1_globals.point.create_proto(object_proto, function_proto);
		var rectangle_proto = avm1_globals.rectangle.create_proto(object_proto, function_proto);

		var matrix = avm1_globals.matrix.create_matrix_object(matrix_proto, function_proto);
		var point = avm1_globals.point.create_point_object(point_proto, function_proto);
		var rectangle = avm1_globals.rectangle.create_rectangle_object(rectangle_proto, function_proto);

		var transform = avm1_globals.transform.create_constructor(object_proto, function_proto);

		var math = avm1_globals.math.create(object_proto, function_proto);
		var mouse = avm1_globals.mouse.create_mouse_object(object_proto, function_proto);

		var key = avm1_globals.key.create_key_object(object_proto, function_proto, null, array_proto);

		var stage = avm1_globals.stage.create_stage_object(object_proto, array_proto, function_proto, null);

		var flash = Avm1Object.createNew(object_proto);
		var geom = Avm1Object.createNew(object_proto);

		var globals = Avm1Object.createNew(null);

		function define_globals(defs) {
			for (var i = 0; i < defs.length; i++) {
				var _ = defs[i];
				_[0].defineValue(_[1], Avm1Value.fromObject(_[2]), _[3]);
			}
		}

		avm1_define_properties_on(AVM1_GLOBAL_DECLS, globals, function_proto);

		define_globals([
			[globals, "Array", array, new Avm1Attribute().dontEnum()],
			[globals, "Button", button, new Avm1Attribute().dontEnum()],
			[globals, "Color", color, new Avm1Attribute().dontEnum()],
			[globals, "Error", error, new Avm1Attribute().dontEnum()],
			[globals, "Object", object, new Avm1Attribute().dontEnum()],
			[globals, "Function", _function, new Avm1Attribute().dontEnum()],
			[globals, "MovieClip", movie_clip, new Avm1Attribute().dontEnum()],
			[globals, "Sound", sound, new Avm1Attribute().dontEnum()],
			[globals, "TextField", text_field, new Avm1Attribute().dontEnum()],
			[globals, "String", string, new Avm1Attribute().dontEnum()],
			[globals, "Number", number, new Avm1Attribute().dontEnum()],
			[globals, "Boolean", boolean, new Avm1Attribute().dontEnum()],
			[globals, "Math", math, new Avm1Attribute().dontEnum()],
			[globals, "Mouse", mouse, new Avm1Attribute().dontEnum()],
			[globals, "Key", key, new Avm1Attribute().dontEnum()],
			[globals, "Stage", stage, new Avm1Attribute().dontEnum()],
			[globals, "flash", flash, new Avm1Attribute().dontEnum()],
			[flash, "geom", geom, new Avm1Attribute()],
			[geom, "ColorTransform", color_transform, new Avm1Attribute()],
			[geom, "Matrix", matrix, new Avm1Attribute()],
			[geom, "Point", point, new Avm1Attribute()],
			[geom, "Rectangle", rectangle, new Avm1Attribute()],
			[geom, "Transform", transform, new Avm1Attribute()],
		]);

		return [
			{
				object: object_proto,
				function: function_proto,
				array: array_proto,
				string: string_proto,
				number: number_proto,
				boolean: boolean_proto,
				movieclip: movie_clip_proto,
				button: button_proto,
				text_field: text_field_proto,
				sound: sound_proto,
				color_transform: color_transform_proto,
				color_transform_constructor: color_transform,
				matrix: matrix_proto,
				matrix_constructor: matrix,
				point: point_proto,
				point_constructor: point,
				rectangle: rectangle_proto,
				rectangle_constructor: rectangle,
				transform_constructor: transform,
			},
			globals
		]
	}
	var avm1_stage_object = {};
	avm1_stage_object.get_property = function(dobj, name, activation, is_slash_path) {
		var magic_property = name[0] == "_";
		if (magic_property) {
			var a = avm1_stage_object.resolve_path_property(dobj, name, activation);
			if (a) {
				return a;
			}
		}
		if (dobj.isContainer()) {
			var o = dobj.childByName(name, activation.is_case_sensitive());
			if (o) {
				if (is_slash_path) {
					return o.getObject();
				} else if (o instanceof Graphic) {
					return o.getParent().getObject();
				} else {
					return o.getObject();
				}
			}
		}
		if (magic_property) {
			var property = activation.context.avm1.displayProperties.getByName(name);
			if (property) {
				return property.get(activation, dobj);
			}
		}
	}
	avm1_stage_object.notify_property_change = function(dobj, property_name, value, activation) {
		var text_fields = [];
		var case_sensitive = activation.is_case_sensitive();
		var bindings = dobj.getAvm1TextFieldBindings();
		if (bindings) {
			for (var i = 0; i < bindings.length; i++) {
				var binding = bindings[i];
				var r;
				if (case_sensitive) {
					r = binding.variable_name == property_name;
				} else {
					r = eq_ignore_case(binding.variable_name, property_name);
				}
				if (r) {
					text_fields.push(binding.text_field);
				}
			}
		}
		for (var i = 0; i < text_fields.length; i++) {
			var tf = text_fields[i];
			tf.set_html_text(value.coerceToString(activation), activation.context);
		}
	}
	avm1_stage_object.has_display_object_property = function(dobj, activation, name) {
		var magic_property = name[0] == "_";
		if (magic_property && !!activation.context.avm1.displayProperties.getByName(name)) {
			return true;
		}
		var case_sensitive = activation.is_case_sensitive();
		if (dobj.isContainer()) {
			var o = dobj.childByName(name, case_sensitive);
			if (o) {
				return true;
			}
		}
		if (magic_property && !!avm1_stage_object.resolve_path_property(dobj, name, activation)) {
			return true;
		}
		return false;
	}
	function avm1_parse_level_id(digits) {
		return +digits;
	}
	avm1_stage_object.resolve_path_property = function(dobj, name, activation) {
		var case_sensitive = activation.is_case_sensitive();
		if (avm1_eq_with_case(name, "_root", case_sensitive)) {
			return activation.rootObject();
		} else if (avm1_eq_with_case(name, "_parent", case_sensitive)) {
			var r = dobj.getAvm1Parent();
			return r ? r.getObject() : Avm1Value.INSTANCE.Undefined;
		} else if (avm1_eq_with_case(name, "_global", case_sensitive)) {
			return Avm1Value.fromObject(activation.context.avm1.globalObject());
		}
		var prefix = name.slice(0, 6);
		if (prefix) {
			if (prefix == "_level" || prefix == "_flash") {
				var level_id = avm1_parse_level_id(name.slice(6));
				var level = activation.get_level(level_id);
				return level ? level.getObject() : Avm1Value.INSTANCE.Undefined;
			}
		}
		return null;
	}
	avm1_stage_object.enumerate_keys = function(dobj, keys) {
		if (dobj instanceof DisplayObjectContainer) {
			var children = dobj.iterRenderList();
			for (var i = children.length - 1; i >= 0; i--) {
				var child = children[i];
				if (child instanceof InteractiveObject) {
					var name = child.name;
					if (name) {
						keys.push(name);
					} else {
						console.log("Interactive DisplayObjects have names");
					}
				}
			}
		}
	}
	avm1_stage_object.action_property_coerce = function(activation, index, value) {
		switch (index) {
			case 0:
			case 1:
			case 2:
			case 3:
			case 4:
			case 5:
			case 6:
			case 7:
			case 8:
			case 9:
			case 10:
			case 12:
				var value_to_number = avm1_stage_object.property_coerce_to_number(activation, value);
				return (value_to_number != null) ? Avm1Value.fromNumber(value_to_number) : value;
			case 16:
			case 18:
			case 20:
			case 21:
				return Avm1Value.fromNumber(value.coerceToNumber(activation));
			case 13:
			case 19:
				return Avm1Value.fromString(value.coerceToString(activation));
			default:
				return value;
		}
	}
	var Avm1DisplayProperty = function(get, set) {
		this._get = get;
		this._set = set;
	}
	Avm1DisplayProperty.prototype.get = function(activation, _this) {
		return this._get(activation, _this);
	}
	Avm1DisplayProperty.prototype.set = function(activation, _this, val) {
		if (this._set) this._set(activation, _this, val);
	}
	Avm1DisplayProperty.prototype.isReadOnly = function(activation, _this, val) {
		return !this._set;
	}
	var Avm1DisplayPropertyMap = function() {
		this.propertyMap = new Avm1PropertyMap();
		this.propertyIndex = [];
		for (var i = 0; i < Avm1DisplayPropertyMap.PROPERTIES.length; i++) {
			var p = Avm1DisplayPropertyMap.PROPERTIES[i];
			this.addProperty(p[0], p[1], p[2]);
		}
	}
	Avm1DisplayPropertyMap.prototype.getByName = function(name) {
		return this.propertyMap.get(name, false);
	}
	Avm1DisplayPropertyMap.prototype.getByIndex = function(index) {
		return this.propertyIndex[index];
	}
	Avm1DisplayPropertyMap.prototype.addProperty = function(name, get, set) {
		var prop = new Avm1DisplayProperty(get, set);
		this.propertyMap.insert(name, prop, false);
		this.propertyIndex.push(prop);
	};
	(function() {
		function property_coerce_to_number(activation, val) {
			if ((val.a != Avm1Value.Null) && (val.a != Avm1Value.Undefined)) {
				var n = val.coerceToNumber(activation);
				if (Number.isFinite(n)) {
					return n;
				}
				return null;
			} else {
				return null;
			}
		}
		function x(activation, _this) {
			return Avm1Value.fromNumber(_this.getX());
		}
		function set_x(activation, _this, val) {
			var n = property_coerce_to_number(activation, val);
			if (n != null) {
				_this.setX(n);
			}
		}
		function y(activation, _this) {
			return Avm1Value.fromNumber(_this.getY());
		}
		function set_y(activation, _this, val) {
			var n = property_coerce_to_number(activation, val);
			if (n != null) {
				_this.setY(n);
			}
		}
		function x_scale(activation, _this) {
			return Avm1Value.fromNumber(_this.getXScale());
		}
		function set_x_scale(activation, _this, val) {
			var n = property_coerce_to_number(activation, val);
			if (n != null) {
				_this.setXScale(n);
			}
		}
		function y_scale(activation, _this) {
			return Avm1Value.fromNumber(_this.getYScale());
		}
		function set_y_scale(activation, _this, val) {
			var n = property_coerce_to_number(activation, val);
			if (n != null) {
				_this.setYScale(n);
			}
		}
		function current_frame(activation, _this) {
			if (_this instanceof MovieClip) {
				return Avm1Value.fromNumber(_this.currentFrame);
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
		}
		function total_frames(activation, _this) {
			if (_this instanceof MovieClip) {
				return Avm1Value.fromNumber(_this.getTotalFrames());
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
		}
		function alpha(activation, _this) {
			return Avm1Value.fromNumber(_this.getAlpha());
		}
		function set_alpha(activation, _this, val) {
			var n = property_coerce_to_number(activation, val);
			if (n != null) {
				_this.setAlpha(n);
			}
		}
		function visible(activation, _this) {
			return Avm1Value.fromBoolean(_this.getVisible());
		}
		function set_visible(activation, _this, val) {
			var n = property_coerce_to_number(activation, val);
			if (n != null) {
				_this.setVisible(n != 0);
			}
		}
		function width(activation, _this) {
			return Avm1Value.fromNumber(_this.getWidth());
		}
		function set_width(activation, _this, val) {
			var n = property_coerce_to_number(activation, val);
			if (n != null) {
				_this.setWidth(n);
			}
		}
		function height(activation, _this) {
			return Avm1Value.fromNumber(_this.getHeight());
		}
		function set_height(activation, _this, val) {
			var n = property_coerce_to_number(activation, val);
			if (n != null) {
				_this.setHeight(n);
			}
		}
		function rotation(activation, _this) {
			var t = _this.getRotation();
			return Avm1Value.fromNumber(t);
		}
		function set_rotation(activation, _this, val) {
			var n = property_coerce_to_number(activation, val);
			if (n != null) {
				_this.setRotation(n);
			}
		}
		function target(activation, _this) {
			return Avm1Value.fromString(_this.slash_path());
		}
		function frames_loaded(activation, _this) {
			if (_this instanceof MovieClip) {
				return Avm1Value.fromNumber(_this.getFramesloaded());
			} else {
				return Avm1Value.INSTANCE.Undefined;
			}
		}
		function name(activation, _this) {
			return Avm1Value.fromString(_this.getName() || "");
		}
		function set_name(activation, _this, val) {
			var n = val.coerceToString(activation);
			_this.setName(n);
		}
		function url(activation, _this) {
			return Avm1Value.fromString(activation.context.swf.url);
		}
		function high_quality(activation, _this) {
			console.log("high_quality");
			return Avm1Value.fromNumber(0);
		}
		function set_high_quality(activation, _this, val) {
			console.log("set_high_quality", val);
		}
		function focus_rect(activation, _this) {
			console.log("focus_rect");
			return Avm1Value.fromNumber(0);
		}
		function set_focus_rect(activation, _this, val) {
			console.log("set_focus_rect");
		}
		function sound_buf_time(activation, _this) {
			console.log("sound_buf_time");
			return Avm1Value.fromNumber(0);
		}
		function set_sound_buf_time(activation, _this, val) {
			console.log("set_sound_buf_time");
		}
		function quality(activation, _this) {
			var quality = activation.context.stage.getQuality().toString();
			return Avm1Value.fromString(quality);
		}
		function set_quality(activation, _this, val) {
			var quality = StageQuality.fromStr(val.coerceToString(activation));
			if (quality) {
				activation.context.stage.setQuality(activation.context, quality);
			}
		}
		function x_mouse(activation, _this) {
			var local = _this.localMousePosition(activation.context);
			return Avm1Value.fromNumber(local.x / 20);
		}
		function y_mouse(activation, _this) {
			var local = _this.localMousePosition(activation.context);
			return Avm1Value.fromNumber(local.y / 20);
		}
		function drop_target() {
			console.log("drop_target");
			return Avm1Value.fromNumber(0);
		}
		avm1_stage_object.property_coerce_to_number = property_coerce_to_number;
		Avm1DisplayPropertyMap.PROPERTIES = [
			["_x", x, set_x],
			["_y", y, set_y],
			["_xscale", x_scale, set_x_scale],
			["_yscale", y_scale, set_y_scale],
			["_currentframe", current_frame, null],
			["_totalframes", total_frames, null],
			["_alpha", alpha, set_alpha],
			["_visible", visible, set_visible],
			["_width", width, set_width],
			["_height", height, set_height],
			["_rotation", rotation, set_rotation],
			["_target", target, null],
			["_framesloaded", frames_loaded, null],
			["_name", name, set_name],
			["_droptarget", drop_target, null],
			["_url", url, null],
			["_highquality", high_quality, set_high_quality],
			["_focusrect", focus_rect, set_focus_rect],
			["_soundbuftime", sound_buf_time, set_sound_buf_time],
			["_quality", quality, set_quality],
			["_xmouse", x_mouse, null],
			["_ymouse", y_mouse, null]
		]
	}());
	var Avm1ScopeClass = function(type) {
		this.type = type;
	}
	Avm1ScopeClass.Global = 1;
	Avm1ScopeClass.Target = 2;
	Avm1ScopeClass.Local = 3;
	Avm1ScopeClass.With = 4;
	var Avm1Scope = function(parent, _class, values) {
		this.values = values;
		this.parent = parent;
		this.class = _class;
	}
	Avm1Scope.fromGlobalObject = function(globals) {
		return new Avm1Scope(null, new Avm1ScopeClass(Avm1ScopeClass.Global), globals);
	}
	Avm1Scope.newLocalScope = function(parent) {
		return new Avm1Scope(parent, new Avm1ScopeClass(Avm1ScopeClass.Local), Avm1Object.createNew(null));
	}
	Avm1Scope.newTargetScope = function(parent, clip) {
		var scope = parent.clone();
		if (scope.class.type == Avm1ScopeClass.Target) {
			scope.values = clip;
		} else {
			scope.parent = scope.parent ? Avm1Scope.newTargetScope(scope.parent, clip) : null;
		}
		return scope;
	}
	Avm1Scope.newWithScope = function(parent_scope, with_object) {
		return new Avm1Scope(parent_scope, new Avm1ScopeClass(Avm1ScopeClass.With), with_object);
	}
	Avm1Scope.prototype.clone = function() {
		return new Avm1Scope(this.parent, this.class, this.values);
	}
	Avm1Scope.prototype.resolve = function(name, activation) {
		return this.resolve_recursive(name, activation, true);
	}
	Avm1Scope.prototype.resolve_recursive = function(name, activation, top_level) {
		if (this.values.has_property(activation, name)) {
			return new Avm1CallableValue(Avm1CallableValue.Callable, this.values, this.values.get_non_slash_path(name, activation));
		}
		if (this.parent) {
			var res = this.parent.resolve(name, activation);
			if (top_level && res.type == Avm1CallableValue.UnCallable) {
				if (res.value.a == Avm1Value.Undefined) {
					if (this.values.has_own_property(activation, name)) {
						var g = activation.rootObject().coerceToObject(activation).get_non_slash_path(name, activation);
						return new Avm1CallableValue(Avm1CallableValue.Callable, this.values, g);
					}
				}
			}
			return res;
		} else {
			return new Avm1CallableValue(Avm1CallableValue.UnCallable, Avm1Value.INSTANCE.Undefined);
		}
	}
	Avm1Scope.prototype.set = function(name, value, activation) {
		var removed = this.values.asDisplayObject();
		if (removed) {
			removed = removed.AVM1_REMOVED;
		} else {
			removed = false;
		}
		if (!removed && ((this.class.type == Avm1ScopeClass.Target) || this.values.has_property(activation, name))) {
			this.values.set(name, value, activation);
		} else if (this.parent) {
			this.parent.set(name, value, activation);
		} else {
			this.values.set(name, value, activation);
		}
	}
	Avm1Scope.prototype.defineLocal = function(name, value, activation) {
		if ((this.class.type == Avm1ScopeClass.With) && this.parent) {
			if (this.values.has_own_property(activation, name)) {
				this.values.set(name, value, activation);
			} else {
				this.parent.defineLocal(name, value, activation);
			}
		} else {
			this.values.set(name, value, activation);
		}
	}
	Avm1Scope.prototype.forceDefineLocal = function(name, value, activation) {
		this.values.set(name, value, activation);
	}
	Avm1Scope.prototype.delete = function(activation, name) {
		if (this.values.has_property(activation, name)) {
			return this.values.delete(activation, name);
		}
		if (this.parent) {
			return this.parent.delete(activation, name);
		}
		return false;
	}
	var Avm1ReturnType = function(type, value) {
		this.type = type;
		if (arguments.length == 2) 
			this.value = value;
	}
	Avm1ReturnType.prototype.getValue = function() {
		return (this.type == Avm1ReturnType.explicit) ? this.value : Avm1Value.INSTANCE.Undefined;
	}
	Avm1ReturnType.implicit = 0;
	Avm1ReturnType.explicit = 1;
	var Avm1FrameControl = function(type, value) {
		this.type = type;
		if (arguments.length == 2) 
			this.value = value;
	}
	Avm1FrameControl.continue = 0;
	Avm1FrameControl.return = 1;
	Avm1FrameControl.objContinue = new Avm1FrameControl(Avm1FrameControl.continue);
	var Avm1ActivationIdentifier = function(data) {
		this.parent = data.parent;
		this.name = data.name;
		this.depth = data.depth;
		this.function_count = data.function_count;
		this.special_count = data.special_count;
	}
	Avm1ActivationIdentifier.root = function(name) {
		return new Avm1ActivationIdentifier({
			parent: null,
			name: name,
			depth: 0,
			function_count: 0,
			special_count: 0
		});
	}
	Avm1ActivationIdentifier.prototype.child = function(name) {
		return new Avm1ActivationIdentifier({
			parent: this,
			name: name,
			depth: this.depth + 1,
			function_count: this.function_count,
			special_count: this.special_count
		});
	}
	Avm1ActivationIdentifier.prototype.function = function(name, reason, max_recursion_depth) {
		return new Avm1ActivationIdentifier({
			parent: this,
			name: name,
			depth: this.depth + 1,
			function_count: this.function_count,
			special_count: this.special_count
		});
	}
	var Avm1CallableValue = function(type, value, value2) {
		this.type = type;
		this.value = value;
		this.value2 = value2;
	}
	Avm1CallableValue.prototype.call_with_default_this = function(default_this, name, activation, args) {
		var val;
		switch(this.type) {
			case Avm1CallableValue.Callable:
				val = (this.value2.a == Avm1Value.Object) ? this.value2.b : null;
				return val ? val.call(name, activation, Avm1Value.fromObject(this.value), args) : Avm1Value.INSTANCE.Undefined;
			case Avm1CallableValue.UnCallable:
				val = (this.value.a == Avm1Value.Object) ? this.value.b : null;
				return val ? val.call(name, activation, Avm1Value.fromObject(default_this), args) : Avm1Value.INSTANCE.Undefined;
		}
	}
	Avm1CallableValue.prototype.getValue = function() {
		switch(this.type) {
			case Avm1CallableValue.UnCallable:
				return this.value;
			case Avm1CallableValue.Callable:
				return this.value2;
		}
	}
	Avm1CallableValue.UnCallable = 1;
	Avm1CallableValue.Callable = 2;
	var MovieClipPath = function(path) {
		var level = 0;
		var parts = path.split(".");
		if (parts[0] != null) {
			if (parts[0] == "_level") {
				var n = +parts[0].slice(6);
				if (Number.isInteger(n)) {
					level = n;
				}
			}
		}
		this.level = level;
		this.path_segments = parts;
		this.full_path = path;
	}
	var Avm1MovieClipReference = function(path, object) {
		this._path = path;
		this.cached_object = object;
	}
	Avm1MovieClipReference.tryFromStagePbject = function(activation, object) {
		var display_object = object.asDisplayObjectNoSuper();
		var path = null;
		var cached = null;
		if (display_object) {
			if (display_object instanceof MovieClip) {
				path = display_object.path();
				cached = display_object.getObject();
			} else if (activation.swfVersion <= 5) {
				var d = Avm1MovieClipReference.process_swf5_references(activation, display_object);
				path = d.path();
				cached = d.getObject();
			} else {
				return null;
			}
		} else {
			return null;
		}
		if (cached.a == Avm1Value.Object) {
			cached = cached.b;
		} else {
			return null;
		}
		return new Avm1MovieClipReference(new MovieClipPath(path), cached);
	}
	Avm1MovieClipReference.process_swf5_references = function(activation, display_object) {
		if (activation.swfVersion <= 5) {
			while(!(display_object instanceof MovieClip)) {
				var p = display_object.getAvm1Parent();
				if (p) {
					display_object = p;
				} else {
					return null;
				}
			}
		}
		return display_object;
	}
	Avm1MovieClipReference.prototype.coerceToObject = function(a) {
		var res = this.resolveReference(a);
		return res ? res[1] : null;
	}
	Avm1MovieClipReference.prototype.coerceToString = function(a) {
		var res = this.resolveReference(a);
		if (res) {
			if (res[0]) {
				return res[2].path();
			} else {
				return this._path.full_path;
			}
		} else {
			return "";
		}
	}
	Avm1MovieClipReference.prototype.path = function() {
		return this._path.full_path;
	}
	Avm1MovieClipReference.prototype.resolveReference = function(activation) {
		var cache = this.cached_object;
		if (cache) {
			var display_object = cache.asDisplayObjectNoSuper();
			if (display_object) {
				if (!display_object.AVM1_REMOVED) {
					var d = Avm1MovieClipReference.process_swf5_references(activation, display_object);
					return [true, cache, d];
				}
			}
		}
		this.cached_object = null;
		var start = activation.get_or_create_level(this._path.level);
		for (var i = 0; i < this._path.path_segments.length; i++) {
			var part = this._path.path_segments[i];
			if (start) {
				if (start instanceof DisplayObjectContainer) {
					start = start.childByName(part, activation.is_case_sensitive());
				}
			}
		}
		if (start) {
			var dd = Avm1MovieClipReference.process_swf5_references(activation, start);
			return [false, dd.getObject().coerceToObject(activation), dd];
		}
		return null;
	}
	var Avm1RegisterSet = function(len) {
		this.registers = [];
		for (var i = 0; i < len; i++) {
			this.registers.push(Avm1Value.INSTANCE.Undefined);
		}
	}
	Avm1RegisterSet.prototype.has = function(idx) {
		return idx in this.registers;
	}
	Avm1RegisterSet.prototype.get = function(idx) {
		return this.registers[idx];
	}
	Avm1RegisterSet.prototype.set = function(idx, value) {
		if (idx in this.registers) {
			this.registers[idx] = value;
		}
	}
	var Avm1Activation = function(context, id) {
		this.context = context;
		this.id = id;
		this.swfVersion = 4;
		this.target_clip = null;
		this.base_clip = null;
		this.scope = null;
		this.thisObject = null;
		this.stack = [];
		this.callee = null;
		this.base_clip_unloaded = false;
		this.constantPool = [];
		this.localRegisters = null;
	}
	Avm1Activation.fromAction = function(context, id, swf_version, scope, constant_pool, base_clip, _this, _callee) {
		var r = new Avm1Activation(context, id);
		r.swfVersion = swf_version;
		r.target_clip = base_clip;
		r.base_clip = base_clip;
		r.thisObject = _this;
		r.scope = scope;
		r.constantPool = constant_pool;
		r.callee = _callee;
		r.base_clip_unloaded = base_clip.AVM1_REMOVED;
		return r;
	}
	Avm1Activation.fromNothing = function(context, id, base_clip) {
		var r = new Avm1Activation(context, id);
		r.swfVersion = base_clip.swfVersion();
		r.target_clip = base_clip;
		r.base_clip = base_clip;
		r.thisObject = Avm1Value.fromObject(context.avm1.globalObject());
		r.constantPool = context.avm1.constantPool;
		r.scope = context.avm1.globalScope;
		r.base_clip_unloaded = base_clip.AVM1_REMOVED;
		return r;
	}
	Avm1Activation.prototype.runChildFrameForAction = function(name, active_clip, code) {
		var parent_activation = Avm1Activation.fromNothing(this.context, Avm1ActivationIdentifier.root("[Actions Parent]"), active_clip);
		var clip_obj = active_clip.getObject();
		var child_scope = new Avm1Scope(parent_activation.scope, new Avm1ScopeClass(Avm1ScopeClass.Target), clip_obj.coerceToObject(this));
		var child_name = parent_activation.id.child(name);
		var child_activation = Avm1Activation.fromAction(this.context, child_name, active_clip.swfVersion(), child_scope, [], active_clip, clip_obj, null);
		child_activation.runActions(code);
	}
	Avm1Activation.prototype.runWithChildFrameForDisplayObject = function(name, active_clip, swf_version, fn) {
		var clip_obj = active_clip.getObject();
		clip_obj = clip_obj.b;
		var child_scope = new Avm1Scope(this.context.avm1.globalScope, new Avm1ScopeClass(Avm1ScopeClass.Target), clip_obj);
		var constant_pool = this.context.avm1.constantPool;
		var activation = Avm1Activation.fromAction(this.context, this.id.child(name), swf_version, child_scope, constant_pool, active_clip, clip_obj, null);
		fn(activation);
	}
	Avm1Activation.prototype.withNewScope = function(name, scope) {
		var r = new Avm1Activation(this.context, this.id.child(name));
		r.swfVersion = this.swfVersion;
		r.target_clip = this.target_clip;
		r.base_clip = this.base_clip;
		r.thisObject = this.thisObject;
		r.constantPool = this.constantPool;
		r.scope = scope;
		r.base_clip_unloaded = this.base_clip_unloaded;
		return r;
	}
	Avm1Activation.prototype.push = function(value) {
		this.stack.push(value);
	}
	Avm1Activation.prototype.pop = function() {
		var val = this.stack.pop();
		if (!val) {
			console.log("Avm1::pop: Stack underflow");
			return Avm1Value.INSTANCE.Undefined;
		}
		return val;
	}
	Avm1Activation.prototype.stackLen = function() {
		return this.stack.length;
	}
	Avm1Activation.prototype.setConstantPool = function(constantPool) {
		this.constantPool = constantPool;
	}
	Avm1Activation.prototype.getCurrentRegister = function(id) {
		if (this.hasLocalRegister(id)) {
			return this.localRegister(id) || Avm1Value.INSTANCE.Undefined;
		} else {
			return this.context.avm1.registers[id] || Avm1Value.INSTANCE.Undefined;
		}
	}
	Avm1Activation.prototype.setCurrentRegister = function(id, value) {
		if (this.hasLocalRegister(id)) {
			this.setLocalRegister(id, value);
		} else {
			if (id in this.context.avm1.registers) {
				this.context.avm1.registers[id] = value;
			}
		}
	}
	Avm1Activation.prototype.allocateLocalRegisters = function(num) {
		this.localRegisters = (num > 0) ? new Avm1RegisterSet(num) : null;
	}
	Avm1Activation.prototype.hasLocalRegister = function(id) {
		return this.localRegisters ? this.localRegisters.has(id) : false;
	}
	Avm1Activation.prototype.localRegister = function(id) {
		return this.localRegisters ? this.localRegisters.get(id) : null;
	}
	Avm1Activation.prototype.setLocalRegister = function(id, value) {
		if (this.localRegisters) {
			this.localRegisters.set(id, value);
		}
	}
	Avm1Activation.prototype.resolveTargetPath = function(root, start, path, first_element, path_has_slash) {
		if (!path) return start;
		var object, is_slash_path;
		if (path[0] == "/") {
			path = path.slice(1);
			object = root.getObject().coerceToObject(this);
			is_slash_path = true;
		} else {
			object = start;
			is_slash_path = false;
		}
		var case_sensitive = this.is_case_sensitive();
		while (path) {
			path = string_trim_start_matches(path, ":");
			var prefix = path.slice(0, Math.min(path.length, 3));
			var val = null;
			if (prefix == ".." || prefix == "../" || prefix == "..:") {
				if (path[2] == "/") {
					is_slash_path = true;
				}
				path = path.slice(3);
				var parent = object.asDisplayObject();
				if (parent) {
					parent = parent.getAvm1Parent();
					if (parent) {
						val = parent.getObject();
					} else {
						return null;
					}
				} else {
					return null;
				}
			} else {
				var pos = 0;
				while(pos < path.length) {
					var _ = path[pos];
					if (_ == ":") {
						break;
					} else if (_ == ".") {
						if (!is_slash_path) break;
					} else if (_ == "/") {
						is_slash_path = true;
						break;
					}
					pos++;
				}
				var name = path.slice(0, pos);
				path = path.slice(pos + 1);
				if (first_element && (name == "this")) {
					val = this.thisObject;
				} else if (first_element && (name == "_root")) {
					val = this.rootObject();
				} else {
					var child = null;
					var d = object.asDisplayObject();
					if (d) {
						if (d.isContainer()) {
							child = d.childByName(name, case_sensitive);
						}	
					}
					if (child) {
						if (path_has_slash) {
							val = child.getObject();
						} else if (child instanceof Graphic) {
							var d = child.getParent();
							val = d ? d.getObject() : Avm1Value.INSTANCE.Undefined;
						} else {
							val = child.getObject();
						}
					} else {
						if (path_has_slash) {
							val = object.get(name, this);
						} else {
							val = object.get_non_slash_path(name, this);
						}
					}
				}
			}
			first_element = false;
			var resO = null;
			if (val.a == Avm1Value.Object) {
				resO = val.b;
			} else if (val.a == Avm1Value.MovieClip) {
				resO = val.coerceToObject(this);
			} else {
				return null;
			}
			object = resO;
		}
		return object;
	}
	Avm1Activation.prototype.resolveTargetDisplayObject = function(start, target, allow_empty) {
		if (target.a == Avm1Value.Object) {
			var o = target.b.asDisplayObject();
			return o;
		}
		var path = target.coerceToString(this);
		if (!allow_empty && !path) {
			return null;
		}
		var root = start.getAvm1Root();
		var _start = start.getObject().coerceToObject(this);
		var d = this.resolveTargetPath(root, _start, path, false, true);
		if (d) {
			return d.asDisplayObject();
		} else {
			return null;
		}
	}
	Avm1Activation.prototype.get_root_parent_container = function() {
		return this.base_clip.getAvm1Stage();
	}
	Avm1Activation.prototype.get_level = function(level_id) {
		var r = this.get_root_parent_container();
		return r ? r.childByDepth(level_id) : null;
	}
	Avm1Activation.prototype.get_or_create_level = function(level_id) {
		var level = this.get_level(level_id);
		if (level) {
			return level;
		} else {
			var mc = MovieClip.createNew(this.base_clip.getMovie());
			mc.setDepth(level_id);
			mc.setDefaultInstanceName(this.context);
			var r = this.get_root_parent_container();
			if (r) {
				r.replaceAtDepth(this.context, mc, level_id);
			}
			return r;
		}
	}
	Avm1Activation.prototype.setTargetClip = function(value) {
		this.target_clip = value ? (!value.AVM1_REMOVED ? value : null) : null;
	}
	Avm1Activation.prototype.setTarget = function(target) {
		var base_clip = this.base_clip;
		var new_target_clip;
		var root = base_clip.getAvm1Root();
		var start = base_clip.getObject().coerceToObject(this);
		if (!target) {
			new_target_clip = base_clip;
		} else {
			var clip = this.resolveTargetPath(root, start, target, false, true);
			if (clip) {
				clip = clip.asDisplayObject();
				if (clip && !this.base_clip.AVM1_REMOVED) {
				} else {
					clip = null;
				}
			}
			if (clip) {
				new_target_clip = clip;
			} else {
				var path = base_clip.AVM1_REMOVED ? "?" : base_clip.path();
				//console.log("SetTarget failed: " + target + " not found");
				var message = "Target not found: Target=" + target + " Base=" + path;
				this.context.avm_trace(message);
				new_target_clip = null;
			}
		}
		this.setTargetClip(new_target_clip);
		var clip_obj = this.target_clip_or_root().getObject().coerceToObject(this);
		this.scope = Avm1Scope.newTargetScope(this.scope, clip_obj);
		return Avm1FrameControl.objContinue;
	}
	Avm1Activation.prototype.in_local_scope = function() {
		var current_scope = this.scope;
		while (current_scope) {
			switch(current_scope.class.type) {
				case Avm1ScopeClass.Local:
					return true;
				case Avm1ScopeClass.Target:
					return false;
			}
			current_scope = current_scope.parent;
		}
		return false;
	}
	Avm1Activation.prototype.defineLocal = function(name, value) {
		if (!this.in_local_scope() && (name.indexOf(".") >= 0 || name.indexOf(":") >= 0)) {
			this.setVariable(name, value);
		} else {
			this.scope.defineLocal(name, value, this);
		}
	}
	Avm1Activation.prototype.forceDefineLocal = function(name, value) {
		this.scope.forceDefineLocal(name, value, this);
	}
	Avm1Activation.prototype.is_case_sensitive = function() {
		return this.swfVersion > 6;
	}
	Avm1Activation.prototype.target_clip_or_root = function() {
		return this.target_clip || this.base_clip.getAvm1Root();
	}
	Avm1Activation.prototype.target_clip_or_base_clip = function() {
		return this.target_clip || this.base_clip;
	}
	Avm1Activation.prototype.rootObject = function() {
		return this.base_clip.getAvm1Root().getObject();
	}
	Avm1Activation.prototype.continue_if_base_clip_exists = function() {
		if (!this.base_clip_unloaded && this.base_clip.AVM1_REMOVED) {
			return new Avm1FrameControl(Avm1FrameControl.return, new Avm1ReturnType(Avm1ReturnType.implicit));
		} else {
			return Avm1FrameControl.objContinue;
		}
	}
	Avm1Activation.prototype.resolve = function(name) {
		if (name == "this") {
			return new Avm1CallableValue(Avm1CallableValue.UnCallable, this.thisObject);
		}
		return this.scope.resolve(name, this);
	}
	Avm1Activation.prototype.getVariable = function(path) { 
		var start = this.target_clip_or_root();
		var path_has_slash = path.indexOf('/') >= 0;
		var separator = string_rfind(path, [":", "."]);
		if (separator != null) {
			var _path = path.slice(0, separator);
			var var_name = path.slice(separator + 1);
			var current_scope = this.scope;
			while(current_scope) {
				var avm1_root = start.getAvm1Root();
				var object = this.resolveTargetPath(avm1_root, current_scope.values, _path, true, path_has_slash);
				if (object) {
					if (object.has_property(this, var_name)) {
						return new Avm1CallableValue(Avm1CallableValue.Callable, object, object.get(var_name, this));
					}
				}
				current_scope = current_scope.parent;
			}
			return new Avm1CallableValue(Avm1CallableValue.UnCallable, Avm1Value.INSTANCE.Undefined);
		}
		if (path_has_slash) {
			var current_scope = this.scope;
			while(current_scope) {
				var avm1_root = start.getAvm1Root();
				var object = this.resolveTargetPath(avm1_root, current_scope.values, _path, false, true);
				if (object) {
					return new Avm1CallableValue(Avm1CallableValue.UnCallable, Avm1Value.fromObject(object));
				}
				current_scope = current_scope.parent;
			}
		}
		return this.resolve(path);
	}
	Avm1Activation.prototype.setVariable = function(path, value) {
		var start = this.target_clip_or_root();
		if (!path) return;
		if (path == "this") {
			this.thisObject = value;
			return;
		}
		var separator = string_rfind(path, [":", "."]);
		if (separator != null) {
			var _path = path.slice(0, separator);
			var var_name = path.slice(separator + 1);
			var current_scope = this.scope;
			while(current_scope) {
				var avm1_root = start.getAvm1Root();
				var object = this.resolveTargetPath(avm1_root, current_scope.values, _path, true, true);
				if (object) {
					object.set(var_name, value, this);
				}
				current_scope = current_scope.parent;
			}
			return new Avm1CallableValue(Avm1CallableValue.UnCallable, Avm1Value.INSTANCE.Undefined);
		}
		this.scope.set(path, value, this);
	}
	Avm1Activation.prototype.resolveVariablePath = function(start, path) {
		var path_has_slash = path.indexOf("/") >= 0;
		var separator = string_rfind(path, [":", "."]);
		if (separator != null) {
			var _path = path.slice(0, separator);
			var var_name = path.slice(separator + 1);
			var current_scope = this.scope;
			while(current_scope) {
				var avm1_root = start.getAvm1Root();
				var object = this.resolveTargetPath(avm1_root, current_scope.values, _path, true, path_has_slash);
				if (object) {
					return [object, var_name];
				}
				current_scope = current_scope.parent;
			}
			return null;
		}
		var obj = start.getObject();
		if (obj.a == Avm1Value.Object) {
			return [obj.b, path];
		} else {
			return null;
		}
	}
	Avm1Activation.prototype.stackPush = function(value) {
		var _value;
		if (value.a == Avm1Value.Object) {
			var mc = Avm1MovieClipReference.tryFromStagePbject(this, value.b);
			_value = mc ? Avm1Value.fromMovieClip(mc) : value;
		} else {
			_value = value;
		}
		this.push(_value);
	}
	Avm1Activation.prototype.runActions = function(code) {
		var read = new Avm1Reader(code);
		while (true) {
			var result = this.doAction(code, read);
			if (result) {
				if (result.type === Avm1FrameControl.return) {
					return result.value;
				}
			} else {
				return new Avm1ReturnType(Avm1ReturnType.implicit);
			}
		}
	}
	Avm1Activation.prototype.doAction = function(data, reader) {
		if (!(reader.bytesAvailable > 0)) {
			return new Avm1FrameControl(Avm1FrameControl.return, new Avm1ReturnType(Avm1ReturnType.implicit));
		}
		var aScript = reader.readAction();
		var actionCode = aScript.opcode;
		if (actionCode == undefined) {
			return new Avm1FrameControl(Avm1FrameControl.return, new Avm1ReturnType(Avm1ReturnType.implicit));
		}
		var actionFunc = avm1Callback[actionCode];
		if (actionFunc) {
			var result = actionFunc.call(this, aScript, reader, data);
			if (result) {
				return result;
			} else {
				console.log("Avm1:" + actionCode);
				return null;
			}
		} else {
			log.error("Unknown AVM1 opcode: " + actionCode);
			return Avm1FrameControl.objContinue;
		}
	}
	Avm1Activation.prototype.getEncoding = function() {
		return SwfEncoding.encodingForVersion(this.swfVersion);
	}
	var avm1Callback = [];
	avm1Callback[0x00] = function() { // ActionEnd
		return new Avm1FrameControl(Avm1FrameControl.return, new Avm1ReturnType(Avm1ReturnType.implicit));
	}
	avm1Callback[0x81] = function(aScript) { // ActionGotoFrame
		var clip = this.target_clip;
		if (clip) {
			if (clip instanceof MovieClip) {
				clip.gotoFrame(this.context, aScript.frame + 1, true);
			}
		}
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x83] = function(aScript) { // ActionGetURL
		var encoding = this.getEncoding();
		var target = encoding.decode(aScript.target);
		var url = encoding.decode(aScript.url);
		console.log(target);
		console.log(url);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x04] = function(aScript) { // ActionNextFrame
		var clip = this.target_clip;
		if (clip) {
			if (clip instanceof MovieClip) {
				clip.nextFrame(this.context);
			}
		}
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x05] = function(aScript) { // ActionPreviousFrame
		var clip = this.target_clip;
		if (clip) {
			if (clip instanceof MovieClip) {
				clip.prevFrame(this.context);
			}
		}
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x06] = function() { // ActionPlay
		var clip = this.target_clip;
		if (clip) {
			if (clip instanceof MovieClip) {
				clip.play(this.context);
			}
		}
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x07] = function() { // ActionStop
		var clip = this.target_clip;
		if (clip) {
			if (clip instanceof MovieClip) {
				clip.stop(this.context);
			}
		}
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x08] = function(aScript) { // ActionToggleQuality
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x09] = function(aScript) { // ActionStopSounds
		this.context.stopAllSounds();
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x8A] = function(aScript, r) { // ActionWaitForFrame
		var frame_num = aScript.frame;
		var loaded;
		if (frame_num > 16000) {
			loaded = false;
		} else {
			loaded = true;
			var clip = this.target_clip;
			if (clip) {
				if (clip instanceof MovieClip) {
					loaded = clip.getFramesloaded() >= Math.min(frame_num, clip.getTotalFrames());
				}
			}
		}
		if (!loaded) {
			avm1_skip_actions(r, aScript.numActionsToSkip);
		}
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x8B] = function(aScript) { // ActionSetTarget
		var target = this.getEncoding().decode(aScript.target);
		return this.setTarget(target);
	}
	
	// SWFv4
	avm1Callback[0x96] = function(aScript) { // ActionPush
		var values = aScript.values;
		for (var i = 0; i < values.length; i++) {
			var val = values[i];
			var type = val.type;
			var value = val.value;
			switch(type) {
				case 0:
					this.push(Avm1Value.fromString(this.getEncoding().decode(value)));
					break;
				case 2:
					this.push(Avm1Value.INSTANCE.Null);
					break;
				case 3:
					this.push(Avm1Value.INSTANCE.Undefined);
					break;
				case 4:
					this.stackPush(this.getCurrentRegister(value));
					break;
				case 1:
				case 6:
				case 7:
					this.push(Avm1Value.fromNumber(value));
					break;
				case 5:
					this.push(Avm1Value.fromBoolean(value));
					break;
				case 8:
				case 9:
					if (value in this.constantPool) {
						this.push(Avm1Value.fromString(this.constantPool[value]));
					} else {
						log.warn("ActionPush: Constant pool index " + value + " out of range (len = " + this.constantPool.length + ")");
						this.push(Avm1Value.INSTANCE.Undefined);
					}
					break;
				default:
					console.log("value:" + type);
					this.push(Avm1Value.INSTANCE.Undefined);
			}
		}
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x17] = function(aScript) { // ActionPop
		this.pop();
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x0A] = function(aScript) { // ActionAdd
		var a = this.pop().coerceToNumber(this);
		var b = this.pop().coerceToNumber(this);
		var result = b + a;
		this.push(Avm1Value.fromNumber(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x0B] = function(aScript) { // ActionSubtract
		var a = this.pop().coerceToNumber(this);
		var b = this.pop().coerceToNumber(this);
		var result = b - a;
		this.push(Avm1Value.fromNumber(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x0C] = function(aScript) { // ActionMultiply
		var a = this.pop().coerceToNumber(this);
		var b = this.pop().coerceToNumber(this);
		var result = b * a;
		this.push(Avm1Value.fromNumber(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x0D] = function(aScript) { // ActionDivide
		var a = this.pop().coerceToNumber(this);
		var b = this.pop().coerceToNumber(this);
		var result = ((a == 0) && (this.swfVersion < 5)) ? Avm1Value.fromString("#ERROR#") : Avm1Value.fromNumber(b / a);
		this.push(result);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x0E] = function(aScript) { // ActionEquals
		var a = this.pop().coerceToNumber(this);
		var b = this.pop().coerceToNumber(this);
		var result = b == a;
		this.push(Avm1Value.fromBoolean(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x0F] = function(aScript) { // ActionLess
		var a = this.pop();
		var b = this.pop();
		var result = b.coerceToNumber(this) < a.coerceToNumber(this);
		this.push(Avm1Value.fromBoolean(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x10] = function(aScript) { // ActionAnd
		var a = this.pop();
		var b = this.pop();
		var result = b.asBool(this.swfVersion) && a.asBool(this.swfVersion);
		this.push(Avm1Value.fromBoolean(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x11] = function(aScript) { // ActionOr
		var a = this.pop();
		var b = this.pop();
		var result = b.asBool(this.swfVersion) || a.asBool(this.swfVersion);
		this.push(Avm1Value.fromBoolean(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x12] = function(aScript) { // ActionNot
		var a = this.pop();
		var result = !a.asBool(this.swfVersion);
		this.push(Avm1Value.fromBoolean(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x13] = function(aScript) { // ActionStringEquals
		var a = this.pop().coerceToString(this);
		var b = this.pop().coerceToString(this);
		var result = b == a;
		this.push(Avm1Value.fromBoolean(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x14] = function(aScript) { // ActionStringLength
		// AS1 strlen
		// In SWF6+, this is the same as String.length (returns number of UTF-16 code units).
		// TODO: In SWF5, this returns the byte length, even though the encoding is locale dependent.
		var val = this.pop().coerceToString(this);
		this.push(Avm1Value.fromNumber(val.length));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x21] = function(aScript) { // ActionStringAdd
		// SWFv4 string concatenation
		// TODO(Herschel): Result with non-string operands?
		var a = this.pop().coerceToString(this);
		var b = this.pop().coerceToString(this);
		var s = b + a;
		this.push(Avm1Value.fromString(s));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x15] = function(aScript) { // ActionStringExtract
		var count = this.pop().coerceToI32(this);
		var index = this.pop().coerceToI32(this);
		var string = this.pop().coerceToString(this);
		var result = (count < 0) ? string.substr(index) : string.substr(index, count);
		this.push(Avm1Value.fromString(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x29] = function(aScript) { // ActionStringLess
		var a = this.pop().coerceToString(this);
		var b = this.pop().coerceToString(this);
		var result = b < a;
		this.push(Avm1Value.fromBoolean(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x31] = function(aScript) { // ActionMBStringLength
		var val = this.pop();
		var len = val.coerceToString(this).length;
		this.push(Avm1Value.fromNumber(len));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x35] = function(aScript) { // ActionMBStringExtract
		console.log("ActionMBStringExtract");
	}
	avm1Callback[0x18] = function(aScript) { // ActionToInteger
		var val = this.pop();
		var result = val.coerceToI32(this);
		this.push(Avm1Value.fromNumber(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x32] = function(aScript) { // ActionCharToAscii
		console.log("ActionCharToAscii");
	}
	avm1Callback[0x33] = function(aScript) { // ActionAsciiToChar
		console.log("ActionAsciiToChar");
	}
	avm1Callback[0x36] = function(aScript) { // ActionCharToAscii
		console.log("ActionCharToAscii");
	}
	avm1Callback[0x37] = function(aScript) { // ActionAsciiToChar
		console.log("ActionAsciiToChar");
	}
	avm1Callback[0x99] = function(aScript, reader) { // ActionJump
		reader.seek(aScript.offset);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x9D] = function(aScript, reader) { // ActionIf
		var val = this.pop();
		if (val.asBool(this.swfVersion)) {
			reader.seek(aScript.offset);
		}
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x9E] = function(aScript) { // ActionCall
		var arg = this.pop();
		var target = this.target_clip_or_root();
		var call_frame = null;
		if (arg.a == Avm1Value.Number) {
			if (target instanceof MovieClip) {
				call_frame = [target, arg.b >>> 0];
			}
		} else {
			var frame_path = arg.coerceToString(this);
			var s = this.resolveVariablePath(target, frame_path);
			if (s) {
				var clip = s[0].asDisplayObject();
				if (clip) {
					if (clip instanceof MovieClip) {
						var frame = s[1];
						if (frame) {
							call_frame = [clip, arg.b >>> 0];
							frame >>> 0;
						} else {
							var f = clip.frameLabelToNumber(frame, this.context);
							if (f != null) {
								call_frame = [clip, f];
							}
						}
					}
				}
			}
		}
		if (call_frame) {
			var actions = call_frame[0].actionsOnFrame(this.context, call_frame[1]);
			for (var i = 0; i < actions.length; i++) {
				var action = actions[i];
				this.runChildFrameForAction("[Frame Call]", call_frame[0], action);
			}
		} else {
			console.log("Call: Invalid call");
		}
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x1C] = function(aScript) { // ActionGetVariable
		var var_path_val = this.pop();
		var path = var_path_val.coerceToString(this);
		var value = this.getVariable(path).getValue();
		this.stackPush(value);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x1D] = function(aScript) { // ActionSetVariable
		// Flash 4-style variable
		var value = this.pop();
		var var_path_val = this.pop();
		var var_path = var_path_val.coerceToString(this);
		this.setVariable(var_path, value);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x9A] = function(aScript) { // ActionGetURL2
		var target_val = this.pop();
		var target = target_val.coerceToString(this);
		var url_val = this.pop();
		var url = url_val.coerceToString(this);
		console.log("ActionGetURL2");
		console.log(url);
		console.log(target);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x9F] = function(aScript) { // ActionGoToFrame2
		var clip = this.target_clip_or_root();
		if (clip) {
			if (clip instanceof MovieClip) {
				var frame = this.pop();
				avm1_globals.movieclip.goto_frame(clip, this, [frame], !aScript.setPlaying, aScript.sceneOffset);
			}
		}
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x20] = function(aScript) { // ActionSetTarget2
		var target = this.pop();
		var base_clip = this.base_clip;
		if (base_clip.AVM1_REMOVED) {
			this.setTargetClip(null);
			return Avm1FrameControl.objContinue;
		}
		switch(target.a) {
			case Avm1Value.String:
				return this.setTarget(target.b);
			case Avm1Value.Undefined:
				this.setTargetClip((this.swfVersion > 6) ? null : base_clip);
				break;
			case Avm1Value.Object:
				var clip = target.b.asDisplayObject();
				if (clip) {
					this.setTargetClip(clip);
				} else {
					var t = target.coerceToString(this);
					return this.setTarget(t);
				}
				break;
			case Avm1Value.MovieClip:
				var clip = target.coerceToObject(this).asDisplayObject();
				if (clip) {
					this.setTargetClip(clip);
				} else {
					var t = target.coerceToString(this);
					return this.setTarget(t);
				}
				break;
			default:
				var t = target.coerceToString(this);
				return this.setTarget(t);
		}
		var clip_obj = this.target_clip_or_base_clip().getObject().coerceToObject(this);
		this.scope = Avm1Scope.newTargetScope(this.scope, clip_obj);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x22] = function(aScript) { // ActionGetProperty
		var prop_index = this.pop().coerceToNumber(this);
		var path = this.pop();
		var clip;
		if (this.target_clip) {
			clip = this.resolveTargetDisplayObject(this.target_clip, path, true);
		} else {
			clip = this.resolveTargetDisplayObject(this.base_clip, path, false);
		}
		var property;
		if (!Number.isFinite(prop_index) && (prop_index <= -1.0)) {

		} else {
			property = this.context.avm1.displayProperties.getByIndex(prop_index >>> 0);
		}
		var result;
		if (clip) {
			if (property) {
				result = property.get(this, clip);
			} else {
				result = Avm1Value.INSTANCE.Undefined;
			}
		} else {
			result = Avm1Value.INSTANCE.Undefined;
		}
		this.stackPush(result);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x23] = function(aScript) { // ActionSetProperty
		var prop_value = this.pop();
		var prop_index = this.pop().coerceToNumber(this);
		var path = this.pop();
		var clip;
		if (this.target_clip) {
			clip = this.resolveTargetDisplayObject(this.target_clip, path, true);
		} else {
			clip = this.resolveTargetDisplayObject(this.base_clip, path, false);
		}
		var property;
		if (!Number.isFinite(prop_index) && (prop_index <= -1.0)) {
			property = null;
		} else {
			property = this.context.avm1.displayProperties.getByIndex(prop_index >>> 0);
		}
		if (property) {
			if (!clip && property.isReadOnly()) {
				avm1_stage_object.action_property_coerce(this, prop_index, prop_value);
			}
		}
		if (clip) {
			if (property) {
				property.set(this, clip, prop_value);
			} else {
				console.log("SetProperty: Invalid property " + prop_index);
			}
		} else {
			console.log("SetProperty: Invalid target: " + path);
		}
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x24] = function(aScript) { // ActionCloneSprite
		var depth = this.pop().coerceToI32(this);
		var target = this.pop().coerceToString(this);
		var source = this.pop();
		var start_clip = this.target_clip_or_root();
		var source_clip = this.resolveTargetDisplayObject(start_clip, source, true);
		var movie_clip;
		if (source_clip) {
			if (source_clip instanceof MovieClip) {
				movie_clip = source_clip;
			}
		}
		if (movie_clip) {
			avm1_globals.movieclip.clone_sprite(movie_clip, this.context, target, depth, null);
		} else {
			console.log("CloneSprite: Source is not a movie clip");
		}
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x25] = function(aScript) { // ActionRemoveSprite
		var target = this.pop();
		var start_clip = this.target_clip_or_root();
		var target_clip = this.resolveTargetDisplayObject(start_clip, target, true);
		if (target_clip) {
			avm1_remove_display_object(target_clip, this);
		} else {
			console.log("RemoveSprite: Source is not a display object");
		}
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x27] = function(aScript) { // ActionStartDrag
		var target = this.pop();
		var start_clip = this.target_clip_or_root();
		var display_object = this.resolveTargetDisplayObject(start_clip, target, true);
		var lock_center = this.pop().coerceToI32(this) == 1;
		var constrain = this.pop().coerceToI32(this) == 1;
		var constraint_args;
		if (constrain) {
			var y_max = this.pop().coerceToNumber(this);
			var x_max = this.pop().coerceToNumber(this);
			var y_min = this.pop().coerceToNumber(this);
			var x_min = this.pop().coerceToNumber(this);
			constraint_args = [x_min, y_min, x_max, y_max];
		} else {
			constraint_args = null;
		}
		if (display_object) {
			avm1_globals.movieclip.start_drag_impl(display_object, this, lock_center, constraint_args);
		} else {
			console.log("StartDrag: Invalid target");
		}
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x28] = function(aScript) { // ActionEndDrag
		Player.updateDrag(this.context);
		this.context.setDragObject(null);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x8D] = function(aScript) { // ActionWaitForFrame2
		console.log("ActionWaitForFrame2");
	}
	avm1Callback[0x26] = function(aScript) { // ActionTrace
		var val = this.pop();
		var out = (val.a == Avm1Value.Undefined) ? "undefined" : val.coerceToString(this);
		this.context.avm_trace(out);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x34] = function(aScript) { // ActionGetTime
		var result = (Date.now() - this.context.startTime) | 0;
		this.push(Avm1Value.fromNumber(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x30] = function(aScript) { // ActionRandomNumber
		var max = this.pop().coerceToNumber(this) | 0;
		var result = (max > 0) ? ((Math.random() * max) | 0) : 0;
		this.push(Avm1Value.fromNumber(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x8C] = function(aScript) { // GotoLabel
		var label = this.getEncoding().decode(aScript.label);
		var clip = this.target_clip;
		if (clip) {
			if (clip instanceof MovieClip) {
				var frame = clip.frameLabelToNumber(label, this.context);
				if (frame != null) {
					clip.gotoFrame(this.context, frame, true);
				}
			}
		}
		return Avm1FrameControl.objContinue;
	}
	
	// SWFv5
	avm1Callback[0x3d] = function(aScript) { // ActionCallFunction
		var fn_name_value = this.pop();
		var fn_name = fn_name_value.coerceToString(this);
		var num_args = this.pop().coerceToU32(this);
		num_args = Math.min(num_args, this.stackLen());
		var args = [];
		for (var i = 0; i < num_args; i++) {
			var arg = this.pop();
			if (arg.a == Avm1Value.MovieClip) {
				args.push(Avm1Value.fromObject(arg.coerceToObject(this)));
			} else {
				args.push(arg);
			}
		}
		var variable = this.getVariable(fn_name);
		var result = variable.call_with_default_this(this.target_clip_or_root().getObject().coerceToObject(this), fn_name, this, args);
		this.stackPush(result);
		return this.continue_if_base_clip_exists();
	}
	avm1Callback[0x52] = function(aScript) { // ActionCallMethod
		var method_name = this.pop();
		var object_val = this.pop();
		var num_args = this.pop().coerceToU32(this);
		num_args = Math.min(num_args, this.stackLen());
		var args = [];
		for (var i = 0; i < num_args; i++) {
			var arg = this.pop();
			if (arg.a == Avm1Value.MovieClip) {
				args.push(Avm1Value.fromObject(arg.coerceToObject(this)));
			} else {
				args.push(arg);
			}
		}
		if ((object_val.a == Avm1Value.Undefined) || (object_val.a == Avm1Value.Null)) {
			this.push(Avm1Value.INSTANCE.Undefined);
			return Avm1FrameControl.objContinue;
		}
		var object = object_val.coerceToObject(this);
		var _method_name = (method_name.a == Avm1Value.Undefined) ? "" : method_name.coerceToString(this);
		var result;
		if (_method_name) {
			result = object.callMethod(_method_name, args, this, Avm1ExecutionReason.INSTANCE.FunctionCall);
		} else {
			result = object.call("[Anonymous]", this, Avm1Value.INSTANCE.Undefined, args);
		}
		this.stackPush(result);
		return this.continue_if_base_clip_exists();
	}
	avm1Callback[0x88] = function(aScript) { // ActionConstantPool
		var encoding = this.getEncoding();
		var result = [];
		var strings = aScript.strings;
		for (var i = 0; i < strings.length; i++) {
			result.push(encoding.decode(strings[i]));
		}
		this.context.avm1.setConstantPool(result);
		this.setConstantPool(this.context.avm1.constantPool);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x8e] = function(aScript, _reader, parent_data) { // ActionDefineFunction
		var swf_version = this.swfVersion;
		var func_data = parent_data.toUnboundedSubslice(aScript.actions);
		var constant_pool = this.constantPool;
		var func = new Avm1Function(swf_version, func_data, aScript, this.scope, constant_pool, this.base_clip);
		var name = func.name;
		var prototype = Avm1Object.createNew(this.context.avm1.prototypes.object);
		var func_obj = Avm1FunctionObject.createFunction(func, this.context.avm1.prototypes.function, prototype);
		if (name.length) {
			this.defineLocal(name, Avm1Value.fromObject(func_obj));
		} else {
			this.push(Avm1Value.fromObject(func_obj));
		}
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x3c] = function(aScript) { // ActionDefineLocal
		var value = this.pop();
		var name_val = this.pop();
		var name = name_val.coerceToString(this);
		this.defineLocal(name, value);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x41] = function(aScript) { // ActionDefineLocal2
		var name_val = this.pop();
		var name = name_val.coerceToString(this);
		if (!this.in_local_scope() && ((name.indexOf(":") >= 0) || (name.indexOf(".") >= 0))) {
			var a = this.getVariable(name);
			if (a.type == Avm1CallableValue.UnCallable) {
				if (a.value.a == Avm1Value.Undefined) {
					this.setVariable(name, Avm1Value.INSTANCE.Undefined);
				}
			}
		} else if (!this.scope.values.has_property(this, name)) {
			this.scope.defineLocal(name, Avm1Value.INSTANCE.Undefined, this);
		}
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x3a] = function(aScript) { // ActionDelete
		var name_val = this.pop();
		var name = name_val.coerceToString(this);
		var object = this.pop();
		var success;
		if (object.a == Avm1Value.Object) {
			success = object.b.delete(this, name);
		} else if (object.a == Avm1Value.MovieClip) {
			success = object.coerceToObject(this).delete(this, name);
		} else {
			log.warn("Cannot delete property " + name + " from " + object);
			success = false;
		}
		this.push(Avm1Value.fromBoolean(success));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x3b] = function(aScript) { // ActionDelete2
		var name_val = this.pop();
		var name = name_val.coerceToString(this);
		var success = this.scope.delete(this, name);
		this.push(Avm1Value.fromBoolean(success));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x46] = function(aScript) { // ActionEnumerate
		var name_value = this.pop();
		var name = name_value.coerceToString(this);
		var object = this.getVariable(name).getValue();
		this.push(Avm1Value.INSTANCE.Undefined);
		if (object.a == Avm1Value.MovieClip) {
			var ob = object.coerceToObject(this);
			var keys = ob.getKeys(this, false);
			keys.reverse();
			for (var i = 0; i < keys.length; i++) {
				this.push(Avm1Value.fromString(keys[i]));
			}
		} else if (object.a == Avm1Value.Object) {
			var ob = object.b;
			var keys = ob.getKeys(this, false);
			keys.reverse();
			for (var i = 0; i < keys.length; i++) {
				this.push(Avm1Value.fromString(keys[i]));
			}
		} else {
			console.log("Cannot enumerate", object);
		}
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x49] = function(aScript) { // ActionEquals2
		var a = this.pop();
		var b = this.pop();
		var result = b.abstract_eq(a, this);
		this.push(Avm1Value.fromBoolean(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x4e] = function(aScript) { // ActionGetMember
		var name_val = this.pop();
		var name = name_val.coerceToString(this);
		var object_val = this.pop();
		var object = object_val.coerceToObject(this);
		var result = object.get_non_slash_path(name, this);
		this.stackPush(result);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x42] = function(aScript) { // ActionInitArray
		var num_elements = this.pop().coerceToNumber(this);
		var result;
		if (num_elements < 0.0 || num_elements > 0x7fffffff) {
			result = Avm1Value.INSTANCE.Undefined;
		} else {
			var elements = [];
			for (var _ = 0; _ < num_elements | 0; _++) {
				elements.push(this.pop());
			}
			result = Avm1Value.fromObject(Avm1ArrayBuilder.createNew(this).with(elements));
		}	
		this.push(result);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x43] = function(aScript) { // ActionInitObject
		var num_props = this.pop().coerceToNumber(this);
		var result;
		if (num_props < 0 || num_props > 2147483647) {
			result = Avm1Value.INSTANCE.Undefined;
		} else {
			var object = Avm1Object.createNew(this.context.avm1.prototypes.object);
			for (var _ = 0; _ < num_props; _++) {
				var value = this.pop();
				var name_val = this.pop();
				var name = name_val.coerceToString(this);
				object.set(name, value, this);
			}
			result = Avm1Value.fromObject(object);
		}
		this.push(result);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x53] = function(aScript) { // ActionNewMethod
		var method_name = this.pop();
		var object_val = this.pop();
		var num_args = this.pop().coerceToU32(this);
		num_args = Math.min(num_args, this.stackLen());
		var args = [];
		for (var i = 0; i < num_args; i++) {
			var arg = this.pop();
			if (arg.a == Avm1Value.MovieClip) {
				args.push(Avm1Value.fromObject(arg.coerceToObject(this)));
			} else {
				args.push(arg);
			}
		}
		if (object_val.a == Avm1Value.Undefined || object_val.a == Avm1Value.Null) {
			return Avm1FrameControl.objContinue;
		}
		var object = object_val.coerceToObject(this);
		var _method_name = (method_name.a == Avm1Value.Undefined) ? "" : method_name.coerceToString(this);
		var result;
		if (_method_name) {
			var constructor = object.get(_method_name, this);
			if (constructor.a == Avm1Value.Object) {
				result = constructor.b.construct(this, args);
			} else {
				console.log("Tried to construct with non-object constructor", constructor);
				result = Avm1Value.INSTANCE.Undefined;
			}
		} else {
			result = object.construct(this, args);
		}
		this.stackPush(result);
		return this.continue_if_base_clip_exists();
	}
	avm1Callback[0x40] = function(aScript) { // ActionNewObject
		var fn_name_val = this.pop();
		var fn_name = fn_name_val.coerceToString(this);
		var num_args = this.pop().coerceToU32(this);
		num_args = Math.min(num_args, this.stackLen());
		var args = [];
		for (var i = 0; i < num_args; i++) {
			var arg = this.pop();
			if (arg.a == Avm1Value.MovieClip) {
				args.push(Avm1Value.fromObject(arg.coerceToObject(this)));
			} else {
				args.push(arg);
			}
		}
		var name_value = this.resolve(fn_name).getValue();
		var constructor = name_value.coerceToObject(this);
		var result = constructor.construct(this, args);
		this.stackPush(result);
		return this.continue_if_base_clip_exists();
	}
	avm1Callback[0x4f] = function(aScript) { // ActionSetMember
		var value = this.pop();
		var name_val = this.pop();
		var name = name_val.coerceToString(this);
		var object = this.pop().coerceToObject(this);
		object.set(name, value, this);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x45] = function(aScript) { // ActionTargetPath
		var param = this.pop().coerceToObject(this);
		var display_object = param.asDisplayObject();
		var result = null;
		if (display_object) {
			result = Avm1Value.fromString(display_object.path());
		}  else {
			result = Avm1Value.INSTANCE.Undefined;
		}
		this.push(result);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x94] = function(aScript, _reader, parent_data) { // ActionWith
		var code = parent_data.toUnboundedSubslice(aScript.actions);
		var value = this.pop();
		switch(value.a) {
			case Avm1Value.Undefined:
			case Avm1Value.Null:
				console.log("Error: A 'with' action failed because the specified object did not exist.");
				return Avm1FrameControl.objContinue;
			default:
				var object = value.coerceToObject(this);
				var with_scope = Avm1Scope.newWithScope(this.scope, object);
				var new_activation = this.withNewScope("[With]", with_scope);
				var res = new_activation.runActions(code);
				if (res.type == Avm1ReturnType.explicit) {
					return new Avm1FrameControl(Avm1FrameControl.return, res);
				} else {
					return Avm1FrameControl.objContinue;
				}
		}
	}
	avm1Callback[0x4a] = function(aScript) { // ActionToNumber
		var val = this.pop();
		var result = val.coerceToNumber(this);
		this.push(Avm1Value.fromNumber(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x4b] = function(aScript) { // ActionToString
		var val = this.pop();
		var string = val.coerceToString(this);
		this.push(Avm1Value.fromString(string));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x44] = function(aScript) { // ActionTypeOf
		var type_of = this.pop().typeOf(this);
		this.push(Avm1Value.fromString(type_of));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x47] = function(aScript) { // ActionAdd2
		var a = this.pop().toPrimitive(this);
		var b = this.pop().toPrimitive(this);
		var a_type = a.a;
		var b_type = b.a;
		var a_value = a.b;
		var b_value = b.b;
		var result;
		if ((a_type == Avm1Value.String) && (b_type == Avm1Value.String)) {
			result = Avm1Value.fromString(b_value + a_value);
		} else if (a_type == Avm1Value.String) {
			result = Avm1Value.fromString(b.coerceToString(this) + a_value);
		} else if (b_type == Avm1Value.String) {
			result = Avm1Value.fromString(b_value + a.coerceToString(this));
		} else {
			result = Avm1Value.fromNumber(b.coerceToNumber(this) + a.coerceToNumber(this));
		}
		this.push(result);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x48] = function(aScript) { // ActionLess2
		var a = this.pop();
		var b = this.pop();
		var result = b.abstract_lt(a, this);
		this.push(result);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x3f] = function(aScript) { // ActionModulo
		// TODO: Wrong operands?
		var a = this.pop().coerceToNumber(this);
		var b = this.pop().coerceToNumber(this);
		var result = b % a;
		this.push(Avm1Value.fromNumber(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x60] = function(aScript) { // ActionBitAnd
		var a = this.pop().coerceToI32(this);
		var b = this.pop().coerceToI32(this);
		var result = a & b;
		this.push(Avm1Value.fromNumber(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x63] = function(aScript) { // ActionBitLShift
		var a = this.pop().coerceToI32(this) & 0b11111;
		var b = this.pop().coerceToI32(this);
		var result = b << a;
		this.push(Avm1Value.fromNumber(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x61] = function(aScript) { // ActionBitOr
		var a = this.pop().coerceToI32(this);
		var b = this.pop().coerceToI32(this);
		var result = a | b;
		this.push(Avm1Value.fromNumber(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x64] = function(aScript) { // ActionBitRShift
		var a = this.pop().coerceToU32(this) & 0b11111;
		var b = this.pop().coerceToI32(this);
		var result = b >> a;
		this.push(Avm1Value.fromNumber(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x65] = function(aScript) { // ActionBitURShift
		// TODO
		var a = this.pop().coerceToU32(this) & 0b11111;
		var b = this.pop().coerceToU32(this);
		var result = b >>> a;
		this.push(Avm1Value.fromNumber(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x62] = function(aScript) { // ActionBitXor
		var a = this.pop().coerceToI32(this);
		var b = this.pop().coerceToI32(this);
		var result = b ^ a;
		this.push(Avm1Value.fromNumber(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x51] = function(aScript) { // ActionDecrement
		var a = this.pop().coerceToNumber(this);
		var result = a - 1;
		this.push(Avm1Value.fromNumber(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x50] = function(aScript) { // ActionIncrement
		var a = this.pop().coerceToNumber(this);
		var result = a + 1;
		this.push(Avm1Value.fromNumber(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x4c] = function(aScript) { // ActionPushDuplicate
		var val = this.pop();
		this.push(val);
		this.push(val);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x3e] = function(aScript) { // ActionReturn
		var return_value = this.pop();
		return new Avm1FrameControl(Avm1FrameControl.return, new Avm1ReturnType(Avm1ReturnType.explicit, return_value));
	}
	avm1Callback[0x4d] = function(aScript) { // ActionStackSwap
		var a = this.pop();
		var b = this.pop();
		this.push(a);
		this.push(b);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x87] = function(aScript) { // ActionStoreRegister
		var val = this.pop();
		this.push(val);
		this.setCurrentRegister(aScript.register, val);
		return Avm1FrameControl.objContinue;
	}
	
	// SWFv6
	avm1Callback[0x54] = function(aScript) { // ActionInstanceOf
		var constr = this.pop().coerceToObject(this);
		var obj = this.pop();
		var result;
		if (obj.a == Avm1Value.Object) {
			obj = obj.b;
			var prototype = constr.get("prototype", this).coerceToObject(this);
			result = obj.isInstanceOf(this, constr, prototype);
		} else if (obj.a == Avm1Value.MovieClip) {
			obj = obj.coerceToObject(this);
			var prototype = constr.get("prototype", this).coerceToObject(this);
			result = obj.isInstanceOf(this, constr, prototype);
		} else {
			result = false;
		}
		this.push(Avm1Value.fromBoolean(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x55] = function(aScript) { // ActionEnumerate2
		var value = this.pop();
		this.push(Avm1Value.INSTANCE.Undefined);
		if (value.a == Avm1Value.MovieClip) {
			var ob = value.coerceToObject(this);
			var keys = ob.getKeys(this, false);
			keys.reverse();
			for (var i = 0; i < keys.length; i++) {
				this.push(Avm1Value.fromString(keys[i]));
			}
		} else if (value.a == Avm1Value.Object) {
			var ob = value.b;
			var keys = ob.getKeys(this, false);
			keys.reverse();
			for (var i = 0; i < keys.length; i++) {
				this.push(Avm1Value.fromString(keys[i]));
			}
		} else {
			console.log("Cannot enumerate", value);
		}
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x66] = function(aScript) { // ActionStrictEquals
		var a = this.pop();
		var b = this.pop();
		var result  = a.eq(b);
		this.push(Avm1Value.fromBoolean(result));
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x67] = function(aScript) { // ActionGreater
		var a = this.pop();
		var b = this.pop();
		var result = a.abstract_lt(b, this);
		this.push(result);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x68] = function(aScript) { // ActionStringGreater
		var a = this.pop().coerceToString(this);
		var b = this.pop().coerceToString(this);
		var result = b > a;
		this.push(Avm1Value.fromBoolean(result));
		return Avm1FrameControl.objContinue;
	}
	
	// SWFv7
	avm1Callback[0x9b] = avm1Callback[0x8e]; // ActionDefineFunction2
	avm1Callback[0x69] = function(aScript) { // ActionExtends
		var superclass = this.pop().coerceToObject(this);
		var subclass = this.pop().coerceToObject(this);
		var super_prototype = superclass.get("prototype", this).coerceToObject(this);
		var sub_prototype = Avm1Object.createNew(super_prototype);
		sub_prototype.defineValue("constructor", Avm1Value.fromObject(superclass), new Avm1Attribute().dontEnum());
		sub_prototype.defineValue("__constructor__", Avm1Value.fromObject(superclass), new Avm1Attribute().dontEnum());
		subclass.set("prototype", Avm1Value.fromObject(sub_prototype), this);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x2b] = function(aScript) { // ActionCastOp
		var obj = this.pop();
		var constr = this.pop().coerceToObject(this);
		var is_instance_of;
		if (obj.a == Avm1Value.Object) {
			var prototype = constr.get("prototype", this).coerceToObject(this);
			is_instance_of = obj.b.isInstanceOf(this, constr, prototype);
		} else if (obj.a == Avm1Value.MovieClip) {
			var _obj = obj.b.coerceToObject(this);
			var prototype = constr.get("prototype", this).coerceToObject(this);
			is_instance_of = _obj.isInstanceOf(this, constr, prototype);
		} else {
			is_instance_of = false;
		}
		var result = is_instance_of ? obj : Avm1Value.INSTANCE.Null;
		this.push(result);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x2c] = function(aScript) { // ActionImplementsOp
		var constructor = this.pop().coerceToObject(this);
		var count = this.pop();
		if (count.isPrimitive()) {
			count = count.coerceToI32(this);
		} else {
			console.log("ImplementsOp: Object not coerced into number");
			count = 0;
		}
		count = Math.min(count, this.stackLen());
		var interfaces = [];
		for (var i = 0; i < count; i++) {
			interfaces.push(this.pop().coerceToObject(this));
		}
		var prototype = constructor.get("prototype", this).coerceToObject(this);
		prototype.setInterfaces(interfaces);
		return Avm1FrameControl.objContinue;
	}
	avm1Callback[0x8f] = function(aScript, _reader, parent_data) { // ActionTry
		var result;
		try {
			result = this.runActions(parent_data.toUnboundedSubslice(aScript.tryBody));
		} catch(e) {
			if (e instanceof Avm1Error) {
				var catchBody = aScript.catchBody;
				if (catchBody) {
					var catchVar = aScript.catchVar;
					var activation = Avm1Activation.fromAction(this.context, this.id.child("[Catch]"), this.swfVersion, this.scope, this.constantPool, this.base_clip, this.thisObject, this.callee);
					activation.localRegisters = this.localRegisters;
					if (typeof catchVar == "number") {
						activation.setCurrentRegister(catchVar, e.value);
					} else {
						var name = activation.getEncoding().decode(catchVar);
						activation.setVariable(name, e.value);
					}
					result = activation.runActions(parent_data.toUnboundedSubslice(catchBody));
				}
			} else {
				console.log(e);
			}
		} finally {
			var finallyBody = aScript.finallyBody;
			if (finallyBody) {
				var v = this.runActions(parent_data.toUnboundedSubslice(finallyBody));
				if (v.type == Avm1ReturnType.explicit) {
					return new Avm1ReturnType(Avm1ReturnType.explicit, v.value);
				}
			}
		}
		if (result) {
			switch(result.type) {
				case Avm1ReturnType.implicit: return Avm1FrameControl.objContinue;
				case Avm1ReturnType.explicit: return new Avm1FrameControl(Avm1FrameControl.return, new Avm1ReturnType(Avm1ReturnType.explicit, result.value));
			}	
		} else {
			return Avm1FrameControl.objContinue;
		}
	}
	avm1Callback[0x2a] = function(aScript) { // ActionThrow
		var value = this.pop();
		throw new Avm1Error(value);
	}
	var Avm1 = function() {
		this.version = 6;
		this.clipExecList = null;
		var result_globals  = avm1_create_globals();
		this.prototypes = result_globals[0];
		this.globalScope = Avm1Scope.fromGlobalObject(result_globals[1]);
		this.displayProperties = new Avm1DisplayPropertyMap();
		this.maxRecursionDepth = 255;
		this.constantPool = [];
		this.stack = [];
		this.registers = [
			Avm1Value.INSTANCE.Undefined,
			Avm1Value.INSTANCE.Undefined,
			Avm1Value.INSTANCE.Undefined,
			Avm1Value.INSTANCE.Undefined
		];
		this.constructorRegistryCaseInsensitive = new Avm1PropertyMap();
		this.constructorRegistryCaseSensitive = new Avm1PropertyMap();
		this.use_new_invalid_bounds_value = false;
	}
	Avm1.runWithStackFrameForDisplayObject = function(activeClip, action_context, fn) {
		var clip_obj = activeClip.getObject();
		clip_obj = clip_obj.b;
		var child_scope = new Avm1Scope(action_context.avm1.globalScope, new Avm1ScopeClass(Avm1ScopeClass.Target), clip_obj);
		var constant_pool = action_context.avm1.constantPool;
		var activation = Avm1Activation.fromAction(action_context, Avm1ActivationIdentifier.root("[Display Object]"), activeClip.swfVersion(), child_scope, constant_pool, activeClip, clip_obj, null);
		fn(activation);
	}
	Avm1.prototype.get_use_new_invalid_bounds_value = function() {
		return this.use_new_invalid_bounds_value;
	}
	Avm1.prototype.activate_use_new_invalid_bounds_value = function() {
		this.use_new_invalid_bounds_value = true;
	}
	Avm1.prototype.clearStack = function() {
		this.stack = [];
	}
	Avm1.prototype.push = function(value) {
		this.stack.push(value);
	}
	Avm1.prototype.pop = function() {
		return this.stack.pop();
	}
	Avm1.prototype.stackLen = function() {
		return this.stack.length;
	}
	Avm1.prototype.getRegisteredConstructor = function(swf_version, symbol) {
		var is_case_sensitive = swf_version >= 7;
		var registry = is_case_sensitive ? this.constructorRegistryCaseSensitive : this.constructorRegistryCaseInsensitive;
		return registry.get(symbol, is_case_sensitive);
	}
	Avm1.prototype.registerConstructor = function(swf_version, symbol, constructor) {
		var is_case_sensitive = swf_version >= 7;
		var registry = is_case_sensitive ? this.constructorRegistryCaseSensitive : this.constructorRegistryCaseInsensitive;
		if (constructor) {
			registry.insert(symbol, constructor, is_case_sensitive);
		} else {
			registry.remove(symbol, is_case_sensitive);
		}
	}
	Avm1.prototype.setConstantPool = function(constantPool) {
		this.constantPool = constantPool;
	}
	Avm1.prototype.findDisplayObjectsPendingRemoval = function(obj, out) {
		var parent = obj;
		if (parent.isContainer()) {
			var children = parent.iterRenderList();
			for (var i = 0; i < children.length; i++) {
				var child = children[i];
				if (child.AVM1_PENDING_REMOVAL) {
					out.push(child);
				}
				this.findDisplayObjectsPendingRemoval(child, out);
			}
		}
	}
	Avm1.prototype.removePending = function(context) {
		var out = [];
		var rootClip = context.stage.getRootClip();
		if (rootClip) {
			this.findDisplayObjectsPendingRemoval(rootClip, out);
		}
		for (var i = 0; i < out.length; i++) {
			var child = out[i];
			var parent = child.getParent();
			if (parent && (parent.isContainer())) {
				parent.removeChildDirectly(context, child);
				parent.container.updatePendingRemovals();
			} else {
				console.log("AVM1 object pending removal doesn't have a parent, ", child, "pending removal", out);
			}
		}
	}
	Avm1.prototype.runFrame = function(context) {
		this.removePending(context);
		var prev = null;
		var next = this.clipExecList;
		context.framePhase.set(new FramePhase(FramePhase.Idle));
		while (true) {
			var clip = next;
			if (!clip) {
				break;
			}
			next = clip.nextAvm1Clip;
			if (clip.AVM1_REMOVED) {
				if (prev) {
					prev.nextAvm1Clip = next;
				} else {
					this.clipExecList = next;
				}
				clip.nextAvm1Clip = null;
			} else {
				clip.runFrameAvm1(context);
				prev = clip;
			}
		}
		context.framePhase.set(new FramePhase(FramePhase.Idle));
	}
	Avm1.prototype.addExecuteList = function(clip) {
		if (!clip.nextAvm1Clip) {
			clip.nextAvm1Clip = this.clipExecList;
			this.clipExecList = clip;
		}
	}
	Avm1.prototype.runStackFrameForAction = function(active_clip, name, action, context) {
		var parent_activation = Avm1Activation.fromNothing(context, Avm1ActivationIdentifier.root("[Actions Parent]"), active_clip);
		var clip_obj = active_clip.getObject();
		var child_scope = new Avm1Scope(parent_activation.scope, new Avm1ScopeClass(Avm1ScopeClass.Target), clip_obj.coerceToObject(this));
		var constant_pool = parent_activation.context.avm1.constantPool;
		var child_name = parent_activation.id.child(name);
		var child_activation = Avm1Activation.fromAction(context, child_name, active_clip.swfVersion(), child_scope, constant_pool, active_clip, clip_obj, null);
		try {
			child_activation.runActions(action);
		} catch(e) {
			avm1_root_error_handler(child_activation, e);
		}
	}
	Avm1.prototype.runStacFrameForMethod = function(active_clip, obj, name, args, context) {
		if (!obj) return;
		var activation = Avm1Activation.fromNothing(context, Avm1ActivationIdentifier.root(name), active_clip);
		obj.callMethod(name, args, activation, Avm1ExecutionReason.INSTANCE.Special);
	}
	Avm1.prototype.runStackFrameForInitAction = function(active_clip, code, context) {
		var parent_activation = Avm1Activation.fromNothing(context, Avm1ActivationIdentifier.root("[Init Parent]"), active_clip);
		var clip_obj = active_clip.getObject();
		var child_scope = new Avm1Scope(parent_activation.scope, new Avm1ScopeClass(Avm1ScopeClass.Target), clip_obj.coerceToObject(this));
		var constant_pool = parent_activation.context.avm1.constantPool;
		var child_name = parent_activation.id.child("[Init]");
		var child_activation = Avm1Activation.fromAction(context, child_name, active_clip.swfVersion(), child_scope, constant_pool, active_clip, clip_obj, null);
		child_activation.push(Avm1Value.INSTANCE.Undefined);
		try {
			child_activation.runActions(code);
		} catch(e) {
			avm1_root_error_handler(child_activation, e);
		}
	}
	Avm1.prototype.globalObject = function() {
		return this.globalScope.values;
	}
	
	function avm1_root_error_handler(activation, error) {
		if (error instanceof Avm1Error) {
			var message = error.value.coerceToString(activation);
			console.log(message);
		} else {
			console.log(error);
		}
	}
	function avm1_skip_actions(reader, num_actions_to_skip) {
		for (var _ = 0; _ < num_actions_to_skip; _++) {
			reader.readAction();
		}
	}
	////////// Avm2Property //////////
	var Avm2Property = function(type, data) {
		this.type = type;
		this.data = data;
	}
	Avm2Property.newMethod = function(disp_id) {
		return new Avm2Property(Avm2Property.Method, disp_id);
	}
	Avm2Property.newGetter = function(disp_id) {
		return new Avm2Property(Avm2Property.Virtual, {get:disp_id,set:null});
	}
	Avm2Property.newSetter = function(disp_id) {
		return new Avm2Property(Avm2Property.Virtual, {get:null,set:disp_id});
	}
	Avm2Property.newSlot = function(slot_id) {
		return new Avm2Property(Avm2Property.Slot, slot_id);
	}
	Avm2Property.newConstSlot = function(slot_id) {
		return new Avm2Property(Avm2Property.ConstSlot, slot_id);
	}
	Avm2Property.Virtual = 1;
	Avm2Property.Method = 2;
	Avm2Property.Slot = 3;
	Avm2Property.ConstSlot = 4;
	////////// Avm2PropertyMap //////////
	var Avm2PropertyMap = function() {
		this.properties = Object.create(null);
	}
	Avm2PropertyMap.prototype.get = function(name) {}
	Avm2PropertyMap.prototype.getForMultiname = function(name) {}
	Avm2PropertyMap.prototype.get_with_ns_for_multiname = function(name) {}
	Avm2PropertyMap.prototype.contains_key = function(name) {}
	Avm2PropertyMap.prototype.insert = function(name, value) {}
	Avm2PropertyMap.prototype.insert_with_namespace = function(ns, name, value) {}
	Avm2PropertyMap.prototype.remove = function(name) {}
	////////// Value //////////
	var Avm2ValueHint = function(type) {
		this.type = type;
	}
	Avm2ValueHint.String = 1;
	Avm2ValueHint.Number = 2;
	var Avm2Value = function() {
		this.a = arguments[0];
		if (arguments.length > 1) {
			this.b = arguments[1];
		}
	}
	Avm2Value.fromString = function(value) {
		return new Avm2Value(Avm2Value.String, value);
	}
	Avm2Value.fromNumber = function(value) {
		return new Avm2Value(Avm2Value.Number, value);
	}
	Avm2Value.fromBoolean = function(value) {
		return new Avm2Value(Avm2Value.Bool, value);
	}
	Avm2Value.Undefined = 1;
	Avm2Value.Null = 2;
	Avm2Value.Bool = 3;
	Avm2Value.Number = 4;
	Avm2Value.Integer = 5;
	Avm2Value.String = 6;
	Avm2Value.Object = 7;
	Avm2Value.INSTANCE = {
		Undefined: new Avm2Value(Avm2Value.Undefined),
		Null: new Avm2Value(Avm2Value.Null)
	}
	function valid_orphan(_dobj) {
		var dobj = _dobj.upgrade();
		if (dobj) {
			if (!dobj.getParent()) {
				return dobj;
			}	
		}
		return null;
	}
	////////// Script //////////
	var Avm2TranslationUnit = function(movie, abc, name) {
		this.domain = null;
		this.name = name;
		this.abc = abc;
		this.classes = [];
		this.methods = [];
		this.scripts = [];
		this.strings = [];
		this.namespaces = [];
		this.multinames = [];
		this.movie = movie;
	}
	Avm2TranslationUnit.fromABC = function(abc, domain, name, movie) {
		var r = new Avm2TranslationUnit(movie, abc, name);
		
		return r;
	}
	Avm2TranslationUnit.prototype.loadClasses = function(activation) {
		
	}
	Avm2TranslationUnit.prototype.setClass = function(index, _class) {
		this.classes[index] = _class;
	}
	Avm2TranslationUnit.prototype.loadMethod = function(method_index, is_function, activation) {
		
	}
	Avm2TranslationUnit.prototype.loadClass = function(class_index, activation) {
		
	}
	Avm2TranslationUnit.prototype.loadScript = function(script_index, activation) {
		
	}
	var Avm2Script = function() {
		this._globals = null;
		this._domain = null;
		this._init = null;
		this.initialized = false;
		this.translationUnit = null;
	}
	Avm2Script.create_globals_object = function(unit, script, domain, activation) {
		
	}
	Avm2Script.prototype.init = function() {
		return [this._init, this._globals, this._domain];
	}
	Avm2Script.prototype.globals = function() {
		if (!this.initialized) {
			this.initialized = true;
			Avm2.runScriptInitializer(this, context);
		}
		return this._globals;
	}
	////////// Scope //////////
	var Avm2Scope = function(values, _with) {
		this.values = 0;
		this.with = _with;
	}
	Avm2Scope.createNew = function(values) {
		return new Avm2Scope(values, false);
	}
	Avm2Scope.newWith = function(values) {
		return new Avm2Scope(values, true);
	}
	var Avm2ScopeContainer = function(scopes, cache) {
		this.scopes = scopes;
		this.cache = cache;
	}
	Avm2ScopeContainer.createNew = function(scopes) {
		var r = new Avm2ScopeContainer(scopes, false);

		return r;
	}
	Avm2ScopeContainer.prototype.get = function(index) {
		return this.scopes[index];
	}
	Avm2ScopeContainer.prototype.get_unchecked = function(index) {
		return this.scopes[index];
	}
	Avm2ScopeContainer.prototype.is_empty = function() {
		return !this.scopes.length;
	}
	var Avm2ScopeChain = function(container, domain) {
		this.container = container;
		this.domain = domain;
	}
	Avm2ScopeChain.createNew = function(domain) {
		return new ScopeChain(null, domain);
	}
	////////// Domain //////////
	var Avm2Domain = function() {
		this.defs = new Avm2PropertyMap();
		this.classes = new Avm2PropertyMap();
		this.parent = null;
		this.domainMemory = null;
		this.defaultDomainMemory = null;
		this.children = [];
	}
	Avm2Domain.uninitializedDomain = function(parent) {
		var domain = new Avm2Domain();
		domain.parent = parent;
		return domain;
	}
	////////// Activation //////////
	var Avm2Activation = function(context) {
		this.numLocals = 0;
		this.callerDomain = null;
		this.callerMovie = null;
		this.boundSuperclassObject = null;
		this.boundClass = null;
		this.stackDepth = null;
		this.scopeDepth = null;
		this.context = context;
	}
	Avm2Activation.fromNothing = function(context) {
		var n = new Avm2Activation(context);
		return n;
	}
	Avm2Activation.fromScript = function(context, script) {
		//var [method, global_object, domain] = script.init();
		//var body = method.body;

	}
	Avm2Activation.prototype.runActions = function(method) {
		
	}

	////////// Avm2 //////////
	var Avm2 = function() {
		var playerglobals_domain = Avm2Domain.uninitializedDomain(null);
		var stage_domain = Avm2Domain.uninitializedDomain(playerglobals_domain);
		this.playerVersion = null;
		this.systemClasses = null;
		this.stack = [];
		this.scopeStack = [];
		this.playerglobals_domain = playerglobals_domain;
		this.stage_domain = stage_domain;
		this.orphanObjects = [];
	}
	Avm2.each_orphan_obj = function(context, callback) {
		var orphan_objs = context.avm2.orphanObjects;
		for (var i = 0; i < orphan_objs.length; i++) {
			var orphan = orphan_objs[i];
			var dobj = valid_orphan(orphan);
			if (dobj) {
				callback(dobj, context);
			}
		}
	}
	Avm2.cleanup_dead_orphans = function(context) {
		var r = context.avm2.orphanObjects;
		var a = [];
		for (var i = 0; i < r.length; i++) {
			var element = r[i];
			var dobj = valid_orphan(element);
			if (dobj) {
				if (dobj.PLACED_BY_SCRIPT) {
					a.push(element);
				}
			}
		}
		r.length = 0;
		for (var i = 0; i < a.length; i++) {
			r.push(a[i]);
		}
	}
	Avm2.prototype.add_orphan_obj = function(dobj) {
		this.orphanObjects.push(dobj.downgrade());
	}
	Avm2.prototype.push_internal = function(value) {
		this.stack.push(value);
	}
	Avm2.prototype.push = function(value) {
		this.push_internal(value);
	}
	Avm2.prototype.pop = function() {
		var value = this.stack.pop();
		return value;
	}
	Avm2.prototype.r = function() {
		
	}
	Avm2.runScriptInitializer = function(script, context) {
		//var init_activation = Avm2Activation.fromScript(context, script);
		//var [method, _globals, _domain] = script.init();
		
	}
	var FramePhase = function(type) {
		this.type = type;
	}
	FramePhase.prototype.set = function(other) {
		this.type = other.type;
	}
	FramePhase.Enter = 1;
	FramePhase.Construct = 1;
	FramePhase.FrameScripts = 1;
	FramePhase.Exit = 1;
	FramePhase.Idle = 1;
	function run_all_phases_avm2(context) {
		var stage = context.stage;
		if (stage.movie.isActionScript3()) return;
		context.framePhase.type = FramePhase.Enter;
		Avm2.each_orphan_obj(context, function(orphan, context) {
			orphan.enterFrame(context);
		});
		stage.enterFrame(context);
		context.framePhase.type = FramePhase.Construct;
		Avm2.each_orphan_obj(context, function(orphan, context) {
			orphan.constructFrame(context);
		});
		stage.constructFrame(context);
		stage.frameConstructed(context);
		context.framePhase.type = FramePhase.FrameScripts;
		Avm2.each_orphan_obj(context, function(orphan, context) {
			orphan.runFrameScripts(context);
		});
		stage.runFrameScripts(context);
		context.framePhase.type = FramePhase.Exit;
		stage.exitFrame(context);
		Avm2.cleanup_dead_orphans(context);
		context.framePhase.type = FramePhase.Idle;
	}
	function run_inner_goto_frame(context, removed_frame_scripts, initial_clip) {
		if (initial_clip.swfVersion() <= 9 && initial_clip.getMovie().isActionScript3()) {
			initial_clip.constructFrame(context);
			initial_clip.setSkipNextEnterFrame(true);
	   		return;
		}
		var stage = context.stage;
		var old_phase = context.framePhase.type;
		context.framePhase.type = FramePhase.Construct;
		Avm2.each_orphan_obj(context, function(orphan, context) {
			orphan.constructFrame(context);
		});
		stage.constructFrame(context);
		stage.frameConstructed(context);
		context.framePhase.type = FramePhase.FrameScripts;
		stage.runFrameScripts(context);
		Avm2.each_orphan_obj(context, function(orphan, context) {
			orphan.runFrameScripts(context);
		});
		for (var i = 0; i < removed_frame_scripts.length; i++) {
			var child = removed_frame_scripts[i];
			child.runFrameScripts(context);
		}
		context.framePhase.type = FramePhase.Exit;
		stage.exitFrame(context);
		Avm2.cleanup_dead_orphans(context);
		context.framePhase.type = old_phase;
	}
	function catchup_display_object_to_frame(context, dobj) {
		if (!dobj.getMovie().isActionScript3()) {
	   		return;
		}
		switch (context.framePhase.type) {
			case FramePhase.Enter:
				dobj.enterFrame(context);
				break;
			case FramePhase.Construct:
				dobj.enterFrame(context);
				dobj.constructFrame(context);
				break;
		}
	}
	function scaleMat(mat, sx, sy) {
		mat[0] *= sx;
		mat[1] *= sy;
		mat[2] *= sx;
		mat[3] *= sy;
		mat[4] *= sx;
		mat[5] *= sy;
	}
	function translateMat(mat, dx, dy) {
		mat[4] += dx;
		mat[5] += dy;
	}
	function invertMat(mat) {
		var det = mat[0] * mat[3] - mat[2] * mat[1];
		var tx = (mat[3] * mat[4] - mat[2] * mat[5]) / -det;
		var ty = (mat[1] * mat[4] - mat[0] * mat[5]) / det;
		var a = mat[3] / det;
		var b = mat[1] / -det;
		var c = mat[2] / -det;
		var d = mat[0] / det;
		mat[0] = a;
		mat[1] = b;
		mat[2] = c;
		mat[3] = d;
		mat[4] = tx;
		mat[5] = ty;
	}
	var Timers = function() {
		this.timers = [];
		this.timer_counter = 0;
		this.cur_time = 0;
	}
	Timers.prototype.update_timers = function(context, dt) {
		var level0 = context.stage.getRootClip();
		this.cur_time += 10;
		for (var i = 0; i < this.timers.length; i++) {
			var timer = this.timers[i];
			if ((timer.tick_time - this.cur_time) < 0) {
				timer.tick_time = this.cur_time + timer.interval;
				var callback = timer.callback;
				switch(callback.type) {
					case "avm1_function":
						var avm1_activation = Avm1Activation.fromNothing(context, Avm1ActivationIdentifier.root("[Timer Callback]"), level0);
						callback.func.call("[Timer Callback]", avm1_activation, Avm1Value.INSTANCE.Undefined, callback.params);
						break;
					case "avm1_method":
						var avm1_activation = Avm1Activation.fromNothing(context, Avm1ActivationIdentifier.root("[Timer Callback]"), level0);
						callback.this.callMethod(callback.methodName, callback.params, avm1_activation, Avm1ExecutionReason.INSTANCE.Special);
						break;
				}
				if (timer.is_timeout) {
					timer.id = null;
				}
			}
		}
		this._timersRetain();
	}
	Timers.prototype._timersRetain = function() {
		var newA = [];
		for (var i = 0; i < this.timers.length; i++) {
			var t = this.timers[i];
			if (t.id != null) {
				newA.push(t);
			}
		}
		this.timers = newA;
	}
	Timers.prototype.remove = function(id) {
		for (var i = 0; i < this.timers.length; i++) {
			var t = this.timers[i];
			if (t.id == id) {
				t.id = null;
				this._timersRetain();
				return true;
			}
		}
		return false;
	}
	Timers.prototype.addTimer = function(callback, interval, is_timeout) {
		this.timer_counter++;
		var id = this.timer_counter;
		var timer = {
			id: id,
			callback: callback,
			tick_time: this.cur_time + interval,
			interval: interval,
			is_timeout: is_timeout
		}
		this.timers.push(timer);
		return id;
	}
	var ActionQueue = function() {
		this.actionQueue = [[], [], []];
	}
	ActionQueue.priority = function(action) {
		var type = action.type;
		switch(type) {
			case "initialize": return 2;
			case "construct": return 1;
			default: return 0;
		}
	}
	ActionQueue.prototype.queueAction = function(clip, action, isUnload) {
		var _action = {};
		_action.clip = clip;
		var priority = ActionQueue.priority(action);
		_action.action = action;
		_action.isUnload = isUnload;
		this.actionQueue[priority].splice(0, 0, _action);
	}
	ActionQueue.prototype.popAction = function() {
		for (var i = 2; i >= 0; i--) {
			var a = this.actionQueue[i];
			if (a.length > 0) {
				return a.pop();
			}
		}
		return null;
	}
	var AudioBackend = function() {
		AudioMixerBackend.call(this);
		this.mixer = new AudioMixer(audioContext.sampleRate);
		this.node = audioContext.createGain();
		this.node.connect(audioContext.destination);
		this.node.gain.value = 0;
		this.left = new Float32Array(11025);
		this.right = new Float32Array(11025);
		this.source = audioContext.createScriptProcessor(1024, 2, 2);
		this.source.onaudioprocess = this.writeSampleData.bind(this)
		this.source.connect(this.node);
		this._source = null;
		this.debug_ms = 0;
		this.cur_time = 0;
		this.hdhfg = 1024;
		this.kgbk = 0;
		var jhgjhg = [];
		for (var i = 0; i < 1024; i++) {
			jhgjhg[i] = new Float32Array([0, 0]);
		}
		this.jhgjhg = jhgjhg;
		this._is_playing_start = Date.now();
		this._is_playing_time = 0;
	}
	AudioBackend.prototype = Object.create(AudioMixerBackend.prototype);
	AudioBackend.prototype.constructor = AudioBackend;
	AudioBackend.prototype.getPlayingCompressSound = function() {
		var soundInstances = this.mixer.soundInstances;
		var o = {};
		for (var i = 0; i < soundInstances.length; i++) {
			var sound = soundInstances[i];
			var e = sound.stream.getDecoder();
			var n = e.debugType();
			o[n] = true
		}
		return Object.keys(o);
	}
	AudioBackend.prototype.pause = function() {
		this.node.gain.value = 0;
		this.stopSource();
	}
	AudioBackend.prototype.resume = function() {
		this.node.gain.value = 1;
		this.startSource();
	}
	AudioBackend.prototype.getPlayingAudioCount = function() {
		return this.mixer.soundInstances.length;
	}
	AudioBackend.prototype.getVolume = function() {
		return this.mixer.volume * 100;
	}
	AudioBackend.prototype.setVolume = function(value) {
		this.mixer.volume = value / 100;
	}
	AudioBackend.prototype.getTime = function() {
		if (audioContext.state != "running") this._is_playing_time = (Date.now() - this._is_playing_start);
		return (((this.cur_time / audioContext.sampleRate) * 1000) | 0) + this._is_playing_time;
	}
	AudioBackend.prototype.stopSource = function() {
		if (this._source) {
			this._source.disconnect();
			this._source = null;
		}
	}
	AudioBackend.prototype.startSource = function() {
		this.stopSource();
		this._source = audioContext.createBufferSource();
		this._source.connect(this.source);
		this._source.start();
	}
	AudioBackend.prototype.writeSampleData = function(evt) {
		var output1 = evt.outputBuffer.getChannelData(0);
		var output2 = evt.outputBuffer.getChannelData(1);
		if (this._source) {
			var i = 0;
			var s = Date.now();
			this.mixer.mix(this.jhgjhg);
			this.debug_ms = (Date.now() - s) | 0;
			this.kgbk = this.cur_time;
			for (i = 0; i < 1024; i++) {
				var l = this.jhgjhg[i][0];
				var r = this.jhgjhg[i][1];
				output1[i] = l;
				output2[i] = r;
				var s = (this.hdhfg + i) % 11025;
				this.left[s] = l;
				this.right[s] = r;
			}
			this.hdhfg += 1024;
			this.cur_time += 1024;
		}
	}
	AudioBackend.prototype.toWaveform = function(output) {
		if (!this._source) {
			output.fill(0);
			return;
		}
		var rg = (audioContext.sampleRate / 44100) * 1200;
		var time = this.kgbk;
		var max4 = output.length / 2;
		for (var i = 0; i < output.length; i += 2) {
			var _g = (((((i / 2) / max4) * rg) | 0) + time) % 11025;
			output[i] = this.left[_g] || 0;
			output[i + 1] = this.right[_g] || 0;
		}
	}
	AudioBackend.prototype.tick = function() {}
	var MouseCursor = function(type) {
		this.type = type;
	}
	MouseCursor.Arrow = 1;
	MouseCursor.Hand = 1;
	MouseCursor.IBeam = 1;
	MouseCursor.Grab = 1;
	var MouseData = function() {
		this.hovered = null;
		this.pressed = null;
		this.right_pressed = null;
		this.middle_pressed = null;
	}
	var InputEvent = function(type, data) {
		this.type = type;
		this.data = data;
	}
	InputEvent.KeyDown = 1;
	InputEvent.KeyUp = 2;
	InputEvent.MouseMove = 3;
	InputEvent.MouseUp = 4;
	InputEvent.MouseDown = 5;
	InputEvent.MouseLeave = 6;
	var InputManager = function() {
		this.keysDown = [];
		this.lastKey = 0;
	}
	InputManager.prototype.addKey = function(keyCode) {
		this.lastKey = keyCode;
		this.keysDown[keyCode] = true;
	}
	InputManager.prototype.removeKey = function(keyCode) {
		this.lastKey = keyCode;
		this.keysDown[keyCode] = false;
	}
	InputManager.prototype.isKeyDown = function(keyCode) {
		return !!this.keysDown[keyCode];
	}
	InputManager.prototype.processEvent = function(event) {
		var result;
		switch(event.type) {
			case PlayerEvent.MouseUp:
				result = new InputEvent(InputEvent.MouseUp, event.data);
				break;
			case PlayerEvent.MouseMove:
				result = new InputEvent(InputEvent.MouseMove, event.data);
				break;
			case PlayerEvent.MouseDown:
				result = new InputEvent(InputEvent.MouseDown, event.data);
				break;
			case PlayerEvent.KeyDown:
				result = new InputEvent(InputEvent.KeyDown, event.data);
				break;
			case PlayerEvent.KeyUp:
				result = new InputEvent(InputEvent.KeyUp, event.data);
				break;
		}
		if (result) {
			this.handleEvent(result);
			return result;
		}
		return null;
	}
	InputManager.prototype.handleEvent = function(event) {
		switch(event.type) {
			case InputEvent.KeyDown:
				this.addKey(event.data);
				break;
			case InputEvent.KeyUp:
				this.removeKey(event.data);
				break;
		}
	}
	InputManager.prototype.getLastKeyCode = function() {
		return this.lastKey;
	}
	var UiBackend = function() {
		this._mouseVisible = true;
	}
	UiBackend.prototype.mouseVisible = function() {
		return this._mouseVisible;
	}
	UiBackend.prototype.setMouseVisible = function(b) {
		this._mouseVisible = b;
	}
	var LogBackend = function() {}
	LogBackend.prototype.avm_trace = function(message) {
		console.log(message);
	}

	var PlayerEvent = function(type, data) {
		this.type = type;
		this.data = data;
	}
	PlayerEvent.KeyDown = 1;
	PlayerEvent.KeyUp = 2;
	PlayerEvent.MouseMove = 3;
	PlayerEvent.MouseUp = 4;
	PlayerEvent.MouseDown = 5;
	PlayerEvent.MouseLeave = 6;
	var Player = function() {
		this.onload = null;
		this.onerror = null;
		this.onprogress = null;
		this._width = 0;
		this._height = 0;
		this.useBitmapCache = false;
		this.width = 0;
		this.height = 0;
		this.version = 0;
		this.frameRate = 5;
		this.mousePosition = new Point(0, 0);
		this.mouseData = new MouseData();
		this.needsRender = false;
		this.scale = 1;
		this.playing = false;
		this.vCamId = 0;
		this.vCamShow = false;
		this.dragObject = null;
		this.renderScaleType = 0;
		this.root = document.createElement('div');
		this.root.classList.add('pinkfie-root');
		this.library = new Library();
		try {
			if (config.useWebGL) {
				this.renderer = new RenderWebGL();
			} else {
				this.renderer = new RenderCanvas2d();
			}
		} catch(e) {
			alert(e);
			this.renderer = new RenderCanvas2d();
		}
		this.canvas = this.renderer.canvas;
		this.root.appendChild(this.canvas);
		this.canvas.tabIndex = 0;
		this.canvas.style.outline = 'none';
		this.audio = new AudioBackend();
		this.audioManager = new AudioManager();
		this.avm1 = new Avm1();
		this.avm2 = new Avm2();
		this.input = new InputManager();
		this.video = new VideoBackend();
		this.ui = new UiBackend();
		this.unbound_text_fields = [];
		this.framePhase = new FramePhase(FramePhase.Idle);
		this.wth = false;
		this._unloop = false;
		this.transformStack = new TransformStack();
		this.debugTransformStack = new TransformStack();
		this.instanceCounter = 0;
		this.actionQueue = new ActionQueue();
		this.cursor = 0;
		this.frame_accumulator = 0;
		this.time_offset = 0;
		this.last_time = 0;
		this.startTime = null;
		this.timers = new Timers();
		this.log = new LogBackend();
		this.stage = new Stage(false, null);
		this.renderType = "render";
		this.time_til_next_timer = 0;
		this.addEventListeners();
		this.debugRectLineShapeRender = this.renderer.registerShape([{
			type: 1,
			width: 40,
			path2d: [[0, 0, 0], [2, 2000, 0], [2, 2000, 2000], [2, 0, 2000], [2, 0, 0]],
			fill: {
				type: 0,
				color: [255, 255, 255, 1]
			}
		}]);
		this.registerDeviceFont({
			tag: new SwfInput(pinkfieFont, 32).parseDefineFont2(3, pinkfieFont.length),
			encoding: SwfEncoding.encodingForVersion(8),
			type: "swf_tag"
		});
	}
	Player.updateDrag = function(context) {
		var mousePosition = context.mousePosition.clone();
		var dragObject = context.getDragObject();
		if (dragObject) {
			var display_object = dragObject.display_object;
			if (display_object.AVM1_REMOVED) {
				context.setDragObject(null);
				return;
			}
			var parent = display_object.getParent();
			var local_to_global_matrix = parent ? parent.localToGlobalMatrix() : Matrix.IDENTITY.clone();
			var global_to_local_matrix = local_to_global_matrix.inverse() || Matrix.IDENTITY.clone();
			var new_position;
			if (dragObject.lock_center) {
				var _new_position = global_to_local_matrix.mulPoint(mousePosition);
				new_position = dragObject.constraint.clamp(_new_position)
			} else {
				var position = new Point(display_object.getX() * 20, display_object.getY() * 20);
				var mouse_delta = mousePosition.sub(dragObject.last_mouse_position);
				var _new_position = position.add(global_to_local_matrix.mulPoint(mouse_delta));
				_new_position = dragObject.constraint.clamp(_new_position);
				mouse_delta = local_to_global_matrix.mulPoint(_new_position.sub(position));
				dragObject.last_mouse_position.x += mouse_delta.x;
				dragObject.last_mouse_position.y += mouse_delta.y;
				new_position = _new_position;
			}
			display_object.setX(new_position.x / 20);
			display_object.setY(new_position.y / 20);
			if (display_object instanceof MovieClip) {

			}
		}
	}
	Object.defineProperty(Player.prototype, "unloop", {
		get: function() {
			return this._unloop;
		},
		set: function(value) {
			this._unloop = value;
			this.clipSetLoop(!value);
		}
	});
	Player.prototype.getQuality = function() {
		return this.stage.getQuality().toString();
	}
	Player.prototype.addEventListeners = function() {
		this._onmousedown = this._onmousedown.bind(this);
		this._onmouseup = this._onmouseup.bind(this);
		this._onmousemove = this._onmousemove.bind(this);
		this._ontouchstart = this._ontouchstart.bind(this);
		this._ontouchend = this._ontouchend.bind(this);
		this._ontouchmove = this._ontouchmove.bind(this);
		document.addEventListener('mousedown', this._onmousedown);
		document.addEventListener('mouseup', this._onmouseup);
		document.addEventListener('mousemove', this._onmousemove);
		document.addEventListener('touchstart', this._ontouchstart, { passive: false });
		document.addEventListener('touchend', this._ontouchend);
		document.addEventListener('touchmove', this._ontouchmove);
		this.root.addEventListener('keyup', this._onkeyup.bind(this));
		this.root.addEventListener('keydown', this._onkeydown.bind(this));
	}
	Player.prototype.removeEventListeners = function() {
		document.removeEventListener('mousedown', this._onmousedown);
		document.removeEventListener('mouseup', this._onmouseup);
		document.removeEventListener('mousemove', this._onmousemove);
		document.removeEventListener('touchstart', this._ontouchstart);
		document.removeEventListener('touchend', this._ontouchend);
		document.removeEventListener('touchmove', this._ontouchmove);
	}
	Player.prototype.registerDeviceFont = function(definition) {
		this.library.registerDeviceFont(definition);
	}
	Player.prototype._onkeyup = function(e) {
		e.stopPropagation();
		if (e.target === this.canvas) {
			if (!this.isPlaying()) return;
			this.handleInputEvent(new PlayerEvent(PlayerEvent.KeyUp, e.keyCode));
			e.preventDefault();
		}
	}
	Player.prototype._onkeydown = function(e) {
		e.stopPropagation();
		if (e.target === this.canvas) {
			if (!this.isPlaying()) return;
			this.handleInputEvent(new PlayerEvent(PlayerEvent.KeyDown, e.keyCode));
			e.preventDefault();
		}
	}
	Player.prototype._onmousedown = function(e) {
		if (hasTouchEvents) return;
		if (e.target === this.canvas) {
			this.updateMouse(e);
			this.updateMouseDown(e);
			e.preventDefault();
			this.canvas.focus();
		}
	}
	Player.prototype._onmouseup = function(e) {
		if (hasTouchEvents) return;
		this.updateMouseUp(e);
		if (e.target === this.canvas)
			e.preventDefault();
	}
	Player.prototype._onmousemove = function(e) {
		if (hasTouchEvents) return;
		this.updateMouse(e);
	}
	Player.prototype._ontouchstart = function(e) {
		for (var i = 0; i < e.changedTouches.length; i++) {
			var t = e.changedTouches[i];
			if (e.target === this.canvas) {
				this.updateMouse(t);
				this.updateMouseDown(t);
				e.preventDefault();
			}
		}
	}
	Player.prototype._ontouchend = function(e) {
		for (var i = 0; i < e.changedTouches.length; i++) {
			var t = e.changedTouches[i];
			if (e.target === this.canvas) {
				this.updateMouseUp(t);
				e.preventDefault();
			}
		}
	}
	Player.prototype._ontouchmove = function(e) {
		for (var i = 0; i < e.changedTouches.length; i++) {
			var t = e.changedTouches[i];
			if (e.target === this.canvas) {
				this.updateMouse(t);
			}
		}
	}
	Player.prototype.getMousePoint = function(e) {
		var rect = this.canvas.getBoundingClientRect();
		var xm = e.clientX - rect.left;
		var ym = e.clientY - rect.top;
		var g = this.getScaleRender();
		var x = ((xm / g[6]) - g[2]) / g[4];
		var y = ((ym / g[7]) - g[3]) / g[5];
		var wx = Math.round(x * this.width);
		var wy = Math.round(y * this.height);
		return [wx, wy];
	}
	Player.prototype.isPlaying = function() {
		return this.playing;
	}
	Player.prototype.updateMouse = function(e) {
		this.handleInputEvent(new PlayerEvent(PlayerEvent.MouseMove, this.getMousePoint(e)));
	}
	Player.prototype.updateMouseDown = function(e) {
		this.handleInputEvent(new PlayerEvent(PlayerEvent.MouseDown, this.getMousePoint(e)));
	}
	Player.prototype.updateMouseUp = function(e) {
		this.handleInputEvent(new PlayerEvent(PlayerEvent.MouseUp, this.getMousePoint(e)));
	}
	Player.prototype.updateMouseLeave = function() {
		this.handleInputEvent(new PlayerEvent(PlayerEvent.MouseLeave));
	}
	Player.prototype.getInstanceCounter = function() {
		return this.instanceCounter;
	}
	Player.prototype.handleInputEvent = function(_event) {
		var player_event_handled = false;
		if (!this.isPlaying()) return;
		var event = this.input.processEvent(_event);
		if (!event) return false;
		this.mutateWithUpdateContext(function(context) {
			var clipEvent = null;
			switch (event.type) {
				case InputEvent.KeyDown:
					clipEvent = new ClipEvent(ClipEvent.KeyDown);
					break;
				case InputEvent.KeyUp:
					clipEvent = new ClipEvent(ClipEvent.KeyUp);
					break;
				case InputEvent.MouseDown:
					clipEvent = new ClipEvent(ClipEvent.MouseDown);
					break;
				case InputEvent.MouseUp:
					clipEvent = new ClipEvent(ClipEvent.MouseUp);
					break;
				case InputEvent.MouseMove:
					clipEvent = new ClipEvent(ClipEvent.MouseMove);
					break;
			}
			if (clipEvent) {
				if (context.stage.handleClipEvent(context, clipEvent)) {
					player_event_handled = true;
				}
			}
			switch (event.type) {
				case InputEvent.MouseDown:
				case InputEvent.MouseUp:
				case InputEvent.MouseMove:
					this.mousePosition.x = event.data[0] * 20;
					this.mousePosition.y = event.data[1] * 20;
					this.mutateWithUpdateContext(function(context) {
						Player.updateDrag(context);
					});
					break;
			}
			this.runActions(context);
		});
		this.mutateWithUpdateContext(function(context) {
			switch (event.type) {
				case InputEvent.MouseDown:
					this.mousePick(context, "down");
					break;
				case InputEvent.MouseUp:
					this.mousePick(context, "up");
					break;
				case InputEvent.MouseMove:
					this.mousePick(context, "move");
					break;
			}
		});
		return true;
	}
	Player.prototype.clipIsPlaying = function() {
		var clip = this.getRootClip();
		return clip ? clip.isPlaying : false;
	}
	Player.prototype.rootCurrentFrame = function() {
		var clip = this.getRootClip();
		return clip ? clip.currentFrame : 0;
	}
	Player.prototype.rootFramesloaded = function() {
		var clip = this.getRootClip();
		return clip ? clip.getFramesloaded() : 0;
	}
	Player.prototype.getTotalFrames = function() {
		var clip = this.getRootClip();
		return clip ? clip.getTotalFrames() : 0;
	}
	Player.prototype.addInstanceCounter = function() {
		return this.instanceCounter++;
	}
	Player.prototype.isActionScript3 = function() {
		return this.swf.isActionScript3();
	}
	Player.prototype.checkAVM2 = function() {
		var clip = this.getRootClip();
		if (clip) {
			return clip.staticData.abcTags.size > 0;
		} else {
			return false;
		}
	}
	Player.prototype.getDisplayTypes = function() {
		return Object.keys(this.swf.library.getDisplayTypes());
	}
	Player.prototype.getCompressSound = function() {
		var clip = this.getRootClip();
		var rootClipTag = clip.staticData;
		var characters = this.swf.library.getDisplays();
		var resultType = {};
		for (var i = 0; i < characters.length; i++) {
			var c = characters[i];
			var data = c.data;
			switch(c.displayType) {
				case "Sound":
					resultType[data.format.compression] = true;
					break;
				case "MovieClip":
					var audioStreamInfo = data.audioStreamInfo;
					if (audioStreamInfo) {
						var compression = audioStreamInfo.stream.compression;
						if (compression != "uncompressedUnknownEndian") {
							resultType[compression] = true;
						}
					}
					break;
			}
		}
		var audioStreamInfo = rootClipTag.audioStreamInfo;
		if (audioStreamInfo) {
			var compression = audioStreamInfo.stream.compression;
			if (compression != "uncompressedUnknownEndian") {
				resultType[compression] = true;
			}
		}
		return Object.keys(resultType);
	}
	Player.prototype.getCompressVideo = function() {
		var characters = this.swf.library.getDisplays();
		var resultType = {};
		for (var i = 0; i < characters.length; i++) {
			var c = characters[i];
			var data = c.data;
			if (c.displayType == "Video") {
				resultType[data.data.codec] = true;
			}
		}
		return Object.keys(resultType);
	}
	Player.prototype.getRootClip = function() {
		return this.stage.getRootClip();
	}
	Player.prototype.getDebugVideoText = function() {
		var clip = this.getRootClip();
		if (!clip) return "";
		var resultTypes = this.getChildTypes(clip);
		var result = [];
		for (var i = 0; i < resultTypes.length; i++) {
			var r = resultTypes[i];
			if (r.displayType == "Video") {
				result.push(r);
			}
		}
		var txt = "";
		for (var i = 0; i < result.length; i++) {
			var r = result[i];
			txt += r.getDebugVideoText();
			if (i != (result.length - 1)) {
				txt += ", ";
			}
		}
		return txt;
	}
	Player.prototype.getScaleBoundsText = function() {
		var scaleW = this._width / 640;
		var scaleH = this._height / 360;
		var scale = Math.min(Math.abs(scaleW), Math.abs(scaleH)) * this.scale;
		return (this.renderScaleType == 1) ? 1 : scale;
	}
	Player.prototype.getRectStage = function() {
		var _movieCanvas = this.canvas;
		var w, h;
		var x = 0, y = 0;
		var __Width = this._width;
		var __Height = this._height;
		if (this.renderScaleType) {
			w = _movieCanvas.width;
			h = _movieCanvas.height;
			x = 0;
			y = 0;
		} else {
			if ((__Height - (_movieCanvas.height * (__Width / _movieCanvas.width))) < 0) {
				w = (_movieCanvas.width * (__Height / _movieCanvas.height));
				h = (_movieCanvas.height * (__Height / _movieCanvas.height));
				x = (__Width - w) / 2;
			} else {
				w = (_movieCanvas.width * (__Width / _movieCanvas.width));
				h = (_movieCanvas.height * (__Width / _movieCanvas.width));
				y = (__Height - h) / 2;
			}	
		}
		return [x, y, w, h];
	}
	Player.prototype.getPlayingAudioCount = function() {
		return this.audio.getPlayingAudioCount();
	}
	Player.prototype.stopAllSounds = function() {
		this.mutateWithUpdateContext(function(context) {
			context.stopAllSounds();
		});
	}
	Player.prototype.getScaleRender = function() {
		var tx = 0;
		var ty = 0;
		var scaleX;
		var scaleY;
		var r = this.getRectStage();
		var a = r[2];
		var b = r[3];
		var c = 0;
		var d = 0;
		if (this.renderScaleType == 2) {
			scaleX = (this.canvas.width / this.width);
			scaleY = (this.canvas.height / this.height);
			a = this.width;
			b = this.height;
			c = (this._width / this.width);
			d = (this._height / this.height);
			tx = 0;
			ty = 0;
		} else if (this.renderScaleType == 1) {
			scaleX = scaleY = 1;
			a = this.width;
			b = this.height;
			c = (this._width / this.canvas.width);
			d = (this._height / this.canvas.height);
			tx = ((this.canvas.width / 2) - (this.width / 2));
			ty = ((this.canvas.height / 2) - (this.height / 2));
		} else {
			scaleX = (this.canvas.width / this.width);
			scaleY = (this.canvas.height / this.height);
			c = 1;
			d = 1;
		}
		return [scaleX, scaleY, tx, ty, a, b, c, d];
	}
	Player.prototype.getTime = function() {
		return this.audio.getTime();
	}
	Player.prototype.tick = function() {
		if (this.time_offset == 0) this.time_offset = this.getTime();
		if (this.startTime == null) this.startTime = Date.now();
		if (this.playing) {
			var fd = Math.max(this.getTime() - this.time_offset, 0);
			while ((fd - this.last_time) >= 0) {
				this.last_time += 10;
				this.frame_accumulator += 10;
			}
			var frame_rate = this.frameRate;
			var frame_time = 1000 / frame_rate;
			var startTime = Date.now();
			var frame = 0;
			while ((((Date.now() - startTime) < 50) && (frame < 5)) && (this.frame_accumulator >= 0)) {
				this.runFrame();
				this.frame_accumulator -= frame_time;
				frame++;
			}
			var audioSkewTime = false;
			if (this.frame_accumulator >= 0) {
				this.frame_accumulator = 0;
				this.last_time = 0;
				this.time_offset = this.getTime();
				this.audioManager.audioSkewTime(this.audio, 0);
				audioSkewTime = true;
			}
			if (this.ui.mouseVisible()) {
				var tgs = this.cursor > 0;
				if (tgs) {
					this.canvas.style.cursor = "pointer";
				} else {
					this.canvas.style.cursor = "auto";
				}
			} else {
				this.canvas.style.cursor = "none";
			}
			this.update_timers(10);
			this.update(function() {});
			if (audioSkewTime) this.audio.resume();
			this.audio.tick();
		} else {
			this.last_time = 0;
			this.time_offset = this.getTime();
		}
		if (this.needsRender) {
			this.render();
		}
	}
	Player.prototype.mutateWithUpdateContext = function(callback) {
		var context = new UpdateContext({
			player: this,
			renderer: this.renderer,
			library: this.library,
			audio: this.audio,
			audioManager: this.audioManager,
			swf: this.swf,
			avm1: this.avm1,
			avm2: this.avm2,
			input: this.input,
			log: this.log,
			ui: this.ui,
			framePhase: this.framePhase,
			video: this.video,
			stage: this.stage,
			actionQueue: this.actionQueue,
			timers: this.timers,
			unbound_text_fields: this.unbound_text_fields,
			mousePosition: this.mousePosition
		});
		var ret = callback.call(this, context);
		return ret;
	}
	Player.prototype.update_timers = function(dt) {
		this.time_til_next_timer += dt;
		this.mutateWithUpdateContext(function(context) {
			this.timers.update_timers(context, dt)
		});
	}
	Player.prototype.gotoFrame = function(frame) {
		this.mutateWithUpdateContext(function(context) {
			var parent = this.getRootClip();
			if (parent) {
				parent.gotoFrame(context, frame, !parent.isPlaying);
			}
			this.runActions(context);
		});
	}
	Player.prototype.getChildrenTypes = function() {
		var clip = this.getRootClip();
		var types = [];
		var resultTypes = this.getChildTypes(clip);
		for (var i = 0; i < resultTypes.length; i++) {
			var c = resultTypes[i];
			types.push(c.displayType);
		}
		return types;
	}
	Player.prototype.getChildTypes = function(child) {
		var types = [];
		if (child.isContainer()) {
			var children = child.iterRenderList();
			for (var i = 0; i < children.length; i++) {
				var c = children[i];
				var resultTypes = this.getChildTypes(c);
				for (var l = 0; l < resultTypes.length; l++) {
					types.push(resultTypes[l]);
				}
			}
		}
		types.push(child);
		return types;
	}
	Player.prototype.mousePick = function(context, type) {
		var clip = this.getRootClip();
		if (clip) {
			var needsRender = false;
			if ((type == "move") && !this.mouseData.pressed) {
				var button = clip.mousePickAvm1(context, this.mousePosition, false);
				if (button) {
					if (this.mouseData.hovered !== button) {
						if (this.mouseData.hovered) {
							this.mouseData.hovered.eventDispatch(context, new ClipEvent(ClipEvent.RollOut));
							needsRender = true;
						}
						button.eventDispatch(context, new ClipEvent(ClipEvent.RollOver));
						needsRender = true;
						this.mouseData.hovered = button;
					}
					this.openCursor();
				} else {
					if (this.mouseData.hovered) {
						this.mouseData.hovered.eventDispatch(context, new ClipEvent(ClipEvent.RollOut));
						needsRender = true;
						this.mouseData.hovered = null;
					}
					this.closeCursor();
				}
			} else if (type == "down") {
				if (this.mouseData.hovered) {
					if (this.mouseData.hovered.AVM1_REMOVED) {
						this.mouseData.hovered = null;
						this.closeCursor();
					} else {
						this.mouseData.pressed = this.mouseData.hovered;
						this.mouseData.hovered = null;
						this.mouseData.pressed.eventDispatch(context, new ClipEvent(ClipEvent.Press));
						needsRender = true;
					}
				}
			} else if (type == "up") {
				if (this.mouseData.pressed) {
					if (this.mouseData.pressed.AVM1_REMOVED) {
						this.mouseData.pressed = null;
						this.mouseData.hovered = null;
						this.closeCursor();
					} else {
						this.mouseData.pressed.eventDispatch(context, new ClipEvent(ClipEvent.Release));
						needsRender = true;
						this.mouseData.hovered = this.mouseData.pressed;
						this.mouseData.pressed = null;
					}
				}
			}
			this.runActions(context);
			this.needsRender = needsRender;
		}
	}
	Player.prototype.preload = function(executionLimit) {
		return this.mutateWithUpdateContext(function(context) {
			var did_finish = true;
			var root = this.getRootClip();
			did_finish = root.preload(context, executionLimit);
			return did_finish;
		});
	}
	Player.prototype.debugInfo = function() {
		var result = "# Player Info\n";
		result += this.renderer.debugInfo() + "\n";
		var swfMetadata = this.getMetadata();
		if (swfMetadata) {
			result += "\n# Metadata\n";
			result += "width: " + swfMetadata.width + "\n";
			result += "height: " + swfMetadata.height + "\n";
			result += "frameRate: " + swfMetadata.frameRate + "\n";
			result += "numFrames: " + swfMetadata.numFrames + "\n";
			result += "swfVersion: " + swfMetadata.version + "\n";
			result += "backgroundColor: " + swfMetadata.backgroundColor + "\n";
			result += "isActionScript3: " + swfMetadata.isActionScript3 + "\n";
			result += "uncompressedLength: " + swfMetadata.uncompressedLength + "\n";
		}
		return result;
	}
	Player.prototype.getMetadata = function() {
		if (this.swf) {
			var version = this.swf.version;
			var width = this.swf.width;
			var height = this.swf.height;
			var frameRate = this.swf.frameRate;
			var numFrames = this.swf.numFrames;
			var backgroundColor = [255, 255, 255];
			var b = this.stage.getBackgroundColor();
			if (b) {
				backgroundColor[0] = b[0];
				backgroundColor[1] = b[1];
				backgroundColor[2] = b[2];	
			}
			return {
				backgroundColor,
				version,
				width,
				height,
				frameRate,
				numFrames,
				isActionScript3: this.swf.isActionScript3(),
				uncompressedLength: this.swf.uncompressedLength
			}
		} else {
			return null;
		}
	}
	Player.prototype.setRootMovie = function(movie) {
		this.swf = movie;
		var version = movie.version;
		var width = movie.width;
		var height = movie.height;
		var frameRate = movie.frameRate;
		log.log(`Loaded SWF version ${version}, resolution ${width}x${height} @ ${frameRate} FPS`);
		this.version = version;
		this.frameRate = frameRate;
		this.width = width;
		this.height = height;
		this.avm1.version = version;
		this.stage.setMovieSize(width, height);
		this.stage.setMovie(movie);
		this.mutateWithUpdateContext(function(context) {
			var root = MovieClip.playerRootMovie(null, movie);
			root.setIsRoot(true);
			root.postInstantiation(context, null, Instantiator.Movie, false);
			root.setDefaultRootName(context);
			this.stage.replaceAtDepth(context, root, 0);
		});
	}
	Player.prototype.runFrame = function() {
		this.update(function(context) {
			run_all_phases_avm2(context);
			this.avm1.runFrame(context);
			this.audioManager.updateSounds(context);
		});
		if (this.isActionScript3()) this.runVCam();
		this.needsRender = true;
	}
	Player.prototype.runVCam = function() {
		var _parent = this.getRootClip();
		if (this.vCamId) {
			var resultVcamId = null;
			var useScaleStage = false;
			try {
				resultVcamId = JSON.parse("[" + this.vCamId + "]");
			} catch(e) {
			}
			if (resultVcamId) {
				if (resultVcamId[0] == "USS") 
					useScaleStage = true;
				this.executeVCamById(_parent, resultVcamId, useScaleStage);
			}
		} else {
			_parent.applyMatrix(Matrix.IDENTITY);
			_parent.applyColorTransform([1, 1, 1, 1, 0, 0, 0, 0]);
		}
	}
	Player.prototype.update = function(func) {
		var rval = this.mutateWithUpdateContext(function(context) {
			var rval2 = func.call(this, context);
			this.runActions(context);
			return rval2;
		});
		return rval;
	}
	Player.prototype.executeVCamById = function(clip, idList, useScaleStage) {
		var children = clip.iterRenderList();
		var activeVCam = false;
		for (var i = 0; i < children.length; i++) {
			var mc = children[i];
			if (mc instanceof MovieClip) {
				if (idList.indexOf(mc.getId()) >= 0) {
					activeVCam = true;
					this.executeVCam(clip, mc, useScaleStage);
				} else {
					this.executeVCamById(mc, idList, useScaleStage);
				}
			}
		}
		if (clip.hasClipVCam) {
			if (!activeVCam) {
				console.log("DESACTIVE VCAM", clip);
				clip.hasClipVCam = false;
				clip.applyMatrix(Matrix.IDENTITY);
				clip.applyColorTransform([1, 1, 1, 1, 0, 0, 0, 0]);  
			}
		} else {
			if (activeVCam) {
				if (!clip.hasClipVCam) {
					console.log("ACTIVE VCAM v1.1", clip);
					clip.hasClipVCam = true;
				}
			}
		}
	}
	Player.prototype.executeVCam = function(_parent, vCam, useScaleStage) {
		if (vCam && (vCam instanceof MovieClip)) {
			var c = vCam.getColorTransform();
			vCam.setVisible(!!this.vCamShow);
			var bounds = vCam.getBounds();
			var camW = bounds.width / 20;
			var camH = bounds.height / 20;
			var sw = this.width;
			var sh = this.height;
			if (useScaleStage) {
				camW = sw;
				camH = sh;
			}
			var w = camW * vCam.getXScale();
			var h = camH * vCam.getYScale();
			var _scaleX = sw / w;
			var _scaleY = sh / h;
			var matrix = vCam.getMatrix().toArray();
			matrix[4] /= 20;
			matrix[5] /= 20;
			invertMat(matrix);
			scaleMat(matrix, vCam.getXScale(), vCam.getYScale());
			translateMat(matrix, (w / 2), (h / 2));
			scaleMat(matrix, _scaleX, _scaleY);
			matrix[4] *= 20;
			matrix[5] *= 20;
			_parent.applyMatrix(Matrix.fromArray(matrix));
			_parent.applyColorTransform([c[0], c[1], c[2], c[3], c[4], c[5], c[6], c[7]]);
		}
	}
	Player.prototype.runActions = function(context) {
		var actionInfo;
		while (actionInfo = this.actionQueue.popAction()) {
			if (!actionInfo.isUnload && (!actionInfo.clip.getMovie().isActionScript3() && (actionInfo.clip.AVM1_REMOVED || actionInfo.clip.AVM1_PENDING_REMOVAL))) {
				continue;
			}
			var action = actionInfo.action;
			switch (action.type) {
				case "normal":
				case "initialize":
					this.avm1.runStackFrameForAction(actionInfo.clip, "[Frame]", action.bytecode, context);
					break;
				case "construct":
					if (action.constructor) {
						var activation = Avm1Activation.fromNothing(context, Avm1ActivationIdentifier.root("[Construct]"), actionInfo.clip);
						var prototype = action.constructor.get("prototype", activation);
						if (prototype) {
							var object = actionInfo.clip.getObject();
							if (object.a == Avm1Value.Object) {
								object = object.b;
								object.defineValue("__proto__", prototype, new Avm1Attribute().dontEnum().dontDelete());
								for (var i = 0; i < action.events.length; i++) {
									var event = action.events[i];
									this.avm1.runStackFrameForAction(actionInfo.clip, "[Construct]", event, context);
								}
								action.constructor.constructOnExisting(activation, object, []);
							}
						}
					} else {
						for (var i = 0; i < action.events.length; i++) {
							var event = action.events[i];
							this.avm1.runStackFrameForAction(actionInfo.clip, "[Construct]", event, context);
						}
					}
					break;
				case "method":
					this.avm1.runStacFrameForMethod(actionInfo.clip, action.object, action.name, action.args, context);
					break;
			}
			this.avm1.clearStack();
		}
	}
	Player.prototype.resize = function(w, h) {
		this.needsRender = true;
		this._width = w;
		this._height = h;
		var scaleW = w / this.width;
		var scaleH = h / this.height;
		var scale = Math.min(Math.abs(scaleW), Math.abs(scaleH));
		var qScale = this.scale;
		var _w = this.renderScaleType ? w : Math.floor(this.width * scale);
		var _h = this.renderScaleType ? h : Math.floor(this.height * scale);
		this.renderer.resize(_w * qScale, _h * qScale);
		var rc = this.getRectStage();
		this.canvas.style.left = rc[0] + "px";
		this.canvas.style.top = rc[1] + "px";
		this.canvas.style.width = _w + "px";
		this.canvas.style.height = _h + "px";
		this.render();
	}
	Player.prototype.render = function() {
		var isR = this.renderType !== "bounds without render";
		var isB = (this.renderType == "bounds without render") || (this.renderType == "render with bounds");
		var backgroundColor = [255, 255, 255, 1];
		if (isR) {
			var b = this.stage.getBackgroundColor();
			if (b) {
				backgroundColor[0] = b[0];
				backgroundColor[1] = b[1];
				backgroundColor[2] = b[2];	
			}
		}
		var cacheDraws = [];
		var context = new RenderContext({
			library: this.library,
			renderer: this.renderer,
			commands: new CommandList(),
			transformStack: this.transformStack,
			debugTransformStack: this.debugTransformStack,
			cacheDraws,
			isOffscreen: false,
			useBitmapCache: this.useBitmapCache,
			stage: this.stage
		});
		var a = this.getScaleRender();
		this.stage.viewport_matrix.a = a[0];
		this.stage.viewport_matrix.d = a[1];
		this.stage.viewport_matrix.tx = a[2] * 20;
		this.stage.viewport_matrix.ty = a[3] * 20;
		if (isR) this.stage.render(context);
		if (isB) this.stage.debugRender(context, this);
		this.renderer.submitFrame(backgroundColor, context.commands, cacheDraws);
		this.needsRender = false;
	}
	Player.prototype.drawTextW = function(context, x, y, scal, txt) {
		var deviceFont = context.library.deviceFont;
		var renderer = context.renderer;
		var fontScale = deviceFont.scale / 1024;
		var sc = scal;
		var rrr = 0;
		for (var i = 0; i < txt.length; i++) {
			var glyph = deviceFont.getGlyphForChar(txt.charCodeAt(i));
			if (glyph) {
				var shapeHandle = glyph.getShapeHandle(renderer);
				context.transformStack.stackPush(new Transform(new Matrix(sc / fontScale, 0, 0, sc / fontScale, (x + (rrr * sc)), y + (40 * scal)), [1, 1, 1, 1, 0, 0, 0, 0]));
				context.commands.renderShape(shapeHandle, context.transformStack.getTransform());
				context.transformStack.stackPop();
				rrr += glyph.advance / 20;
			}
		}
	}
	Player.prototype.closeCursor = function() {
		this.cursor = 0;
	}
	Player.prototype.openCursor = function() {
		this.cursor = 1;
	}
	Player.prototype.destroy = function() {
		this.audio.pause();
		this.removeEventListeners();
		this.renderer.destroy();
	}
	Player.prototype.pause = function() {
		this.playing = false;
		this.audio.pause();
	}
	Player.prototype.resume = function() {
		this.playing = true;
		this.audio.resume();
	}
	Player.prototype.runMenu = function(menu) {
		this.mutateWithUpdateContext(function(context) {
			switch (menu) {
				case "play/stop":
					this.togglePlayRootMovie(context);
					break;
				case "loop":
					this.toggleLoopRootMovie();
					break;
				case "rewind":
					this.rewindRootMovie(context);
					break;
				case "forward":
					this.forwardRootMovie(context);
					break;
				case "back":
					this.backRootMovie(context);
					break;
				case "quality:low":
					context.stage.setQuality(context, new StageQuality(StageQuality.Low));
					break;
				case "quality:medium":
					context.stage.setQuality(context, new StageQuality(StageQuality.Medium));
					break;
				case "quality:high":
					context.stage.setQuality(context, new StageQuality(StageQuality.High));
					break;
			}
			this.runActions(context);
		});
	}
	Player.prototype.clipGetLoop = function() {
		var clip = this.getRootClip();
		if (clip) {
			return clip.isLoop;
		}
		return false;
	}
	Player.prototype.clipSetLoop = function(loop) {
		var clip = this.getRootClip();
		if (clip) {
			clip.isLoop = loop;
		}
	}
	Player.prototype.togglePlayRootMovie = function(context) {
		var clip = this.getRootClip();
		if (clip) {
			if (clip.isPlaying) {
				clip.stop(context);
			} else {
				clip.play(context);
			}
		}
	}
	Player.prototype.toggleLoopRootMovie = function() {
		var clip = this.getRootClip();
		if (clip) {
			clip.isLoop = !clip.isLoop;
		}
	}
	Player.prototype.rewindRootMovie = function(context) {
		var clip = this.getRootClip();
		this.needsRender = true;
		if (clip) {
			clip.gotoFrame(context, 1, true);
		}
	}
	Player.prototype.forwardRootMovie = function(context) {
		var clip = this.getRootClip();
		this.needsRender = true;
		if (clip) {
			clip.nextFrame(context);
		}
	}
	Player.prototype.backRootMovie = function(context) {
		var clip = this.getRootClip();
		this.needsRender = true;
		if (clip) {
			clip.prevFrame(context);
		}
	}
	function getByteText(byte) {
		if (byte >= 1000000) {
			return "" + (Math.floor(byte / 10000) / 100) + "MB";
		} else {
			if (byte >= 1000) {
				return "" + Math.floor(byte / 1000) + "KB";
			} else {
				return "" + byte + "B";
			}
		}
	}
	var ExecutionLimit = function(limit) {
		this.limit = limit;
	}
	ExecutionLimit.prototype.didOpsBreachLimit = function(context, g) {
		this.limit -= g;
		return this.limit < 0;
	}
	var Loader = function(file) {
		this.progressText = 'loading';
		this.swfFile = file;
		this.onload = null;
		this.onerror = null;
		this.onprogress = null;
		this.swfdecompress = null;
		this.aborted = false;
		this.audioContext = null;
		this.interval = null;
	}
	Loader.prototype.cancel = function() {
		if (this.swfdecompress) {
			this.swfdecompress.cancel();
			this.swfdecompress = null;
		}
		this.cancelInterval();
		this.onload = null;
		this.onerror = null;
		this.onprogress = null;
		this.aborted = true;
	}
	Loader.prototype.cancelInterval = function() {
		if (this.interval !== null) {
			clearInterval(this.interval);
			this.interval = null;
		}
	}
	Loader.prototype.emitProgress = function(fs, bytesLoaded, bytesTotal) {
		this.progressText = ((fs[0] > 0) ? 'Building Tags ' : 'Descompressing SWF ') + (getByteText(bytesLoaded) + " / " + getByteText(bytesTotal));
		if (this.onprogress) {
			this.onprogress(fs);
		}
	}
	Loader.prototype.loadSwfMovie = function(swfData, calllback) {
		var _this = this;
		var stage = new Player(this.audioContext);
		var swfdecompress = new SwfDecompress(swfData);
		swfdecompress.onprogress = function (fs) {
			var _ = swfdecompress.getProgress();
			_this.emitProgress([0, fs], _.bytesLoaded, _.bytesTotal);
		};
		swfdecompress.onload = function (result) {
			if (!_this.aborted) {
				var movie = SwfMovie.from(result);
				stage.setRootMovie(movie);
				_this.interval = setInterval(function() {
					var g = stage.preload(new ExecutionLimit(500000));
					if (g) {
						_this.cancelInterval();
						if (!_this.aborted) calllback(stage);
					} else {
						var root = stage.getRootClip();
						var l = root.getLoadedBytes();
						var r = root.getTotalBytes();
						_this.emitProgress([1, l / r], l, r);
					}
				}, 10);
			}
			_this.swfdecompress = null;
		};
		swfdecompress.onerror = function (e) {
			if (_this.onerror) {
				_this.onerror(e);
			}
		};
		_this.swfdecompress = swfdecompress;
		swfdecompress.load();
	}
	Loader.prototype.load = function() {
		var _this = this;
		var reader = new FileReader();
		reader.onload = function (e) {
			var data = new Uint8Array(e.target.result);
			_this.loadSwfMovie(data, function (stage) {
				if (_this.onload) {
					_this.onload(stage);
				}
			});
		};
		reader.readAsArrayBuffer(this.swfFile);
	}
	function getDuraction(num) {
		var txt = '';
		var _ms = Math.floor(num);
		var _mm = Math.floor(num / 60);
	
		var ms = _ms % 60;
		var mm = _mm % 60;
		var mh = Math.floor(num / 3600);
		if (_mm >= 60) {
			txt += '' + mh;
			txt += ':';
		}
		if ((mm >= 10) || (_ms < 600)) {
			txt += '' + mm;
		} else {
			txt += '0' + mm;
		}
		txt += ':';
		if (ms >= 10) {
			txt += '' + ms;
		} else {
			txt += '0' + ms;
		}
		return txt;
	}
	var Slot = function() {
		this._listeners = [];
	}
	Slot.prototype.subscribe = function(fn) {
		this._listeners.push(fn);
	}
	Slot.prototype.emit = function() {
		for (var listener of this._listeners) {
			listener.apply(null, arguments);
		}
	}
	function JPEGEncoder(quality) {var self = this;var fround = Math.round;var ffloor = Math.floor;var YTable = new Array(64);var UVTable = new Array(64);var fdtbl_Y = new Array(64);var fdtbl_UV = new Array(64);var YDC_HT;var UVDC_HT;var YAC_HT;var UVAC_HT;var bitcode = new Array(65535); var category = new Array(65535); var outputfDCTQuant = new Array(64); var DU = new Array(64); var byteout = []; var bytenew = 0; var bytepos = 7; var YDU = new Array(64); var UDU = new Array(64); var VDU = new Array(64); var clt = new Array(256); var RGB_YUV_TABLE = new Array(2048); var currentQuality; var ZigZag = [0, 1, 5, 6, 14, 15, 27, 28, 2, 4, 7, 13, 16, 26, 29, 42, 3, 8, 12, 17, 25, 30, 41, 43, 9, 11, 18, 24, 31, 40, 44, 53, 10, 19, 23, 32, 39, 45, 52, 54, 20, 22, 33, 38, 46, 51, 55, 60, 21, 34, 37, 47, 50, 56, 59, 61, 35, 36, 48, 49, 57, 58, 62, 63]; var std_dc_luminance_nrcodes = [0, 0, 1, 5, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0]; var std_dc_luminance_values = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]; var std_ac_luminance_nrcodes = [0, 0, 2, 1, 3, 3, 2, 4, 3, 5, 5, 4, 4, 0, 0, 1, 125]; var std_ac_luminance_values = [1, 2, 3, 0, 4, 17, 5, 18, 33, 49, 65, 6, 19, 81, 97, 7, 34, 113, 20, 50, 129, 145, 161, 8, 35, 66, 177, 193, 21, 82, 209, 240, 36, 51, 98, 114, 130, 9, 10, 22, 23, 24, 25, 26, 37, 38, 39, 40, 41, 42, 52, 53, 54, 55, 56, 57, 58, 67, 68, 69, 70, 71, 72, 73, 74, 83, 84, 85, 86, 87, 88, 89, 90, 99, 100, 101, 102, 103, 104, 105, 106, 115, 116, 117, 118, 119, 120, 121, 122, 131, 132, 133, 134, 135, 136, 137, 138, 146, 147, 148, 149, 150, 151, 152, 153, 154, 162, 163, 164, 165, 166, 167, 168, 169, 170, 178, 179, 180, 181, 182, 183, 184, 185, 186, 194, 195, 196, 197, 198, 199, 200, 201, 202, 210, 211, 212, 213, 214, 215, 216, 217, 218, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250]; var std_dc_chrominance_nrcodes = [0, 0, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0]; var std_dc_chrominance_values = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]; var std_ac_chrominance_nrcodes = [0, 0, 2, 1, 2, 4, 4, 3, 4, 7, 5, 4, 4, 0, 1, 2, 119]; var std_ac_chrominance_values = [0, 1, 2, 3, 17, 4, 5, 33, 49, 6, 18, 65, 81, 7, 97, 113, 19, 34, 50, 129, 8, 20, 66, 145, 161, 177, 193, 9, 35, 51, 82, 240, 21, 98, 114, 209, 10, 22, 36, 52, 225, 37, 241, 23, 24, 25, 26, 38, 39, 40, 41, 42, 53, 54, 55, 56, 57, 58, 67, 68, 69, 70, 71, 72, 73, 74, 83, 84, 85, 86, 87, 88, 89, 90, 99, 100, 101, 102, 103, 104, 105, 106, 115, 116, 117, 118, 119, 120, 121, 122, 130, 131, 132, 133, 134, 135, 136, 137, 138, 146, 147, 148, 149, 150, 151, 152, 153, 154, 162, 163, 164, 165, 166, 167, 168, 169, 170, 178, 179, 180, 181, 182, 183, 184, 185, 186, 194, 195, 196, 197, 198, 199, 200, 201, 202, 210, 211, 212, 213, 214, 215, 216, 217, 218, 226, 227, 228, 229, 230, 231, 232, 233, 234, 242, 243, 244, 245, 246, 247, 248, 249, 250]; function initQuantTables(sf) { var YQT = [16, 11, 10, 16, 24, 40, 51, 61, 12, 12, 14, 19, 26, 58, 60, 55, 14, 13, 16, 24, 40, 57, 69, 56, 14, 17, 22, 29, 51, 87, 80, 62, 18, 22, 37, 56, 68, 109, 103, 77, 24, 35, 55, 64, 81, 104, 113, 92, 49, 64, 78, 87, 103, 121, 120, 101, 72, 92, 95, 98, 112, 100, 103, 99]; for (var i = 0; i < 64; i++) { var t = ffloor((YQT[i] * sf + 50) / 100); if (t < 1) { t = 1 } else if (t > 255) { t = 255 } YTable[ZigZag[i]] = t } var UVQT = [17, 18, 24, 47, 99, 99, 99, 99, 18, 21, 26, 66, 99, 99, 99, 99, 24, 26, 56, 99, 99, 99, 99, 99, 47, 66, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99]; for (var j = 0; j < 64; j++) { var u = ffloor((UVQT[j] * sf + 50) / 100); if (u < 1) { u = 1 } else if (u > 255) { u = 255 } UVTable[ZigZag[j]] = u } var aasf = [1, 1.387039845, 1.306562965, 1.175875602, 1, .785694958, .5411961, .275899379]; var k = 0; for (var row = 0; row < 8; row++) { for (var col = 0; col < 8; col++) { fdtbl_Y[k] = 1 / (YTable[ZigZag[k]] * aasf[row] * aasf[col] * 8); fdtbl_UV[k] = 1 / (UVTable[ZigZag[k]] * aasf[row] * aasf[col] * 8); k++ } } } function computeHuffmanTbl(nrcodes, std_table) { var codevalue = 0; var pos_in_table = 0; var HT = new Array; for (var k = 1; k <= 16; k++) { for (var j = 1; j <= nrcodes[k]; j++) { HT[std_table[pos_in_table]] = []; HT[std_table[pos_in_table]][0] = codevalue; HT[std_table[pos_in_table]][1] = k; pos_in_table++; codevalue++ } codevalue *= 2 } return HT } function initHuffmanTbl() { YDC_HT = computeHuffmanTbl(std_dc_luminance_nrcodes, std_dc_luminance_values); UVDC_HT = computeHuffmanTbl(std_dc_chrominance_nrcodes, std_dc_chrominance_values); YAC_HT = computeHuffmanTbl(std_ac_luminance_nrcodes, std_ac_luminance_values); UVAC_HT = computeHuffmanTbl(std_ac_chrominance_nrcodes, std_ac_chrominance_values) } function initCategoryNumber() { var nrlower = 1; var nrupper = 2; for (var cat = 1; cat <= 15; cat++) { for (var nr = nrlower; nr < nrupper; nr++) { category[32767 + nr] = cat; bitcode[32767 + nr] = []; bitcode[32767 + nr][1] = cat; bitcode[32767 + nr][0] = nr } for (var nrneg = -(nrupper - 1); nrneg <= -nrlower; nrneg++) { category[32767 + nrneg] = cat; bitcode[32767 + nrneg] = []; bitcode[32767 + nrneg][1] = cat; bitcode[32767 + nrneg][0] = nrupper - 1 + nrneg } nrlower <<= 1; nrupper <<= 1 } } function initRGBYUVTable() { for (var i = 0; i < 256; i++) { RGB_YUV_TABLE[i] = 19595 * i; RGB_YUV_TABLE[i + 256 >> 0] = 38470 * i; RGB_YUV_TABLE[i + 512 >> 0] = 7471 * i + 32768; RGB_YUV_TABLE[i + 768 >> 0] = -11059 * i; RGB_YUV_TABLE[i + 1024 >> 0] = -21709 * i; RGB_YUV_TABLE[i + 1280 >> 0] = 32768 * i + 8421375; RGB_YUV_TABLE[i + 1536 >> 0] = -27439 * i; RGB_YUV_TABLE[i + 1792 >> 0] = -5329 * i } } function writeBits(bs) { var value = bs[0]; var posval = bs[1] - 1; while (posval >= 0) { if (value & 1 << posval) { bytenew |= 1 << bytepos } posval--; bytepos--; if (bytepos < 0) { if (bytenew == 255) { writeByte(255); writeByte(0) } else { writeByte(bytenew) } bytepos = 7; bytenew = 0 } } } function writeByte(value) { byteout.push(value) } function writeWord(value) { writeByte(value >> 8 & 255); writeByte(value & 255) } function fDCTQuant(data, fdtbl) { var d0, d1, d2, d3, d4, d5, d6, d7; var dataOff = 0; var i; var I8 = 8; var I64 = 64; for (i = 0; i < I8; ++i) { d0 = data[dataOff]; d1 = data[dataOff + 1]; d2 = data[dataOff + 2]; d3 = data[dataOff + 3]; d4 = data[dataOff + 4]; d5 = data[dataOff + 5]; d6 = data[dataOff + 6]; d7 = data[dataOff + 7]; var tmp0 = d0 + d7; var tmp7 = d0 - d7; var tmp1 = d1 + d6; var tmp6 = d1 - d6; var tmp2 = d2 + d5; var tmp5 = d2 - d5; var tmp3 = d3 + d4; var tmp4 = d3 - d4; var tmp10 = tmp0 + tmp3; var tmp13 = tmp0 - tmp3; var tmp11 = tmp1 + tmp2; var tmp12 = tmp1 - tmp2; data[dataOff] = tmp10 + tmp11; data[dataOff + 4] = tmp10 - tmp11; var z1 = (tmp12 + tmp13) * .707106781; data[dataOff + 2] = tmp13 + z1; data[dataOff + 6] = tmp13 - z1; tmp10 = tmp4 + tmp5; tmp11 = tmp5 + tmp6; tmp12 = tmp6 + tmp7; var z5 = (tmp10 - tmp12) * .382683433; var z2 = .5411961 * tmp10 + z5; var z4 = 1.306562965 * tmp12 + z5; var z3 = tmp11 * .707106781; var z11 = tmp7 + z3; var z13 = tmp7 - z3; data[dataOff + 5] = z13 + z2; data[dataOff + 3] = z13 - z2; data[dataOff + 1] = z11 + z4; data[dataOff + 7] = z11 - z4; dataOff += 8 } dataOff = 0; for (i = 0; i < I8; ++i) { d0 = data[dataOff]; d1 = data[dataOff + 8]; d2 = data[dataOff + 16]; d3 = data[dataOff + 24]; d4 = data[dataOff + 32]; d5 = data[dataOff + 40]; d6 = data[dataOff + 48]; d7 = data[dataOff + 56]; var tmp0p2 = d0 + d7; var tmp7p2 = d0 - d7; var tmp1p2 = d1 + d6; var tmp6p2 = d1 - d6; var tmp2p2 = d2 + d5; var tmp5p2 = d2 - d5; var tmp3p2 = d3 + d4; var tmp4p2 = d3 - d4; var tmp10p2 = tmp0p2 + tmp3p2; var tmp13p2 = tmp0p2 - tmp3p2; var tmp11p2 = tmp1p2 + tmp2p2; var tmp12p2 = tmp1p2 - tmp2p2; data[dataOff] = tmp10p2 + tmp11p2; data[dataOff + 32] = tmp10p2 - tmp11p2; var z1p2 = (tmp12p2 + tmp13p2) * .707106781; data[dataOff + 16] = tmp13p2 + z1p2; data[dataOff + 48] = tmp13p2 - z1p2; tmp10p2 = tmp4p2 + tmp5p2; tmp11p2 = tmp5p2 + tmp6p2; tmp12p2 = tmp6p2 + tmp7p2; var z5p2 = (tmp10p2 - tmp12p2) * .382683433; var z2p2 = .5411961 * tmp10p2 + z5p2; var z4p2 = 1.306562965 * tmp12p2 + z5p2; var z3p2 = tmp11p2 * .707106781; var z11p2 = tmp7p2 + z3p2; var z13p2 = tmp7p2 - z3p2; data[dataOff + 40] = z13p2 + z2p2; data[dataOff + 24] = z13p2 - z2p2; data[dataOff + 8] = z11p2 + z4p2; data[dataOff + 56] = z11p2 - z4p2; dataOff++ } var fDCTQuant; for (i = 0; i < I64; ++i) { fDCTQuant = data[i] * fdtbl[i]; outputfDCTQuant[i] = fDCTQuant > 0 ? fDCTQuant + .5 | 0 : fDCTQuant - .5 | 0 } return outputfDCTQuant } function writeAPP0() { writeWord(65504); writeWord(16); writeByte(74); writeByte(70); writeByte(73); writeByte(70); writeByte(0); writeByte(1); writeByte(1); writeByte(0); writeWord(1); writeWord(1); writeByte(0); writeByte(0) } function writeSOF0(width, height) { writeWord(65472); writeWord(17); writeByte(8); writeWord(height); writeWord(width); writeByte(3); writeByte(1); writeByte(17); writeByte(0); writeByte(2); writeByte(17); writeByte(1); writeByte(3); writeByte(17); writeByte(1) } function writeDQT() { writeWord(65499); writeWord(132); writeByte(0); for (var i = 0; i < 64; i++) { writeByte(YTable[i]) } writeByte(1); for (var j = 0; j < 64; j++) { writeByte(UVTable[j]) } } function writeDHT() { writeWord(65476); writeWord(418); writeByte(0); for (var i = 0; i < 16; i++) { writeByte(std_dc_luminance_nrcodes[i + 1]) } for (var j = 0; j <= 11; j++) { writeByte(std_dc_luminance_values[j]) } writeByte(16); for (var k = 0; k < 16; k++) { writeByte(std_ac_luminance_nrcodes[k + 1]) } for (var l = 0; l <= 161; l++) { writeByte(std_ac_luminance_values[l]) } writeByte(1); for (var m = 0; m < 16; m++) { writeByte(std_dc_chrominance_nrcodes[m + 1]) } for (var n = 0; n <= 11; n++) { writeByte(std_dc_chrominance_values[n]) } writeByte(17); for (var o = 0; o < 16; o++) { writeByte(std_ac_chrominance_nrcodes[o + 1]) } for (var p = 0; p <= 161; p++) { writeByte(std_ac_chrominance_values[p]) } } function writeSOS() { writeWord(65498); writeWord(12); writeByte(3); writeByte(1); writeByte(0); writeByte(2); writeByte(17); writeByte(3); writeByte(17); writeByte(0); writeByte(63); writeByte(0) } function processDU(CDU, fdtbl, DC, HTDC, HTAC) { var EOB = HTAC[0]; var M16zeroes = HTAC[240]; var pos; var I16 = 16; var I63 = 63; var I64 = 64; var DU_DCT = fDCTQuant(CDU, fdtbl); for (var j = 0; j < I64; ++j) { DU[ZigZag[j]] = DU_DCT[j] } var Diff = DU[0] - DC; DC = DU[0]; if (Diff == 0) { writeBits(HTDC[0]) } else { pos = 32767 + Diff; writeBits(HTDC[category[pos]]); writeBits(bitcode[pos]) } var end0pos = 63; for (; end0pos > 0 && DU[end0pos] == 0; end0pos--) {} if (end0pos == 0) { writeBits(EOB); return DC } var i = 1; var lng; while (i <= end0pos) { var startpos = i; for (; DU[i] == 0 && i <= end0pos; ++i) {} var nrzeroes = i - startpos; if (nrzeroes >= I16) { lng = nrzeroes >> 4; for (var nrmarker = 1; nrmarker <= lng; ++nrmarker) writeBits(M16zeroes); nrzeroes = nrzeroes & 15 } pos = 32767 + DU[i]; writeBits(HTAC[(nrzeroes << 4) + category[pos]]); writeBits(bitcode[pos]); i++ } if (end0pos != I63) { writeBits(EOB) } return DC } function initCharLookupTable() { var sfcc = String.fromCharCode; for (var i = 0; i < 256; i++) { clt[i] = sfcc(i) } } this.encode = function(image, quality) { if (quality) setQuality(quality); byteout = new Array; bytenew = 0; bytepos = 7; writeWord(65496); writeAPP0(); writeDQT(); writeSOF0(image.width, image.height); writeDHT(); writeSOS(); var DCY = 0; var DCU = 0; var DCV = 0; bytenew = 0; bytepos = 7; this.encode.displayName = "_encode_"; var imageData = image.data; var width = image.width; var height = image.height; var quadWidth = width * 4; var tripleWidth = width * 3; var x, y = 0; var r, g, b; var start, p, col, row, pos; while (y < height) { x = 0; while (x < quadWidth) { start = quadWidth * y + x; p = start; col = -1; row = 0; for (pos = 0; pos < 64; pos++) { row = pos >> 3; col = (pos & 7) * 4; p = start + row * quadWidth + col; if (y + row >= height) { p -= quadWidth * (y + 1 + row - height) } if (x + col >= quadWidth) { p -= x + col - quadWidth + 4 } r = imageData[p++]; g = imageData[p++]; b = imageData[p++]; YDU[pos] = (RGB_YUV_TABLE[r] + RGB_YUV_TABLE[g + 256 >> 0] + RGB_YUV_TABLE[b + 512 >> 0] >> 16) - 128; UDU[pos] = (RGB_YUV_TABLE[r + 768 >> 0] + RGB_YUV_TABLE[g + 1024 >> 0] + RGB_YUV_TABLE[b + 1280 >> 0] >> 16) - 128; VDU[pos] = (RGB_YUV_TABLE[r + 1280 >> 0] + RGB_YUV_TABLE[g + 1536 >> 0] + RGB_YUV_TABLE[b + 1792 >> 0] >> 16) - 128 } DCY = processDU(YDU, fdtbl_Y, DCY, YDC_HT, YAC_HT); DCU = processDU(UDU, fdtbl_UV, DCU, UVDC_HT, UVAC_HT); DCV = processDU(VDU, fdtbl_UV, DCV, UVDC_HT, UVAC_HT); x += 32 } y += 8 } if (bytepos >= 0) { var fillbits = []; fillbits[1] = bytepos + 1; fillbits[0] = (1 << bytepos + 1) - 1; writeBits(fillbits) } writeWord(65497); return new Uint8Array(byteout); } ; function setQuality(quality) { if (quality <= 0) { quality = 1 } if (quality > 100) { quality = 100 } if (currentQuality == quality) return; var sf = 0; if (quality < 50) { sf = Math.floor(5e3 / quality) } else { sf = Math.floor(200 - quality * 2) } initQuantTables(sf); currentQuality = quality } function init() { if (!quality) quality = 50; initCharLookupTable(); initHuffmanTbl(); initCategoryNumber(); initRGBYUVTable(); setQuality(quality); } init() }
	function jpeg_encode(imgData, qu) {if (typeof qu === "undefined")qu = 50;var encoder = new JPEGEncoder(qu);var data = encoder.encode(imgData, qu);return {data: data,width: imgData.width,height: imgData.height}}
	var ScreenCap = function() {
		this.canvas = document.createElement("canvas");
		this.ctx = this.canvas.getContext("2d");
	}
	ScreenCap.prototype.scanWithJPEG = function(image, width, height) {
		this.canvas.width = width || image.width;
		this.canvas.height = height || image.height;
		this.ctx.drawImage(image, 0, 0, this.canvas.width, this.canvas.height);
		var imgData = this.ctx.getImageData(0, 0, this.canvas.width, this.canvas.height);
		var result = jpeg_encode(imgData, 100);
		return result.data;
	}
	var LoaderSwfUrl = function(url, callback, callback2) {
		this.url = url;
		this.callback = callback;
		this.callback2 = callback2;
	}
	LoaderSwfUrl.prototype.cancel = function() {
		this.callback = null;
		this.callback2 = null;
	}
	LoaderSwfUrl.prototype.fetchSwfMd5 = function(md5, callback, callbackProgress) {
		var xhr = new XMLHttpRequest();
		xhr.onload = function () {
			if (xhr.status == 200) {
				callback(new Uint8Array(xhr.response, 0x2c));
			} else {
				callback(null, xhr.status);
			}
		};
		xhr.onprogress = function (e) {
			if (callbackProgress) callbackProgress(e.loaded / e.total, e.loaded, e.total);
		};
		xhr.onerror = function () {
			callback(null, "");
		};
		xhr.responseType = "arraybuffer";
		xhr.open("GET", "https://assets.scratch.mit.edu/internalapi/asset/" + md5 + ".wav/get/");
		xhr.send();
	}
	LoaderSwfUrl.prototype.fetchSwfUrl = function(url, callback, callbackProgress) {
		var _this = this;
		if (Array.isArray(url)) {
			var result = [];
			var id_md5 = 0;
			function _excgfd() {
				if (result.length > 1) {
					var len = 0;
					for (var i = 0; i < result.length; i++) {
						len += result[i].length;
					}
					var res = new Uint8Array(len);
					var offest = 0;
					for (var i = 0; i < result.length; i++) {
						res.set(result[i], offest);
						offest += result[i].length;
					}
					callback(new Blob([res]), null);
				} else {
					callback(new Blob([result[0]]), null);
				}
			}
			function _next() {
				_this.fetchSwfMd5(url[id_md5], function(res, status) {
					if (!res) {
						callback(null, "failed md5: " + status, "");
						return;
					}
					id_md5++;
					result.push(res);
					if (id_md5 >= url.length) {
						_excgfd();
					} else {
						_next();
					}
				}, function(_p, l, t) {
					if (callbackProgress) callbackProgress((id_md5 / url.length) + (_p / url.length), l, t);
				});
			}
			_next();
		} else {
			var xhr = new XMLHttpRequest();
			xhr.onload = function () {
				var dat = new Uint8Array(xhr.response);
				if (xhr.status !== 200) {
					log.log(url + " -> " + (xhr.statusText || xhr.status));
					var mh = "";
					try {
						if (dat.length < 125) {
							mh = new TextDecoder().decode(dat);
							log.log(mh);
						}
					} catch(e) {
					}
					callback(null, xhr.status, mh || xhr.statusText);
				} else {
					callback(new Blob([dat]), null);
				}
			};
			xhr.onprogress = function (e) {
				if (callbackProgress) callbackProgress(e.loaded / e.total, e.loaded, e.total);
			};
			xhr.onerror = function () {
				callback(null, "unknown");
			};
			xhr.responseType = "arraybuffer";
			xhr.open("GET", url);
			xhr.send();
		}
	}
	LoaderSwfUrl.prototype.load = function() {
		var _this = this;
		var url = this.url;
		this.fetchSwfUrl(url, function() {
			if (_this.callback) _this.callback.apply(null, arguments);
		}, function() {
			if (_this.callback2) _this.callback2.apply(null, arguments);
		});
	}
	var Waveform = function() {
		this.canvas = document.createElement("canvas");
		this.ctx = this.canvas.getContext("2d");
		this.canvas.style.background = '#000';
		this.width = 100;
		this.height = 40;
		this.canvas.width = this.width;
		this.canvas.height = this.height;
		this.waveform = new Float32Array(this.width * 4);
	}
	Waveform.prototype.render = function() {
		this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
		this.ctx.strokeStyle = "#fff";
		this.ctx.lineWidth = 1;
		this.ctx.beginPath();
		this.ctx.moveTo(0, (this.height * 0.25));
		for (var i = 0; i < this.width *2; i+=1) {
			var o = ((((i / (this.width*2)) * this.waveform.length) / 2) | 0) * 2;
			var l = this.waveform[o];
			this.ctx.lineTo(i/2, ((l * (this.height * 0.25)) + (this.height * 0.25)) | 0);
		}
		this.ctx.moveTo(0, (this.height * 0.75));
		for (var i = 0; i < this.width*2; i+=1) {
			var o = ((((i / (this.width*2)) * this.waveform.length) / 2) | 0) * 2;
			var l = this.waveform[o + 1];
			this.ctx.lineTo(i/2, ((l * (this.height * 0.25)) + (this.height * 0.75)) | 0);
		}
		this.ctx.stroke();
	}
	function urlToNameFile(url) {
		try {
			var j = url;
			var h = j.indexOf("?");
			var s = j.length;
			if (h >= 0) {
				s = h;
			}
			var o = s;
			while((s >= 0) && (j.charAt(s) != "/")) {
				s--;
			}
			return decodeURIComponent(j.slice(s + 1, o));
		} catch(e) {
			return null;
		}
	};
	(function() {
		var css = `.pinkfie-root{
  position: relative;
  width: 100%;
  height: 100%;
}
.pinkfie-root > * {
  position: absolute;
  left: 0;
  top: 0;
  transform: translateZ(0);
}

.watcher-pinkfie-stats {
  background-color: #222;
  padding: 3px 5px;
  margin: 3px;
  height: auto;
  border: 2px solid #444;
  border-radius: 6px;
  font-size: 12px;
}

.watcher-pinkfie-menu-vertical {
  background-color: #222;
  border-radius: 8px;
  border: 2px solid #444;
  padding: 1px;
}
.watcher-pinkfie-menu-vertical div {
  border-radius: 4px;
  padding: 1px;
  margin: 0px;
  color: #ccc;
}
.watcher-pinkfie-menu-vertical div:hover {
  cursor: pointer;
  background-color: #ccc;
  color: #222;
}
.watcher-pinkfie-setting {
  background: #222;
  color: #ccc;
  border: 2px solid #444;
  border-radius: 8px;
}
.watcher-pinkfie-setting a {
  color: #ccc;
  cursor: pointer;
  text-decoration: underline;
  transition: 0s;
}
.watcher-pinkfie-setting a:hover{
  text-shadow: 0px 0px 2px rgba(255, 255, 255, 1), 0px 0px 2px rgba(255, 255, 255, 1), 0px 0px 2px rgba(255, 255, 255, 1), 0px 0px 2px rgba(255, 255, 255, 1);
}

/* Player Styles */
.pinkfie-player-root{
  font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
}
.pinkfie-player-stage{
	position: relative;
}

/* Player Fullscreen */
.pinkfie-player-root[fullscreen] {
  position: absolute;
  top: 0;
  left: 0;
  background: #000;
  height: 100%;
  width: 100%;
}
.pinkfie-body-fullscreen {
  background: #000;
  overflow: hidden;
}

/* Player Click To Play */
.pinkfie-player-click-to-play-container {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
  pointer-events: all;
  background-color: rgba(0, 0, 0, 0.6);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
}
.pinkfie-player-click-to-play-icon {
  width: 160px;
  height: 160px;
  background-image: url(data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIxMTkuNzkzNzIiIGhlaWdodD0iMTE5Ljc5MzcyIiB2aWV3Qm94PSIwLDAsMTE5Ljc5MzcyLDExOS43OTM3MiI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTE4MC4xMDMxNCwtMTIwLjEwMzE0KSI+PGcgZGF0YS1wYXBlci1kYXRhPSJ7JnF1b3Q7aXNQYWludGluZ0xheWVyJnF1b3Q7OnRydWV9IiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9Im5vbnplcm8iIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSI2IiBzdHJva2UtbGluZWNhcD0iYnV0dCIgc3Ryb2tlLWxpbmVqb2luPSJtaXRlciIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2UtZGFzaGFycmF5PSIiIHN0cm9rZS1kYXNob2Zmc2V0PSIwIiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6IG5vcm1hbCI+PHBhdGggZD0iTTE4My4xMDMxNCwxODBjMCwtMzEuNDIzMjcgMjUuNDczNTksLTU2Ljg5Njg2IDU2Ljg5Njg2LC01Ni44OTY4NmMzMS40MjMyNywwIDU2Ljg5Njg2LDI1LjQ3MzU5IDU2Ljg5Njg2LDU2Ljg5Njg2YzAsMzEuNDIzMjcgLTI1LjQ3MzU5LDU2Ljg5Njg2IC01Ni44OTY4Niw1Ni44OTY4NmMtMzEuNDIzMjcsMCAtNTYuODk2ODYsLTI1LjQ3MzU5IC01Ni44OTY4NiwtNTYuODk2ODZ6Ii8+PHBhdGggZD0iTTIyNS43MTY3NywyMDMuNjA4NjZ2LTQ2Ljc0NTEzbDMzLjc2MDM3LDIzLjM3MjU3eiIvPjwvZz48L2c+PC9zdmc+);
  background-size: 160px 160px;
}

/* Player Loading */
.pinkfie-player-loading{
  position: relative;
  width: 100%;
  height: 100%;
  background: #0c0;
}
.pinkfie-player-loading-anim{
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, 40px); 
  color: #000;
}
.pinkfie-player-loading-image {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -60px);
  width: 320px;
  height: 84px;
  margin: auto;
  background-image: url(data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIyMTguMDk0NjUiIGhlaWdodD0iNTguMzk5NjQiIHZpZXdCb3g9IjAsMCwyMTguMDk0NjUsNTguMzk5NjQiPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMzAuODg4MjYsLTE1MC44MDAxOCkiPjxnIGRhdGEtcGFwZXItZGF0YT0ieyZxdW90O2lzUGFpbnRpbmdMYXllciZxdW90Ozp0cnVlfSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJub256ZXJvIiBzdHJva2Utd2lkdGg9IjgiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJtaXRlciIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2UtZGFzaGFycmF5PSIiIHN0cm9rZS1kYXNob2Zmc2V0PSIwIiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6IG5vcm1hbCI+PHBhdGggZD0iTTI2My4zMzg1LDIwNS4xNzk4NGwxMC44MjQ1MiwtNDYuMzAzNDZsMjcuMjAwMDgsLTAuMzIzOCIgc3Ryb2tlPSIjMDAzNmZmIi8+PHBhdGggZD0iTTI2OS42NzAxMSwxODAuODIyNmwyNC40OTQ0NCwwLjAzODEzIiBzdHJva2U9IiMwMDM2ZmYiLz48cGF0aCBkPSJNMTg5LjM5MTQ0LDE1Ni4yOTY0NWwtOS45MDAwOSw0Ni43Mjg0MyIgc3Ryb2tlPSIjZTUwMGZmIi8+PHBhdGggZD0iTTE5Mi42ODQ4MSwyMDMuMzE1NTNsNi43MzIwNiwtMjcuNzIwMjYiIHN0cm9rZT0iI2U1MDBmZiIvPjxwYXRoIGQ9Ik0xOTcuNDM2ODYsMTg3LjA3OTM4YzAsMCA0LjI1NjMyLC0xMC4wMDc4NCAxMy4wOTE1MSwtOS42MTI4N2MxMC41MjA0MSwwLjMyODY5IDMuMTQ0NjQsMjYuNjQxMDMgMy4xNDQ2NCwyNi42NDEwMyIgc3Ryb2tlPSIjZTUwMGZmIi8+PHBhdGggZD0iTTMwMy43MzEzNSwyMDUuMTk5ODJsNS41NDQwNSwtMzQuOTczNjciIHN0cm9rZT0iIzAwMzZmZiIvPjxwYXRoIGQ9Ik0zNDMuMTY1MTQsMjAwLjM2NTExYzAsMCAtNC44NjczNCw1LjY5MDY5IC0xMi41ODcsNC4yNzk4N2MtOS4wMDk4MiwtMS42NDY2IC0xMC45NjA1MSwtOS40NjY4OCAtMTEuMDU1MjcsLTE1LjA1OTc1Yy0wLjEwNzk1LC02LjM3MTY5IDQuMDEyNDQsLTE1LjEyODQ2IDEzLjUwMTkyLC0xNS42ODAxNmM2Ljk2MTMzLC0wLjQwNDcyIDEyLjkyOTcsNS4zNDYyMyAxMS45ODg5MSwxMi44ODQzYy0wLjAzOTE4LDAuMzEzOTIgLTIzLjkxODg4LDAuOTE0NTEgLTIzLjkxODg4LDAuOTE0NTEiIHN0cm9rZT0iIzAwMzZmZiIvPjxnIHN0cm9rZT0iI2U1MDBmZiI+PHBhdGggZD0iTTEzNC44ODgyNiwyMDMuNjA4OWwxNS4wMTk1NSwtNDguNDM4MDYiLz48cGF0aCBkPSJNMTUyLjExNjU2LDE1NC44MDAxOGMwLDAgMjYuNzkzNDEsMS4xNzEyNCAyMi41ODkyMywxMi41MjM3M2MtNC4yMDQxOCwxMS4zNTI0OSAtMzAuMTYxMzEsNy45MjMwNiAtMzAuMTYxMzEsNy45MjMwNiIvPjwvZz48cGF0aCBkPSJNMjM1LjUwNjcxLDE1Ny41MTU3M2wtOS45MDAwOSw0Ni43Mjg0MyIgc3Ryb2tlPSIjZTUwMGZmIi8+PHBhdGggZD0iTTI0OS41MDE1NSwyMDQuMDQ1NjdsLTE3LjA3OTQ3LC0xNi45ODgyN2wyMi40OTg2LC0xMC42MDAyOSIgc3Ryb2tlPSIjZTUwMGZmIi8+PC9nPjwvZz48L3N2Zz4=);
  background-size: 320px 84px;
}
.pinkfie-player-loading-progress{
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, 65px);
  width: 150px;
  height: 10px;
  background-color: #000;
  border-radius: 10px;
}
.pinkfie-player-loading-progress div{
  position: absolute;
  top: 0%;
  left: 0%;
  width: 10%;
  height: 100%;
  background: #0f0;
  transition: 0.2s;
  border-radius: 10px;
}`;
		var s = document.createElement("style");
		s.innerText = css;
		document.head.appendChild(s);
	}());
	var PinkFiePlayer = function() {
		var _this = this;
		this.onload = new Slot();
		this.onstartload = new Slot();
		this.oncleanup = new Slot();
		this.onerror = new Slot();
		this.onprogress = new Slot();
		this.onresume = new Slot();
		this.onpause = new Slot();
		this.onoptionschange = new Slot();
		this.MAGIC = {
			LARGE_Z_INDEX: '9999999999',
		};
		this.scanned = new ScreenCap();
		this.stage = null;
		this.currentLoader = null;
		this.currentLoaderSwfUrl = null;
		this.fullscreenEnabled = false;
		this.clickToPlayContainer = null;
		this.width = 0;
		this.height = 0;
		this._width = 0;
		this._height = 0;
		this.root = document.createElement('div');
		this.root.className = 'pinkfie-player-root';
		this.playerContainer = document.createElement('div');
		this.playerContainer.className = 'pinkfie-player-stage';
		this.root.appendChild(this.playerContainer);
		this.options = {};
		this._viewFrame = false;
		this._displayMessage = [0, "", 0, 1500];
		this.mousePoint = [0, 0];
		this.tickTime = 0;
		this.swfTitle = null;
		this.swfUrl = null;
		this.swfData = null;
		this._quality = "";
		this.view_waveforn = new Waveform();
		this.addStatsControls();
		this.addNAS3();
		this.addloadingC();
		this.addMenuVerticals();
		this.addSettingVerticals();
		this.addControlVerticals();
		this.setOptions(object_assign({}, PinkFiePlayer.DEFAULT_OPTIONS));
		window.addEventListener('resize', function() {_this.updateFullscreen()});
		document.addEventListener('fullscreenchange', function() {_this.onfullscreenchange()});
		document.addEventListener('mozfullscreenchange', function() {_this.onfullscreenchange()});
		document.addEventListener('webkitfullscreenchange', function() {_this.onfullscreenchange()});
		document.addEventListener('contextmenu', function(e) {
			if (_this.stage) {
				if ((e.target === _this.stage.canvas) || (e.target === _this.clickToPlayContainer)) {
					e.preventDefault();
					_this.sendList(e);
				}
			} else {
				if (e.target === _this.loadingContainer) {
					e.preventDefault();
					_this.sendList(e);	
				}
			}
		});
		document.addEventListener('click', function(e) {
			_this.MenuVertical.style.display = 'none';
			_this.MenuVertical.style.opacity = '0';
		});
		this.handleError = this.handleError.bind(this);
		this.resize(640, 400);
		setInterval(this.tick.bind(this), 10);
	}
	PinkFiePlayer.version = "1.3.10";
	PinkFiePlayer.built = "2025-07-2";
	PinkFiePlayer.isBeta = false;
	PinkFiePlayer.prototype.addNAS3 = function() {
		this.nas3 = document.createElement('div');
		this.nas3.className = 'watcher-pinkfie-setting';
		this.nas3.style = '';
		this.nas3.style.display = 'none';
		this.nas3.style.overflow = 'auto';
		this.nas3.style.position = 'absolute';
		this.nas3.style.top = '0';
		this.nas3.style.left = '50%';
		this.nas3.style.padding = '6px';
		this.nas3.style.transform = 'translate(-50%, 0)';
		this.nas3.style.width = '90%';
		this.nas3.style.height = 'auto';
		this.nas3.style.textAlign = 'center';
		this.nas3.textContent = 'This SWF contains ActionScript 3 which is not yet supported by PinkFie. The movie may not work as intended.';
		this.playerContainer.appendChild(this.nas3);
	}
	PinkFiePlayer.prototype.menuSettingControls = function(visible) {
		for (var i = 0; i < this._controlsSettigs.length; i++) {
			this._controlsSettigs[i].style.display = visible ? "" : "none";
		}
	}
	PinkFiePlayer.prototype.addMenuVerticals = function() {
		this.MenuVertical = document.createElement('div');
		this.MenuVertical.className = 'watcher-pinkfie-menu-vertical';
		this.movie_playPause = this._createE('Pause', function(e) {
			e.preventDefault();
			this.toggleRunning();
			this.MenuVertical.style.display = 'none';
		});
		this.MenuVertical.appendChild(this.movie_playPause);
		var controlsMC = [];
		this.movie_playStop = this._createE('Stop', function(e) {
			e.preventDefault();
			this.c_playStop();
			this.MenuVertical.style.display = 'none';
		});
		this.movie_loopButton = this._createE('Loop: OFF', function(e) {
			e.preventDefault();
			this.c_loop();
			this.MenuVertical.style.display = 'none';
		});
		controlsMC.push(this.movie_playStop);
		controlsMC.push(this.movie_loopButton);
		controlsMC.push(this._createE('Rewind', function(e) {
			e.preventDefault();
			this.c_rewind();
			this.MenuVertical.style.display = 'none';
		}));
		controlsMC.push(this._createE('Step Forward', function(e) {
			e.preventDefault();
			this.c_Forward();
			this.MenuVertical.style.display = 'none';
		}));
		controlsMC.push(this._createE('Step Back', function(e) {
			e.preventDefault();
			this.c_Back();
			this.MenuVertical.style.display = 'none';
		}));
		for (var i = 0; i < controlsMC.length; i++) {
			this.MenuVertical.appendChild(controlsMC[i]);	
		}
		this._controlsMC = controlsMC;
		this.fullscreenButton = this._createE('Enter fullscreen', function(e) {
			e.preventDefault();
			this.fullscreen();
			this.MenuVertical.style.display = 'none';
		});
		this.MenuVertical.appendChild(this.fullscreenButton);
		var _ffdgdf2 = this._createE('Copy debug info', function(e) {
			e.preventDefault();
			this.copyDebugInfo();
		});
		this.__fdgdf = this._createE('Download SWF', function(e) {
			e.preventDefault();
			this.downloadSwf();
		});
		this.MenuVertical.appendChild(_ffdgdf2);
		this.MenuVertical.appendChild(this.__fdgdf);
		var ss = [];
		ss.push(this._createE('Controls', function(e) {
			e.preventDefault();
			this.showControls();
			this.MenuVertical.style.display = 'none';
		}));
		ss.push(this._createE('Settings', function(e) {
			e.preventDefault();
			this.showSetting();
			this.MenuVertical.style.display = 'none';
		}));
		for (var i = 0; i < ss.length; i++) {
			this.MenuVertical.appendChild(ss[i]);	
		}
		this._controlsSettigs = ss;
		this.MenuVertical.style.display = 'none';
		this.MenuVertical.style.opacity = '0';
		this.playerContainer.appendChild(this.MenuVertical);
	}
	PinkFiePlayer.prototype.addSettingVerticals = function() {
		var _this = this;
		this.settingVertical = document.createElement('div');
		this.settingVertical.className = 'watcher-pinkfie-setting';
		this.settingVertical.style = '';
		this.settingVertical.style.display = 'none';
		this.settingVertical.style.overflow = 'auto';
		this.settingVertical.style.position = 'absolute';
		this.settingVertical.style.top = '0';
		this.settingVertical.style.left = '50%';
		this.settingVertical.style.padding = '6px';
		this.settingVertical.style.transform = 'translate(-50%, 0)';
		this.settingVertical.style.width = '320px';
		this.settingVertical.style.height = 'auto';
		this.settingVertical.innerHTML = '<h3 style="margin:0;">Settings</h3>';
		var rrj2 = document.createElement('a');
		rrj2.onclick = function() {
			_this.settingVertical.style.display = 'none';
		};
		rrj2.style = '';
		rrj2.style.position = 'fixed';
		rrj2.style.display = 'block';
		rrj2.style.top = '0px';
		rrj2.style.right = '0px';
		rrj2.style["background-position"] = '50% 80%';
		rrj2.innerHTML = "[x]";
		var rrj5 = document.createElement('label');
		rrj5.innerHTML = "Render Mode: ";
		var rrj6 = document.createElement('select');
		rrj6.innerHTML = '<option value="render">render<option value="render with bounds">render with display bounds<option value="bounds without render">display bounds without render';
		rrj6.addEventListener("change", function() {
			if (rrj6.value) {
				_this.setOptions({
					rendermode: rrj6.value
				});
			}
		});
		this._rrj6 = rrj6;
		var kjhjhkh = document.createElement('label');
		kjhjhkh.innerHTML = "Render Scale Mode: ";
		var _kjhjhkh = document.createElement('select');
		_kjhjhkh.innerHTML = '<option value="0">Zoom to Fit<option value="2">Stretch to Fit<option value="1">Unscale (100%)';
		_kjhjhkh.addEventListener("change", function() {
			if (_kjhjhkh.value) {
				_this.setOptions({
					renderscalemode: +_kjhjhkh.value
				});
			}
		});
		this._kjhjhkh = _kjhjhkh;
		var rrj7 = document.createElement('label');
		rrj7.innerHTML = "Quality: ";
		var rrj8 = document.createElement('select');
		rrj8.innerHTML = '<option value="high">high<option value="medium">medium<option value="low">low';
		rrj8.addEventListener("change", function() {
			if (rrj8.value) {
				_this.setOptions({
					quality: rrj8.value
				});
				_this._quality = rrj6.value;
			}
		});
		this.__rrj8 = rrj8;
		var rrjhg7 = document.createElement('label');
		rrjhg7.innerHTML = "VCAM: ";
		var rrj9 = document.createElement('input');
		rrj9.type = 'text';
		rrj9.style.width = "80px";
		rrj9.placeholder = "(sprite id)";
		rrj9.addEventListener("change", function() {
			if (rrj9.value) {
				_this.setOptions({
					vCamId: rrj9.value
				});
			}
		});
		this.__rrj9 = rrj9;
		this.settingVertical.appendChild(rrj2);
		this.settingVertical.appendChild(rrj7);
		this.settingVertical.appendChild(rrj8);
		this.settingVertical.appendChild(rrjhg7);
		this.settingVertical.appendChild(rrj9);
		this.settingVertical.appendChild(document.createElement('br'));
		this.settingVertical.appendChild(rrj5);
		this.settingVertical.appendChild(rrj6);
		this.settingVertical.appendChild(document.createElement('br'));
		this.settingVertical.appendChild(kjhjhkh);
		this.settingVertical.appendChild(_kjhjhkh);
		this.settingVertical.appendChild(document.createElement('br'));
		var rrjhg8 = document.createElement('label');
		rrjhg8.innerHTML = "Enable Bitmap Cache: ";
		this.settingVertical.appendChild(rrjhg8);
		var rrjhg9 = document.createElement('input');
		rrjhg9.type = 'checkbox';
		rrjhg9.addEventListener('click', function(e) {
			_this.setOptions({
				useBitmapCache: e.target.checked
			});
		});
		this.__rrjhg9 = rrjhg9;
		this.settingVertical.appendChild(rrjhg9);
		this.playerContainer.appendChild(this.settingVertical);
	}
	PinkFiePlayer.prototype.addControlVerticals = function() {
		var _this = this;
		this.controlVertical = document.createElement('div');
		this.controlVertical.className = 'watcher-pinkfie-setting';
		this.controlVertical.style = '';
		this.controlVertical.style.display = 'none';
		this.controlVertical.style.overflow = 'auto';
		this.controlVertical.style.position = 'absolute';
		this.controlVertical.style.bottom = '0';
		this.controlVertical.style.left = '50%';
		this.controlVertical.style.padding = '6px';
		this.controlVertical.style.transform = 'translate(-50%, 0)';
		this.controlVertical.style.width = '320px';
		this.controlVertical.style.height = 'auto';
		this.controlVertical.innerHTML = '<h3 style="margin:0;">Controls</h3>';
		var rrj2 = document.createElement('a');
		rrj2.onclick = function() {
			_this.controlVertical.style.display = 'none';
		};
		rrj2.style = '';
		rrj2.style.position = 'fixed';
		rrj2.style.display = 'block';
		rrj2.style.top = '0px';
		rrj2.style.right = '0px';
		rrj2.style["background-position"] = '50% 80%';
		rrj2.innerHTML = "[x]";
		var rrj3 = document.createElement('label');
		rrj3.innerHTML = "volume:";
		var rrj4 = document.createElement('input');
		rrj4.type = "range";
		rrj4.style.width = "80px";
		rrj4.value = 100;
		rrj4.max = 100;
		rrj4.min = 0;
		rrj4.addEventListener('input', function() {
			_this.setVolume(rrj4.value);
		});
		this._rrj4 = rrj4;

		var _fdfj = document.createElement('div');
		var fdfj = document.createElement('input');
		fdfj.style.width = "180px";
		fdfj.type = 'range';
		fdfj.value = 1;
		fdfj.min = 1;
		fdfj.max = 2;
		fdfj.addEventListener("input", function() {
			if (fdfj.value && _this.stage) {
				_this.stage.gotoFrame(+fdfj.value);
			}
		});
		this.__fdfj = fdfj;
		var a = document.createElement("label");
		a.innerHTML = 'Frame';
		var a2 = document.createElement("label");
		a2.innerHTML = '1/1';
		this.__a2 = a2;
		_fdfj.appendChild(a);
		_fdfj.appendChild(fdfj);
		_fdfj.appendChild(a2);
		var di3 = document.createElement('a');
		di3.innerHTML = "View Stats";
		di3.style.margin = "4px";
		di3.onclick = this.viewStats.bind(this);
		this.__agdfdf = _fdfj;
		this.controlVertical.appendChild(rrj2);
		this.controlVertical.appendChild(rrj3);
		this.controlVertical.appendChild(rrj4);
		this.controlVertical.appendChild(di3);
		this.controlVertical.appendChild(document.createElement('br'));
		this.controlVertical.appendChild(_fdfj);
		var fdgdf2 = document.createElement("a");
		fdgdf2.innerHTML = "Stop Sounds";
		fdgdf2.style.margin = "4px";
		fdgdf2.onclick = function() {
			if (_this.stage) {
				_this.stage.stopAllSounds();
			}
		}
		this.controlVertical.appendChild(fdgdf2);
		var gfdfg = document.createElement("a");
		gfdfg.innerHTML = "Save Screenshot";
		gfdfg.style.margin = "4px";
		gfdfg.onclick = function() {
			_this.saveScreenshot();
		}
		this.controlVertical.appendChild(gfdfg);
		this.playerContainer.appendChild(this.controlVertical);
	}
	PinkFiePlayer.prototype.addStatsControls = function() {
		this.statsE = document.createElement("div");
		this.statsE.style.color = "#fff";
		this.statsE.style.position = "absolute";
		this.statsE.style.top = "0px";
		this.statsE.style.left = "0px";
		this.statsE.style.fontSize = "15px";
		this.statsE.style.display = "none";
		var r = document.createElement("div");
		r.className = "watcher-pinkfie-stats";
		r.style.display = "none";
		var r1 = document.createElement("div");
		var playpause = document.createElement("div");
		playpause.textContent = "Pause";
		playpause.className = "watcher-pinkfie-stats";
		playpause.style.display = "none";
		this.statsE_R = r;
		this.statsE_R1 = r1;
		r.appendChild(r1);
		r.appendChild(this.view_waveforn.canvas);
		this.statsE_PP = playpause;
		this.statsE.appendChild(playpause);
		this.statsE.appendChild(r);
		this.playerContainer.appendChild(this.statsE);
	}
	PinkFiePlayer.prototype.addloadingC = function() {
		var loadingContainer = document.createElement("div");
		loadingContainer.className = "pinkfie-player-loading";
		loadingContainer.innerHTML = '';
		var a1 = document.createElement("div");
		a1.className = 'pinkfie-player-loading-image';
		var a2 = document.createElement("div");
		a2.className = 'pinkfie-player-loading-anim';
		var a3 = document.createElement("div");
		a3.className = 'pinkfie-player-loading-progress';
		var a4 = document.createElement("div");
		a4.style.width = "0%";
		a3.appendChild(a4);
		loadingContainer.appendChild(a1);
		loadingContainer.appendChild(a2);
		loadingContainer.appendChild(a3);
		var rfg = document.createElement('p');
		rfg.textContent = "(c) 2025 Anim Tred";
		rfg.style.color = "#000";
		rfg.style.margin = "4px";
		rfg.style.position = "absolute";
		rfg.style.bottom = "0";
		rfg.style.left = "50%";
		rfg.style.transform = "translate(-50%,0)";
		loadingContainer.appendChild(rfg);
		loadingContainer.style.display = "none";
		this.loadingContainerProgress = a4;
		this.loadingContainerProgressText = a2;
		this.loadingContainer = loadingContainer;
		this.playerContainer.appendChild(this.loadingContainer);
	}
	PinkFiePlayer.prototype._createE = function(name, fun) {
		var MVG1 = document.createElement('div');
		MVG1.textContent = name;
		MVG1.onclick = fun.bind(this);
		return MVG1;
	}
	PinkFiePlayer.prototype.sendList = function(event) {
		var rect = this.playerContainer.getBoundingClientRect();
		this.showMenuVertical(event.clientX - rect.left, event.clientY - rect.top);
	}
	PinkFiePlayer.prototype.showMenuVertical = function(x, y) {
		var totalframes = this.stage ? (this.stage.rootFramesloaded() > 1) : 0;
		for (var i = 0; i < this._controlsMC.length; i++) {
			this._controlsMC[i].style.display = totalframes ? "" : "none";
		}
		this.MenuVertical.style.display = '';
		this.MenuVertical.style.position = 'absolute';
		this.MenuVertical.style.left = x + 'px';
		this.MenuVertical.style.top = y + 'px';
		this.MenuVertical.style.height = 'auto';
		this.MenuVertical.style.opacity = '1';
	}
	PinkFiePlayer.prototype.getSwfName = function() {
		if (this.swfTitle) {
			var n = this.swfTitle.split(".");
			var j = n.pop();
			if (j !== "swf") {
				n.push(j);
			}
			return n.join(".");
		} else {
			return this.getSwfMetadataName();
		}
	}
	PinkFiePlayer.prototype.getSwfMetadataName = function() {
		var swf = this.stage.swf;
		return "pinkfie_" + swf.header.compression + "_" + swf.header.version + "_" + swf.header.uncompressedLength + "_fps" + swf.movieInfo.frameRate + "_frames" + swf.movieInfo.numFrames;
	}
	PinkFiePlayer.prototype.hasStage = function() {
		return !!this.stage;
	}
	PinkFiePlayer.prototype.getOptions = function() {
		return this.options;
	}
	PinkFiePlayer.prototype.takeScreenshotJPEG = function() {
		var _movieCanvas = this.stage.canvas;
		this.stage.render();
		return this.scanned.scanWithJPEG(_movieCanvas);
	}
	PinkFiePlayer.prototype.saveScreenshot = function() {
		if (!this.hasStage()) return;
		var j = this.getSwfMetadataName();
		var _j = this.takeScreenshotJPEG();
		var _h = new Blob([_j]);
		var a = document.createElement("a");
		a.href = URL.createObjectURL(_h);
		a.download = j + ".jpg";
		a.click();
	}
	PinkFiePlayer.prototype.downloadSwf = function() {
		if (!this.swfData) return;
		var j = this.hasStage() ? this.getSwfName() : "swf_download";
		var h = URL.createObjectURL(this.swfData);
		var a = document.createElement("a");
		a.href = h;
		a.download = j + ".swf";
		a.click();
	}
	PinkFiePlayer.prototype.copyDebugInfo = function() {
		var text = this.debugInfo();
		if ("clipboard" in navigator) {
			navigator.clipboard.writeText(text);
		} else {
			console.log(text);
		}
	}
	PinkFiePlayer.prototype.debugInfo = function() {
		var text = "";
		if (this.hasStage()) {
			text += this.stage.debugInfo();
			text += "\n";
		}
		text += "# Page Info";
		text += "\nPage URL: " + window.location.href;
		if (this.swfUrl) {
			text += "\nSWF URL: " + this.swfUrl;
		}
		text += "\n";
		text += "\n# Browser Info";
		text += "\nUser Agent: " + navigator.userAgent;
		text += "\nHas touch support: " + hasTouchEvents + "\n";
		text += "\n# PinkFie Info";
		text += "\nVersion: " + this.version;
		text += "\nBuilt: " + this.built;
		return text;
	}
	PinkFiePlayer.prototype.isPlayMovie = function() {
		if (!this.hasStage()) return false;
		return this.stage.clipIsPlaying();
	}
	PinkFiePlayer.prototype.isLoopMovie = function() {
		if (!this.hasStage()) return false;
		return this.stage.clipGetLoop();
	}
	PinkFiePlayer.prototype.c_playStop = function() {
		if (!this.hasStage()) return;
		this.stage.runMenu("play/stop");
	}
	PinkFiePlayer.prototype.c_loop = function() {
		if (!this.hasStage()) return;
		this.stage.runMenu("loop");
	}
	PinkFiePlayer.prototype.c_rewind = function() {
		if (!this.hasStage()) return;
		this.stage.runMenu("rewind");
	}
	PinkFiePlayer.prototype.c_Forward = function() {
		if (!this.hasStage()) return;
		this.stage.runMenu("forward");
	}
	PinkFiePlayer.prototype.c_Back = function() {
		if (!this.hasStage()) return;
		this.stage.runMenu("back");
	}
	PinkFiePlayer.prototype.setOptions = function(changedOptions) {
		this.options = object_assign(object_assign({}, this.options), changedOptions);
		if (this.hasStage()) {
			this.applyOptionsToStage();
		}
		this._rrj4.value = this.options.volume;
		if (this.__rrj8) {
			this.__rrj8.value = this.options.quality;
		}
		this._quality = this.options.quality;
		if (this.__rrj9) {
			this.__rrj9.value = this.options.vCamId;
		}
		this.__rrjhg9.checked = this.options.useBitmapCache;
		this.onoptionschange.emit(changedOptions);
	}
	PinkFiePlayer.prototype.viewStats = function() {
		if (this._viewFrame) {
			this._viewFrame = false;
		} else {
			this._viewFrame = true;
		}
	}
	PinkFiePlayer.prototype.showSetting = function() {
		this.settingVertical.style.display = '';
	}
	PinkFiePlayer.prototype.showControls = function() {
		this.controlVertical.style.display = '';
	}
	PinkFiePlayer.prototype.enableAttribute = function(name) {
		this.root.setAttribute(name, '');
	}
	PinkFiePlayer.prototype.disableAttribute = function(name) {
		this.root.removeAttribute(name);
	}
	PinkFiePlayer.prototype.setAttribute = function(name, enabled) {
		if (enabled) {
			this.enableAttribute(name);
		} else {
			this.disableAttribute(name);
		}
	}
	PinkFiePlayer.prototype.updateFullscreen = function() {
		if (!this.fullscreenEnabled) {
			this.applyResizeStage();
			return;
		}
		this._resize(window.innerWidth, window.innerHeight);
		this.root.style.paddingLeft = '0px';
		this.root.style.paddingTop = '0px';
	}
	PinkFiePlayer.prototype.onfullscreenchange = function() {
		if (typeof document.fullscreen === 'boolean' && document.fullscreen !== this.fullscreenEnabled) {
			this.exitFullscreen();
		} else if (typeof document.webkitIsFullScreen === 'boolean' && document.webkitIsFullScreen !== this.fullscreenEnabled) {
			this.exitFullscreen();
		}
	}
	PinkFiePlayer.prototype.enterFullscreen = function() {
		if (this.options.fullscreenMode === 'full') {
			if (this.root.requestFullScreenWithKeys) {
				this.root.requestFullScreenWithKeys();
			} else if (this.root.webkitRequestFullScreen) {
				this.root.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
			} else if (this.root.requestFullscreen) {
				this.root.requestFullscreen();
			}
		}
		document.body.classList.add('pinkfie-body-fullscreen');
		this.root.style.zIndex = this.MAGIC.LARGE_Z_INDEX;
		this.enableAttribute('fullscreen');
		this.fullscreenEnabled = true;
		this.updateFullscreen();
	}
	PinkFiePlayer.prototype.exitFullscreen = function() {
		this.disableAttribute('fullscreen');
		this.fullscreenEnabled = false;
		if (document.fullscreenElement === this.root || document.webkitFullscreenElement === this.root) {
			if (document.exitFullscreen) {
				document.exitFullscreen();
			} else if (document.mozCancelFullScreen) {
				document.mozCancelFullScreen();
			} else if (document.webkitCancelFullScreen) {
				document.webkitCancelFullScreen();
			} else if (document.webkitExitFullscreen) {
				document.webkitExitFullscreen();
			}
		}
		this.root.style.zIndex = '';
		document.body.classList.remove('pinkfie-body-fullscreen');
		this._resize(this.width, this.height);
	}
	PinkFiePlayer.prototype.handleError = function(error) {
		console.log(error);
		this.onerror.emit(error);
	}
	PinkFiePlayer.prototype.beginLoadingSWF = function() {
		this.cleanup();
		this.loadingContainer.style.display = "";
		this.onstartload.emit();
	}
	PinkFiePlayer.prototype.loadLoader = function(loader) {
		var _this = this;
		_this.currentLoaderSwfUrl = null;
		_this.currentLoader = loader;
		loader.onprogress = function (fs) {
			var r = fs[1];
			var r12 = (fs[0] + fs[1]) * 0.5;
			if (r > 1) r = 1;
			if (r < 0) r = 0;
			if (r12 > 1) r12 = 1;
			if (r12 < 0) r12 = 0;
			_this.onprogress.emit(r12);
			_this.loadingContainerProgressText.textContent = loader.progressText;
			_this.loadingContainerProgress.style.width = (r * 100) + "%";
		};
		loader.onload = function (stage) {
			_this.currentLoader = null;
			_this.loadingContainerProgress.style.width = "0%";
			_this.setStage(stage);
		};
		loader.onerror = function (e) {
			_this.handleError(e);
		};
		loader.load();
	}
	PinkFiePlayer.prototype.loadSwfFromFile = function(file) {
		this.beginLoadingSWF();
		this.loadingContainerProgressText.textContent = "Loading SWF Data";
		this.swfData = file;
		var loader = new Loader(file);
		this.loadLoader(loader);
	}
	PinkFiePlayer.prototype.loadSwfFromURL = function(url) {
		this.beginLoadingSWF();
		this.loadingContainerProgressText.textContent = "Loading SWF URL";
		var _this = this;
		var loaderC = new LoaderSwfUrl(url, function (file, status, message) {
			if (file) {
				_this.swfData = file;
				var loader = new Loader(file);
				_this.loadLoader(loader);
				if (!Array.isArray(url)) {
					_this.swfUrl = url;
					_this.swfTitle = urlToNameFile(url);
					_this.__fdgdf.style.display = "";
				}
			} else {
				_this.loadingContainerProgressText.textContent = "Failed to load SWF: " + status;
				_this.loadingContainerProgressText.title = message || "";
			}
		}, function(r, l, t) {
			_this.loadingContainerProgressText.textContent = "Loading SWF URL " + getByteText(l) + " / " + getByteText(t);
			_this.loadingContainerProgress.style.width = Math.round(r * 100) + "%";
		});
		this.currentLoaderSwfUrl = loaderC;
		loaderC.load();
	}
	PinkFiePlayer.prototype.fullscreen = function() {
		if (this.fullscreenEnabled) {
			this.fullscreenButton.textContent = "Enter fullscreen";
			this.exitFullscreen();
		} else {
			this.fullscreenButton.textContent = "Exit fullscreen";
			this.enterFullscreen();
		}
	}
	PinkFiePlayer.prototype.reload = function() {
		var swfData = this.swfData;
		if (swfData) {
			var swfTitle = this.swfTitle;
			var swfUrl = this.swfUrl;
			var a = this.__fdgdf.style.display;
			this.beginLoadingSWF();
			this.swfData = swfData;
			this.swfTitle = swfTitle;
			this.swfUrl = swfUrl;
			var loader = new Loader(swfData);
			this.__fdgdf.style.display = a;
			this.loadLoader(loader);	
		}
	}
	PinkFiePlayer.prototype.setStage = function(stage) {
		this.stage = stage;
		this.applyOptionsToStage();
		this.applyResizeStage();
		this.statsE.style.display = "";
		this.playerContainer.insertBefore(stage.root, this.playerContainer.childNodes[0]);
		this.loadingContainer.style.display = "none";
		this.applyAutoplayPolicy(this.options.autoplayPolicy);
		this.onload.emit(stage);
	}
	PinkFiePlayer.prototype.applyAutoplayPolicy = function(policy) {
		switch (policy) {
			case 'always':
				if (this.stage && this.stage.checkAVM2()) {
					this.showClickToPlayContainer();
				} else {
					this.triggerStartMovie();
				}
				break;
			case 'never': 
				this.showClickToPlayContainer();
				break;
		}
	}
	PinkFiePlayer.prototype.triggerStartMovie = function() {
		this.stage.resume();
		this.loadingContainer.style.display = "none";
		if (this.clickToPlayContainer) {
			this.removeClickToPlayContainer();
		}
	}
	PinkFiePlayer.prototype.showClickToPlayContainer = function() {
		var _this = this;
		if (!this.clickToPlayContainer) {
			if (this.stage && this.stage.checkAVM2()) {
				this.nas3.style.display = "";
			}
			this.clickToPlayContainer = document.createElement('div');
			this.clickToPlayContainer.className = 'pinkfie-player-click-to-play-container';
			this.clickToPlayContainer.onclick = function() {
				_this.removeClickToPlayContainer();
				_this.triggerStartMovie();
			};
			var content = document.createElement('div');
			content.className = 'pinkfie-player-click-to-play-icon';
			this.clickToPlayContainer.appendChild(content);
			this.stage.root.appendChild(this.clickToPlayContainer);
		}
	}
	PinkFiePlayer.prototype.removeClickToPlayContainer = function() {
		if (this.clickToPlayContainer) {
			this.stage.root.removeChild(this.clickToPlayContainer);
			this.nas3.style.display = "none";
			this.clickToPlayContainer = null;
		}
	}
	PinkFiePlayer.prototype.applyResizeStage = function() {
		if (this.stage) {
			this.stage.resize(this._width, this._height);
			var rc = this.stage.getRectStage();
			var XG = rc[0];
			var YG = rc[1];
			this.statsE.style.top = YG + "px";
			this.statsE.style.left = XG + "px";
		}
	}
	PinkFiePlayer.prototype.resize = function(w, h) {
		this.width = w;
		this.height = h;
		if (!this.fullscreenEnabled) {
			this._resize(w, h);
		}
	}
	PinkFiePlayer.prototype._resize = function(w, h) {
		this._width = w;
		this._height = h;
		this.playerContainer.style.width = w + "px";
		this.playerContainer.style.height = h + "px";
		this.applyResizeStage();
		this.render();
	}
	PinkFiePlayer.prototype.applyOptionsToStage = function() {
		if (this.stage) {
			this.stage.audio.setVolume(this.options.volume);
			this.stage.vCamId = this.options.vCamId;
			this.stage.vCamShow = this.options.vCamShow;
			this.stage.wth = this.options.wth;
			this.stage.clipSetLoop(!this.options.unloop);
			var renderDirty = false;
			var q = this.stage.getQuality();
			if (q != this.options.quality) {
				switch (this.options.quality) {
					case "low":
						this.stage.runMenu("quality:low");
						break;
					case "medium":
						this.stage.runMenu("quality:medium");
						break;
					case "high":
						this.stage.runMenu("quality:high");
						break;
				}
				this._quality = this.options.quality;
				renderDirty = true;
			}
			if (this.stage.renderType != this.options.rendermode) {
				this.stage.renderType = this.options.rendermode;
				renderDirty = true;
			}
			if (this.stage.renderScaleType != this.options.renderscalemode) {
				this.stage.renderScaleType = this.options.renderscalemode;
				renderDirty = true;
			}
			if (this.stage.useBitmapCache != this.options.useBitmapCache) {
				this.stage.useBitmapCache = this.options.useBitmapCache;
				renderDirty = true;
			}
			if (renderDirty) {
				this.applyResizeStage();
			}
		}
	}
	PinkFiePlayer.prototype.tick = function() {
		this.tickTime += 10;
		if (this.hasStage()) {
			var clip_current_frame = this.stage.rootCurrentFrame();
			var clip_total_frames = this.stage.getTotalFrames();
			if (clip_total_frames > 1) {
				this.__a2.textContent = clip_current_frame + "/" + clip_total_frames;
				this.__fdfj.min = 1;
				this.__fdfj.max = clip_total_frames;
				this.__fdfj.value = clip_current_frame;
				this.__agdfdf.style.display = '';
			} else {
				this.__agdfdf.style.display = 'none';
			}
			if (this.__rrj8) {
				var sq = this.stage.getQuality();
				if (sq != this._quality) {
					this.__rrj8.value = sq;
					this.setOptions({
						quality: sq
					});
				}
			}
		} else {
			this.__agdfdf.style.display = 'none';
		}
		if (this.hasStage()) {
			this.stage.tick(10);
			if (this.isPlayMovie()) this.movie_playStop.innerHTML = "Stop";
			else this.movie_playStop.innerHTML = "Play";
			if (this.isLoopMovie()) this.movie_loopButton.innerHTML = "Loop: ON";
			else this.movie_loopButton.innerHTML = "Loop: OFF";
			if (this._displayMessage[0] == 1) {
				if ((!this.stage.playing)) {
					this._displayMessage[2] = this.tickTime;
				}
				if (this.stage.playing) {
					this._displayMessage[1] = "Play";
				} else {
					this._displayMessage[1] = "Pause";
				}
			}
		}
		if (this.hasStage() && this.stage.playing) {
			this.movie_playPause.innerHTML = "Pause";
		} else {
			this.movie_playPause.innerHTML = "Resume";
		}
		this.render();
	}
	PinkFiePlayer.prototype.setVolume = function(val) {
		this.setOptions({ volume: val });
	}
	PinkFiePlayer.prototype.resume = function() {
		if (this.hasStage()) {
			if (this.clickToPlayContainer) {
				this.removeClickToPlayContainer();
			}
			this.stage.resume();
		}
	}
	PinkFiePlayer.prototype.pause = function() {
		if (this.hasStage()) {
			if (this.clickToPlayContainer) {
				this.removeClickToPlayContainer();
			}
			this.stage.pause();
		}
	}
	PinkFiePlayer.prototype.toggleRunning = function() {
		if (this.hasStage()) {
			this._displayMessage[0] = 1;
			if (this.stage.playing) {
				this.pause();
			} else {
				this.resume();
			}
		}
	}
	PinkFiePlayer.prototype.render = function() {
		if (this.hasStage()) {
			var rrgg = ((this.tickTime - this._displayMessage[2]) < this._displayMessage[3]);
			if (this._viewFrame && this.stage) {
				var clip_current_frame = this.stage.rootCurrentFrame();
				var clip_total_frames = this.stage.rootFramesloaded();
				var _r = getDuraction((clip_current_frame / clip_total_frames) * (clip_total_frames / this.stage.frameRate)) + "/" + getDuraction(clip_total_frames / this.stage.frameRate);
				var _u = clip_current_frame + "/" + clip_total_frames;
				var hkj = "Time: " + _r;
				hkj += "<br>Frame: " + _u;
				hkj += "<br>Playing Audio: " + this.stage.getPlayingAudioCount() + " " + this.stage.audio.debug_ms + "ms";
				var resultPlayingCompressSound = this.stage.audio.getPlayingCompressSound().join(" ");
				if (resultPlayingCompressSound && this.stage.playing) {
					hkj += "<br>" + resultPlayingCompressSound;
					this.view_waveforn.canvas.style.display = "";
					this.stage.audio.toWaveform(this.view_waveforn.waveform); 
					this.view_waveforn.render();
				} else {
					this.view_waveforn.canvas.style.display = "none";
				}
				var _gh = this.stage.getDebugVideoText();
				if (_gh) {
					hkj += "<br>Time Videos Codec:<br>" + _gh;
				}
				this.statsE_R.style.display = "";
				this.statsE_R1.innerHTML = hkj;
			} else {
				this.statsE_R.style.display = "none";
			}
			if ((this._displayMessage[0] && rrgg)) {
				var GSGGG = this._displayMessage[1];
				this.statsE_PP.textContent = GSGGG;
				this.statsE_PP.style.display = "inline-block";
			} else {
				if (this._displayMessage[0] !== 1) {
					if (this._displayMessage[0]) {
						if (this.clickToPlayContainer) {
							this._displayMessage[0] = 0;
						} else {
							this._displayMessage[0] = 1;
						}
					}
				}
				this.statsE_PP.style.display = "none";
			}
		}
	}
	PinkFiePlayer.prototype.cleanup = function() {
		if (this.fullscreenEnabled) {
			this.exitFullscreen();
		}
		this.swfTitle = null;
		this.swfUrl = null;
		this.swfData = null;
		this.__fdfj.min = 1;
		this.__fdfj.max = 2;
		this.__fdfj.value = 1;
		this.__fdgdf.style.display = "none";
		this.nas3.style.display = 'none';
		this.loadingContainer.style.display = "none";
		this.loadingContainerProgressText.textContent = "";
		this.loadingContainerProgressText.title = "";
		this.loadingContainerProgress.style.width = "0%";
		this.statsE.style.display = "none";
		this._displayMessage[0] = 0;
		this.__agdfdf.style.display = 'none';
		for (var i = 0; i < this._controlsMC.length; i++) {
			this._controlsMC[i].style.display = "none";
		}
		if (this.currentLoader) {
			this.currentLoader.cancel();
			this.currentLoader = null;
		}
		if (this.currentLoaderSwfUrl) {
			this.currentLoaderSwfUrl.cancel();
			this.currentLoaderSwfUrl = null;
		}
		if (this.clickToPlayContainer) {
			this.removeClickToPlayContainer();
		}
		if (this.stage) {
			this.stage.destroy();
			this.playerContainer.removeChild(this.stage.root);
			this.stage = null;
		}
		this.oncleanup.emit();
	}
	PinkFiePlayer.DEFAULT_OPTIONS = {
		autoplayPolicy: 'always',
		volume: 100,
		fullscreenMode: 'full',
		quality: "high",
		rendermode: "render",
		vCamId: 0,
		vCamShow: false,
		unloop: false,
		renderscalemode: 0,
		useBitmapCache: false
	}
	PinkFiePlayer.enableFlashObject = function(){var S=null,E=[];function t(e){E.push(e);var TS=new PinkFiePlayer();TS.resize(+e.width, +e.height);TS.loadSwfFromURL(e.src);var SA=[];for(var i=0;i<e.parentNode.children.length;i++){var o=e.parentNode.children[i];SA.push(o)};e.parentNode.insertBefore(TS.root, SA[SA.indexOf(e)]);e.remove()};function d(){var J=document.querySelectorAll('embed[src$=".swf"]');for(var p=0;p<J.length;p++){var o=J[p];if(E.indexOf(o)==-1&&o.src)if(o.type=='application/x-shockwave-flash')t(o)}};S=setInterval(d,100)}
	PinkFiePlayer.config = config;
	console.log("%c PinkFie %c v" + PinkFiePlayer.version + " %c", "color: #fff; background: #5f5f5f", "color: #fff; background: #4bc729", "");
	return PinkFiePlayer;
}());